{"meta":{"title":"ðŸ§ Peach","subtitle":"equne","description":"èœœæ¡ƒå­¦ä»£ç ","author":"equne","url":"https://equnee.github.io","root":"/"},"pages":[],"posts":[{"title":"IO - è¾“å…¥/è¾“å‡ºæµâ‘´_åˆ†ç±»","slug":"note/Basics/IO/IO_IO_1","date":"2023-05-09T17:19:01.932Z","updated":"2023-05-16T12:50:38.996Z","comments":true,"path":"note/Basics/IO/IO_IO_1/","link":"","permalink":"https://equnee.github.io/note/Basics/IO/IO_IO_1/","excerpt":"","text":"java.io - ç›®å½• æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºï¼šSystem æŽ§åˆ¶å°è¯»å†™ç±»ï¼šConsole æ–‡ä»¶åŸºæœ¬å¤„ç† æ–‡ä»¶æ“ä½œç±»ï¼šFile æ–‡ä»¶æœç´¢ç±»ï¼šFileFilterã€FilenameFilter æ–‡ä»¶ä»»æ„è¯»å†™ç±»ï¼šRandomAccessFile è¾“å…¥/è¾“å‡ºæµ è¾“å…¥/è¾“å‡ºæµ - åˆ†ç±» è¾“å…¥/è¾“å‡ºæµ - å®žçŽ°ç±» åºåˆ—åŒ–/ååºåˆ—åŒ– JavaæŠŠæ‰€æœ‰ä¼ ç»Ÿçš„æµç±»åž‹ï¼ˆç±»æˆ–æŠ½è±¡ç±»ï¼‰éƒ½æ”¾åœ¨ java.io åŒ…ä¸­ï¼Œä»¥å®žçŽ°è¾“å…¥/è¾“å‡ºåŠŸèƒ½ã€‚ ï¼ˆä¸€ï¼‰æµåˆ†ç±» Javaä¸­æŠŠä¸åŒçš„è¾“å…¥/è¾“å‡ºæºï¼ˆé”®ç›˜ã€æ–‡ä»¶ã€ç½‘ç»œè¿žæŽ¥ç­‰ï¼‰æŠ½è±¡è¡¨è¿°ä¸ºâ€œæµâ€ï¼ˆstreamï¼‰ï¼Œé€šè¿‡æµçš„æ–¹å¼å…è®¸Javaç¨‹åºä½¿ç”¨ç›¸åŒçš„æ–¹å¼æ¥è®¿é—®ä¸åŒçš„è¾“å…¥/è¾“å‡ºæºã€‚ %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR T([\"IOæµåˆ†ç±»\"]):::p T --> A([\"æŒ‰ç…§(è¯»/å†™)æ–¹å‘åˆ†ç±»\"]):::p T --> B([\"æŒ‰ç…§(è¯»/å†™)å­—èŠ‚æ•°å¤§å°åˆ†ç±»\"]):::b T --> C([\"æŒ‰ç…§æµçš„è§’è‰²åˆ†ç±»\"]):::g A -.-> |\"inï¼ˆè¯»å–ï¼‰\"| a(\"æ–‡ä»¶è¾“å…¥æµå­—èŠ‚åž‹æ–‡ä»¶è¾“å…¥æµå­—ç¬¦åž‹æ–‡ä»¶è¾“å…¥æµ\"):::lp A -.-> |\"outï¼ˆå†™å…¥ï¼‰\"| a2(\"æ–‡ä»¶è¾“å‡ºæµå­—èŠ‚åž‹æ–‡ä»¶è¾“å‡ºæµå­—ç¬¦åž‹æ–‡ä»¶è¾“å‡ºæµ\"):::lp B -.-> |\"1å­—èŠ‚\"| b(\"å­—èŠ‚åž‹æ–‡ä»¶æµï¼ˆäºŒè¿›åˆ¶å†…å®¹ï¼‰FileInputStreamFileOUtputStream\"):::lb B -.-> |\"1å­—ç¬¦ï¼ˆ2å­—èŠ‚ï¼‰\"| b2(\"å­—ç¬¦åž‹æ–‡ä»¶æµï¼ˆæ–‡æœ¬å†…å®¹ï¼‰FileReaderFileWriter\"):::lb C -.-> |\"ç›´æŽ¥è¿žæŽ¥åˆ°æ•°æ®æº\"| c(\"åº•å±‚èŠ‚ç‚¹æµï¼ˆä½Žçº§æµï¼‰\"):::lg C -.-> |\"å°è£…å·²å­˜åœ¨çš„æµ\"| c2(\"ä¸Šå±‚å¤„ç†æµï¼ˆé«˜çº§æµï¼‰\"):::lg classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆäºŒï¼‰æµæ¨¡åž‹ï¼ˆ1ï¼‰æµçš„åŸºæœ¬æ¦‚å¿µæ¨¡åž‹ 4ä¸ªæŠ½è±¡åŸºç±»ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph TD t([\"4ä¸ªæŠ½è±¡åŸºç±»\"]):::p t --> |\"è¾“å…¥æµ\"| A(\"InputStreanï¼ˆå­—èŠ‚è¾“å…¥æµï¼‰Readerï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰\"):::lp t --> |\"è¾“å‡ºæµ\"| B(\"OutputStreamï¼ˆå­—èŠ‚è¾“å‡ºæµï¼‰Writerï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰\"):::lp A -.-> a(\"æŠŠè¾“å…¥è®¾å¤‡æŠ½è±¡æˆâ€œæ°´ç®¡â€ï¼Œæ°´ç®¡é‡Œçš„æ¯ä¸ªâ€œæ°´æ»´â€ä¾æ¬¡æŽ’åˆ—\"):::info B -.-> b(\"æŠŠè¾“å‡ºè®¾å¤‡æŠ½è±¡æˆâ€œæ°´ç®¡â€ï¼Œæ°´ç®¡é‡Œæ²¡æœ‰ä»»ä½•æ°´æ»´\"):::info info(\"Java IOæµ40å¤šä¸ªç±»éƒ½ç”±å®ƒä»¬æ´¾ç”Ÿ\"):::info classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#56565b,stroke-dasharray: 3 3, stroke-width: 2px è¾“å…¥æµï¼š è¾“å…¥æµä½¿ç”¨éšå¼çš„è®°å½•æŒ‡é’ˆæ¥è¡¨ç¤ºå½“å‰æ­£å‡†å¤‡ä»Žå“ªä¸ªâ€œæ°´æ»´â€å¼€å§‹è¯»å–ï¼Œæ¯å½“ç¨‹åºä»ŽInputStreamæˆ–Readeré‡Œå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªâ€œæ°´æ»´â€åŽï¼Œè®°å½•æŒ‡é’ˆè‡ªåŠ¨å‘åŽç§»åŠ¨ã€‚ è¾“å‡ºæµï¼š å½“æ‰§è¡Œè¾“å‡ºæ—¶ï¼Œç¨‹åºç›¸å½“äºŽä¾æ¬¡æŠŠâ€œæ°´æ»´â€æ”¾å…¥åˆ°è¾“å‡ºæµçš„æ°´ç®¡ä¸­ï¼Œè¾“å‡ºæµåŒæ ·é‡‡ç”¨éšå¼çš„è®°å½•æŒ‡é’ˆæ¥æ ‡è¯†å½“å‰æ°´æ»´å³å°†æ”¾å…¥çš„ä½ç½®ï¼Œæ¯å½“ç¨‹åºå‘OutputStreamæˆ–Writeré‡Œè¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªæ°´æ»´åŽï¼Œè®°å½•æŒ‡é’ˆè‡ªåŠ¨å‘åŽç§»åŠ¨ã€‚ æ³¨ï¼šåˆ’åˆ†è¾“å…¥/è¾“å‡ºæµæ—¶æ˜¯ä»Žç¨‹åºè¿è¡Œæ‰€åœ¨å†…å­˜çš„è§’åº¦æ¥è€ƒè™‘çš„ï¼Œå› æ­¤ï¼ˆå†…å­˜ â€”&gt; ç¡¬ç›˜ï¼‰åº”è¯¥æ˜¯è¾“å‡ºæµã€‚ ï¼ˆ2ï¼‰å¤„ç†æµæ¨¡åž‹ èŠ‚ç‚¹æµå’Œå¤„ç†æµ ä½¿ç”¨èŠ‚ç‚¹æµï¼ˆä½Žçº§æµï¼‰è¿›è¡Œè¾“å…¥/è¾“å‡ºæ—¶ï¼Œç¨‹åºç›´æŽ¥è¿žæŽ¥åˆ°å®žé™…çš„æ•°æ®æºï¼Œå’Œå®žé™…çš„è¾“å…¥/è¾“å‡ºèŠ‚ç‚¹è¿žæŽ¥ã€‚ å¤„ç†æµï¼ˆé«˜çº§æµï¼‰å¯¹å·²å­˜åœ¨çš„æµè¿›è¡Œè¿žæŽ¥æˆ–å°è£…ï¼Œé€šè¿‡å°è£…åŽçš„æµæ¥å®žçŽ°æ•°æ®è¯»/å†™åŠŸèƒ½ã€‚ ä½¿ç”¨å¤„ç†æµæ¥åŒ…è£…èŠ‚ç‚¹æµï¼š ç¨‹åºé€šè¿‡å¤„ç†æµï¼ˆåˆç§°é«˜çº§æµã€åŒ…è£…æµã€è¿‡æ»¤æµï¼‰æ¥æ‰§è¡Œè¾“å…¥/è¾“å‡ºåŠŸèƒ½ï¼Œè®©èŠ‚ç‚¹æµä¸Žåº•å±‚çš„I/Oè®¾å¤‡ã€æ–‡ä»¶äº¤äº’ã€‚ï¼ˆå¤„ç†æµå¯â€œå«æŽ¥â€åœ¨ä»»ä½•å·²å­˜åœ¨çš„æµçš„åŸºç¡€ä¹‹ä¸Šï¼‰ ðŸ“Œ Javaä½¿ç”¨å¤„ç†æµæ¥åŒ…è£…èŠ‚ç‚¹æµæ˜¯ä¸€ç§å…¸åž‹çš„è£…é¥°å™¨è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡ä½¿ç”¨å¤„ç†æµæ¥åŒ…è£…ä¸åŒçš„èŠ‚ç‚¹æµï¼Œæ—¢å¯ä»¥æ¶ˆé™¤ä¸åŒèŠ‚ç‚¹æµçš„å®žçŽ°å·®å¼‚ï¼Œä¹Ÿå¯ä»¥æä¾›æ›´æ–¹ä¾¿çš„æ–¹æ³•æ¥å®Œæˆè¾“å…¥/è¾“å‡ºåŠŸèƒ½ã€‚å› æ­¤å¤„ç†æµä¹Ÿè¢«ç§°ä¸ºåŒ…è£…æµã€‚ ï¼ˆä¸‰ï¼‰æŠ½è±¡åŸºç±»ï¼ˆ1ï¼‰InputStream å’Œ Reader InputStreamåŒ…å«çš„3ä¸ªæ–¹æ³•ï¼š æ–¹æ³• è¯´æ˜Ž int read() ä»Žè¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—èŠ‚ï¼Œè¿”å›žæ‰€è¯»å–çš„å­—èŠ‚æ•°æ®ï¼ˆå­—èŠ‚æ•°æ®å¯ç›´æŽ¥è½¬æ¢ä¸ºintç±»åž‹ï¼‰ã€‚ int read(byte[] b) ä»Žè¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼ˆæœ€å¤šb.lengthä¸ªå­—èŠ‚ï¼‰ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å­—èŠ‚æ•°ç»„bä¸­ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ int read(byte[] b, int off, int len) ä»Žè¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼ˆæœ€å¤šlenä¸ªå­—èŠ‚ï¼‰ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æ•°ç»„bä¸­ï¼Œæ”¾å…¥æ•°ç»„bä¸­æ—¶ä»Žoffä½ç½®å¼€å§‹ï¼ˆå¹¶ä¸æ˜¯ä»Žæ•°ç»„èµ·ç‚¹å¼€å§‹ï¼‰ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ readeråŒ…å«çš„3ä¸ªæ–¹æ³•ï¼š æ–¹æ³• è¯´æ˜Ž int read() ä»Žè¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—ç¬¦ï¼Œè¿”å›žæ‰€è¯»å–çš„å­—ç¬¦æ•°æ®ï¼ˆå­—ç¬¦æ•°æ®å¯ç›´æŽ¥è½¬æ¢ä¸ºintç±»åž‹ï¼‰ã€‚ int read(char[] cbuf) ä»Žè¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼ˆæœ€å¤šcbuf.lengthä¸ªå­—ç¬¦ï¼‰ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å­—ç¬¦æ•°ç»„cbufä¸­ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—ç¬¦æ•°ã€‚ int read(char[] cbuf, int off, int len) ä»Žè¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼ˆæœ€å¤šlenä¸ªå­—ç¬¦ï¼‰ï¼Œå¹¶å°†å…¶å­˜åœ¨å­—ç¬¦æ•°ç»„cbufä¸­ï¼Œä»Žoffä½ç½®å¼€å§‹ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—ç¬¦æ•°ã€‚ æ¨¡åž‹ï¼š InputStream å’Œ Reader éƒ½æ˜¯å°†è¾“å…¥æ•°æ®æŠ½è±¡æˆå¦‚å›¾æ‰€ç¤ºçš„æ°´ç®¡ï¼š ä½¿ç”¨æ•°ç»„ä½œä¸º read() æ–¹æ³•çš„å‚æ•°æ—¶ï¼Œå¯ç†è§£ä¸ºä½¿ç”¨ä¸€ä¸ªâ€œç«¹ç­’â€åˆ°æ°´ç®¡ä¸­å–æ°´ã€‚ç›´åˆ° read(char[] cbuf) æˆ– read(byte[] b) æ–¹æ³•è¿”å›ž-1ï¼Œè¡¨æ˜Žåˆ°äº†è¾“å…¥æµçš„ç»“æŸç‚¹ã€‚ ï¼ˆ2ï¼‰OutputStream å’Œ Writer OutputStreamåŒ…å«çš„3ä¸ªæ–¹æ³•ï¼š æ–¹æ³• è¯´æ˜Ž void write(int c) å°†æŒ‡å®šçš„å­—èŠ‚/å­—ç¬¦cè¾“å‡ºåˆ°è¾“å‡ºæµä¸­ã€‚ int write(byte[]/char[] buf) å°†å­—èŠ‚æ•°ç»„/å­—ç¬¦æ•°ç»„ä¸­çš„æ•°æ®è¾“å‡ºåˆ°æŒ‡å®šè¾“å‡ºæµä¸­ã€‚ int write(byte[]/char[] buf, int off, int len) ä»Žè¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼ˆæœ€å¤šlenä¸ªå­—èŠ‚ï¼‰ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æ•°ç»„bä¸­ï¼Œæ”¾å…¥æ•°ç»„bä¸­æ—¶ä»Žoffä½ç½®å¼€å§‹ï¼ˆå¹¶ä¸æ˜¯ä»Žæ•°ç»„èµ·ç‚¹å¼€å§‹ï¼‰ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ WriteråŒ…å«çš„2ä¸ªæ–¹æ³•ï¼š Writerå¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥ä»£æ›¿å­—ç¬¦æ•°ç»„ï¼Œå³ä»¥Stringå¯¹è±¡ä½œä¸ºå‚æ•° æ–¹æ³• è¯´æ˜Ž int write(String str) å°†strå­—ç¬¦ä¸²é‡ŒåŒ…å«çš„å­—ç¬¦è¾“å‡ºåˆ°æŒ‡å®šè¾“å‡ºæµä¸­ã€‚ int write(String str, int off, int len) å°†strå­—ç¬¦ä¸²é‡Œä»Žoffä½ç½®å¼€å§‹ï¼Œé•¿åº¦ä¸ºlençš„å­—ç¬¦è¾“å‡ºåˆ°æŒ‡å®šè¾“å‡ºæµä¸­ã€‚ ï¼ˆå››ï¼‰*æµä½“ç³»ï¼ˆ1ï¼‰åˆ†ç±» åˆ†ç±» å­—èŠ‚è¾“å…¥æµ å­—èŠ‚è¾“å‡ºæµ å­—ç¬¦è¾“å…¥æµ å­—ç¬¦è¾“å‡ºæµ æŠ½è±¡ç±» InputStream OutputStream Reader Writer è½¬æ¢ç±» InputStream-Reader OutputStream-Writer ç¬¬ä¸€ç±»ï¼šæ•°æ®æºç±» æ–‡ä»¶ File-InputStream File-OutputStream FileReader FilerWriter æ•°ç»„ ByteArray-InputStream ByteArray-OutputStream CharArray-Reader CharArray-Writer å¯¹è±¡ Object-InputStream Object-OutputStream å­—ç¬¦ä¸² StringBuffer-InputStream StringReader StringWriter ç¬¬äºŒç±»ï¼šæ•°æ®æµä¸²è”ç±» ç®¡é“ Pipe-InputStream Pipe-OutputStream PipeReader PipeWriter åºåˆ— Sequence-InputStream ç¬¬ä¸‰ç±»ï¼šæ•°æ®æµè¿‡æ»¤ç±» è¿‡æ»¤ Filter-InputStream Filter-OutputStream FilterReader FilterWriter ç¼“å†² Buffered-InputStream Buffered-OutputStream Buffered-Reader Buffered-Writer æ•°æ® Data-InputStream Data-OutputStream è¡Œå· LineNumber-InputStream LineNumber-Reader æŽ¨å›ž Pushback-InputStream Pushback-Reader æ ¼å¼åŒ– PrintStream PrintWriter ï¼ˆ2ï¼‰è¯´æ˜Žgraph LR T([\"æµä½“ç³»è¯´æ˜Ž\"]):::p T -.- 1(\"æŠ½è±¡åŸºç±»æ— æ³•ç›´æŽ¥åˆ›å»ºå®žä¾‹ï¼Œå¿…é¡»é€šè¿‡å­ç±»åˆ›å»º\"):::p T -.- 2(\"æ•°æ®æºç±»ï¼ˆèŠ‚ç‚¹æµï¼‰åˆ›å»ºå„ç§æµçš„èµ·å§‹ç±»ï¼Œå¿…é¡»ä¸ŽæŒ‡å®šç‰©ç†èŠ‚ç‚¹å…³è”\"):::g T -.- 3(\"æ•°æ®æµä¸²è”ç±»æ•°æ®æµè¿‡æ»¤ç±»æ˜¯å¯¹å„ç§æµå®žä¾‹çš„åŒ…è£…\"):::g T -.- 4(\"#12288;#12288;#12288;è½¬æ¢ç±»#12288;#12288;#12288;\"):::g %% æŠ½è±¡åŸºç±» 1 -.- input(\"InputStreamã€OutputStreamã€Readerã€Writer â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;FilterInputStreamã€FilterOutputStreamã€#12288;#12288; FilterReaderã€FilterWriter#12288;#12288;#12288;#12288;#12288;#12288;#12288;#12288;#12288; \"):::lp %% æ•°æ®æºç±» 2-.- array(\"&nbsp;æ–‡ä»¶æµï¼šä»¥æ–‡ä»¶ä¸ºæ•°æ®æºï¼Œå¯æ“ä½œæ–‡ä»¶ä¸­çš„å†…å®¹ â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;æ•°ç»„æµï¼šå°†å†…å­˜ä¸­çš„å†…éƒ¨ç¼“å­˜åŒºä½œä¸ºæ•°æ®æºã€‚#12288; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;å¯¹è±¡æµï¼šé€šè¿‡å­—èŠ‚æµè¯»å†™å¯¹è±¡ï¼Œå®žçŽ°å¯¹è±¡åºåˆ—åŒ– â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;å­—ç¬¦ä¸²ï¼šæ•°æ®æºä¸ºå­—ç¬¦ä¸²çš„å­—ç¬¦æµã€‚#12288;#12288;#12288;#12288;#12288; \"):::lg %% æµä¸²è”ç±» 3 -.- pip(\"&nbsp;ç®¡é“æµï¼šç®¡é“(pipe)ï¼Œå®žçŽ°è¿›ç¨‹é—´çš„é€šä¿¡åŠŸèƒ½ã€‚&nbsp; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;åºåˆ—æµï¼šè¡¨ç¤ºå…¶ä»–è¾“å…¥æµçš„é€»è¾‘ä¸²è”,å¯åˆå¹¶æµã€‚ \"):::lg %% æµè¿‡æ»¤ç±» 3 -.- ft(\"&nbsp;è¿‡æ»¤æµï¼šå°è£…å…¶ä»–æµï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›é¢å¤–åŠŸèƒ½ã€‚ â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;ç¼“å†²æµï¼šå¢žåŠ ç¼“å†²åŠŸèƒ½ï¼Œå¯¹æµèµ·ç¼“å†²è£…é¥°ã€‚#12288;#12288; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;æ•°æ®æµï¼šå¯æŒ‰8ç§åŸºæœ¬ç±»åž‹å’Œå­—ç¬¦ä¸²æ¥è¯»å†™æµã€‚&nbsp; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;è¡Œå·æµï¼šå¯è·Ÿè¸ªã€è®¾ç½®è¡Œå·ï¼Œæ ‡è®°ä»¥æ¢å¤ç­‰ã€‚#12288; â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;æŽ¨å›žæµï¼šå°†å†…å®¹æŽ¨å›žåˆ°æŽ¨å›žç¼“å†²åŒºä»¥é‡å¤è¯»å–ã€‚ â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ &nbsp;æ‰“å°æµï¼šå°†åŸºæœ¬ç±»åž‹ã€å¯¹è±¡è¾“å‡ºä¸ºå­—ç¬¦ä¸²è¡¨ç¤ºã€‚ \"):::lg %% è½¬æ¢ç±» 4 -.- isr(\"è½¬æ¢æµï¼šå°†å­—èŠ‚æµè½¬æ¢æˆå­—ç¬¦æµ#12288;#12288;#12288;#12288;#12288;#12288;#12288;#12288;\"):::lg classDef p fill:#e5c0cb classDef b fill:#aab7d2 classDef g fill:#a6ccc3 classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆ3ï¼‰å­ç±»å›¾* InputStream classDiagram class InputStream class ByteArrayInputStream class FileInputStream class ObjectInputStream class FilterInputStream class PipedInputStream class SequenceInputStream class StringBufferInputStream class BufferedInputStream class DataInputStream class LineNumberInputStream class PushbackInputStream InputStream","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"}]},{"title":"IO - è¾“å…¥/è¾“å‡ºæµâ‘µ_å®žçŽ°ç±»","slug":"note/Basics/IO/IO_IO_2","date":"2023-05-09T06:59:55.657Z","updated":"2023-05-16T12:51:41.422Z","comments":true,"path":"note/Basics/IO/IO_IO_2/","link":"","permalink":"https://equnee.github.io/note/Basics/IO/IO_IO_2/","excerpt":"","text":"java.io - ç›®å½• æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºï¼šSystem æŽ§åˆ¶å°è¯»å†™ç±»ï¼šConsole æ–‡ä»¶åŸºæœ¬å¤„ç† æ–‡ä»¶æ“ä½œç±»ï¼šFile æ–‡ä»¶æœç´¢ç±»ï¼šFileFilterã€FilenameFilter æ–‡ä»¶ä»»æ„è¯»å†™ç±»ï¼šRandomAccessFile è¾“å…¥/è¾“å‡ºæµ è¾“å…¥/è¾“å‡ºæµ - åˆ†ç±» è¾“å…¥/è¾“å‡ºæµ - å®žçŽ°ç±» åºåˆ—åŒ–/ååºåˆ—åŒ– æµä½“ç³»ï¼š åˆ†ç±» å­—èŠ‚è¾“å…¥æµ å­—èŠ‚è¾“å‡ºæµ å­—ç¬¦è¾“å…¥æµ å­—ç¬¦è¾“å‡ºæµ æŠ½è±¡ç±» InputStream OutputStream Reader Writer è½¬æ¢ç±» InputStream-Reader OutputStream-Writer ç¬¬ä¸€ç±»ï¼šæ•°æ®æºç±» æ–‡ä»¶ File-InputStream File-OutputStream FileReader FilerWriter æ•°ç»„ ByteArray-InputStream ByteArray-OutputStream CharArray-Reader CharArray-Writer å¯¹è±¡ Object-InputStream Object-OutputStream å­—ç¬¦ä¸² StringBuffer-InputStream StringReader StringWriter ç¬¬äºŒç±»ï¼šæ•°æ®æµä¸²è”ç±» ç®¡é“ Pipe-InputStream Pipe-OutputStream PipeReader PipeWriter åºåˆ— Sequence-InputStream ç¬¬ä¸‰ç±»ï¼šæ•°æ®æµè¿‡æ»¤ç±» è¿‡æ»¤ Filter-InputStream Filter-OutputStream FilterReader FilterWriter ç¼“å†² Buffered-InputStream Buffered-OutputStream Buffered-Reader Buffered-Writer æ•°æ® Data-InputStream Data-OutputStream è¡Œå· LineNumber-InputStream LineNumber-Reader æŽ¨å›ž Pushback-InputStream Pushback-Reader æ ¼å¼åŒ– PrintStream PrintWriter ï¼ˆä¸€ï¼‰æ–‡ä»¶æµgraph LR T([\"æ–‡ä»¶æµï¼ˆä½Žçº§æ–‡ä»¶æµï¼‰\"]):::p T --> t(\"å¯æ“ä½œæ–‡ä»¶ä¸­çš„å†…å®¹\"):::info t --> A([\"æŒ‰ç…§(è¯»/å†™)æ–¹å‘åˆ†ç±»\"]):::p t --> B([\"æŒ‰ç…§(è¯»/å†™)å­—èŠ‚æ•°å¤§å°åˆ†ç±»\"]):::b A -.-> |\"inï¼ˆè¯»å–ï¼‰\"| a(\"æ–‡ä»¶è¾“å…¥æµå­—èŠ‚åž‹æ–‡ä»¶è¾“å…¥æµå­—ç¬¦åž‹æ–‡ä»¶è¾“å…¥æµ\"):::lp A -.-> |\"outï¼ˆå†™å…¥ï¼‰\"| a2(\"æ–‡ä»¶è¾“å‡ºæµå­—èŠ‚åž‹æ–‡ä»¶è¾“å‡ºæµå­—ç¬¦åž‹æ–‡ä»¶è¾“å‡ºæµ\"):::lp B -.-> |\"1å­—èŠ‚\"| b(\"å­—èŠ‚åž‹æ–‡ä»¶æµFileInputStreamFileOUtputStream\"):::lb B -.-> |\"1å­—ç¬¦ï¼ˆ2å­—èŠ‚ï¼‰\"| b2(\"å­—ç¬¦åž‹æ–‡ä»¶æµFileReaderFileWriter\"):::lb classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆ1ï¼‰FileInputStramå­—èŠ‚åž‹æ–‡ä»¶è¾“å…¥æµ * ç»§æ‰¿å…³ç³»ç»§æ‰¿äºŽ InputStream ç±»ï¼ˆå­—èŠ‚åž‹è¾“å…¥æµï¼‰ * æž„é€ æ–¹æ³• æž„é€ æ–¹æ³• è¯´æ˜Ž ï¼ˆæ²¡æœ‰æ— å‚æž„é€ æ–¹æ³•ï¼‰ FileInputStram(File file) é€šè¿‡Fileå¯¹è±¡æž„é€  FileInputStram(String name) é€šè¿‡æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æž„é€  * å¸¸ç”¨æ–¹æ³• å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž è¿”å›žå€¼ç±»åž‹ finalize() GCå¯¹è±¡å›žæ”¶ available() è¿”å›žå½“å‰æµç®¡é“ä¸­æœ‰å¤šå°‘ç¼“å­˜å­—èŠ‚ï¼Œæ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚å¯¹åº”çš„ Unicode ç ã€‚ï¼ˆè¯»å¾—åˆ°è¿”å›ž 0â€“65536ï¼Œè¯»ä¸åˆ°è¿”å›ž-1ï¼‰ int ðŸ”º read() ä»Žè¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—èŠ‚ï¼Œè¿”å›žè¯»å–çš„å­—èŠ‚æ•°æ®ï¼ˆUnicodeç ï¼‰ int read(byte[])ï¼šå°†è¾“å…¥æµå†…å®¹å†™å…¥æ•°ç»„é‡Œï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ int read(byte[] b, int off, int leng)ï¼šå°†è¾“å…¥æµå†…å®¹å†™å…¥æ•°ç»„é‡Œï¼Œä»Žoffä½ç½®å¼€å§‹ï¼Œæ”¾å…¥lenä¸ªå­—èŠ‚ï¼ˆä¸æ˜¯ä»Žæ•°ç»„èµ·ç‚¹å¼€å§‹ï¼‰ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ int skip() è·³è¿‡å‡ ä¸ªå­—èŠ‚è¯»å– long n close() å…³é—­æµç®¡é“ï¼ˆâš ï¸ å¿…é¡»è¦åšï¼Œæœ€å¥½æ”¾åœ¨ finally{} é‡Œï¼‰ - read()åˆ›å»ºä¸€ä¸ªå­—èŠ‚åž‹æ–‡ä»¶è¾“å…¥æµï¼Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚ try&#123; File file = new File(&quot;D://Test//test.txt&quot;); FileInputStream fis = new FileInputStram(file); int i = fis.read(); // â† æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚ while(i!=-1)&#123; System.out.ptinln(i); // â†’ è¿”å›žå­—èŠ‚å¯¹åº”å¾—Unicodeç  i = fis.read(); &#125;&#125;catch(IOException e)&#123; e.printStackTrace;&#125; - read(byte[] b)è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè£…å…¥æ•°ç»„å†…ã€‚è¿”å›žè¯»å–çš„æœ‰æ•ˆå­—ç¬¦ä¸ªæ•°ã€‚ try&#123; FileInputStream fis = new FileInputStram(&quot;D://Test//test.txt&quot;); byte[] b = new bytep[5]; int count = fis.read(b); // â† è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè£…è¿›æ•°ç»„é‡Œ while(count!=-1)&#123; // â†’ è¿”å›žè¯»å–åˆ°çš„æœ‰æ•ˆå­—èŠ‚ä¸ªæ•° // ðŸ”¸ String value = new String(b); String value = new String(b, 0, count); // ä½¿ç”¨åç§»é‡æž„é€ å­—èŠ‚åž‹æ•°ç»„å­—ç¬¦ä¸² System.out.ptint(value); // count = fis.read(b); &#125; &#125;catch(IOException e)&#123; e.printStackTrace; &#125;/* æ–‡ä»¶å†…å®¹ï¼š * abcdefg * hijklmn * opq *//* ðŸ”¸ ç›´æŽ¥ä½¿ç”¨String(b)è¯»å–å†…å®¹ï¼š * a b c d e * f g \\r \\n h * i j k l m * n \\r \\n o p * q \\r \\n o p &lt;â€”â€” åˆ°qç»“æŸï¼Œä½†æ˜¯ä¹‹å‰çš„æ²¡æœ‰è¢«æ›¿æ¢æŽ‰ - skip()try &#123; FileInputStream fis = new FileInputStream(&quot;D://Test//test.txt&quot;); fis.skip(2); int code = fis.read(); // c System.out.println((char)code);&#125; catch (IOException e) &#123; e.printStackTrace();&#125; - close()try&#123; File file = new File(&quot;D://Test//test.txt&quot;); FileOutStream fos = new FileOutStram(file); fos.write(97); // å†™å…¥codeç  fos.flush(); // åˆ·æ–° å°†ç®¡é“ä¸­çš„å­—èŠ‚æŽ¨å…¥æ–‡ä»¶ä¸­&#125;catch(IOException e)&#123; e.printStackTrace;&#125; ï¼ˆ2ï¼‰FileOutputStreamå­—èŠ‚åž‹æ–‡ä»¶è¾“å‡ºæµ * ç»§æ‰¿å…³ç³»ç»§æ‰¿äºŽ OutputStream ç±» * æž„é€ æ–¹æ³• æž„é€ æ–¹æ³• è¯´æ˜Ž ï¼ˆæ²¡æœ‰æ— å‚æž„é€ æ–¹æ³•ï¼‰ FileOutputStram(File file) åˆ©ç”¨Fileå¯¹è±¡æž„é€ ï¼ˆé»˜è®¤è¦†ç›–åŽŸæ–‡ï¼‰ FileOutputStram(File file, Boolean append) åˆ©ç”¨Fileå¯¹è±¡æž„é€ ã€æ˜¯å¦å°†å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆtrueï¼šä¸è¦†ç›–ï¼‰ FileOutputStram(String name) é€šè¿‡æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æž„é€  FileOutputStram(String name, Boolean append) é€šè¿‡æ–‡ä»¶è·¯å¾„æž„é€ ã€æ˜¯å¦è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ * å¸¸ç”¨æ–¹æ³• å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž *finalize()* GCå¯¹è±¡å›žæ”¶ write() å†™å…¥åˆ°æ–‡ä»¶ï¼ˆä¸Žread()åŒºåˆ«ï¼‰ write(int code)ï¼šå°†ç»™å®šcodeå†™å…¥æ–‡ä»¶ ï¼ˆâ€™=â€™å­—ç¬¦charä¹Ÿè¡Œ,ä¼šè‡ªåŠ¨è½¬æ¢ï¼‰ write(byte[])ï¼š å°†æ•°ç»„å†…å®¹å†™å…¥æ–‡ä»¶æµé‡Œï¼ˆStringâ€”getByte()ï¼‰ flush() åˆ·æ–°ï¼šå°†ç®¡é“å†…å­—èŠ‚æŽ¨å…¥æ–‡ä»¶ close() * æ³¨æ„ï¼šåœ¨finallyä¸­å…³é—­ - write()try&#123; File file = new File(&quot;D://Test//test.txt&quot;); FileOutStream fos = new FileOutStram(file); fos.write(97); // å†™å…¥codeç  fos.flush(); // åˆ·æ–° å°†ç®¡é“ä¸­çš„å­—èŠ‚æŽ¨å…¥æ–‡ä»¶ä¸­ &#125;&#125;catch(IOException e)&#123; e.printStackTrace;&#125; ï¼ˆ3ï¼‰FileReaderå­—ç¬¦åž‹æ–‡ä»¶è¾“å…¥æµ * ç»§æ‰¿å…³ç³»ç»§æ‰¿äºŽInputStreamReader ç±»ï¼ˆå­—èŠ‚åž‹è¾“å…¥æµï¼‰ * æž„é€ æ–¹æ³• æž„é€ æ–¹æ³• è¯´æ˜Ž ï¼ˆæ²¡æœ‰æ— å‚æž„é€ æ–¹æ³•ï¼‰ FileReader(File file) é€šè¿‡Fileå¯¹è±¡æž„é€ ï¼ˆé»˜è®¤è¦†ç›–åŽŸæ–‡ï¼‰ FIleReader(String fileName) é€šè¿‡æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æž„é€  FileReader(FileDescriptor fd) é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æž„å»ºï¼ˆæ–‡ä»¶æè¿°ç¬¦çš„æœ‰æ•ˆèŒƒå›´æ˜¯ 0 åˆ° OPEN_MAXï¼‰ * å¸¸ç”¨æ–¹æ³• å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž ðŸ”º read() ä»Žè¾“å…¥æµä¸­è¯»å–å•ä¸ªå­—ç¬¦ï¼Œè¿”å›žæ‰€è¯»å–çš„å­—ç¬¦æ•°æ® int read(char[] cbuf) ä»Žè¾“å…¥æµä¸­æœ€å¤šè¯»å–cbuf.lengthä¸ªå­—ç¬¦çš„æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å­—ç¬¦æ•°ç»„cbufä¸­ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—ç¬¦æ•°ã€‚ int read(char[] cbuf, int off, int len) ä»Žè¾“å…¥æµä¸­æœ€å¤šè¯»å–lenä¸ªå­—ç¬¦çš„æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å­—ç¬¦æ•°ç»„cbufä¸­ï¼Œä»Žoffä½ç½®å¼€å§‹å­˜å‚¨ï¼ˆå¹¶ä¸æ˜¯ä»Žæ•°ç»„èµ·ç‚¹å¼€å§‹ï¼‰ï¼Œè¿”å›žå®žé™…è¯»å–çš„å­—ç¬¦æ•°ã€‚ ï¼ˆ4ï¼‰FileWriterå­—ç¬¦åž‹æ–‡ä»¶è¾“å‡ºæµ * ç»§æ‰¿å…³ç³»ç»§æ‰¿äºŽ OutputStreamWriter ç±» ï¼ˆå­—èŠ‚åž‹è¾“å‡ºæµï¼‰ * æž„é€ æ–¹æ³• æž„é€ æ–¹æ³• è¯´æ˜Ž ï¼ˆæ²¡æœ‰æ— å‚æž„é€ æ–¹æ³•ï¼‰ FileWriter(File file) åˆ©ç”¨Fileå¯¹è±¡æž„å»ºï¼ˆé»˜è®¤è¦†ç›–åŽŸæ–‡ï¼‰ FileWriter(File file, Boolean boolean) åˆ©ç”¨Fileå¯¹è±¡æž„é€ ã€æ˜¯å¦å°†å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆtrueï¼šä¸è¦†ç›–ï¼‰ FileWriter(String name) é€šè¿‡æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æž„é€  FileWriter(String name, Boolean boolean) é€šè¿‡æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²æž„é€ ã€æ˜¯å¦è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ * å¸¸ç”¨æ–¹æ³• å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž write() è¯»å– write(char) write(String) - write()String str = &quot;abc&quot;;char[] c = str.toCharArray();FileWriter fw = new FileWriter(file);fw.write(97);fw.write(c); ï¼ˆ5ï¼‰Demoâ‘  æ–‡ä»¶çš„å¤åˆ¶import java.io.*;public class OperateFile &#123; public void copyFile(File file, String path)&#123; try &#123; // ðŸ”» 0 åˆ›å»ºå¯¹è±¡ FileInputStream fis = new FileInputStream(new File(&quot;D://test.txt&quot;)); File newFile = new File(path + &quot;//&quot; + file.gsetName()); FileOutputStream fos = new FileOutputStream(newFile); // ðŸ”» 1 è¯»å–æ–‡ä»¶ byte[] b = new byte[1024]; // é€šå¸¸åˆ›å»ºçš„æ•°ç»„ï¼š1kb-8kbä¹‹é—´ int count = fis.read(b); // countè®°å½•è¯»å–çš„æœ‰æ•ˆå­—èŠ‚æ•°ï¼Œè¯»å–åˆ°byteæ•°ç»„bé‡Œ // ðŸ”» 2 å†™å…¥æ–‡ä»¶ while(count!=-1)&#123; // å½“èƒ½è¯»å–åˆ°å†…å®¹æ—¶ // ðŸ”¸ï¼ˆåšç‚¹æ‰‹è„šï¼‰ fos.write(b, 0, count); // å†™å…¥æœ‰æ•ˆå­—èŠ‚æ•° fos.flush(); count = fis.read(b); // æœ€åŽå†æ¬¡è¯»å–ï¼Œè¯»å–ä¸åˆ°å†…å®¹æ—¶ï¼Œcount=-1æ—¶é€€å‡ºwhileå¾ªçŽ¯ &#125; System.out.println(&quot;å¤åˆ¶å®Œæ¯•ï¼&quot;); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; // å…³é—­ &#125; &#125; public static void main(String[] args) &#123; OperateFile of = new OperateFile(); of.copyFile(new File(&quot;D://test.txt&quot;), &quot;D://test&quot;); &#125;&#125; â‘¡ æ–‡ä»¶çš„åŠ å¯†// è¯»å–æ–‡ä»¶ -&gt; åšç‚¹æ‰‹è„š -&gt; å†™å…¥æ–‡ä»¶byte temp = b[0];b[0] = b[1];b[1] = temp; â‘¢ æ–‡ä»¶å¤¹çš„å¤åˆ¶public void superCopyFile(File file, String newPath)&#123; String oldFilePath = file.getAbsolutePath(); String newFilePath = newPath + oldFilePath.split(&quot;:&quot;)[1]; File[] files = file.listFiles(); // èŽ·å–å½“å‰ä¼ é€’è¿›æ¥çš„Fileå¯¹è±¡çš„æ‰€æœ‰å­å…ƒç´  File newFile = new File(newFilePath); // åˆ¤æ–­å½“å‰ä¼ é€’è¿›æ¥çš„fileæ˜¯ä¸ªæ–‡ä»¶è¿˜æ˜¯ä¸ªæ–‡ä»¶å¤¹ ï¼ˆâ‘ isFile isDirectory â‘¡listFile) if(files!=null)&#123; // ðŸ”» 1. æ–‡ä»¶å¤¹ï¼ˆæ‰èƒ½æž„æˆæ–‡ä»¶æ•°ç»„å¯¹è±¡ï¼‰ newFile.mkdir(); // é€šè¿‡æ–°çš„fileå¯¹è±¡æ“ä½œ åœ¨ç¡¬ç›˜ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ if(files.length!=0)&#123; // ðŸ”» 3. æ–‡ä»¶å¤¹å†…æœ‰æ–‡ä»¶ for(File f:files)&#123; this.superCopyFile(f, newPath); // ðŸ‘ˆ ä½¿ç”¨é€’å½’ &#125; &#125; System.out.println(newFile.getName() + &quot;æ–‡ä»¶å¤¹å¤åˆ¶å®Œæˆï¼&quot;); &#125; else &#123; // ðŸ”» 2. æ–‡ä»¶ ï¼ˆæ²¡æœ‰å­æ–‡ä»¶äº†ï¼‰ FileInputStream fis = null; FileOutputStream fos = null; try &#123; fis = new FileInputStream(new File(oldFilePath)); fos = new FileOutputStream(newFile); byte[] b = new byte[1024]; int count = fis.read(b); while(count!=-1)&#123; fos.write(b,0,count); fos.flush(); count = fis.read(b); &#125; System.out.println(newFile.getName() + &quot;æ–‡ä»¶å¤åˆ¶å®Œæˆï¼&quot;); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; if(fis!=null)&#123; try &#123; fis.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; if (fos!=null)&#123; try &#123; fos.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; ï¼ˆäºŒï¼‰å¯¹è±¡æµï¼ˆ1ï¼‰å¯¹è±¡åºåˆ—åŒ–%%{ init: { 'themeVariables': { 'fontSize': '12px' } } }%% graph LR subgraph \"åº”ç”¨å±‚1\" A(\"å¯¹è±¡\"):::lb end subgraph \"åº”ç”¨å±‚2\" B(\"å¯¹è±¡\"):::lb end subgraph \"ç½‘ç»œåè®®\" C(\"äºŒè¿›åˆ¶æµ\"):::p end A --> |\"[ è½¬æ¢ ]ObjectOutputStreamFileOutputStream\"|C C --> |\"[ è¿˜åŽŸ ]ObjectInputStreamFileInputStream\"|B style ç½‘ç»œåè®® fill:#f4e4e9, stroke-dasharray: 3 3, stroke-width: 2px classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#3f3f3f,stroke-dasharray: 3 3, stroke-width: 1px åºåˆ—åŒ–ï¼šå¯¹è±¡çš„æŒä¹…å­˜å‚¨ ObjectOutputStream å’Œ ObjectInputStream åˆ†åˆ«ä¸Ž FileOutputStream å’Œ FileInputStream ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡åœ¨æµä¸­ä½¿ç”¨æ–‡ä»¶å¯ä»¥å®žçŽ°å¯¹è±¡çš„æŒä¹…å­˜å‚¨ã€‚ ObjectInputStreamï¼šç”¨äºŽæ¢å¤é‚£äº›å·²ç»åºåˆ—åŒ–å­˜å‚¨çš„å¯¹è±¡ã€‚ç¡®ä¿ä»Žæµåˆ›å»ºçš„å›¾å½¢ä¸­æ‰€æœ‰å¯¹è±¡çš„ç±»åž‹ä¸ŽJavaè™šæ‹Ÿæœºä¸­æ˜¾ç¤ºçš„ç±»ç›¸åŒ¹é…ã€‚ åºåˆ—åŒ–ç»†èŠ‚ï¼š è¯»å†™é¡ºåºè¦ä¸€è‡´ï¼ˆå¯¹è±¡ç±»åž‹è½¬æ¢å¼‚å¸¸ï¼šjava.io.OptionalDataExceptionï¼‰ è¦æ±‚å¿…é¡»å®žçŽ° Serializable æˆ– Externalizable æŽ¥å£ åœ¨åºåˆ—åŒ–ç±»ä¸­æ·»åŠ  SerialVersionUIDï¼Œæé«˜ç‰ˆæœ¬å…¼å®¹æ€§ åºåˆ—åŒ–å¯¹è±¡æ—¶é»˜è®¤æ‰€æœ‰å±žæ€§éƒ½åºåˆ—åŒ–ï¼Œé™¤ static å’Œ transit åºåˆ—åŒ–å¯ç»§æ‰¿æ€§ï¼Œè‹¥æŸç±»å®žçŽ°åºåˆ—åŒ–ï¼Œå…¶å­ç±»ä¹Ÿé»˜è®¤å®žçŽ°åºåˆ—åŒ– ï¼ˆ2ï¼‰æ–¹æ³• readObject() readObject()ï¼šè´Ÿè´£è¯»å–é€šè¿‡å¯¹åº”çš„ writeObject() æ–¹æ³•å†™å…¥çš„æ•°æ®ï¼Œä¸ºç‰¹å®šç±»è¯»å–å’Œæ¢å¤å¯¹è±¡çš„çŠ¶æ€ã€‚ æ¢å¤çŠ¶æ€ï¼šä»Ž ObjectInputStream è¯»å–æ•°æ®å¹¶å°†å…¶åˆ†é…ç»™å¯¹è±¡çš„é€‚å½“å­—æ®µã€‚ è¯»å–å„ç§æ•°æ®ç±»åž‹çš„å‡½æ•° // ä¸Ž ObjectOutputStream write()ç›¸å¯¹åº”boolean readBoolean(); // è¯»å–ä¸€ä¸ªbooleanå€¼byte readByte(); // è¯»å–ä¸€ä¸ª8ä½çš„å­—èŠ‚char readChar(); // è¯»å–ä¸€ä¸ª16ä½çš„charå€¼double readDouble(); // è¯»å–ä¸€ä¸ª 64 ä½çš„doubleå€¼float readFloat(); // è¯»å–ä¸€ä¸ª 32 ä½çš„floatå€¼int readInt(); // è¯»å–ä¸€ä¸ª 32 ä½çš„intå€¼long readLong(); // è¯»å–ä¸€ä¸ª 64 ä½çš„longå€¼short readShort(); // è¯»å–ä¸€ä¸ª 16 ä½çš„shortå€¼// ä»Žåºåˆ—åŒ–æµè¯»å–ç±»æè¿°ç¬¦protected ObjectStreamClass readClassDescriptor(); // æŒ‰åç§°ä»Žæµä¸­è¯»å–æŒä¹…å­—æ®µå¹¶ä½¿å…¶å¯ç”¨ObjectInputStream.GetField readFields();// å…è®¸å­ç±»è¯»å–å¹¶éªŒè¯å®ƒä»¬è‡ªå·±çš„æµå¤´éƒ¨protected void readStreamHeader();// ä»Ž ObjectInputStream è¯»å–â€œéžå…±äº«â€å¯¹è±¡Object readUnshared(); ï¼ˆ3ï¼‰ç¤ºä¾‹â‘  å¯¹è±¡åºåˆ—åŒ– Person ç±»ï¼š public class Person implements java.io.Serializable &#123; // ðŸ”¹ ä½¿ç”¨Serializableæ¥å®žçŽ°åºåˆ—åŒ–ï¼Œè®©ç›®æ ‡ç±»å®žçŽ°Serializableæ ‡è®°æŽ¥å£ private String name; private int age; // æ³¨æ„æ­¤å¤„æ²¡æœ‰æä¾›æ— å‚æ•°çš„æž„é€ å™¨ï¼šðŸ”»ååºåˆ—åŒ–æœºåˆ¶æ— é¡»é€šè¿‡æž„é€ å™¨æ¥åˆå§‹åŒ–Javaå¯¹è±¡ public Person(String name , int age) &#123; System.out.println(&quot;æœ‰å‚æ•°çš„æž„é€ å™¨&quot;); this.name=name; this.age=age; &#125; // çœç•¥nameä¸Žageçš„setterå’Œgetteræ–¹æ³• ...&#125; ä½¿ç”¨ ObjectOutputStream å°†ä¸€ä¸ªPersonå¯¹è±¡å†™å…¥ç£ç›˜æ–‡ä»¶ï¼š public class WriteObject&#123; public static void main(String[] args) &#123; try( // ðŸ”¹ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªObjectOutputStreamè¾“å‡ºæµ ObjectOutputStream oos = new ObjectOutputStream( new FileOutputStream(&quot;object.txt&quot;))) // è¿™ä¸ªè¾“å‡ºæµæ˜¯ä¸€ä¸ªå¤„ç†æµï¼Œæ‰€ä»¥å¿…é¡»å»ºç«‹åœ¨å…¶ä»–èŠ‚ç‚¹æµï¼ˆæ–‡ä»¶è¾“å‡ºæµï¼‰çš„åŸºç¡€ä¹‹ä¸Š &#123; Person per = new Person(&quot;å­™æ‚Ÿç©º&quot;, 500); // ðŸ”¹ï¼ˆ2ï¼‰è°ƒç”¨ObjectOutputStreamå¯¹è±¡çš„writeObject()æ–¹æ³•è¾“å‡ºå¯åºåˆ—åŒ–å¯¹è±¡ oos.writeObject(per); // å°†perå¯¹è±¡å†™å…¥è¾“å‡ºæµ &#125; catch (IOException ex)&#123; ex.printStackTrace(); &#125; &#125; &#125;// è¿è¡Œä¸Šé¢ç¨‹åºï¼Œå°†ä¼šçœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ªobject.txtæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å°±æ˜¯Personå¯¹è±¡ã€‚ â‘¡ å¯¹è±¡ååºåˆ—åŒ– ä»Žåˆšåˆšç”Ÿæˆçš„object.txtæ–‡ä»¶ä¸­è¯»å–Personå¯¹è±¡ï¼š public class ReadObject &#123; public static void main(String[] args) &#123; try( // ðŸ”¹ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªObjectInputStreamè¾“å…¥æµ ObjectInputStream ois=new ObjectInputStream( new FileInputStream(&quot;object.txt&quot;))) // è¿™ä¸ªè¾“å…¥æµæ˜¯ä¸€ä¸ªå¤„ç†æµï¼Œæ‰€ä»¥å¿…é¡»å»ºç«‹åœ¨å…¶ä»–èŠ‚ç‚¹æµçš„åŸºç¡€ä¹‹ä¸Šã€‚ &#123; // ðŸ”¹ï¼ˆ2ï¼‰ä»Žè¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªJavaå¯¹è±¡ï¼Œå¹¶å°†å…¶å¼ºåˆ¶ç±»åž‹è½¬æ¢ä¸ºPersonç±» Person p = (Person)ois.readObject(); // è°ƒç”¨ObjectInputStreamå¯¹è±¡çš„readObject() System.out.println(&quot;åå­—ä¸ºï¼š&quot; + p.getName() + &quot;\\nå¹´é¾„ä¸ºï¼š&quot; + p.getAge()); &#125; catch (Exception ex) &#123; ex.printStackTrace(); &#125; &#125;&#125; ï¼ˆä¸‰ï¼‰è½¬æ¢æµè½¬æ¢æµï¼ˆInputStreamReaderã€OutputStreamWriterï¼‰ï¼ŒReaderçš„å­ç±»ï¼Œå¯ä»¥å°† InputStream åŒ…è£…æˆ Readerã€‚ç”¨äºŽå®žçŽ°å°†å­—èŠ‚æµè½¬æ¢æˆå­—ç¬¦æµã€‚â€”â€” å¯è§£å†³æ–‡ä»¶ä¹±ç é—®é¢˜ã€‚ Demoï¼šèŽ·å–é”®ç›˜è¾“å…¥ /* è¯¥ç¨‹åºå°† System.in åŒ…è£…æˆ BufferedReaderï¼Œ BufferedReaderæµå…·æœ‰ç¼“å†²åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ä¸€æ¬¡è¯»å–ä¸€è¡Œæ–‡æœ¬ï¼š ä»¥æ¢è¡Œç¬¦ä¸ºæ ‡å¿—ï¼Œè‹¥æ²¡æœ‰è¯»åˆ°æ¢è¡Œç¬¦ï¼Œåˆ™ç¨‹åºé˜»å¡žï¼Œç­‰åˆ°è¯»åˆ°æ¢è¡Œç¬¦ä¸ºæ­¢ã€‚*/public class KeyinTest &#123; public static void main(String[] args) &#123; try&#123; // å°† Sytem.in å¯¹è±¡è½¬æ¢æˆ Reader å¯¹è±¡ InputStreamReader reader = new InputStreamReader(System.in); // å°†æ™®é€šçš„ReaderåŒ…è£…æˆBufferedReader BufferedReader br = new BufferedReader(reader)) String buffer = null; // é‡‡ç”¨å¾ªçŽ¯æ–¹å¼æ¥é€è¡Œåœ°è¯»å– while ((buffer = br.readLine()) !=null) &#123; //å¦‚æžœè¯»å–çš„å­—ç¬¦ä¸²ä¸º&quot;exit&quot;ï¼Œåˆ™ç¨‹åºé€€å‡º if (buffer.equals(&quot;exit&quot;)) &#123; System.exit(1); &#125; //æ‰“å°è¯»å–çš„å†…å®¹ System.out.println(&quot;è¾“å…¥å†…å®¹ä¸º:&quot; + buffer); &#125; &#125; catch (IOException ioe) &#123; ioe.printStackTrace(); &#125; &#125;&#125; InputStreamReader Javaä½¿ç”¨ System.in ä»£è¡¨æ ‡å‡†è¾“å…¥ï¼ˆå³é”®ç›˜è¾“å…¥ï¼‰ï¼Œä½†è¿™ä¸ªæ ‡å‡†è¾“å…¥æµæ˜¯ InputStream ç±»çš„å®žä¾‹ï¼Œä½¿ç”¨ä¸å¤ªæ–¹ä¾¿ï¼Œä¸”é”®ç›˜è¾“å…¥å†…å®¹éƒ½æ˜¯æ–‡æœ¬å†…å®¹ï¼Œæ‰€ä»¥å¯ç”¨ InputStreamReader å°†å…¶è½¬æ¢æˆå­—ç¬¦è¾“å…¥æµã€‚ BufferedReaderï¼š ç”±äºŽ BufferedReader å…·æœ‰ä¸€ä¸ª readLine() æ–¹æ³•ï¼Œå¯ä»¥éžå¸¸æ–¹ä¾¿åœ°ä¸€æ¬¡è¯»å…¥ä¸€è¡Œå†…å®¹ï¼Œæ‰€ä»¥ç»å¸¸æŠŠè¯»å–æ–‡æœ¬å†…å®¹çš„è¾“å…¥æµåŒ…è£…æˆ BufferedReaderï¼Œç”¨æ¥æ–¹ä¾¿åœ°è¯»å–è¾“å…¥æµçš„æ–‡æœ¬å†…å®¹ã€‚ ðŸ”¸ åªæœ‰å­—èŠ‚è½¬å­—ç¬¦ï¼šå› ä¸ºå­—ç¬¦æµæ¯”å­—èŠ‚æµæ“ä½œæ›´æ–¹ä¾¿ ï¼ˆå››ï¼‰ç®¡é“æµå®žçŽ°äº†pipeçš„æ¦‚å¿µï¼Œä¸»è¦åœ¨çº¿ç¨‹ä¸­ä½¿ç”¨ï¼šä¸€ä¸ªçº¿ç¨‹å¯ä»¥éšæ—¶å‘ç®¡é“è¾“å‡ºæµå‘é€æ•°æ®ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹éšæ—¶ä»Žç®¡é“è¾“å…¥æµè¯»å–æ•°æ®ï¼Œå®žçŽ°ä¸¤ä¸ªçº¿ç¨‹é—´çš„é€šä¿¡ï¼ˆå¼‚æ­¥ä¼ è¾“æ•°æ®ï¼‰ã€‚ è¾“å…¥æµå’Œè¾“å‡ºæµå¿…é¡»ç»“åˆä½¿ç”¨ï¼šè‹¥å‘è¿žæŽ¥ç®¡é“è¾“å‡ºæµæä¾›æ•°æ®å­—èŠ‚çš„çº¿ç¨‹ï¼ˆå‘é€ç«¯ï¼‰ä¸å­˜åœ¨ï¼Œåˆ™è®¤ä¸ºè¯¥ç®¡é“å·²æŸåã€‚ ðŸ“Œ æ³¨æ„ï¼šæ•°æ®çš„ä¼ è¾“æ–¹å‘ã€‚ ï¼ˆ1ï¼‰PipedInputStreamç®¡é“è¾“å…¥æµï¼ˆæŽ¥æ”¶ç«¯ï¼‰åº”è¯¥è¿žæŽ¥åˆ°ç®¡é“è¾“å‡ºæµï¼ˆå‘é€ç«¯ï¼‰ã€‚ graph LR A[[\"çº¿ç¨‹1\"]] B[[\"çº¿ç¨‹2\"]] pi([\"PipedOutputStream\"]):::lp po([\"PipedInputStreamæä¾›è¦å†™å…¥ç®¡é“è¾“å‡ºæµçš„\"]):::g A ==> |\"å‘é€\"|pi pi -.-> |\"ï½œç¼“å†²åŒº\"|po po ==> |\"è¯»å–\"|B subgraph \"ç®¡é“è¾“å‡ºæµï½œç®¡é“è¾“å…¥æµ\" pi po end classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#3f3f3f,stroke-dasharray: 3 3, stroke-width: 1px * ç¼“å­˜åŒºï¼šç®¡é“è¾“å…¥æµåŒ…å«ä¸€ä¸ªç¼“å­˜åŒºï¼Œå¯åœ¨ç¼“å­˜åŒºé™å®šçš„èŒƒå›´å†…å°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†ç¦»å¼€ã€‚ðŸ”º ä¸å»ºè®®å¯¹è¿™ä¸¤ä¸ªå¯¹è±¡å°è¯•ä½¿ç”¨å•ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºè¿™æ ·å¯èƒ½æ­»é”çº¿ç¨‹ã€‚ * è¾“å…¥è¾“å‡ºæµçš„è¿žæŽ¥æ–¹æ³•ï¼ˆ1ï¼‰ï¼šæž„é€ æ–¹æ³• // æž„é€ æ–¹æ³•ï¼š// â‘  ä»¥ç®¡é“è¾“å‡ºæµçš„å®žä¾‹ä½œä¸ºè¾“å…¥ (ä½¿å…¶è¿žæŽ¥åˆ°srcæŒ‡å®šçš„ç®¡é“å­—èŠ‚è¾“å‡ºæµã€‚) PipedInputStream(PipedOutputStream src); // â‘¡ åˆ›å»ºä¸€ä¸ªå°šæœªè¿žæŽ¥çš„PipedInputStreamPipedInputStream(); * è¾“å…¥è¾“å‡ºæµçš„è¿žæŽ¥æ–¹æ³•ï¼ˆ2ï¼‰ï¼šconnect() // è°ƒç”¨PipedInputStreamç±»çš„connect()å»ºç«‹ä¸Žè¾“å‡ºæµçš„è¿žæŽ¥ï¼šä½¿æ­¤ç®¡é“è¾“å…¥æµè¿žæŽ¥åˆ°ç®¡é“è¾“å‡ºæµsrcvoid connect(PipedOutputStream src); * å¸¸ç”¨æ–¹æ³•ï¼š public int avaliable(); // è¿”å›žå¯è¯»å–çš„å­—èŠ‚ä¹¦public void close(); // å…³é—­ç®¡é“è¾“å…¥æµå¹¶é‡Šæ”¾ç³»ç»Ÿèµ„æºpublic int read(); // ä»Žç®¡é“è¾“å…¥æµä¸­è¯»å–ä¸‹ä¸€ä¸ªå­—èŠ‚æ•°æ®public int read(byte[] b, int off, int len); // ä»Žç®¡é“è¾“å…¥æµè¯»å–lenå­—èŠ‚æ•°æ®åˆ°æ•°ç»„protected void receive(int b); // ä»Žç®¡é“ä¸­æŽ¥å—1å­—èŠ‚æ•°æ®public void connect(PipedOutputStream src); // è¿žæŽ¥åˆ°æŒ‡å®šè¾“å‡ºæµï¼Œç®¡é“è¾“å…¥æµå°†ä»Žè¯¥è¾“å‡ºæµæŽ¥å—æ•°æ® * ç¤ºä¾‹ï¼š /** * ç®€å•åœ°å»ºç«‹æµé“¾æŽ¥ï¼ˆðŸ“Œ æ³¨æ„ï¼šè¿™æ ·å®žé™…ä¸Šæ²¡æœ‰æ„ä¹‰ï¼Œé€šå¸¸åº”ç”¨äºŽçº¿ç¨‹é—´é€šä¿¡ï¼‰ */public class TestPipedInputStream &#123; public static void main(String[] args) throws IOException &#123; try &#123; // ðŸ”¹ åˆ›å»ºç®¡é“è¾“å‡ºæµ PipedOutputStream os = new PipedOutputStream(); // ðŸ”¹ åˆ›å»ºè¾“å…¥æµ PipedInputStream is = new PipedInputStream(os); // ðŸ”¸ ä»Žè¾“å‡ºæµå†™å…¥æ•°æ® byte[] b = new byte[3]; b[0] = 100; b[1] = 101; b[2] = 102; os.write(b); // ðŸ”¸ ä»Žè¾“å…¥æµè¯»å–æ•°æ® while (is.available() ï¼ž 0) &#123; int c = is.read(); System.out.print((char)c); &#125; // ðŸ”¹ å…³é—­è¾“å…¥æµ is.close(); //å…³é—­è¾“å‡ºæµ os.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125; ï¼ˆ2ï¼‰PipedOutputStreamPipedOutputStream å¯ä»¥å°†ç®¡é“è¾“å‡ºæµè¿žæŽ¥åˆ°ç®¡é“è¾“å…¥æµæ¥åˆ›å»ºé€šä¿¡ç®¡é“ã€‚ç®¡é“è¾“å‡ºæµæ˜¯æŒ‡ä¸€ä¸ªé€šä¿¡ç®¡é“çš„å‘é€ç«¯ï¼Œå®ƒå¿…é¡»ä¸Žä¸€ä¸ªä½œä¸ºæŽ¥æ”¶ç«¯çš„PipedInputStreamå¯¹è±¡ç›¸è¿žã€‚ graph LR A[[\"çº¿ç¨‹1\"]] B[[\"çº¿ç¨‹2\"]] pi([\"PipedOutputStream\"]):::p po([\"PipedInputStream\"]):::lg A ==> |\"å‘é€\"|pi pi -.-> |\"ï½œç¼“å†²åŒº\"|po po ==> |\"è¯»å–\"|B subgraph \"ç®¡é“è¾“å‡ºæµï½œç®¡é“è¾“å…¥æµ\" pi po end classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#3f3f3f,stroke-dasharray: 3 3, stroke-width: 1px * ç¤ºä¾‹ï¼š - å‘é€è€…çº¿ç¨‹Senderï¼šåˆ›å»ºäº†ä¸€ä¸ªè¾“å‡ºæµ PipedOutputStream çš„å¯¹è±¡ outï¼Œåœ¨è¯¥çº¿ç¨‹çš„ä¸»å‡½æ•° run() ä¸­è°ƒç”¨ out çš„ write() å†™å…¥æ•°æ®ã€‚ - æŽ¥æ”¶è€…çº¿ç¨‹Receiverï¼šåˆ›å»ºäº†ä¸€ä¸ªè¾“å…¥æµ PipedInputStream çš„å¯¹è±¡ inï¼Œåœ¨è¯¥çº¿ç¨‹çš„ä¸»å‡½æ•° run() ä¸­è°ƒç”¨ in çš„ read() è¯»å–æ•°æ®ã€‚ /** * ç®¡é“è¾“å‡ºæµä¸Žç®¡é“è¾“å…¥æµåœ¨å¤šçº¿ç¨‹ä¸­çš„åº”ç”¨ï¼š * - Senderï¼šç®¡é“è¾“å‡ºæµï¼ˆPipedOutputStreamï¼‰çš„ç‹¬ç«‹çº¿ç¨‹ç±» * - Receiverï¼šç®¡é“è¾“å…¥æµï¼ˆPipedInputStreamï¼‰çš„ç‹¬ç«‹çº¿ç¨‹ç±» */public class TestPipedOutputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºå‘é€è€…çº¿ç¨‹ Sender t1 = new Sender(); PipedOutputStream out = t1.getOutputStream(); // ðŸ”¹ åˆ›å»ºæŽ¥æ”¶è€…çº¿ç¨‹ Receiver t2 = new Receiver(); PipedInputStream in = t2.getInputStream(); // ðŸ”¸ è¿žæŽ¥ç®¡é“æµ out.connect(in); // ðŸ”¹ å¯åŠ¨å‘é€è€…çº¿ç¨‹å’ŒæŽ¥æ”¶è€…çº¿ç¨‹ new Thread(t1).start(); new Thread(t2).start(); // åœ¨è¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½å¯åŠ¨åŽå°±ä¼šè¿è¡Œå„è‡ªçš„run()ä¸»å‡½æ•°ï¼Œ // ä»Žoutä¸­å†™å…¥çš„æ•°æ®å°±ä¼šä¼ é€’åˆ°inä¸­ï¼Œå®žçŽ°æ•°æ®çš„å¼‚æ­¥ä¼ è¾“ã€‚ &#125; catch (Exception e) &#123; &#125; &#125; &#125;//ï¼ˆ1ï¼‰å‘é€è€…çº¿ç¨‹ç±»class Sender extends Thread &#123; private PipedOutputStream out = new PipedOutputStream(); public PipedOutputStream getOutputStream() &#123; return out; &#125; public void run() &#123; // ðŸ”¹ å‘é€å­—ç¬¦ä¸² String s = new String(&quot;hello,receiver,how are you&quot;); try &#123; out.write(s.getBytes()); out.close(); &#125; catch (IOException e) &#123; System.out.println(e.getMessage()); &#125; &#125;&#125;//ï¼ˆ2ï¼‰æŽ¥æ”¶è€…çº¿ç¨‹class Receiver extends Thread &#123; private PipedInputStream in = new PipedInputStream(); public PipedInputStream getInputStream() &#123; return in; &#125; public void run() &#123; // ðŸ”¹ æŽ¥æ”¶å­—ç¬¦ä¸² String s = null; byte[] buf = new byte[1024]; try &#123; int len = in.read(buf); s = new String(buf, 0, len); System.out.println(&quot;from:\\n&quot; + s); in.close(); &#125; catch (IOException e) &#123; System.out.println(e.getMessage()); &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œå³å¯å®žçŽ°å‘é€è€…çº¿ç¨‹å¾€æŽ¥æ”¶è€…çº¿ç¨‹å‘é€æ•°æ®çš„åŠŸèƒ½ï¼Œ// å®ƒä»¬åˆ†åˆ«ä½¿ç”¨äº†ç®¡é“è¾“å…¥æµå’Œè¾“å‡ºæµã€‚ ï¼ˆäº”ï¼‰åºåˆ—æµSequenceInputStream ç±»å…è®¸è¿žæŽ¥å¤šä¸ª InputStream æµï¼Œè¡¨ç¤ºå…¶ä»–è¾“å…¥æµçš„é€»è¾‘ä¸²è”ã€‚ï¼ˆä¸²è¡Œè¾“å…¥æµï¼‰ %%{ init: { 'themeVariables': { 'fontSize': '12px' } } }%% graph A([InputStream s1]):::lp B([InputStream s2]):::lp C([InputStream s3]):::lp D([InputStream s1]):::lb E([InputStream s2]):::lb A --> B --> C subgraph \"ï¼ˆ2ï¼‰ SequenceInputStream(e)\" subgraph \"Enumeration âŸ¨? extends InputStreamâŸ© e\" A B C end end subgraph \"ï¼ˆ1ï¼‰ SequenceInputStream(s1, s2)\" D --> E end classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#3f3f3f,stroke-dasharray: 3 3, stroke-width: 1px ä¸²è”è¾“å…¥æºï¼šå®ƒä»Žè¾“å…¥æµçš„æœ‰åºé›†åˆå¼€å§‹ï¼Œä»Žç¬¬ä¸€ä¸ªè¾“å…¥æµå¼€å§‹è¯»å–ï¼Œè¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼ŒæŽ¥ç€ä»Žç¬¬äºŒä¸ªè¾“å…¥æµè¯»å–ï¼Œä¾æ¬¡ç±»æŽ¨ï¼Œç›´åˆ°åˆ°è¾¾åŒ…å«çš„æœ€åŽä¸€ä¸ªè¾“å…¥æµçš„æ–‡ä»¶æœ«å°¾ä¸ºæ­¢ã€‚ * æž„é€ å‡½æ•°ï¼š //ï¼ˆ1ï¼‰ä¸²è”æ•°æ®æºSequenceInputStream(InputStream s1,InputStream s2); // å°†æŒ‰é¡ºåºè¯»å–è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå…ˆè¯»å–s1ï¼Œç„¶åŽè¯»å–s2 //ï¼ˆ2ï¼‰ä¸²è” Enumeration ç±»åž‹çš„æ•°æ®æºåˆ—è¡¨SequenceInputStream(Enumerationï¼œ?extends InputStreamï¼že); * Demoï¼š /** å°†ä¸¤ä¸ªæ–‡ä»¶æ•°æ®æºä¸²è”èµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ªSequenceInputStreamç±»åž‹çš„æ•°æ®æºå¹¶è¾“å‡ºæ–‡ä»¶å†…å®¹åˆ°æŽ§åˆ¶å°ä¸­ã€‚ */public class TestSequenceInputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºè¾“å…¥æºæ•°ç»„ // * ä¸²è”çš„æ•°æ®æºåˆ—è¡¨ä¸­ï¼Œå¯ä»¥åŒ…å«å„ç§InputStreamå®žçŽ°ç±»çš„æ•°æ®æµå¯¹è±¡ã€‚ FileInputStream fis1 = new FileInputStream(&quot;D:/demo/test.txt&quot;); FileInputStream fis2 = new FileInputStream(&quot;D:/demo/test2.txt&quot;); Vectorï¼œFileInputStreamï¼ž vector = new Vectorï¼œFileInputStreamï¼ž(); vector.add(fis1); vector.add(fis2); Enumerationï¼œFileInputStreamï¼ž e = vector.elements(); // ðŸ”¸ åˆ›å»ºåºåˆ—è¾“å…¥æº SequenceInputStream is = new SequenceInputStream(e); // ðŸ”¹ ä»Žè¾“å…¥æµè¯»å–æ•°æ® while (is.available() ï¼ž 0) &#123; int c = is.read(); System.out.print((char)c); &#125; // ðŸ”¹ å…³é—­è¾“å…¥æµ is.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125; ï¼ˆå…­ï¼‰è¿‡æ»¤æµè¿‡æ»¤æµç”¨äºŽæ‰©å±•å…¶ä»–æµï¼Œå¢žå¼ºå…¶åŠŸèƒ½ã€‚å®ƒåŒ…å«å…¶ä»–ä¸€äº›è¾“å…¥/è¾“å‡ºæµï¼Œå°†è¿™äº›æµç”¨åšå…¶åŸºæœ¬æ•°æ®æºï¼Œå®ƒå¯ä»¥ç›´æŽ¥ä¼ è¾“æ•°æ®æˆ–æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œä¾‹å¦‚ FilterInputStream ç±»æœ¬èº«åªæ˜¯ç®€å•åœ°é‡å†™é‚£äº›å°†æ‰€æœ‰è¯·æ±‚ä¼ é€’ç»™æ‰€åŒ…å«è¾“å…¥æµçš„ InputStream çš„æ‰€æœ‰æ–¹æ³•ã€‚å› æ­¤ï¼Œè¿™ä¸ªç±»æœ¬èº«å¯¹äºŽæ•°æ®æµå¹¶æ²¡æœ‰ä»€ä¹ˆä½œç”¨ã€‚æ‰€ä»¥é€šå¸¸å¹¶ä¸å•ç‹¬ä½¿ç”¨å®ƒä»¬ï¼Œè€Œæ˜¯ä½¿ç”¨å®ƒä»¬çš„å­ç±»ã€‚ ï¼ˆä¸ƒï¼‰ç¼“å†²æµç¼“å†²æµä¸»è¦ä¸ºè¾“å…¥/è¾“å‡ºæµç¼“å­˜æ•°æ®ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ flush() æ–¹æ³•å¼ºåˆ¶å°†ç¼“å­˜ä¸­çš„æ•°æ®çœŸæ­£å†™å…¥åˆ°è¾“å‡ºæµä¸­ã€‚ï¼ˆè¾“å…¥æµå¯¹è±¡çš„å…³é—­é¡ºåºå¿…é¡»ä¸Žå…¶åˆ›å»ºçš„é¡ºåºç›¸åï¼ŒåŽé¢çš„è¾“å‡ºæµä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼‰ ï¼ˆ1ï¼‰BufferedInpuStreamBufferedInputStreamä¸ºå¦ä¸€ä¸ªè¾“å…¥æµæ·»åŠ ä¸€äº›åŠŸèƒ½ï¼Œå³ç¼“å­˜è¾“å…¥çš„èƒ½åŠ›ã€‚ åœ¨åˆ›å»ºBufferedInputStreamæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå†…éƒ¨ç¼“å­˜åŒºæ•°ç»„ã€‚åœ¨è¯»å–æˆ–è·³è¿‡æµä¸­çš„å­—èŠ‚æ—¶ï¼Œå¯æ ¹æ®éœ€è¦ä»ŽåŒ…å«çš„è¾“å…¥æµå†æ¬¡å¡«å……è¯¥å†…éƒ¨ç¼“å­˜åŒºï¼Œä¸€æ¬¡å¡«å……å¤šä¸ªå­—èŠ‚ã€‚ * Demoï¼š public class TestBufferedInputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹åˆ›å»ºè¾“å…¥æµ FileInputStream is = new FileInputStream(&quot;D:/demo/test.txt&quot;); BufferedInputStream bis = new BufferedInputStream(is); // ðŸ”¹ä»Žè¾“å…¥æµè¯»å–æ•°æ® while (bis.available() ï¼ž 0) &#123; int c = bis.read(); System.out.print((char)c); &#125; // ðŸ”¹å…³é—­è¾“å…¥æµ bis.close(); is.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125; ï¼ˆ2ï¼‰BufferedOutputStreamBufferedOutputStream ç»§æ‰¿è‡ª FilterOutputStreamï¼Œå®ƒä¸Ž BufferedInputStream ç›¸å¯¹åº”ï¼Œä¸»è¦ä¸ºè¾“å‡ºæµåšç¼“å­˜ã€‚ * demo /** å°†æ–‡ä»¶è¾“å…¥æµå¯¹è±¡osè½¬æ¢ä¸ºç¼“å­˜è¾“å‡ºæµ */public class TestBufferedOutputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹åˆ›å»ºè¾“å‡ºæµ FileOutputStream os = new FileOutputStream(&quot;D:/demo/test.txt&quot;); BufferedOutputStream bos = new BufferedOutputStream(os); // ðŸ”¹å†™å…¥æ•°ç»„æ•°æ® byte[] buf = new byte[3]; buf[0] = 100; buf[1] = 101; buf[2] = 102; bos.write(buf); // ðŸ”¹å…³é—­è¾“å‡ºæµ bos.close(); os.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œå°†ä¼šå¾€æ–‡ä»¶ä¸­å†™å…¥3ä¸ªå­—ç¬¦â€œdefâ€ã€‚ ï¼ˆ3ï¼‰BufferedReaderBufferedReader ä»Žå­—ç¬¦è¾“å…¥æµä¸­è¯»å–æ–‡æœ¬ï¼Œç¼“å­˜å„ä¸ªå­—ç¬¦ï¼Œä»¥å®žçŽ°å­—ç¬¦/æ•°ç»„/è¡Œçš„é«˜æ•ˆè¯»å–ã€‚ * æž„é€ æ–¹æ³•ï¼š ðŸ“Œ Readeræ‰€åšçš„æ¯ä¸ªè¯»å–è¯·æ±‚éƒ½ä¼šå¯¼è‡´å¯¹åº•å±‚å­—ç¬¦æˆ–å­—èŠ‚æµè¿›è¡Œç›¸åº”çš„è¯»å–è¯·æ±‚ã€‚å› æ­¤ï¼Œå»ºè®®ç”¨ BufferedReader åŒ…è£…æ‰€æœ‰å…¶ read() æ“ä½œå¯èƒ½å¼€é”€å¾ˆé«˜çš„Readerï¼ˆå¦‚ FileReader å’ŒInputStreamReaderï¼‰ BufferedReader(Reader in); // åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å¤§å°è¾“å…¥ç¼“å­˜åŒºçš„ç¼“å­˜å­—ç¬¦è¾“å…¥æµBufferedReader(Reader in,int sz); // åˆ›å»ºä¸€ä¸ªä½¿ç”¨æŒ‡å®šå¤§å°è¾“å…¥ç¼“å­˜åŒºçš„ç¼“å­˜å­—ç¬¦è¾“å…¥æµ * Demoï¼š /** * ç»„åˆä½¿ç”¨ FileReader å’Œ BufferedReaderï¼šèŽ·å¾—ä¸€ä¸ªå…·æœ‰ç¼“å­˜çš„æ–‡ä»¶è¾“å…¥æµ */ public class TestBufferedReader &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹åˆ›å»ºè¾“å…¥æµ FileReader is = new FileReader(&quot;D:/demo/test.txt&quot;); BufferedReader bis = new BufferedReader(is); // ðŸ”¹ä»Žè¾“å…¥æµè¯»å–æ•°æ® while (bis.ready()) &#123; int c = bis.read(); System.out.print((char)c); &#125; // ðŸ”¹å…³é—­è¾“å…¥æµ bis.close(); is.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œå°†ä¼šè¾“å‡ºæ–‡ä»¶ä¸­çš„å†…å®¹åˆ°æŽ§åˆ¶å°ä¸­ã€‚ ï¼ˆ4ï¼‰BufferedWriterBufferedWriter å°†æ–‡æœ¬å†™å…¥å­—ç¬¦è¾“å‡ºæµï¼Œç¼“å­˜å„ä¸ªå­—ç¬¦ï¼Œä»Žè€Œæä¾›å•ä¸ªå­—ç¬¦ã€æ•°ç»„å’Œå­—ç¬¦ä¸²çš„é«˜æ•ˆå†™å…¥ã€‚ * ä½¿ç”¨ ðŸ“Œ é€šå¸¸ Writer å°†å…¶è¾“å‡ºç«‹å³å‘é€åˆ°åº•å±‚å­—ç¬¦æˆ–å­—èŠ‚æµã€‚é™¤éžè¦æ±‚æç¤ºè¾“å‡ºï¼Œå¦åˆ™å»ºè®®ç”¨ BufferedWriter åŒ…è£…æ‰€æœ‰å…¶ write() æ“ä½œå¯èƒ½å¼€é”€å¾ˆé«˜çš„ Writerï¼ˆå¦‚FileWriterså’ŒOutputStreamWritersï¼‰ã€‚ä¾‹å¦‚ä»¥ä¸‹æ¡ˆä¾‹å°†ç¼“å†² PrintWriter å¯¹æ–‡ä»¶çš„è¾“å‡ºã€‚ PrintWriter out = new PrintWriter( new BufferedWriter(new FileWriter(&quot;foo.out&quot;)));// è‹¥æ²¡æœ‰ç¼“å†²ï¼Œåˆ™æ¯æ¬¡è°ƒç”¨ print() æ–¹æ³•ä¼šå¯¼è‡´å°†å­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼Œ// ç„¶åŽç«‹å³å†™å…¥åˆ°æ–‡ä»¶ï¼Œè€Œè¿™æ˜¯æžå…¶ä½Žæ•ˆçš„ã€‚ * è¾“å‡ºæ¢è¡Œ è¯¥ç±»æä¾›äº† newLine() æ–¹æ³•ï¼Œå®ƒä½¿ç”¨å¹³å°è‡ªå·±çš„è¡Œåˆ†éš”ç¬¦æ¦‚å¿µï¼Œæ­¤æ¦‚å¿µç”±ç³»ç»Ÿå±žæ€§ line.separator å®šä¹‰ã€‚ å¹¶éžæ‰€æœ‰å¹³å°éƒ½ä½¿ç”¨æ–°è¡Œç¬¦ï¼ˆ\\nï¼‰æ¥ç»ˆæ­¢å„è¡Œã€‚å› æ­¤è°ƒç”¨æ­¤æ–¹æ³•æ¥ç»ˆæ­¢æ¯ä¸ªè¾“å‡ºè¡Œè¦ä¼˜äºŽç›´æŽ¥å†™å…¥æ–°è¡Œç¬¦ã€‚ * Demo /** å°†æ–‡ä»¶è¾“å…¥æµå¯¹è±¡osè½¬æ¢ä¸ºç¼“å­˜è¾“å‡ºæµã€‚ */public class TestBufferedWriter &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºè¾“å‡ºæµ FileWriter os = new FileWriter(&quot;D:/demo/test.txt&quot;); BufferedWriter bos = new BufferedWriter(os); // ðŸ”¹ å†™å…¥æ•°ç»„æ•°æ® char[] buf = new char[3]; buf[0] = &#x27;a&#x27;; buf[1] = &#x27;b&#x27;; buf[2] = &#x27;ä¸­&#x27;; bos.write(buf); // ðŸ”¹ å…³é—­è¾“å‡ºæµ bos.close(); os.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œå°†ä¼šåœ¨æ–‡ä»¶ä¸­å†™å…¥â€œabä¸­â€ã€‚ ï¼ˆå…«ï¼‰æ•°æ®æµï¼ˆ1ï¼‰DataInputStreamæ•°æ®è¾“å…¥æµå…è®¸åº”ç”¨ç¨‹åºä»¥ä¸Žæœºå™¨æ— å…³æ–¹å¼ä»Žåº•å±‚è¾“å…¥æµä¸­è¯»å–åŸºæœ¬Javaæ•°æ®ç±»åž‹ã€‚ * æ–¹æ³• boolean readBoolean(); // è¯»å–ä¸€ä¸ªbooleanå€¼byte readByte(); // è¯»å–ä¸€ä¸ª8ä½çš„å­—èŠ‚char readChar(); // è¯»å–ä¸€ä¸ª16ä½çš„charå€¼double readDouble(); // è¯»å–ä¸€ä¸ª 64 ä½çš„doubleå€¼float readFloat(); // è¯»å–ä¸€ä¸ª 32 ä½çš„floatå€¼int readInt(); // è¯»å–ä¸€ä¸ª 32 ä½çš„intå€¼long readLong(); // è¯»å–ä¸€ä¸ª 64 ä½çš„longå€¼short readShort(); // è¯»å–ä¸€ä¸ª 16 ä½çš„shortå€¼ * ç±»ä¼¼ ObjectInputStream ObjectInputStreamï¼šè¯»å–åŸºæœ¬æ•°æ®ç±»åž‹ + å¯¹è±¡æ•°æ®ç±»åž‹DataInputStrreamï¼š è¯»å–åŸºæœ¬æ•°æ®ç±»åž‹ * Demo /** * è¯»å–DataOutputStreamç±»æ‰€å†™æ–‡ä»¶çš„è¿‡ç¨‹ * ï¼ˆdata.tmpå¯ä»¥é€šè¿‡ä¸‹ä¸€èŠ‚ä¸­ DataOutputStream ç±»çš„æ¼”ç¤ºç¨‹åºè¿è¡Œç”Ÿæˆï¼‰ */public class TestDataInputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºæ–‡ä»¶è¾“å…¥æµ FileInputStream fis = new FileInputStream(&quot;D:/demo/data.tmp&quot;); // ðŸ”¹ åˆ›å»ºæ•°æ®è¾“å…¥æµ DataInputStream dis = new DataInputStream(fis); // ðŸ”¸ è¯»å–å¯¹è±¡æ•°æ® int i = dis.readInt(); boolean b = dis.readBoolean(); float f = dis.readFloat(); System.out.println(&quot;i=&quot; + i); System.out.println(&quot;b=&quot; + b); System.out.println(&quot;f=&quot; + f); // ðŸ”¹ å…³é—­è¾“å…¥æµ dis.close(); fis.close(); &#125; catch (IOException e) &#123; &#125; &#125; &#125;// i=12345// b=true// f=1000.0 *æ³¨æ„ï¼š ç”±äºŽæ–‡ä»¶ D:/demo/data.tmp æ˜¯å†™å…¥ç±»è°ƒç”¨ DataOutputStream å†™å…¥çš„å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡çš„å†™å…¥éƒ½æ˜¯æœ‰é¡ºåºçš„ï¼Œå› æ­¤è¿™é‡Œçš„è¯»å–ä¹Ÿå¿…é¡»é‡‡ç”¨åŒæ ·çš„é¡ºåºã€‚å¦‚æžœé¡ºåºä¸ä¸€è‡´ï¼Œå°†ä¼šäº§ç”Ÿå¯¹è±¡ç±»åž‹è½¬æ¢å¼‚å¸¸ java.io.OptionalDataExceptionï¼Œå®ƒæ˜¯IOExceptionçš„å­ç±»ã€‚ ï¼ˆ2ï¼‰DataOutputStreamDataOutputStream ä¸Ž DataInputStream ç›¸å¯¹åº”ï¼Œå…è®¸åº”ç”¨ç¨‹åºå°†åŸºæœ¬Javaæ•°æ®ç±»åž‹å†™å…¥è¾“å‡ºæµä¸­ã€‚ç„¶åŽï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ•°æ®è¾“å…¥æµ DataInputStream å°†æ•°æ®è¯»å…¥ã€‚ * æ–¹æ³• // ç»§æ‰¿OutputStreamçš„åŒæ—¶ï¼Œå®žçŽ°äº†DataOutputæŽ¥å£ï¼Œå› æ­¤å®ƒå…·æœ‰DataOutputæ‰€è§„å®šçš„æ–¹æ³•ï¼švoid writeBoolean(boolean v); // å°†ä¸€ä¸ªbooleanå€¼ä»¥1-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµvoid writeByte(int v); // å°†ä¸€ä¸ªbyteå€¼ä»¥1-byteå€¼å½¢å¼å†™å‡ºåˆ°è¾“å‡ºæµä¸­void writeBytes(Strings); // å°†å­—ç¬¦ä¸²æŒ‰å­—èŠ‚é¡ºåºå†™å‡ºåˆ°è¾“å‡ºæµä¸­void writeChar(int v); // å°†ä¸€ä¸ªcharå€¼ä»¥2-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµä¸­ï¼Œå…ˆå†™å…¥é«˜å­—èŠ‚void writeChars(Strings); // å°†å­—ç¬¦ä¸²æŒ‰å­—ç¬¦é¡ºåºå†™å…¥è¾“å‡ºæµvoid writeDouble(double v); // ä½¿ç”¨Doubleç±»ä¸­çš„doubleToLongBitsæ–¹æ³•å°†doubleå‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªlongå€¼ï¼Œç„¶åŽå°†è¯¥longå€¼ä»¥8-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµä¸­ï¼Œå…ˆå†™å…¥é«˜å­—èŠ‚void writeFloat(float v); // ä½¿ç”¨Floatç±»ä¸­çš„floatToIntBitsæ–¹æ³•å°†floatå‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªintå€¼ï¼Œç„¶åŽå°†è¯¥intå€¼ä»¥4-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµä¸­ï¼Œå…ˆå†™å…¥é«˜å­—èŠ‚void writeInt(int v); // å°†ä¸€ä¸ªintå€¼ä»¥4-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµä¸­ï¼Œå…ˆå†™å…¥é«˜å­—èŠ‚void writeLong(long v); // å°†ä¸€ä¸ªlongå€¼ä»¥8-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµä¸­ï¼Œå…ˆå†™å…¥é«˜å­—èŠ‚void writeShort(int v); // å°†ä¸€ä¸ªshortå€¼ä»¥2-byteå€¼å½¢å¼å†™å…¥è¾“å‡ºæµä¸­ï¼Œå…ˆå†™å…¥é«˜å­—èŠ‚void writeUTF(Stringstr); // ä»¥ä¸Žæœºå™¨æ— å…³æ–¹å¼ä½¿ç”¨UTF-8ç¼–ç å°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥è¾“å‡ºæµ * Demo /** * DataOutputStreamç±»å†™å…¥æ–‡ä»¶data.tmpçš„è¿‡ç¨‹ã€‚ */public class TestDataOutputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºæ–‡ä»¶è¾“å‡ºæµ FileOutputStream fos = new FileOutputStream(&quot;D:/demo/data.tmp&quot;); // ðŸ”¹ åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ DataOutputStream oos = new DataOutputStream(fos); // ðŸ”¸ å†™å…¥å¯¹è±¡æ•°æ® oos.writeInt(12345); oos.writeBoolean(true); oos.writeFloat(1000.0f); // ðŸ”¹ å…³é—­è¾“å‡ºæµ oos.close(); fos.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œå°†ä¼šå°†å¯¹è±¡æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ã€‚ ï¼ˆä¹ï¼‰è¡Œå·è¾“å…¥æµï¼ˆ1ï¼‰LineNumberInputStreamLineNumberInputStream å¯è·Ÿè¸ªè¡Œå·ã€è®¾ç½®è¡Œå·ã€å¯¹è¡Œåšæ ‡è®°ä»¥ä¾¿æ¢å¤ç­‰åŠŸèƒ½ã€‚ åè¯ è¯´æ˜Ž è¡Œ ä»¥å›žè½¦ç¬¦ï¼ˆ\\rï¼‰ã€æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰ã€å›žè½¦ç¬¦åŽç´§è·Ÿçš„æ¢è¡Œç¬¦ï¼ˆ\\r\\nï¼‰ï¼ˆä¸‰ç§æƒ…å†µï¼‰ç»“å°¾çš„å­—èŠ‚åºåˆ—ã€‚ è¡Œå· ä»¥0å¼€å¤´ï¼Œå¹¶åœ¨readè¿”å›žæ¢è¡Œç¬¦æ—¶é€’å¢ž1ã€‚ * æ–¹æ³•ï¼šï¼ˆDeprecatedï¼‰ getLineNumber(); // å–å¾—è¡Œå·setLineNumber(); // è®¾ç½®è¡Œå· * demoï¼š /** * æŒ‰ç…§æ–‡ä»¶çš„è¡Œè¯»å–ï¼Œè¾“å‡ºæ¯ä¸€è¡Œçš„è¡Œå·å’Œå†…å®¹ã€‚ */public class TestLineNumberInputStream &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºæ–‡ä»¶è¾“å…¥æµ FileInputStream fis = new FileInputStream(&quot;D:/demo/test.txt&quot;); // ðŸ”¹ åˆ›å»ºè¡Œå·è¾“å…¥æµ LineNumberInputStream lis = new LineNumberInputStream(fis); // ðŸ”¹ åˆ›å»ºæ•°æ®è¾“å…¥æµï¼šé€šè¿‡DataInputStream è¿›è¡Œè¾“å…¥æµè¿‡æ»¤ï¼ŒèŽ·å¾—readLine()çš„åŠŸèƒ½ã€‚ DataInputStream dis = new DataInputStream(lis); // ðŸ”¸ è¯»å–æ•°æ® String line; while ((line = dis.readLine()) != null) &#123; System.out.println(lis.getLineNumber() + &quot;:&quot; + line); &#125; // å…³é—­è¾“å…¥æµ dis.close(); lis.close(); fis.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// 1:hello,World!// 2:hello,China!// 3:Hello,Beijing! ï¼ˆ2ï¼‰LineNumberReader* æž„é€ æ–¹æ³•ï¼š ç”±äºŽè¯¥ç±»ç»§æ‰¿è‡ªBufferedReaderï¼Œå› æ­¤å®ƒæ‹¥æœ‰ä¸ŽBufferedReaderç›¸åŒçš„ä¸¤ä¸ªæž„é€ æ–¹æ³•ï¼š LineNumberReader(Reader in); // ä½¿ç”¨é»˜è®¤è¾“å…¥ç¼“å­˜åŒºçš„å¤§å°åˆ›å»ºæ–°çš„è¡Œç¼–å·readerLineNumberReader(Reader in,int sz); // åˆ›å»ºæ–°çš„è¡Œç¼–å·readerï¼Œå°†å­—ç¬¦è¯»å…¥ç»™å®šå¤§å°çš„ç¼“å­˜åŒº * æ–¹æ³•ï¼š getLineNumber(); // å–å¾—è¡Œå· setLineNumber(int); // è®¾ç½®è¡Œå·// æ³¨æ„ï¼šsetLineNumber(int)ä¸ä¼šå®žé™…æ›´æ”¹æµä¸­çš„å½“å‰ä½ç½®ï¼›å®ƒåªæ›´æ”¹ç”±getLineNumber()è¿”å›žçš„å€¼ * demoï¼š /** * æ ¹æ®æ–‡ä»¶è¾“å…¥æµfisåˆ›å»ºè¡Œå·è¾“å…¥æµçš„æ–¹æ³•ï¼Œ * é€šè¿‡lisçš„readLine()æ–¹æ³•å¯ä»¥è¯»å–ä¸€è¡Œæ•°æ®ï¼Œä½¿ç”¨getLineNumber()å–å¾—è¡Œå·ï¼Œå¹¶è¾“å‡ºè¡Œå·å’Œè¯¥è¡Œå†…å®¹ã€‚ */public class TestLineNumberReader &#123; public static void main(String[] args) &#123; try &#123; // ðŸ”¹ åˆ›å»ºæ–‡ä»¶è¾“å…¥æµ FileReader fis = new FileReader(&quot;D:/demo/test.txt&quot;); // ðŸ”¹ åˆ›å»ºè¡Œå·è¾“å…¥æµ LineNumberReader lis = new LineNumberReader(fis); // ðŸ”¸ è¯»å–æ•°æ® String line; while ((line = lis.readLine()) != null) &#123; System.out.println(lis.getLineNumber() + &quot;:&quot; + line); &#125; // å…³é—­è¾“å…¥æµ lis.close(); fis.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// 1:hello,World!// 2:hello,China!// 3:Hello,Beijing! ï¼ˆåï¼‰æŽ¨å›žè¾“å…¥æµPushbackInputStream å’Œ PushbackReader ä¸ºå¦ä¸€ä¸ªè¾“å…¥æµæ·»åŠ æ€§èƒ½ï¼Œå…è®¸å°†å­—èŠ‚(å­—ç¬¦)æŽ¨å›žåˆ°æµä¸­ï¼šå³â€œæŽ¨å›žï¼ˆpushbackï¼‰â€æˆ–â€œå–æ¶ˆè¯»å–ï¼ˆunreadï¼‰â€ä¸€ä¸ªå­—èŠ‚(å­—ç¬¦)çš„èƒ½åŠ›ã€‚ PushbackInputStream å’Œ PushbackReader çš„3ä¸ªæ–¹æ³•ï¼š æ–¹æ³• è¯´æ˜Ž void unread(int b) å°†ä¸€ä¸ªå­—èŠ‚/å­—ç¬¦æŽ¨å›žåˆ°æŽ¨å›žç¼“å†²åŒºé‡Œï¼Œä»Žè€Œå…è®¸é‡å¤è¯»å–åˆšåˆšè¯»å–çš„å†…å®¹ã€‚ void unread(byte[]/char[] buf) å°†ä¸€ä¸ªå­—èŠ‚/å­—ç¬¦æ•°ç»„å†…å®¹æŽ¨å›žåˆ°æŽ¨å›žç¼“å†²åŒºé‡Œï¼Œä»Žè€Œå…è®¸é‡å¤è¯»å–åˆšåˆšè¯»å–çš„å†…å®¹ã€‚ void unread(byte[]/char[] b, int off, int len) å°†ä¸€ä¸ªå­—èŠ‚/å­—ç¬¦æ•°ç»„é‡Œä»Žoffå¼€å§‹ï¼Œé•¿åº¦ä¸ºlenå­—èŠ‚/å­—ç¬¦çš„å†…å®¹æŽ¨å›žåˆ°æŽ¨å›žç¼“å†²åŒºé‡Œï¼Œä»Žè€Œå…è®¸é‡å¤è¯»å–åˆšåˆšè¯»å–çš„å†…å®¹ã€‚ åœ¨è¯»å–ç»ˆæ­¢å­—èŠ‚(å­—ç¬¦)åŽï¼Œä»£ç ç‰‡æ®µå¯ä»¥â€œå–æ¶ˆè¯»å–â€è¯¥å­—èŠ‚(å­—ç¬¦)ï¼Œè¿™æ ·ï¼Œè¾“å…¥æµä¸Šçš„ä¸‹ä¸€ä¸ªè¯»å–æ“ä½œå°†ä¼šé‡æ–°è¯»å–è¢«æŽ¨å›žçš„å­—èŠ‚(å­—ç¬¦)ã€‚ å¤„ç†ç¤ºæ„å›¾ éœ€æŒ‡å®šç¼“å†²åŒºå¤§å° å½“åˆ›å»ºä¸€ä¸ª PushbackInputStream å’Œ PushbackReader æ—¶éœ€è¦æŒ‡å®šæŽ¨å›žç¼“å†²åŒºçš„å¤§å°ï¼Œé»˜è®¤çš„æŽ¨å›žç¼“å†²åŒºçš„é•¿åº¦ä¸º1ã€‚ è‹¥ç¨‹åºä¸­æŽ¨å›žåˆ°æŽ¨å›žç¼“å†²åŒºçš„å†…å®¹è¶…å‡ºäº†æŽ¨å›žç¼“å†²åŒºçš„å¤§å°ï¼Œå°†ä¼šå¼•å‘ Pushback buffer overflow çš„ IOException å¼‚å¸¸ã€‚ Demoï¼š public class TestPushbackInputStream &#123; public static void main(String[] args) &#123; try &#123; // åˆ›å»ºæ–‡ä»¶è¾“å…¥æµ FileInputStream fis = new FileInputStream(&quot;D:/demo/test.txt&quot;); // åˆ›å»ºæŽ¨å›žè¾“å…¥æµ PushbackInputStream pis = new PushbackInputStream(fis); // è¯»å–å¯¹è±¡æ•°æ® int c = pis.read(); System.out.print((char)c); pis.unread(c); // ðŸ”» æŽ¨å›žä¸€ä¸ªå­—èŠ‚ c = pis.read(); // å†æ¬¡è¯»å– System.out.print((char)c); // å…³é—­è¾“å…¥æµ pis.close(); fis.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºå°†ä¼šé‡å¤è¾“å‡ºç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚ ï¼ˆåä¸€ï¼‰æ‰“å°æµï¼ˆæ ¼å¼åŒ–ï¼‰ï¼ˆ1ï¼‰PrintStream%%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR A([\"PrintStreamï¼ˆä¸ŽOutputStreamç›¸æ¯”ï¼‰\"]):::p A -.-> a(\"æ·»åŠ äº†ä¸€ç»„ print() / println() æ–¹æ³•ï¼Œå¯ä»¥æ‰“å°å„ç§æ•°æ®ç±»åž‹ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚\"):::lp A -.-> b(\"ä¸ä¼šæŠ›å‡ºIOException\"):::lp A -.-> c(\"è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼šå†™å…¥å†…å®¹åŽè‡ªåŠ¨è°ƒç”¨flush()æ–¹æ³•\"):::lp classDef p fill:#ddaebd classDef lp fill:#f4e4e9 ï¼ˆå­—èŠ‚åž‹ï¼‰PrintStream æ˜¯ä¸€ç§ FilterOutputStreamï¼Œåœ¨ OutputStream çš„æŽ¥å£ä¸Šï¼Œé¢å¤–æä¾›äº†ä¸€äº›å†™å…¥å„ç§æ•°æ®ç±»åž‹çš„æ–¹æ³•ã€‚ä»¥åŠå¯¹åº”çš„ä¸€ç»„ println() æ–¹æ³•ï¼ˆè‡ªåŠ¨åŠ ä¸Šæ¢è¡Œç¬¦ï¼‰ã€‚ æ–¹æ³• è¯´æ˜Ž void print(boolean) å°†booleanç±»åž‹æ•°æ®å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(char) å°†charç±»åž‹æ•°æ®å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(int) å°†intç±»åž‹æ•°æ®å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(long) å°†longç±»åž‹æ•°æ®å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(float) å°†floatç±»åž‹æ•°æ®å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(double) å°†doubleç±»åž‹æ•°æ®å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(char[]) å°†å­—ç¬¦ä¸²æ•°ç»„å†™åˆ°PrintStreamæµä¸­ void print(String) å°†å­—ç¬¦ä¸²å†™åˆ°PrintStreamæµä¸­ void print(Obj) å°†å¯¹è±¡å¯¹åº”å­—ç¬¦ä¸²å†™åˆ°PrintStreamä¸­ ðŸ”º ä¸¤æ–¹æ³•å†™å…¥æ•°æ®æ—¶éƒ½ä¼šå°†æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå®žé™…è°ƒç”¨çš„æ–¹æ³•ï¼šwrite(String s)ã€‚ ptrint(0x61) = write(String.valueOf(0x61)) ï¼ˆ2ï¼‰PrintWriter ï¼ˆå­—ç¬¦åž‹ï¼‰PrintWriteræ‰©å±•äº† Writer æŽ¥å£ï¼Œå®ƒçš„ print() / println() æ–¹æ³•æœ€ç»ˆè¾“å‡ºçš„æ˜¯ char æ•°æ®ã€‚ä½¿ç”¨æ–¹æ³•åŒ PrintStreamã€‚ ï¼ˆ3ï¼‰é‡å®šå‘æ ‡å‡†è¾“å…¥/è¾“å‡º é‡å®šå‘æ ‡å‡†è¾“å…¥/è¾“å‡º Javaçš„æ ‡å‡†è¾“å…¥/è¾“å‡ºåˆ†åˆ«é€šè¿‡ System.inï¼ˆä»Žé”®ç›˜è¾“å…¥ï¼‰å’Œ System.outï¼ˆè¾“å‡ºåˆ°å±å¹•ï¼‰æ¥ä»£è¡¨ã€‚è€Œ System ç±»é‡Œæä¾›äº†å¦‚ä¸‹3ä¸ªé‡å®šå‘æ ‡å‡†è¾“å…¥/è¾“å‡ºçš„æ–¹æ³•ã€‚ æ–¹æ³• è¯´æ˜Ž static void setErr(PrintStream err) é‡å®šå‘ â€œæ ‡å‡†â€é”™è¯¯è¾“å‡ºæµã€‚ static void setIn(InputStream in) é‡å®šå‘â€œæ ‡å‡†â€è¾“å…¥æµã€‚ static void setOut(PrintStream out) é‡å®šå‘ â€œæ ‡å‡†â€è¾“å‡ºæµã€‚ demoï¼šé‡å®šå‘æ ‡å‡†è¾“å‡º /** * é€šè¿‡é‡å®šå‘æ ‡å‡†è¾“å‡ºæµï¼Œå°†System.outçš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶è¾“å‡ºï¼Œè€Œä¸æ˜¯åœ¨å±å¹•ä¸Šè¾“å‡ºã€‚ */public class RedirectOut &#123; public static void main(String[] args) &#123; try( // ä¸€æ¬¡æ€§åˆ›å»ºPrintStreamè¾“å‡ºæµ PrintStream ps=new PrintStream(new FileOutputStream(&quot;out.txt&quot;))) &#123; // å°†ç³»ç»Ÿçš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°psè¾“å‡ºæµ System.setOut(ps); // å‘æ ‡å‡†è¾“å‡ºè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸² System.out.println(&quot;æ™®é€šå­—ç¬¦ä¸²&quot;); // å‘æ ‡å‡†è¾“å‡ºè¾“å‡ºä¸€ä¸ªå¯¹è±¡ System.out.println(new RedirectOut()); &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125;&#125; è¯¥ä»£ç åˆ›å»ºäº†ä¸€ä¸ª PrintStream è¾“å‡ºæµï¼Œå¹¶å°†ç³»ç»Ÿçš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°è¯¥ Print Stream è¾“å‡ºæµã€‚è¿è¡Œè¯¥ç¨‹åºæ— ä»»ä½•è¾“å‡ºï¼šå› ä¸ºæ ‡å‡†è¾“å‡ºä¸å†è¾“å‡ºåˆ°å±å¹•ï¼Œè€Œæ˜¯è¾“å‡ºåˆ° out.txt æ–‡ä»¶ã€‚ demoï¼šé‡å®šå‘æ ‡å‡†è¾“å…¥ /** * ä¸‹é¢ç¨‹åºé‡å®šå‘æ ‡å‡†è¾“å…¥ï¼Œä»Žè€Œå¯ä»¥å°†System.iné‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œè€Œä¸æ˜¯é”®ç›˜è¾“å…¥ã€‚ */public class RedirectIn &#123; public static void main(String[] args) &#123; try( FileInputStream fis=new FileInputStream(&quot;RedirectIn.java&quot;)) &#123; // å°†æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°fisè¾“å…¥æµ System.setIn(fis); // ä½¿ç”¨System.inåˆ›å»ºScannerå¯¹è±¡ï¼Œç”¨äºŽèŽ·å–æ ‡å‡†è¾“å…¥ Scanner sc=new Scanner(System.in); // å¢žåŠ ä¸‹é¢ä¸€è¡ŒåªæŠŠå›žè½¦ä½œä¸ºåˆ†éš”ç¬¦ sc.useDelimiter(&quot;\\n&quot;); // åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªè¾“å…¥é¡¹ while(sc.hasNext()) &#123; // è¾“å‡ºè¾“å…¥é¡¹ System.out.println(&quot;é”®ç›˜è¾“å…¥çš„å†…å®¹æ˜¯ï¼š&quot; + sc.next()); &#125; &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125;&#125; è¯¥ä»£ç åˆ›å»ºäº†ä¸€ä¸ª FileInputStream è¾“å…¥æµï¼Œå¹¶ä½¿ç”¨ System çš„ setIn() æ–¹æ³•å°†ç³»ç»Ÿæ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°è¯¥æ–‡ä»¶è¾“å…¥æµã€‚ è¿è¡Œä¸Šé¢ç¨‹åºï¼Œç¨‹åºä¸ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œè€Œæ˜¯ç›´æŽ¥è¾“å‡ºäº† RedirectIn.java æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™è¡¨æ˜Žç¨‹åºä¸å†ä½¿ç”¨é”®ç›˜ä½œä¸ºæ ‡å‡†è¾“å…¥ï¼Œè€Œæ˜¯ä½¿ç”¨æŒ‡å®šæ–‡ä»¶ä½œä¸ºæ ‡å‡†è¾“å…¥æºã€‚ - end - ðŸ”– ç¬”è®°æ¥è‡ªï¼š ã€ŠJavaç¼–ç¨‹çš„é€»è¾‘ã€‹ ã€ŠJavaé«˜æ‰‹çœŸç»ï¼ˆç¼–ç¨‹åŸºç¡€å·ï¼‰ã€‹ ã€Šç–¯ç‹‚Javaè®²ä¹‰ã€‹ ðŸ“Ž è¡¥å……ï¼š IO - å¯¹è±¡åºåˆ—åŒ–","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"}]},{"title":"IO - Fileã€FileFilter å’Œ FilenameFilter","slug":"note/Basics/IO/IO_File","date":"2023-05-08T12:02:52.578Z","updated":"2023-05-16T12:50:43.105Z","comments":true,"path":"note/Basics/IO/IO_File/","link":"","permalink":"https://equnee.github.io/note/Basics/IO/IO_File/","excerpt":"","text":"java.io - ç›®å½• æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºï¼šSystem æŽ§åˆ¶å°è¯»å†™ç±»ï¼šConsole æ–‡ä»¶åŸºæœ¬å¤„ç† æ–‡ä»¶æ“ä½œç±»ï¼šFile æ–‡ä»¶æœç´¢ç±»ï¼šFileFilterã€FilenameFilter æ–‡ä»¶ä»»æ„è¯»å†™ç±»ï¼šRandomAccessFile è¾“å…¥/è¾“å‡ºæµ è¾“å…¥/è¾“å‡ºæµ - åˆ†ç±» è¾“å…¥/è¾“å‡ºæµ - å®žçŽ°ç±» åºåˆ—åŒ–/ååºåˆ—åŒ– ï¼ˆä¸€ï¼‰File - æ–‡ä»¶å¯¹æ–‡ä»¶å’Œç›®å½•è¿›è¡Œå¢žåˆ æ”¹æŸ¥æ“ä½œ %%{ init: { 'themeVariables': { 'fontSize': '12px' } } }%% graph TD T([\"File æ–‡ä»¶å¯¹è±¡\"]):::p T --> A(\"Fileç±»èƒ½æ“ä½œæ–‡ä»¶æœ¬èº«çš„å±žæ€§\"):::p T -.-x B(\"Fileå¯¹è±¡ä¸èƒ½æ“ä½œæ–‡ä»¶ä¸­çš„å†…å®¹\"):::g A --> a(\"* æŸ¥çœ‹æ–‡ä»¶å±žæ€§#12288;#12288;#12288;* åˆ›å»ºæ–°æ–‡ä»¶ã€æ–‡ä»¶å¤¹* æŸ¥çœ‹çˆ¶çº§ç›®å½•#12288;#12288;#12288;* éåŽ†ã€åˆ é™¤æ–‡ä»¶å¤¹#12288;\"):::lp B -.-> b(\"éœ€è¦é€šè¿‡ I/O çš„æ–¹å¼æ¥å®Œæˆ\"):::lg info(\"fileå¯¹è±¡ä¸æ˜¯çœŸæ­£çš„æ–‡ä»¶ï¼Œè€Œæ˜¯å †å†…å­˜ä¸­åˆ›å»ºå‡ºæ¥çš„ä¸€ä¸ªå¯¹è±¡ç©ºé—´\"):::info classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#a6ccc3 classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#5a5a5f,stroke-dasharray: 3 3, stroke-width: 1px click b \"https://equnee.github.io/note/Basics/IO/IO_IO/\" â‘  å®žçŽ°çš„æŽ¥å£Serializableï¼Œ Comparable â‘¡ æž„é€ æ–¹æ³•åœ¨èƒ½å¤Ÿæ“ä½œç›®å½•æˆ–æ–‡ä»¶ä¹‹å‰ï¼Œè¦å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼ŒæŒ‡å‘ç›®å½•æˆ–æ–‡ä»¶ã€‚ æž„é€ æ–¹æ³• è¯´æ˜Ž ï¼ˆæ²¡æœ‰æ— å‚æž„é€ æ–¹æ³•ï¼‰ File(String pathname) é€šè¿‡å°†ç»™å®šè·¯å¾„åå­—ç¬¦ä¸²è½¬æ¢ä¸ºæŠ½è±¡è·¯å¾„åæ¥åˆ›å»ºä¸€ä¸ªæ–°Fileå®žä¾‹ã€‚ File(File parent, String child) æ ¹æ®parentæŠ½è±¡è·¯å¾„åå’Œchildè·¯å¾„åå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªæ–°Fileå®žä¾‹ã€‚ File(String parent, String child) æ ¹æ®parentè·¯å¾„åå­—ç¬¦ä¸²å’Œchildè·¯å¾„åå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªæ–°Fileå®žä¾‹ã€‚ File(URI uri) é€šè¿‡å°†ç»™å®šçš„ file:URI è½¬æ¢ä¸ºä¸€ä¸ªæŠ½è±¡è·¯å¾„åæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Fileå®žä¾‹ã€‚ â‘¢ å¸¸ç”¨æ–¹æ³• æ–‡ä»¶åŸºæœ¬å±žæ€§ å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž canExecute() å¯æ‰§è¡Œ canRead() å¯è¯» canWrite() å¯å†™ exists() æ–‡ä»¶åæˆ–è·¯å¾„æ˜¯å¦å­˜åœ¨ isHidden() æ˜¯å¦éšè— isFile() åˆ¤æ–­å½“å‰fileæ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡ä»¶ isDirectory() åˆ¤æ–­å½“å‰fileæ˜¯å¦æ˜¯ä¸€ä¸ªç›®å½• isAbsolute() åˆ¤æ–­Fileå¯¹è±¡æ‰€å¯¹åº”çš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„ length() èŽ·å–æ–‡ä»¶ä¸­å­—èŠ‚çš„ä¸ªæ•° lastModified() èŽ·å–æ–‡ä»¶æœ€åŽçš„ä¿®æ”¹æ—¶é—´ï¼ˆlongç±»åž‹ï¼šæ¯«ç§’å€¼ï¼‰ æ–‡ä»¶å å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž è¿”å›žå€¼ç±»åž‹ getName() èŽ·å–æ–‡ä»¶åå­—ï¼ˆTest.txtï¼‰ String name getAbsolutePath() èŽ·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ˆD://test//Test.txtï¼‰ String path getPath() èŽ·å–æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ String path renameTo(File dest) é‡å‘½åï¼Œå‘½åæˆåŠŸè¿”å›žtrue Boolean true åˆ›å»º å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž è¿”å›žå€¼ç±»åž‹ createNewFile() åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼ˆéœ€è¦æ•æ‰IOExceptionï¼‰ boolean mkdir() åˆ›å»ºä¸€ä¸ªç›®å½• boolean mkdirs() åˆ›å»ºæ‰€æœ‰ç›®å½•ï¼ˆåŒæ—¶åˆ›å»ºå¤šå±‚ç›®å½•ï¼‰ boolean createTempFile(String prefix, String suffix, File directory) åœ¨æŒ‡å®šç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ï¼Œä½¿ç”¨ç»™å®šçš„å‰ç¼€å’ŒåŽç¼€å­—ç¬¦ä¸²ç”Ÿæˆå…¶åç§°ã€‚ File èŽ·å–å¯¹è±¡ å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž è¿”å›žå€¼ç±»åž‹ getParent() èŽ·å–å½“å‰Fileçš„çˆ¶ç›®å½•çš„å®Œæ•´è·¯å¾„ String name getParentFile() èŽ·å–å½“å‰Fileçš„çˆ¶äº²fileå¯¹è±¡ File file getAbsoluteFile() è¿”å›žæ­¤Fileå¯¹è±¡æ‰€å¯¹åº”çš„ç»å¯¹è·¯å¾„æ‰€å¯¹åº”çš„Fileå¯¹è±¡ File file list() èŽ·å–å½“å‰Fileå¯¹è±¡çš„æ‰€æœ‰å„¿å­åå­— String[] names listFiles() èŽ·å–å½“å‰Fileå¯¹è±¡çš„æ‰€æœ‰å­å¯¹è±¡ï¼ˆç›®å½•æˆ–æ–‡ä»¶ï¼‰ File[] files static listRoots() åˆ—å‡ºç³»ç»Ÿæ‰€æœ‰çš„æ ¹è·¯å¾„ã€‚ File[] files åˆ é™¤ å¸¸ç”¨æ–¹æ³• è¯´æ˜Ž è¿”å›žå€¼ç±»åž‹ delete() å½»åº•åˆ é™¤æ–‡ä»¶æˆ–ç©ºç›®å½•ï¼Œæ— æ³•åˆ é™¤å¸¦å…ƒç´ çš„æ–‡ä»¶å¤¹ boolean deleteOnExit() åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•å¹¶å…³é—­æµæ“ä½œ boolean - Demopackage com.equne;import java.io.File;import java.io.IOException;public class FileTest&#123; public static void main(String[] args) throws IOException &#123; // ä»¥å½“å‰è·¯å¾„æ¥åˆ›å»ºä¸€ä¸ªFileå¯¹è±¡ File file=new File(&quot;.&quot;); // ç›´æŽ¥èŽ·å–æ–‡ä»¶åï¼Œè¾“å‡ºä¸€ç‚¹ System.out.println(file.getName()); // èŽ·å–ç›¸å¯¹è·¯å¾„çš„çˆ¶è·¯å¾„å¯èƒ½å‡ºé”™ï¼Œä¸‹é¢ä»£ç è¾“å‡ºnull System.out.println(file.getParent()); // èŽ·å–ç»å¯¹è·¯å¾„ System.out.println(file.getAbsoluteFile()); // èŽ·å–ä¸Šä¸€çº§è·¯å¾„ System.out.println(file.getAbsoluteFile().getParent()); // åœ¨å½“å‰è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ File tmpFile=File.createTempFile(&quot;aaa&quot;, &quot;.txt&quot;, file); // æŒ‡å®šå½“JVMé€€å‡ºæ—¶åˆ é™¤è¯¥æ–‡ä»¶ tmpFile.deleteOnExit(); // ä»¥ç³»ç»Ÿå½“å‰æ—¶é—´ä½œä¸ºæ–°æ–‡ä»¶åæ¥åˆ›å»ºæ–°æ–‡ä»¶ File newFile=new File(System.currentTimeMillis() + &quot;&quot;); System.out.println(&quot;newFileå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼š&quot; + newFile.exists()); // ä»¥æŒ‡å®šnewFileå¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ newFile.createNewFile(); // ä»¥newFileå¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå› ä¸ºnewFileå·²ç»å­˜åœ¨ // æ‰€ä»¥ä¸‹é¢æ–¹æ³•è¿”å›žfalseï¼Œå³æ— æ³•åˆ›å»ºè¯¥ç›®å½• newFile.mkdir(); // ä½¿ç”¨list()æ–¹æ³•åˆ—å‡ºå½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œè·¯å¾„ String[] fileList=file.list(); System.out.println(&quot;====å½“å‰è·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œè·¯å¾„å¦‚ä¸‹====&quot;); for (String fileName : fileList) &#123; System.out.println(fileName); &#125; // listRoots()é™æ€æ–¹æ³•åˆ—å‡ºæ‰€æœ‰çš„ç£ç›˜æ ¹è·¯å¾„ File[] roots=File.listRoots(); System.out.println(&quot;====ç³»ç»Ÿæ‰€æœ‰æ ¹è·¯å¾„å¦‚ä¸‹====&quot;); for (File root : roots) &#123; System.out.println(root); &#125; &#125;&#125;/** * . * null * /Users/equne/Desktop/testJava/Test2/. * /Users/equne/Desktop/testJava/Test2 * newFileå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼šfalse * ====å½“å‰è·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œè·¯å¾„å¦‚ä¸‹==== * Test2.iml * out * 1679734377738 * aaa5603141847215609264.txt * .idea * src * ====ç³»ç»Ÿæ‰€æœ‰æ ¹è·¯å¾„å¦‚ä¸‹==== * / * */ (æ‘˜è‡ªã€Šç–¯ç‹‚Javaè®²ä¹‰ã€‹) ï¼ˆäºŒï¼‰FileFilter å’Œ FilenameFilteræŽ¥å£ï¼šå¿«é€Ÿåœ°æŒ‰ç…§ç‰¹å®šè¦æ±‚æ‰¾å‡ºæ‰€æœ‰æ–‡ä»¶ FileFilter ä¸Ž FilenameFilter ç”¨äºŽæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å®ƒä»¬éƒ½æ˜¯æŽ¥å£ï¼Œåªéœ€ç¼–å†™çš„å®žçŽ°ç±»å®žçŽ°å®ƒä»¬çš„å‡½æ•° accept() å³å¯ ã€‚ æŽ¥å£ åŒºåˆ« æ–¹æ³• FileFilter æä¾›æ–‡ä»¶å¯¹è±¡çš„è®¿é—®æ–¹æ³• boolean accept(File file); FilenameFilter æŒ‰ç…§ç›®å½•å’Œæ–‡ä»¶åçš„æ–¹å¼è¿›è¡Œ boolean accept(File directory, String name); â‘  FileFilterDemoï¼šæœç´¢ç‰¹å®šçš„æ–‡ä»¶æ‰©å±•å ExtensionFilter /** * æ‰©å±•åè¿‡æ»¤å™¨ */public class ExtensionFilter implements FileFilter &#123;// ðŸ”´ ä¸€ã€å®šä¹‰ä¸€ä¸ªæ‰©å±•åè¿‡æ»¤å™¨ç±»ï¼šå®žçŽ°æŽ¥å£ FileFilter private String extension; // æ‰©å±•å // ðŸ”´ äºŒã€æž„é€ å‡½æ•°ä¸­åˆå§‹åŒ–å˜é‡extensionï¼šå¾…åŒ¹é…çš„æ–‡ä»¶æ‰©å±•å public ExtensionFilter(String extension) &#123; this.extension = extension; &#125; // ðŸ”´ äºŒã€æŽ¥å£å‡½æ•°ï¼šå®žçŽ°æ‰©å±•åè¿‡æ»¤ public boolean accept(File file) &#123; // ðŸ”¹ è‹¥ä¸ºç›®å½•ï¼šè¿”å›žfalse if (file.isDirectory()) &#123; return false; &#125; // å–å¾—æ–‡ä»¶å String name = file.getName(); // å–å¾—æ‰©å±•åå‰çš„ç¬¦å·â€œ.â€çš„ä¸‹æ ‡ä½ç½® int index = name.lastIndexOf(&quot;.&quot;); // ðŸ”¹ åˆ¤æ–­æ‰©å±•å if(index == -1)&#123; // è‹¥æ²¡æœ‰æ‰©å±•åï¼šè¿”å›žfalse return false; &#125; else if(index == name.length() - 1)&#123; // è‹¥ä»¥ç‚¹å·ç»“å°¾ï¼šè¿”å›žfalse return false; &#125; else&#123; // è‹¥æ‰©å±•åç›¸åŒï¼šè¿”å›žtrue return this.extension.equals(name.substring(index + 1)); &#125; &#125;&#125; TestFile /** * æµ‹è¯•ç±»ï¼šä½¿ç”¨ä¸Šè¿°çš„ExtensionFilterç±»æ¥æŸ¥æ‰¾ D:/demo ç›®å½•ä¸‹ã€æ‰©å±•åä¸ºtxtçš„æ–‡ä»¶åˆ—è¡¨ã€‚ */public class TestFile &#123; public static void main(String[] args) &#123; File file = new File(&quot;D:/demo&quot;); // åˆ›å»ºä¸€ä¸ªtxtè¿‡æ»¤å™¨ ExtensionFilter txtFilter = new ExtensionFilter(&quot;txt&quot;); // ä½¿ç”¨è¿‡æ»¤å™¨æŸ¥æ‰¾txtæ–‡ä»¶ File[] files = file.listFiles(txtFilter); // è¾“å‡ºæŸ¥æ‰¾çš„æ–‡ä»¶åˆ—è¡¨ for (int i = 0; i ï¼œ files.length; i++) &#123; System.out.println(files[i].getAbsolutePath()); &#125; &#125; &#125;// D:\\demo\\test.txt// D:\\demo\\test2.txt è‹¥ä½¿ç”¨ FilenameFilterï¼Œç»“æžœä¼šè®©ä½ å¾ˆéš¾åˆ¤æ–­åˆ°åº•æ˜¯ç›®å½•è¿˜æ˜¯æ–‡ä»¶ã€‚ â‘¡ FilenameFilterFilenameFilter çš„è¿‡æ»¤å‡½æ•° accept() ç›´æŽ¥æ ¹æ®ç›®å½•å’Œæ–‡ä»¶åè¿›è¡Œè¿‡æ»¤ï¼Œä¸Ž FileFilter ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæ–‡ä»¶åå‚æ•°ã€‚é€šå¸¸æˆ‘ä»¬éƒ½å»ºè®®ä½¿ç”¨ FilenameFilter ç±»è¿›è¡Œæ–‡ä»¶è¿‡æ»¤ã€‚ Demoï¼šå›¾ç‰‡è¿‡æ»¤å™¨ ImageFilter /** * å›¾ç‰‡è¿‡æ»¤å™¨ï¼šè¿‡æ»¤æ‰©å±•åä¸º.gif,.jpg,.pngçš„æ–‡ä»¶ */public class ImageFilter implements FilenameFilter &#123; // ðŸ”¹ gifç±»åž‹æ–‡ä»¶ public boolean isGif(String filename) &#123; if (filename.toLowerCase().endsWith(&quot;.gif&quot;)) &#123; return true; &#125; else &#123; return false; &#125; &#125; // ðŸ”¹ jpgç±»åž‹æ–‡ä»¶ public boolean isJpg(String filename) &#123; if (filename.toLowerCase().endsWith(&quot;.jpg&quot;)) &#123; return true; &#125; else &#123; return false; &#125; &#125; // ðŸ”¹ pngç±»åž‹æ–‡ä»¶ public boolean isPng(String filename) &#123; if (filename.toLowerCase().endsWith(&quot;.png&quot;)) &#123; return true; &#125; else &#123; return false; &#125; &#125; // ðŸ”´ æŽ¥å£å‡½æ•°ï¼šå®žçŽ°æ‰©å±•åè¿‡æ»¤ public boolean accept(File dir, String filename) &#123; return (isGif(filename) || isJpg(filename) || isPng(filename)); &#125;&#125; TestFile public class TestFile &#123; public static void main(String[] args) &#123; // ç›®å½•å®žä¾‹ File file = new File(&quot;D:/demo&quot;); // ---------- FileFilter ------------ // åˆ›å»ºä¸€ä¸ªtxtè¿‡æ»¤å™¨ ExtensionFilter txtFilter = new ExtensionFilter(&quot;txt&quot;); // ä½¿ç”¨è¿‡æ»¤å™¨æŸ¥æ‰¾txtæ–‡ä»¶ File[] files = file.listFiles(txtFilter); // è¾“å‡ºæŸ¥æ‰¾çš„æ–‡ä»¶åˆ—è¡¨ for (int i = 0; i ï¼œ files.length; i++) &#123; System.out.println(files[i].getAbsolutePath()); &#125; // --------- FilenameFilter ----------- // åˆ›å»ºä¸€ä¸ªå›¾ç‰‡è¿‡æ»¤å™¨ ImageFilter imageFilter = new ImageFilter(); // ä½¿ç”¨è¿‡æ»¤å™¨æŸ¥æ‰¾å›¾ç‰‡æ–‡ä»¶ File[] images = file.listFiles(imageFilter); // è¾“å‡ºæŸ¥æ‰¾çš„æ–‡ä»¶åˆ—è¡¨ for (int i = 0; i ï¼œ images.length; i++)&#123; System.out.println(images[i].getAbsolutePath()); &#125; &#125;&#125;// D:\\demo\\a.jpg// D:\\demo\\b.gif ï¼ˆæ‘˜è‡ªï¼šã€ŠJavaé«˜æ‰‹çœŸç»ï¼ˆç¼–ç¨‹åŸºç¡€å·ï¼‰ã€‹ï¼‰ ï¼ˆä¸‰ï¼‰*é€’å½’ - éåŽ†æ–‡ä»¶å¤¹â‘  é€’å½’ æœ¬è´¨ï¼šæ–¹æ³•çš„è°ƒç”¨ ï¼ˆå³è‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œä¸”æ¯æ¬¡ä¼ çš„å‚æ•°éƒ½ä¸ä¸€æ ·ï¼‰ public class newTestFile&#123; public void buildTower(int floor)&#123; // è®¾è®¡ä¸€ä¸ªæ–¹æ³•ï¼Œæè¿°ç›–å®å¡” if(floor&gt;1)&#123; this.buildTower(floor-1); &#125; System.out.println(&quot;æ”¹åˆ°ç¬¬&quot;+ floor + &quot;å±‚å•¦&quot;); // è‡ªå·±æ‰§è¡Œ &#125;&#125; å†…å­˜ç»“æž„å›¾ï¼š â‘¡ éåŽ†æ–‡ä»¶å¤¹/* * éåŽ†æ–‡ä»¶å¤¹ã€‚å‚æ•°ï¼šfileï¼ˆä»£è¡¨æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼‰ */import java.io.File;public class newTestFile&#123; public void showFile(File file)&#123; File[] files = File.listFiles(); // å¦‚æžœåœ¨è°ƒç”¨å‰è¾“å‡ºï¼Œåˆ™ç›¸åè¾“å‡º if (files != null &amp;&amp; files.length != 0)&#123; // ðŸ”¹ éžæ–‡ä»¶ &amp;&amp; éžç©ºæ–‡ä»¶å¤¹ for(File f : files)&#123; // éåŽ† this.showFile(); // ðŸ”¹ é€’å½’ &#125; &#125; System.out.println(file.getAbsolutePath()); &#125;&#125; åˆ é™¤æ–‡ä»¶å¤¹ï¼šfile.delete(); // å°†ä¸Šé¢çš„ä¾‹å­æ›¿æ¢ - end -","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"}]},{"title":"IO - æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º","slug":"note/Basics/IO/IO_StandardIO","date":"2023-05-06T15:10:06.697Z","updated":"2023-05-16T12:51:00.635Z","comments":true,"path":"note/Basics/IO/IO_StandardIO/","link":"","permalink":"https://equnee.github.io/note/Basics/IO/IO_StandardIO/","excerpt":"","text":"java.io - ç›®å½• æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºï¼šSystem æŽ§åˆ¶å°è¯»å†™ç±»ï¼šConsole æ–‡ä»¶åŸºæœ¬å¤„ç† æ–‡ä»¶æ“ä½œç±»ï¼šFile æ–‡ä»¶æœç´¢ç±»ï¼šFileFilterã€FilenameFilter æ–‡ä»¶ä»»æ„è¯»å†™ç±»ï¼šRandomAccessFile è¾“å…¥/è¾“å‡ºæµ è¾“å…¥/è¾“å‡ºæµ - åˆ†ç±» è¾“å…¥/è¾“å‡ºæµ - å®žçŽ°ç±» åºåˆ—åŒ–/ååºåˆ—åŒ– ä¸€ã€æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºç±» - SystemSystemæ˜¯Javaç³»ç»Ÿä¸­ä¸€ä¸ªæœ€å¸¸ä½¿ç”¨çš„ç±»ï¼šJavaçš„ç³»ç»Ÿç±»ã€‚ %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR t((\"Systemï¼ˆç³»ç»Ÿç±»ï¼‰\")):::p --> T subgraph é™æ€æ–¹æ³• T([é™æ€æ–¹æ³•]):::p T --> 1(\"æ ‡å‡†è¾“å‡º out æ ‡å‡†è¾“å…¥ in æ ‡å‡†é”™è¯¯è¾“å‡º err\"):::lp T -.- 2(\"è®¿é—®å¤–éƒ¨å®šä¹‰çš„å±žæ€§å’ŒçŽ¯å¢ƒå˜é‡\"):::info T -.- 3(\"åŠ è½½æ–‡ä»¶å’Œåº“\"):::info T -.- 4(\"å¿«é€Ÿå¤åˆ¶æ•°ç»„\"):::info T -.- 5(\"å–å¾—ç³»ç»Ÿæ—¶é—´ï¼šSystem.currentTimeMillis()\"):::info T -.- 6(\"ç³»ç»Ÿé€€å‡ºå‘½ä»¤ï¼šSystem.exit()\"):::info end t --> T2([\"é™æ€æˆå‘˜å˜é‡\"]):::b subgraph \"é™æ€æˆå‘˜å˜é‡(ç”¨äºŽè¿žæŽ¥åˆ°æ ‡å‡†è¾“å…¥/è¾“å‡ºæŽ§åˆ¶è®¾å¤‡ï¼ˆé”®ç›˜å’ŒæŽ§åˆ¶å°ï¼‰)\" T2 --> 7(\"æ ‡å‡†è¾“å‡ºæµï¼šstatic PrintStream out\"):::lb T2 --> 8(\"æ ‡å‡†é”™è¯¯è¾“å‡ºæµï¼šstatic PrintStream err\"):::lb T2 --> 9(\"æ ‡å‡†è¾“å…¥æµï¼šstatic PrintStream in\"):::lb end 7 -.- 7t(\"System.out.print()System.out.println()\"):::lg 8 -.- 8t(\"System.err.print()\"):::lg 9 -.- 9t(\"System.in.read()System.in.read(b)\"):::lg classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info color:#4e4e52,stroke-dasharray: 3 3, stroke-width: 2px â‘  out æ ‡å‡†è¾“å‡ºæµè¾“å‡ºæ¶ˆæ¯åˆ°æŽ§åˆ¶å° // ------ * ç¼–å†™ä¸€è¡Œè¾“å‡ºæ•°æ® ----------------------------------System.out.println(data);// ------ è¾“å‡ºå„ç§ç±»åž‹çš„æ•°å€¼ -----------------------------------void print(boolean b); // æ‰“å°booleanå€¼void print(char c); // æ‰“å°å­—ç¬¦void print(char[]s); // æ‰“å°å­—ç¬¦æ•°ç»„void print(double d); // æ‰“å°åŒç²¾åº¦æµ®ç‚¹æ•°void print(float f); // æ‰“å°æµ®ç‚¹æ•°void print(int i); // æ‰“å°æ•´æ•°void print(long l); // æ‰“å°longæ•´æ•°void print(Object obj); // æ‰“å°å¯¹è±¡void print(String s); // æ‰“å°å­—ç¬¦ä¸²// ------ è¾“å‡ºå„ç§ç±»åž‹çš„æ•°å€¼ + æ¢è¡Œ -------------------------------void println(boolean x); // æ‰“å°booleanå€¼ï¼Œç„¶åŽç»ˆæ­¢è¡Œvoid println(char x); // æ‰“å°å­—ç¬¦ï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(char[]x); // æ‰“å°å­—ç¬¦æ•°ç»„ï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(double x); // æ‰“å°doubleï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(float x); // æ‰“å°floatï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(int x); // æ‰“å°æ•´æ•°ï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(long x); // æ‰“å°longï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(Object x); // æ‰“å°Objectï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œvoid println(String x); // æ‰“å°Stringï¼Œç„¶åŽç»ˆæ­¢è¯¥è¡Œ // ------ ç›´æŽ¥è¾“å‡ºå­—èŠ‚æ•°æ®ï¼ˆå­—èŠ‚æµï¼‰ --------------------------------void write(int b); // å°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥æ­¤æµvoid write(byte[] buf, int off, int len); // å°†lenå­—èŠ‚ä»ŽæŒ‡å®šçš„åˆå§‹åç§»é‡ä¸ºoffçš„byteæ•°ç»„å†™å…¥æ­¤æµ â‘¡ err æ ‡å‡†é”™è¯¯è¾“å‡ºæµè¾“å‡ºé”™è¯¯æ¶ˆæ¯åˆ°æŽ§åˆ¶å° System.err.println(data); /* æ­¤è¾“å‡ºæµç”¨äºŽæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼Œæˆ–è€…æ˜¾ç¤ºé‚£äº›å³ä½¿ç”¨æˆ·è¾“å‡ºæµï¼ˆå˜é‡outçš„å€¼ï¼‰å·²ç»é‡å®šå‘åˆ°é€šå¸¸ä¸è¢«è¿žç»­ç›‘è§†çš„æŸä¸€æ–‡ä»¶æˆ–å…¶ä»–ç›®æ ‡ï¼Œä¹Ÿåº”è¯¥ç«‹åˆ»å¼•èµ·ç”¨æˆ·æ³¨æ„çš„å…¶ä»–ä¿¡æ¯ã€‚ */ â‘¢ in æ ‡å‡†è¾“å…¥æµæŽ¥æ”¶é”®ç›˜è¾“å…¥ read() // è¯»å–ä¸€ä¸ªå­—èŠ‚read(byte[] b) // è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°ç»„ 1. read()public class TestSystemInRead &#123; public static void main(String args[]) &#123; try &#123; int c; while((c=System.in.read())!=0)&#123; // ä»ŽæŽ§åˆ¶å°è¯»å…¥ä¸€ä¸ªå­—èŠ‚ï¼ˆ8bitï¼‰ System.out.write(c); // è¾“å‡ºä¸€ä¸ªå­—èŠ‚ &#125; &#125; catch (Exception e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œåœ¨æŽ§åˆ¶å°è¾“å…¥ä¸€æ®µå­—ç¬¦åŽæŒ‰å›žè½¦é”®ï¼Œå°±ä¼šè°ƒç”¨read()å‡½æ•°çš„å¾ªçŽ¯ï¼Œ// æ¯è¯»åˆ°ä¸€ä¸ªå­—èŠ‚å°±ä¼šè¾“å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œå› æ­¤å›žè½¦å‰è¾“å…¥çš„å­—ç¬¦ä¸²å°±ä¼šåŽŸæ ·è¾“å‡ºã€‚ 2. read(byte[] b)/** * é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º100çš„å­—èŠ‚æ•°ç»„ï¼Œè¡¨ç¤ºä¸€æ¬¡å¯ä»¥è¯»å–100ä¸ªå­—èŠ‚ã€‚ * ç„¶åŽä½¿ç”¨read(byte[] b)è¯»å–100ä¸ªå­—èŠ‚åˆ°byteä¸­ï¼Œå†è°ƒç”¨write()å‡½æ•°è¾“å‡ºè¿™ä¸ªå­—èŠ‚æ•°ç»„åˆ°æŽ§åˆ¶å°ä¸­ã€‚ */public class TestSystemInReadByte &#123; public static void main(String args[]) &#123; try &#123; byte[]b=new byte[100]; // åˆ›å»ºå­—èŠ‚æ•°ç»„ System.in.read(b); // è¯»å–åˆ°æ•°ç»„ä¸­ System.out.write(b,0,100); // è¾“å‡ºå­—èŠ‚æ•°ç»„ &#125; catch (Exception e) &#123; &#125; &#125;&#125;// è¿è¡Œè¯¥ç¨‹åºï¼Œè¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå›žè½¦åŽå°±ä¼šè¾“å‡ºå›žè½¦å‰å­—ç¬¦ä¸²çš„å‰100ä¸ªå­—ç¬¦ã€‚// å¦‚æžœä½ è¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦å°äºŽ100ï¼Œé‚£ä¹ˆä¸ºäº†è¡¥å…¨100ä¸ªå­—èŠ‚ï¼Œå‰©ä½™çš„å­—èŠ‚å°†ä¼šä½¿ç”¨æ–¹æ¡†â€œâ–¡â€è¡¨ç¤ºï¼Œå®žé™…ä¸Šæ˜¯è¿™ä¸ªå­—èŠ‚æ²¡æœ‰æ•°æ®ã€‚// å¦‚æžœè¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äºŽ100ï¼Œå¤šä½™çš„å­—èŠ‚å°±ä¼šè¢«æŠ›å¼ƒã€‚ äºŒã€æŽ§åˆ¶å°è¯»å†™ç±» - Console Consoleç±»ä¼˜ç‚¹ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR A([\"System ç¼ºç‚¹\"]):::g B([\"Console ä¼˜ç‚¹\"]):::p A -.- 1(\"è¯»å…¥çš„å­—èŠ‚æ•°ç»„é•¿åº¦æœ‰100çš„é™åˆ¶ï¼šè‹¥å­—ç¬¦ä¸²é•¿åº¦å°äºŽ100å°†ä¼šä½¿ç”¨æ–¹æ¡†ä»£æ›¿ï¼Œè‹¥å¤§äºŽ100å°†ä¼šè¢«æŠ›å¼ƒã€‚\"):::lg B -.- 2(\"ä¸éœ€è¦æ•æ‰å¼‚å¸¸ï¼Œè¯¥å‡½æ•°æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸\"):::lp B -.- 3(\"ä¸éœ€è¦å°†å­—èŠ‚æ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç›´æŽ¥è¯»å…¥å³å­—ç¬¦ä¸²\"):::lp B -.- 4(\"å¯ä»¥å®Œæ•´è¯»å–ä¸€è¡Œè¾“å…¥å¹¶å®Œæ•´è¾“å‡ºï¼Œæ²¡æœ‰æŠ›å¼ƒå’Œå¡«å……\"):::lp classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px Consoleç±»æ–¹æ³•å¯è®¿é—®ä¸Žå½“å‰Javaè™šæ‹Ÿæœºå…³è”çš„åŸºäºŽå­—ç¬¦çš„æŽ§åˆ¶å°è®¾å¤‡(è‹¥æœ‰)ï¼Œå¸¸æŒ‡é”®ç›˜ã€‚ è™šæ‹Ÿæœºæ˜¯å¦å…·æœ‰æŽ§åˆ¶å°å–å†³äºŽåº•å±‚å¹³å°ï¼Œè¿˜å–å†³äºŽè°ƒç”¨è™šæ‹Ÿæœºçš„æ–¹å¼ï¼š %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph T([\"è®¿é—®ä¸Žè™šæ‹Ÿæœºå…³è”çš„æŽ§åˆ¶å°è®¾å¤‡\"]):::p T --> A(\"â‘  è™šæ‹Ÿæœºä»Žäº¤äº’å¼å‘½ä»¤è¡Œå¯åŠ¨ï¼Œä¸”æ²¡æœ‰é‡å®šå‘æ ‡å‡†è¾“å…¥å’Œè¾“å‡ºæµ\"):::lp T --> B(\"â‘¡ è™šæ‹Ÿæœºè‡ªåŠ¨å¯åŠ¨ ï¼ˆå¦‚ï¼Œç”±åŽå°ä½œä¸šè°ƒåº¦ç¨‹åºå¯åŠ¨ï¼‰\"):::lg A -.- a([\"æŽ§åˆ¶å°å­˜åœ¨\"]):::p B -.- b([\"æ— æŽ§åˆ¶å°\"]):::g a -.- |\"è¿žæŽ¥åˆ°è®¾å¤‡ï¼ˆé”®ç›˜ï¼‰\"|1(\"ç”±æ­¤ç±»å”¯ä¸€çš„å®žä¾‹è¡¨ç¤ºï¼ˆè°ƒç”¨ System.console() èŽ·å¾—ï¼‰\"):::lp a -.- |\"æ— å¯ç”¨è®¾å¤‡\"|2(\"å¯¹è¯¥æ–¹æ³•çš„è°ƒç”¨è¿”å›žnull\"):::info %% å°†ç”±æ­¤ç±»å”¯ä¸€çš„å®žä¾‹è¡¨ç¤ºï¼ˆå¯é€šè¿‡è°ƒç”¨ System.console() èŽ·å¾—ï¼‰\") classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px â‘  è¯»å–ä¿¡æ¯ readLine()ä»ŽæŽ§åˆ¶å°è¯»å–è¾“å…¥çš„å­—ç¬¦ä¸² System.console().readLine(); /** * ä½¿ç”¨äº†System.console()å‡½æ•°å–å¾—äº†Consoleå¯¹è±¡ï¼Œ * ç„¶åŽä½¿ç”¨readLine()å‡½æ•°å³å¯è¯»å–ä¸€è¡Œå­—ç¬¦ä¸²çš„è¾“å…¥ã€‚è¯¥å‡½æ•°åœ¨ç”¨æˆ·æ‰§è¡Œå›žè½¦æ—¶è°ƒç”¨ã€‚ */public class TestConsole &#123; public static void main(String args[]) &#123; while (true) &#123; String str = System.console().readLine(); // å–å¾—è¾“å…¥å­—ç¬¦ä¸² System.out.println(str); // è¾“å‡ºå­—ç¬¦ä¸² &#125; &#125;&#125; â‘¡ è¾“å‡ºä¿¡æ¯ printf()ä»ŽæŽ§åˆ¶å°è¾“å‡ºæ¶ˆæ¯ System.console().printf(str); æ³¨ï¼šå…¶è¯»å†™æ“ä½œæ˜¯åŒæ­¥çš„ï¼Œä»¥ä¿è¯å…³é”®æ“ä½œèƒ½å®Œæ•´å®Œæˆã€‚å› æ­¤è°ƒç”¨readLine()ã€printf()æ—¶å¯èƒ½é˜»å¡žã€‚ â‘¢ è¯»å–å¯†ç  readPassword() åº”ç”¨ç¨‹åºéœ€è¦è¯»å–å¯†ç æˆ–å…¶ä»–å®‰å…¨æ•°æ®ï¼Œåˆ™åº”ä½¿ç”¨ readPassword() æˆ– readPassword(String, Objectâ€¦)ï¼Œå¹¶åœ¨æ‰§è¡ŒåŽæ‰‹å·¥å°†è¿”å›žçš„å­—ç¬¦æ•°ç»„å½’é›¶ï¼Œä»¥æœ€å¤§é™åº¦åœ°ç¼©çŸ­å†…å­˜ä¸­æ•æ„Ÿæ•°æ®çš„ç”Ÿå­˜æœŸã€‚ è¯»å–å¯†ç  System.console().readPassword() public class TestConsolePassword &#123; public static void main(String args[]) &#123; while (true) &#123; char password[] = System.console().readPassword(); // å–å¾—å¯†ç  System.out.println(password); // è¾“å‡ºå­—ç¬¦ä¸² &#125; &#125;&#125;// å®ƒç›´æŽ¥ç›‘æŽ§é”®ç›˜çš„è¾“å…¥ï¼Œå›žè½¦åŽå³å¯å–å¾—å¯†ç å­—ç¬¦ä¸²ã€‚ è¯»å–å¯†ç æ—¶æ·»åŠ æç¤ºä¿¡æ¯ System.console().readPassword(&quot;[%s]&quot;, &quot;è¯·è¾“å…¥å¯†ç ï¼š&quot;);// å­—ç¬¦ä¸²â€œè¯·è¾“å…¥å¯†ç ï¼šâ€å°†ä½œä¸ºæç¤ºä¿¡æ¯æ˜¾ç¤ºåœ¨æŽ§åˆ¶å°çª—å£ä¸­ã€‚ - end - ðŸ”– ç¬”è®°æ¥è‡ªï¼šã€ŠJavaé«˜æ‰‹çœŸç»ï¼ˆç¼–ç¨‹åŸºç¡€å·ï¼‰ã€‹","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"}]},{"title":"IO - åºåˆ—åŒ–/ååºåˆ—åŒ–","slug":"note/Basics/IO/IO_Object_serialization","date":"2023-05-05T12:22:20.301Z","updated":"2023-05-19T15:49:38.404Z","comments":true,"path":"note/Basics/IO/IO_Object_serialization/","link":"","permalink":"https://equnee.github.io/note/Basics/IO/IO_Object_serialization/","excerpt":"","text":"java.io - ç›®å½• æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºï¼šSystem æŽ§åˆ¶å°è¯»å†™ç±»ï¼šConsole æ–‡ä»¶åŸºæœ¬å¤„ç† æ–‡ä»¶æ“ä½œç±»ï¼šFile æ–‡ä»¶æœç´¢ç±»ï¼šFileFilterã€FilenameFilter æ–‡ä»¶ä»»æ„è¯»å†™ç±»ï¼šRandomAccessFile è¾“å…¥/è¾“å‡ºæµ è¾“å…¥/è¾“å‡ºæµ - åˆ†ç±» è¾“å…¥/è¾“å‡ºæµ - å®žçŽ°ç±» åºåˆ—åŒ–/ååºåˆ—åŒ– åºåˆ—åŒ–ï¼šå°†ç¨‹åºä¸­çš„ç»“æž„ä½“ã€å¯¹è±¡ç­‰ç»“æž„åŒ–å†…å­˜å¯¹è±¡è½¬æ¢ä¸ºæ‰å¹³çš„äºŒè¿›åˆ¶æµï¼›ååºåˆ—åŒ–ï¼šå°†äºŒè¿›åˆ¶æµè¿˜åŽŸä¸ºç»“æž„åŒ–å†…å­˜å¯¹è±¡ã€‚ %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph LR subgraph \"åº”ç”¨å±‚1\" A(\"ç»“æž„ä½“ã€å¯¹è±¡ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰\"):::lb end subgraph \"åº”ç”¨å±‚2\" B(\"ç»“æž„ä½“ã€å¯¹è±¡ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰\"):::lb end subgraph ç½‘ç»œåè®® C(\"äºŒè¿›åˆ¶æµ\"):::p A -.-> |\"[è½¬æ¢]\"|C -.-> |\"[è¿˜åŽŸ]\"|B end style ç½‘ç»œåè®® fill:#f4e4e9, stroke-dasharray: 3 3, stroke-width: 2px classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ä¸€ã€å®žçŽ°æ–¹å¼ï¼ˆ1ï¼‰Serializable + é»˜è®¤è‡ªå®šä¹‰ç±»å®žçŽ°Serializableï¼Œä¸åŒ…å« readObject() å’Œ writeObject()ã€‚ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼è¿›è¡Œæ•°æ®å†™å…¥å’Œè¯»å–æ“ä½œã€‚ * Demoï¼š public class Person implements Serializable &#123; private static final long serialVersionUID = 1L; private String name; private int age; public Person(String name, int age) &#123; this.name = name; this.age = age; &#125;&#125; ï¼ˆ2ï¼‰Serializable + è‡ªå®šä¹‰è‡ªå®šä¹‰ç±»å®žçŽ°Serializableï¼ŒåŒ…å« readObject() å’Œ writeObject()ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹å¼è¿›è¡Œæ•°æ®å†™å…¥å’Œè¯»å–æ“ä½œã€‚ * Demoï¼š public class Person implements Serializable &#123; private static final long serialVersionUID = 1L; private String name; private int age; public Person(String name, int age) &#123; this.name = name; this.age = age; &#125; // ðŸ”» readObject() å’Œ writeObject() çš„å¯è§æ€§æ²¡æœ‰é™åˆ¶ï¼šprivateã€protectedã€defaultã€public private void writeObject(ObjectOutputStream outputStream) throws Exception &#123; // çœç•¥å®žçŽ° &#125; private void readObject(ObjectIntputStream inputStream) throws Exception &#123; // çœç•¥å®žçŽ° &#125;&#125; ï¼ˆ3ï¼‰Externalizableè‡ªå®šä¹‰ç±»å®žçŽ° Externalizableï¼Œé‡å†™ readExternal() å’Œ writeExternal() å®žçŽ°åºåˆ—åŒ–/ååºåˆ—åŒ–åŠŸèƒ½ã€‚ public class Person implements Externalizable &#123; private static final long serialVersionUID = 1L; private String name; private int age; // ðŸ”» æ— å‚æž„é€ å‡½æ•°ï¼šå¿…ä¸å¯å°‘çš„ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ public Person() &#123;&#125; // ðŸ”» å¯è§æ€§æ²¡æœ‰é™åˆ¶ï¼šprivateã€protectedã€defaultã€public private void readExternal(ObjectInput in) throws IOException, ClassNotFoundException &#123; // çœç•¥å®žçŽ° &#125; private void writeExternal(ObjectOutput out) throws IOException &#123; // çœç•¥å®žçŽ° &#125;&#125; äºŒã€æ ¸å¿ƒç±»graph LR t([åºåˆ—åŒ–æ ¸å¿ƒç±»]):::g t --> A(\"â‘´ Serializable\"):::lg t --> B(\"â‘µ Externalizable\"):::lg t --> |\"[ åºåˆ—åŒ–å…³é”®ç±» ]\"|C(\"â‘¶ ObjectOutputStreamå°†å¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶æµ\"):::p t --> |\"[ ååºåˆ—åŒ–å…³é”®ç±» ]\"|D(\"â‘· ObjectInputStreamå°†äºŒè¿›åˆ¶æµè¿˜åŽŸä¸ºå¯¹è±¡\"):::p C -.- c([å†…éƒ¨å…³é”®ç±»]):::info c -.-> c1([\"â‘  BolckDataOutputStream - ç¼“å†²\"]):::lp c -.-> c2([\"â‘¡ HandleTable - é˜²æ­¢é‡å¤\"]):::lp c -.-> c3([\"â‘¢ ReplaceTable - è‡ªå®šä¹‰åºåˆ—åŒ–\"]):::lp c -.-> c4([\"â‘£ ObjecyStreamClass - è®°å½•å…ƒæ•°æ®ã€åå°„\"]):::lp classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#56565b,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆ1ï¼‰SerializableSerializable æ˜¯ä¸€ä¸ªç©ºæŽ¥å£ï¼Œè¡¨æ˜Žäº†å®žçŽ°è‡ªè¯¥æŽ¥å£çš„å­ç±»å…·æœ‰åºåˆ—åŒ–è¡Œä¸ºç‰¹å¾ï¼Œæ‰€æœ‰è¦æ”¯æŒåºåˆ—åŒ–çš„ç±»éƒ½åº”è¯¥å®žçŽ°è¿™ä¸ªæŽ¥å£ã€‚ * æºç ï¼š public interface Serializable &#123;&#125; ï¼ˆ2ï¼‰ExternalizablewriteExternalçš„å‚æ•°ï¼šObjectOutputï¼Œè¡¨ç¤ºè¾“å‡ºå¯¹è±¡çš„æŠ½è±¡ï¼ˆå®ƒç»§æ‰¿è‡ªDataOutputï¼Œèƒ½æ”¯æŒåŸºæœ¬ç±»åž‹ã€Stringã€æ•°ç»„ã€å¯¹è±¡çš„è¾“å‡ºã€‚å®žé™…åº”ç”¨ä¼šä½¿ç”¨å…¶å®žçŽ°ç±» ObjectOutputStreamã€‚ readExternalçš„å‚æ•°ï¼šObjectInputï¼Œè¡¨ç¤ºè¾“å…¥å¯¹è±¡çš„æŠ½è±¡ï¼ˆå®ƒç»§æ‰¿è‡ªDataInputï¼Œèƒ½æ”¯æŒåŸºæœ¬ç±»åž‹ã€Stringã€æ•°ç»„ã€å¯¹è±¡çš„è¾“å…¥ã€‚å®žé™…åº”ç”¨ä¼šä½¿ç”¨å…¶å®žçŽ°ç±» ObjectInputStreamã€‚ * æºç ï¼š public interface Externalizable extends Serializable &#123; // ðŸ”» è‡ªå®šä¹‰çš„ç±»å¿…é¡»è¦†ç›– writeExternal å’Œ readExternal æ–¹æ³•ã€‚ void writeExternal(ObjectOutput out) throws IOException; void readExternal(ObjectInput in) throws IOException, ClassNotFoundException; // ðŸ”» è‡ªå®šä¹‰çš„ç±»å¿…é¡»åŒ…å«æ— å‚æž„é€ å‡½æ•°ã€‚&#125; ï¼ˆ3ï¼‰ObjectOutputStreamâ‘  BlockDataOutputStreamObjectOutputStream å†…ç½®çš„å…·æœ‰ç¼“å†²ä½œç”¨çš„è¾“å‡ºåŠŸèƒ½ç±»ï¼ŒåŒ…å«é˜»å¡žå’Œéžé˜»å¡žä¸¤ç§å·¥ä½œæ¨¡å¼ã€‚ %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph LR T(\"BlockDataOutputStream - ç¼“å†²\"):::p T --> A(\"é˜»å¡žæ¨¡å¼\"):::lp T --> B(\"éžé˜»å¡žæ¨¡å¼\"):::lp A -.- t(\"æ¯æ¬¡å°†ç¼“å†²åŒºæ•°æ®å†™å…¥å‰ä¼šå†™å…¥ä¸€ä¸ªé˜»å¡žæ ‡è®°å¤´éƒ¨ï¼ˆBlock Data Headerï¼‰\"):::info classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#56565b,stroke-dasharray: 3 3, stroke-width: 2px * ä¸¤ç§æ¨¡å¼çš„å·¥ä½œæµç¨‹ç›¸åŒï¼Œéƒ½æ˜¯å…ˆæŠŠå¾…å†™çš„æ•°æ®å†™åˆ°ç¼“å†²åŒºï¼Œç›´åˆ°ç¼“å†²åŒºæ»¡åŽå†æ‰§è¡ŒçœŸæ­£çš„å†™å…¥æ“ä½œã€‚ â‘¡ HandleTableå½“å‰å¾…åºåˆ—åŒ–çš„å¯¹è±¡(A)ï¼Œå¯èƒ½åŒ…å«å¤šä¸ªå…¶ä»–å¯¹è±¡ç±»åž‹çš„æˆå‘˜å˜é‡ï¼Œè€Œè¿™äº›æˆå‘˜å˜é‡å¯èƒ½å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡Tï¼š %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% classDiagram class A class B class C class Tå¯¹è±¡ A: b B A: c C B: t T C: t T A *-- B A *-- C C *-- Tå¯¹è±¡ B *-- Tå¯¹è±¡ ä¸ºäº†ä½¿å¾—åœ¨åºåˆ—åŒ–Aå¯¹è±¡æ—¶ï¼Œä¸é‡å¤åºåˆ—åŒ–Tå¯¹è±¡ï¼Œå¼•å…¥äº†å¯¹è±¡å’Œå¥æŸ„çš„æ˜ å°„å…³ç³»ã€‚ å¥æŸ„ä»Ž0å¼€å§‹æŒ‰é€’å¢žé¡ºåºè‡ªå¢žã€‚æ¯å½“è¦å†™å…¥ä¸€ä¸ªObjectç±»åž‹å¯¹è±¡æ—¶ï¼ŒåŽ» HandleTable æŸ¥è¯¢å…¶æ˜¯å¦å·²ç»å­˜åœ¨ï¼š â¶ å¦‚æžœå­˜åœ¨ï¼Œåˆ™è¯´æ˜Žå·²ç»å†™å…¥è¿‡ï¼Œæœ¬æ¬¡åªå†™å…¥å¥æŸ„å³å¯ï¼›â· å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜Žæ²¡æœ‰è¢«å†™å…¥è¿‡ï¼Œéœ€è¦å†™å…¥è¯¥å¯¹è±¡ã€‚ â‘¢ ReplaceTableä¸ºäº†æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„åºåˆ—åŒ–è¡Œä¸ºï¼ˆJavaåºåˆ—åŒ–æ”¯æŒå¯¹åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿›è¡Œæ‹¦æˆªå¹¶æ‰§è¡Œè‡ªå®šä¹‰çš„åºåˆ—åŒ–è¡Œä¸ºã€‚ï¼‰ ReplaceTable ç”¨æ¥ç®¡ç†æºå¯¹è±¡å’Œç›®æ ‡æ›¿æ¢å¯¹è±¡ï¼Œåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æºå¯¹è±¡æŸ¥æ‰¾ç›®æ ‡æ›¿æ¢å¯¹è±¡ï¼š â¶ å¦‚æžœå­˜åœ¨ç›®æ ‡æ›¿æ¢å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨ç›®æ ‡æ›¿æ¢å¯¹è±¡ï¼›â· å¦åˆ™ä½¿ç”¨æºå¯¹è±¡ã€‚ â‘£ ObjectStreamClassè®°å½•äº†å’Œåºåˆ—åŒ–å¯¹è±¡ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶è´Ÿè´£ç›¸å…³æ–¹æ³•çš„åå°„åˆå§‹åŒ–å’Œæ‰§è¡Œã€‚ å­—æ®µ å­—æ®µæ„ä¹‰ name åºåˆ—åŒ–ç±»çš„å®Œæ•´ç±»å cl åºåˆ—åŒ–ç±»çš„Classç±»åž‹ suid åºåˆ—åŒ–ç±»çš„serialVersionUID isProxy æ˜¯å¦ä¸ºä»£ç†ç±» isEnum æ˜¯å¦ä¸ºæžšä¸¾ç±» serializable æ˜¯å¦å®žçŽ°äº†Serializable externalizable æ˜¯å¦å®žçŽ°äº†Externalizable primDataSize åŸºæœ¬ç±»åž‹çš„æˆå‘˜å­—æ®µä¸ªæ•°ï¼Œä¸åŒ…å«staticå’Œtransientç±»åž‹å­—æ®µ numObjFileds éžåŸºæœ¬ç±»åž‹çš„æˆå‘˜å­—æ®µä¸ªæ•° dataLayout ç±»å±‚æ¬¡ç»“æž„ï¼šå½“å‰ç±»ã€çˆ¶ç±»åŠæ‰€æœ‰ç»§æ‰¿ç±»çš„ç±»æè¿° writeObjectMethod writeObjectæ–¹æ³•ï¼Œé€šè¿‡åå°„èŽ·å– readObjectMethod readObjectæ–¹æ³•ï¼Œé€šè¿‡åå°„èŽ·å– writeReplaceMethod writeReplaceæ–¹æ³•ï¼Œé€šè¿‡åå°„èŽ·å– readReplaceMethod readReplaceæ–¹æ³•ï¼Œé€šè¿‡åå°„èŽ·å– ï¼ˆ4ï¼‰ObjectInputStreamjava.io.ObjectInputStream æ˜¯å®žçŽ°Javaååºåˆ—åŒ–çš„å…³é”®ç±»ï¼Œå’Œ ObjectOutputStream æ˜¯å¯¹åº”çš„ï¼Œå†…éƒ¨åŒ…å«äº† BlockDataInputStreamã€HandleTableã€ReplaceTableã€ObjectStreamClassç­‰ ä¸‰ã€å†…éƒ¨åŽŸç†Javaåºåˆ—åŒ–çš„æµç¨‹ã€åŽŸç†ï¼Œä»¥åŠå„ç§ç±»åž‹æ•°æ®è¿›è¡ŒJavaåºåˆ—åŒ–åŽçš„æ ¼å¼å’Œå ç”¨ç©ºé—´å¤§å°ç­‰ç»†èŠ‚ã€‚ Javaåºåˆ—åŒ–å¯¹æ•´åž‹æ•°æ®é‡‡ç”¨å›ºå®š4å­—èŠ‚å­˜å‚¨ï¼Œè€ŒProtocol Bufferå¯¹æ•´åž‹æ•°æ®é‡‡ç”¨å˜é•¿å­˜å‚¨ï¼Œä½¿å¾—å­˜å‚¨ç©ºé—´è¿›ä¸€æ­¥å‡å°ã€‚ ï¼ˆ1ï¼‰åŸºæœ¬ç±»åž‹çš„åºåˆ—åŒ–æµç¨‹Javaåºåˆ—åŒ–å¯¹åŸºæœ¬ç±»åž‹æ•°æ®çš„å¤„ç†ï¼Œä¸¥æ ¼æŒ‰ç…§å…¶å†…å­˜å ç”¨å¤§å°æ¥è¿›è¡Œã€‚æ¯”å¦‚intç±»åž‹å ç”¨4å­—èŠ‚ï¼ŒJavaåºåˆ—åŒ–æŒ‰ç…§é«˜ä½åˆ°ä½Žä½ä¾æ¬¡æ”¾åˆ°å­—èŠ‚æ•°ç»„ï¼Œå†å†™å…¥åˆ°åºåˆ—åŒ–è¾“å‡ºå¯¹è±¡ï¼š å†™å…¥intç±»åž‹æ•°æ®ï¼š graph TD subgraph \"ObjectOutputStream.java\" A([\"writeInt()\"]):::p end subgraph \"BlockDataOutputStreamï¼ˆå†…éƒ¨ç±»ï¼‰\" A ==> |\"è°ƒç”¨\"|B([\"writeInt()\"]):::p B --- b[\"1024å­—èŠ‚å¤§å°çš„ç¼“å†²åŒº\"]:::lb b -.-> |\"â‘  ç¼“å†²åŒºè¿˜å¯å®¹çº³å¾…å†™å…¥çš„intç±»åž‹æ•°æ®\"|b1(\"æŠŠå½“å‰æ•°æ®æ”¾å…¥ç¼“å†²åŒº\"):::lg B2([\"write()\"]):::p B2 --- 2b[\"ç¼“å†²åŒº\"]:::lb 2b -.-> |\"â‘  ç¼“å†²åŒºèƒ½å®¹çº³å½“å‰å¾…å†™å…¥å­—èŠ‚\"|2b1(\"æŠŠå½“å‰å­—èŠ‚å†™å…¥ç¼“å†²åŒº\"):::lg 2b -.-> |\"â‘¡ ç¼“å†²åŒºå·²æ»¡\"|2b2(\"æŠŠç¼“å†²åŒºçš„æ•°æ®è¾“å‡ºï¼Œå†æŠŠå½“å‰å¾…å†™å…¥å­—èŠ‚æ”¾åˆ°ç¼“å†²åŒº\"):::lg end b -.-> |\"â‘¡ ç¼“å†²åŒºä¸èƒ½å®¹çº³å¾…å†™å…¥çš„intç±»åž‹æ•°æ®\"|C subgraph \"DataOutputStream.java\" C([\"writeInt()\"]):::p C --> d(\"æŒ‰ç…§ä»Žé«˜åˆ°ä½Žçš„å­—èŠ‚é¡ºåºä¾æ¬¡å†™å…¥4ä¸ªå­—èŠ‚\"):::lg d ==> |\"è°ƒç”¨\"|B2 end classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ObjectOutputStream çš„ writeInt()ï¼š public void writeInt(int val) throws IOException &#123; // ðŸ”» çœŸæ­£çš„å†™å…¥æ˜¯é€šè¿‡è°ƒç”¨ BlockDataOutputStreamï¼ˆboutï¼‰ // çš„ writeInt æ–¹æ³•å®žçŽ°çš„ bout.writeInt(val); &#125; BlockDataOutputStream çš„ writeInt()ï¼š public void writeInt(int v) throws IOException &#123; // ðŸ”» BlockDataOutputStreamå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª1024å­—èŠ‚å¤§å°çš„ç¼“å†²åŒº if (pos + 4 &lt;= MAX_BLOCK_SIZE) &#123; // MAX_BLOCK_SIZE = 1024 // ðŸ”¹ è‹¥ç¼“å†²åŒºè¿˜å¯ä»¥å®¹çº³å†™å…¥çš„intç±»åž‹æ•°æ®ï¼šå°†æ•°æ®æ”¾å…¥ç¼“å†²åŒº Bits.putInt(buf, pos, v); pos += 4; &#125; else &#123; // ðŸ”¹ è‹¥ç¼“å†²åŒºæ— æ³•å®¹çº³ï¼šè°ƒç”¨ DataOutputStream çš„ writeInt() dout.writeInt(v) &#125; &#125; DataOutputStream çš„ writeInt()ï¼š // ðŸ”» intç±»åž‹æ˜¯æŒ‰ç…§ä»Žé«˜åˆ°ä½Žçš„å­—èŠ‚é¡ºåºä¾æ¬¡å†™å…¥4ä¸ªå­—èŠ‚çš„public final void writeInt(int v) throws IOException &#123; // outï¼šBlockDataOutputStream out.write((v &gt;&gt;&gt; 24) &amp; 0xFF); out.write((v &gt;&gt;&gt; 16) &amp; 0xFF); out.write((v &gt;&gt;&gt; 8) &amp; 0xFF); out.write((v &gt;&gt;&gt; 0) &amp; oxFF); incCount(4);&#125; BlockDataOutputStream çš„ write() ï¼š public void write(int b) throws IOEception &#123; // ðŸ”¹ è‹¥ç¼“å†²åŒºå·²æ»¡ï¼šå°†ç¼“å†²åŒºæ•°æ®æŽ¨å‡º if(pos &gt;= MAX_BLOCK_SIZE) &#123; drain(); &#125; // ðŸ”¹ å°†å¾…å†™å…¥å­—èŠ‚å†™å…¥ç¼“å†²åŒº buf[pos++] = (byte) b;&#125;void drain() throws IOException &#123; // .. // ðŸ”¸ å°†bufç¼“å†²åŒºå·²æœ‰æ•°æ®è¾“å‡º out.write(buf, 0, pos); pos = 0;&#125; ï¼ˆå…¶ä»–åŸºæœ¬ç±»åž‹æ•°æ®çš„å†™å…¥æµç¨‹ä¸Žæ­¤ç±»ä¼¼ï¼‰ ï¼ˆ2ï¼‰åŸºæœ¬ç±»åž‹çš„åºåˆ—åŒ–å¤§å° æ•°æ®ç±»åž‹ Javaå†…å­˜ä¸­çš„å¤§å° åºåˆ—åŒ–åŽçš„å¤§å° åºåˆ—åŒ–æ“ä½œï¼ˆå‡è®¾å˜é‡ä¸ºVï¼‰ boolean 1 æ•´æ•°1æˆ–0çš„æœ€ä½Žä¸€ä¸ªå­—èŠ‚ write(v ? 1 : 0) byte 1 1 write(v) char 2 2 é«˜ä½å­—èŠ‚å…ˆå†™å…¥write((v&gt;&gt;&gt;8) &amp; 0xFF) write((v&gt;&gt;&gt;0) &amp; 0xFF) short 2 2 é«˜ä½å­—èŠ‚å…ˆå†™å…¥ write((v&gt;&gt;&gt;8) &amp; 0xFF) write((v&gt;&gt;&gt;0) &amp; 0xFF) int 4 4 é«˜ä½å­—èŠ‚å…ˆå†™å…¥ write((v&gt;&gt;&gt;24) &amp; 0xFF) write((v&gt;&gt;&gt;16) &amp; 0xFF) write((v&gt;&gt;&gt;8) &amp; 0xFF) write((v&gt;&gt;&gt;0) &amp; 0xFF) long 8 8 é«˜ä½å­—èŠ‚å…ˆå†™å…¥ write((v&gt;&gt;&gt;56) &amp; 0xFF) write((v&gt;&gt;&gt;48) &amp; 0xFF) write((v&gt;&gt;&gt;40) &amp; 0xFF) write((v&gt;&gt;&gt;32) &amp; 0xFF) write((v&gt;&gt;&gt;24) &amp; 0xFF) write((v&gt;&gt;&gt;16) &amp; 0xFF) write((v&gt;&gt;&gt;8) &amp; 0xFF) write((v&gt;&gt;&gt;0) &amp; 0xFF) float 4 4 ç¬¦åˆIEEE754æ ‡å‡†çš„4å­—èŠ‚ double 8 8 ç¬¦åˆIEEE754æ ‡å‡†çš„8å­—èŠ‚ ï¼ˆ3ï¼‰å¯¹è±¡ç±»åž‹çš„åºåˆ—åŒ–æµç¨‹Javaåºåˆ—åŒ–å¯¹éžåŸºæœ¬ç±»åž‹çš„æ•°æ®å¤„ç†æ¯”åŸºæœ¬ç±»åž‹çš„æ•°æ®å¤„ç†æ›´å¤æ‚ï¼Œè¿™é‡Œè¯´çš„éžåŸºæœ¬ç±»åž‹åŒ…æ‹¬Objectã€Enumã€Arrayç­‰ â€”â€” é€šè¿‡ ObjectOutputStream çš„ writeObject æ–¹æ³•å®žçŽ°çš„ï¼š âžŠ writeObject()graph TD %%subgraph \"ObjectOutputStream\" A([\"writeObject()\"]):::p subgraph \"ObjectOutputStream.java\" A --> |\"[ è°ƒç”¨ ]\"|B([\"writeObject0()\"]):::p B --> |\"æ ¸å¿ƒå®žçŽ°\"|b(\"ifåˆ†æ”¯ï¼šåˆ¤æ–­objç±»åž‹\"):::lb end subgraph \"String / Enum\" b -...- 1t([\"writeString()\"]):::lp b -...- 3t([\"writeEnum()\"]):::lp 1t -.-> 1a(\"å®žçŽ°è‡ªSerializableï¼Œå…·å¤‡æ”¯æŒåºåˆ—åŒ–/ååºåˆ—åŒ–çš„èƒ½åŠ›\"):::info 3t -.-> 1a end subgraph \"Array\" b -.- 2t([\"writeArray()\"]):::lp 2t -.-> |\"åŸºæœ¬ç±»åž‹\"|2a(\"è°ƒç”¨åŸºæœ¬ç±»åž‹çš„åºåˆ—åŒ–æ–¹å¼\"):::lg 2t -.-> |\"Objectç±»åž‹\"|2b(\"é€’å½’è°ƒç”¨æ‰§è¡Œifåˆ†æ”¯\"):::lb %% 2a -.-> b end subgraph \"è‡ªå®šä¹‰çš„åºåˆ—åŒ–ç±»\" b -.....- 4a([\"writeOrdinaryObject()\"]):::lp 4a -.-> |\"Externalizableç±»åž‹ä¸”ä¸æ˜¯åŠ¨æ€ä»£ç†ç±»\"|4a1([\"writeExternalData()\"]):::p 4a -.-> |\"Serializableç±»åž‹\"|4a2([\"writeSerialData()\"]):::p end %%end classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ObjectOutputStream çš„ writeObject() å†…éƒ¨å®žçŽ°æ ¸å¿ƒéƒ¨åˆ†ï¼š public final void writeObject(Object obj) throws IOEXception &#123; // ðŸ”¹ å½“å‰ç±»æ˜¯å¦æ˜¯ ObjectOutputStream çš„å­ç±» if(enableOverride) &#123; writeObjectOverride(obj); return; &#125; // ðŸ”¹ æ‰§è¡Œå¯¹è±¡å†™å…¥ï¼Œfalseè¡¨ç¤ºå…±äº«å†™å…¥ try &#123; writeObject0(obj, false); // ðŸ”» &#125; catch (IOEception ex) &#123;&#125; &#125; writeObject0() çš„å‚æ•°ï¼š objï¼šè¡¨ç¤ºè‡ªå®šä¹‰çš„åºåˆ—åŒ–å¯¹è±¡æˆ–è€…Arrayã€Enumç±»åž‹å¯¹è±¡ã€‚ ç¬¬2ä¸ªå‚æ•°ï¼šè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªå¯¹è±¡å…±åŒå¼•ç”¨æ—¶ï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™æ˜¯å¦è¦å…±äº«å†™å…¥ %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR B([\"writeObject0() å‚æ•°:\"]):::p B -.- b(\"â‘  è¢«å¼•ç”¨çš„å¯¹è±¡å®žä¾‹obj, â‘¡ æ˜¯å¦å…±äº«å†™å…¥\"):::lp subgraph \"[ false ]: å…±äº«å†™å…¥\" b1 end subgraph \"[ true ]: ä¸å…±äº«å†™å…¥\" b2 end b --- |\"é»˜è®¤\"|b1(\"objåªä¼šè¢«åºåˆ—åŒ–ä¸€æ¬¡ï¼Œå…¶ä»–å¼•ç”¨åªä¼šå†™å…¥å¼•ç”¨å¯¹è±¡å¥æŸ„\"):::lg b -.- b2(\"objä¼šè¢«åºåˆ—åŒ–å¤šæ¬¡ï¼Œåºåˆ—åŒ–åŽçš„æ•°æ®å¤§å°ä¼šå¢žåŠ \"):::lg classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px writeObject0() æ ¸å¿ƒå®žçŽ°ï¼š if (obj instanceof String) &#123; // ðŸ”¹ Stringç±»ï¼šå®žçŽ°è‡ªSerializableï¼Œå…·å¤‡æ”¯æŒåºåˆ—åŒ–/ååºåˆ—åŒ–èƒ½åŠ› writeString((String) obj, unshared); &#125; else if (cl.isArray()) &#123; // ðŸ”¹ Arrayç±»ï¼šâ‘ åŸºæœ¬ç±»åž‹ï¼šè°ƒç”¨åŸºæœ¬ç±»åž‹åºåˆ—åŒ–æ–¹å¼ â‘¡Objectç±»åž‹ï¼šé€’å½’if writeArray(obj, desc, unshared); &#125; else if (obj instanceof Enum) &#123; // ðŸ”¹ Enumç±»ï¼šå®žçŽ°è‡ªSerializableï¼Œå…·å¤‡æ”¯æŒåºåˆ—åŒ–/ååºåˆ—åŒ–èƒ½åŠ› writeEnum((Exum&lt;?&gt;) obj, desc, unshared); &#125; else if (obj instanceof Serializable) &#123; // ðŸ”» è‡ªå®šä¹‰çš„ç±»å®žçŽ°äº† Serializableï¼šæ‰§è¡ŒwriteOrdinaryObjectæ–¹æ³• writeOrdinaryObject(obj, desc, unshared); &#125; else &#123; if(extendedDebugInfo) &#123; throw new NotSerializableException(cl.getName() + &quot;\\n&quot; + debugInfoStack.toString()); &#125; else &#123; // â­•ï¸ è¦èƒ½å¤Ÿè¢«ObjectOutputStreamçš„writeObjectæ–¹æ³•åºåˆ—åŒ–ï¼Œå¯¹è±¡å¿…é¡» // å®žçŽ°è‡ªSerializableï¼Œå¦åˆ™ä¼šæŠ›NotSerializableExceptionå¼‚å¸¸ throw new NotSerializableException(cl.getName()); &#125;&#125; writeOrdinaryObject() æ ¸å¿ƒå®žçŽ°ï¼š // è‡ªå®šä¹‰çš„åºåˆ—åŒ–ç±»ï¼šwriteClassDesc(desc, false); // å†™å…¥ç±»æè¿°ä¿¡æ¯handles.assign(unshared ? null : obj);// ðŸ”» è‹¥è‡ªå®šä¹‰çš„ç±»æ˜¯Externalizableç±»åž‹ï¼šè°ƒç”¨writeExternalDataæ–¹æ³•if (desc.isExternalizable() &amp;&amp; !desc.isProxy()) &#123; writeExternalData((Externalizable) obj); // ðŸ”» è‹¥è‡ªå®šä¹‰çš„ç±»æ˜¯Serializableç±»åž‹ï¼šè°ƒç”¨writeSerialDataæ–¹æ³•&#125; else &#123; writeSerialData(obj, desc);&#125; âž‹ writeSerialData()writeOrdinaryObjectæ–¹æ³•å®žçŽ°ä¸­ï¼Œå¦‚æžœè‡ªå®šä¹‰ç±»å®žçŽ°Serializableï¼Œåˆ™ä¼šè°ƒç”¨ writSerialData() å®žçŽ°åºåˆ—åŒ–ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph subgraph \"writeSerialData()\" A([\"desc.getClassDataLayout()\"]):::lp A --> |\"è¿”å›žå€¼\"|b([\"ClassDataSlotç±»åž‹æ•°ç»„\"]):::b %% æ•°ç»„å…ƒç´ é¡ºåºï¼šä»Žæœ€æ ¹éƒ¨çš„ç¥–å…ˆåˆ°å½“å‰ç±»ã€‚ b -.- 1(\"ï¼ˆObjectStreamClassï¼‰desc\"):::lb b -.- 2(\"ï¼ˆbooleanï¼‰hasData\"):::lb b -.- 3(\"... ...\"):::lb 1 --> |\"åˆ¤æ–­æ•°ç»„å…ƒç´ å¯¹åº”çš„ç±»æ˜¯å¦åŒ…å« writeObject æ–¹æ³•\"|t([\"desc.hasWriteObjectMethod()\"]):::lp end subgraph \"ObjectStreamClass.java\" t -.-> |\"[ åŒ…å« ]åå°„è°ƒç”¨\"|1a([\"invokeWriteObject()\"]):::p 1a --> 2a([\"writeObjectMethod.invoke() âœ”ï¸Ž\"]):::lp end t -.-> |\"[ æœªåŒ…å« ]\"|1b([\"defaultWriteFields()\"]):::p subgraph \"defaultWriteFiled()\" 1b --> |\"â‘  å…ˆå†™å…¥åŸºæœ¬ç±»åž‹çš„å­—æ®µ\"|2b([\"bout.write()\"]):::lp 2b --> |\"â‘¡ å†™å…¥å¯¹è±¡ç±»åž‹çš„å­—æ®µ\"|3b([\"writeObject0() âœ”ï¸Ž\"]):::lp end classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px â‘´ å­—æ®µ å­—æ®µè¯´æ˜Žï¼š å­—æ®µ ç±»åž‹ è¯´æ˜Ž getClassDataLayout() ClassDataSlot[] èŽ·å–å½“å‰ç±»åŠç»§æ‰¿é“¾è·¯ä¸Šæ‰€æœ‰ç›´æŽ¥æˆ–é—´æŽ¥å®žçŽ°äº† Serializable çš„ç¥–å…ˆç±»å¯¹åº”çš„åºåˆ—åŒ–å…ƒæ•°æ®ä¿¡æ¯ã€‚* æ•°ç»„å…ƒç´ é¡ºåºï¼šä»Žæœ€æ ¹éƒ¨çš„ç¥–å…ˆåˆ°å½“å‰ç±»ã€‚ desc ObjectStreamClass è®°å½•äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯¹è±¡ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶è´Ÿè´£ç›¸å…³æ–¹æ³•çš„åå°„åˆå§‹åŒ–å’Œæ‰§è¡Œã€‚ hasData boolean è¡¨ç¤ºdescå¯¹åº”çš„Javaå¯¹è±¡æ˜¯å¦æœ‰æ•°æ®è¢«åºåˆ—åŒ–ã€‚ Demoï¼šgetClassDataLayout() å½“åºåˆ—åŒ– MyPeople å¯¹è±¡æ—¶ï¼ŒgetClassDataLayout() è¿”å›žçš„æ•°ç»„å¤§å°ï¼š1 ClassDataSlot[0] = MyPeople ç±»å¯¹åº”çš„ ObjecStreamClass public class People &#123; // ... &#125;public class MyPeople extends People implements Serializable &#123; // ... &#125; å½“åºåˆ—åŒ– MyPeople å¯¹è±¡æ—¶ï¼ŒgetClassDataLayout() è¿”å›žçš„æ•°ç»„å¤§å°ï¼š2 ClassDataSlot[0] = People ç±»å¯¹åº”çš„ ObjectStreamClas ClassDataSlot[1] = MyPeople ç±»å¯¹åº”çš„ ObjecStreamClass public class People implements Serializable &#123; // ... &#125;public class Mypeople extends Prople &#123; // ... &#125; â‘µ æºç  writeSerialData()ï¼š private void writeSerialData(Object obj, ObjectStreamCLass desc) throws IOException &#123; // ðŸ”´ å¯¹äºŽClassDataSlotæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œ // å¦‚æžœè¯¥å…ƒç´ å¯¹åº”çš„ç±»åŒ…å«writeObjectæ–¹æ³•ï¼Œåˆ™è°ƒç”¨writeObjetæ–¹æ³•ã€‚ ObjectStreamClass.ClassDataSlot[] slots = desc.getClassDataLayout(); // èŽ·å–å½“å‰å¾…å†™å…¥Objectç±»æè¿°ä¿¡æ¯ for (int i = 0; i &lt; slots.length; i++) &#123; ObjectStreamClass slotDesc = slots[i].desc; // ðŸ”¹ â‘  è‹¥æœ‰ writeObject æ–¹æ³•ï¼šåå°„è°ƒç”¨ if (slotDesc.hasWriteObjectMethod()) &#123; // ... try &#123; // ... // ðŸ”» åå°„è°ƒç”¨objé‡Œçš„ writeObject æ–¹æ³• slotDesc.invokeWriteObject(obj, this); &#125; finally &#123; // ... &#125; // ðŸ”¹ â‘¡ è‹¥æ—  writeObject æ–¹æ³•ï¼šðŸ”» è°ƒç”¨é»˜è®¤æ–¹æ³• &#125; else &#123; defaultWriteFileds(obj, slotDesc); &#125; &#125;&#125; ObjectStreamClass çš„ invokeWriteObject() å†…éƒ¨å®žçŽ°ï¼š // ðŸ”´ wirteObject æ–¹æ³•ä»¥åå°„æ–¹å¼è¢«è°ƒç”¨ï¼šwriteObjectMethod.invoke(obj, new Object[]&#123; out &#125;); // writeObjectMethod çš„åˆå§‹åŒ–é€šè¿‡åå°„æ–¹å¼å®žçŽ°ï¼šï¼ˆObjectStreamClassçš„æž„é€ æ–¹æ³•ï¼‰writeObjectMethod = getPrivateMethod(cl, &quot;writeObject&quot;, new Class&lt;?&gt;[] &#123; ObjectOutputStream.class &#125;, Void.TYPE); defaultWriteFileds()ï¼š // ðŸ”´ è‹¥å½“å‰å¾…åºåˆ—åŒ–çš„ç±»æ²¡æœ‰writeObjectæ–¹æ³•ï¼Œåˆ™è°ƒç”¨defaultWriteFieldsæ–¹æ³•å®žçŽ°åºåˆ—åŒ–ï¼š// ðŸ”¸ å…ˆå†™å…¥åŸºæœ¬ç±»åž‹å­—æ®µint primDataSize = desc.getPrimDataSize();if (primVals == null || primVals.lengnth &lt; primDataSize) &#123; primVals = new byte[primDataSize];&#125;desc.getPrimFiledValues(obj, primVals);bout.write(primVals, 0, primDataSize, false); // BlockDataOutputStream// ðŸ”¸ å†™å…¥å¯¹è±¡ç±»åž‹çš„å­—æ®µObjectStreamFiled[] fileds = desc.getFileds(false);Object[] objVals = new Object[desc.getNumObjFields()];int numPrimFileds = fields.length - objVals.length;desc.getObjectFiledValues(obj, objVals);for (intn i = 0; i &lt; objVals.length; i++) &#123; try &#123; // â­•ï¸ å¯¹è±¡ç±»åž‹å­—æ®µç»§ç»­è°ƒç”¨writeObject0æ–¹æ³• writeObject0(objVals[i], fileds[numPrimFileds + i].isUnshared()); &#125; finally &#123; &#125;&#125; ðŸ¦‹ ä»ŽObjectOutputStream çš„ writeObject æ‰§è¡Œæµç¨‹æ¥çœ‹ï¼ŒJavaåºåˆ—åŒ–ä»¥æ·±åº¦ä¼˜å…ˆéåŽ†æ–¹å¼ä½¿æ•´ä¸ªå¯¹è±¡å®žçŽ°åºåˆ—åŒ–ã€‚ï¼‰ âžŒ writeExternal()å›žåˆ° writeOrdinaryObject æ–¹æ³•å®žçŽ°ï¼Œå¦‚æžœè‡ªå®šä¹‰ç±»å®žçŽ°äº† Externalizable ä¸”ä¸æ˜¯åŠ¨æ€ä»£ç†ç±»ï¼Œåˆ™ä¼šè°ƒç”¨ writeExternalData æ–¹æ³•å®žçŽ°åºåˆ—åŒ–ï¼š writeExternalData // ðŸ”» æœ€ç»ˆè°ƒç”¨è‡ªå®šä¹‰ç±»å¯¹è±¡çš„ writeExternal æ–¹æ³•å®žçŽ°å†™å…¥if (protocol == PROTOCOL_VERSION_1) &#123; obj.writeExternal(this); &#125; else &#123; bout.setBlockDataMode(true); obj.writeExternal(this); bout.setBlockDataMode(false); bout.writeByte(TC_ENDBLOCKDATA);&#125; writeExternalData æ–¹æ³•çš„å®žçŽ°çœ‹èµ·æ¥æ¯” writeSerializable ç±»æ›´ç®€æ´ï¼ŒåŽŸå› ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph T([\"Externalizable æŽ¥å£\"]):::p T -.- A(\"æŽ¥å£åŒ…å«ï¼šreadExternal() å’Œ writeExternal()\"):::info A --> |\"ï¼ˆæœ‰è§„èŒƒï¼‰\"|A2(\"Externalizable çš„å­ç±»å¿…é¡»è¦†ç›– readExternal() å’Œ writeExternal()\"):::lp T2([\"Serializable æŽ¥å£\"]):::g T2 -.- B(\"ç©ºæŽ¥å£\"):::info B --> |\"ï¼ˆæ— è§„èŒƒï¼‰\"|B2(\"æœ¬èº«æ˜¯ç©ºæŽ¥å£ï¼Œåœ¨å…·ä½“è¡Œä¸ºä¸Šæ²¡æœ‰åšå¼ºåˆ¶æ€§çš„çº¦æŸå’Œè§„èŒƒã€‚(ä»…æ˜¯ä¸€ç§ç‰¹æ€§ï¼‰\"):::lg classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆ4ï¼‰å¯¹è±¡ç±»åž‹çš„åºåˆ—åŒ–æ•°æ®æˆåˆ†åºåˆ—åŒ–è¿‡ç¨‹ä¼šå†™å…¥çš„æ•°æ®æˆåˆ†ï¼šï¼ˆObjectOutputStream çš„ writeObject æ–¹æ³•æ‰§è¡Œæµç¨‹ï¼‰ &#12288;1. å†™å…¥ TC_OBJECT &#12288;2. å†™å…¥ç±»æè¿°ï¼ˆwriteClassDescï¼‰ &#12288;3. å†™å…¥åŸºæœ¬ç±»åž‹å­—æ®µ &#12288;4. èŽ·å–ã€éåŽ†æ‰€æœ‰å¯¹è±¡ç±»åž‹çš„å­—æ®µé€’å½’è°ƒç”¨ writeObject0() å®žçŽ°å†™å…¥ (1ï¼‰å†™å…¥ TC_OBJECTï¼Œå€¼ä¸º0x73ï¼Œbyteç±»åž‹ã€‚ (2ï¼‰å†™å…¥ç±»æè¿°ï¼ˆwriteClassDescï¼‰ï¼Œç±»æè¿°ä¾èµ–å¾…åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå ç”¨å­—èŠ‚ï¼š ç±»æè¿°æ•°æ®æˆåˆ†ï¼š ç±»æè¿°å–å€¼ Tag Tag Valueï¼ˆbyteï¼‰ Tagä¹‹åŽçš„æ•°æ® Null TC_NULL 0x70 æ—  Handleï¼ˆå·²ç»å†™å…¥è¿‡çš„Objectç±»åž‹å¯¹è±¡ï¼‰ TC_REFERENCE 0X71 4å­—èŠ‚çš„å¯¹è±¡ åŠ¨æ€ä»£ç†ç±» TC_PROXYCLASSDESC 0x7D 1ï¼‰4å­—èŠ‚çš„æ‰€æœ‰çˆ¶æŽ¥å£ç±»ä¸ªæ•°2ï¼‰å¾ªçŽ¯å†™å…¥çˆ¶æŽ¥å£çš„åå­—(UTF-8æ ¼å¼)ã€çˆ¶æŽ¥å£çš„ç±»æè¿° è‡ªå®šä¹‰çš„ Serializable æˆ– Externalizable å®žçŽ°ç±» TC_CLASSDESC 0x72 1ï¼‰ç±»åå­—2ï¼‰serialVersionUID3ï¼‰ç±»æ ‡ç­¾4ï¼‰å­—æ®µä¸ªæ•°5ï¼‰ä¸€æ¬¡å¾ªçŽ¯å†™å…¥æ¯ä¸ªå­—æ®µçš„ç±»åž‹ç ã€å­—æ®µåã€å­—æ®µç­¾åï¼ˆéžåŸºæœ¬ç±»åž‹ï¼‰ ç±»æ ‡ç­¾åŠæ„ä¹‰ æžšä¸¾å€¼ æ•´åž‹å€¼ æ„ä¹‰ SC_WRITE_METHOD 0x01 Serializable å®žçŽ°ç±»åŒ…å« writeObject æ–¹æ³• SC_SERIALIZABLE 0x02 Serializable å®žçŽ°ç±» SC_EXTERNALIZABLE 0x04 Externalizable å®žçŽ°ç±» SC_BLOCK_DATA 0x08 Externalizable å®žçŽ°ç±»å†™å…¥æ•°æ®ä½¿ç”¨ Block æ¨¡å¼ SC_ENUM 0x10 æžšä¸¾ç±» ç±»æ ‡ç­¾å¯ä»¥æ˜¯ä¸Šè¿°å–å€¼çš„ç»„åˆã€‚ä¾‹å¦‚ï¼Œè‡ªå®šä¹‰ç±»å®žçŽ°è‡ª Serializable ä¸”åŒ…å«äº† writeObject æ–¹æ³•ï¼Œåˆ™ç±»æ ‡ç­¾çš„å–å€¼ä¸ºï¼šSC_WRITE_METHOD | SC_SERIALIZABLEã€‚ ï¼ˆ3ï¼‰å†™å…¥åŸºæœ¬ç±»åž‹å­—æ®µ å°†åŸºæœ¬ç±»åž‹å­—æ®µæŒ‰å­—æ®µåçš„å­—å…¸é¡ºåºå†™å…¥ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå†æŠŠå­—èŠ‚æ•°ç»„æœ€ç»ˆå†™å…¥åˆ°è¾“å‡ºæµã€‚é€šè¿‡ ObjectStreamClass çš„æž„é€ å‡½æ•°åˆå§‹åŒ–è°ƒç”¨äº† getSerialFields æ–¹æ³•å¾—åˆ°éªŒè¯ï¼š private static ObjectStreamField[] getSerialFields(Class&lt;?&gt; cl) throws InvalidClassException&#123; ObjectStreamField[] fields; if (Serializable.class.isAssignableFrom(cl) &amp;&amp; !Externalizable.class.isAssignableFrom(cl) &amp;&amp; !Proxy.isProxyClass(cl) &amp;&amp; !cl.isInterface()) &#123; if ((fields = getDeclaredSerialFields(cl)) == null) &#123; fields = getDefaultSerialFields(cl); &#125; // ðŸ”» ObjectStreamField æŽ’åº Arrays.sort(fields); &#125; else &#123; fields = NO_FIELDS; &#125; return fields;&#125; ObjectStreamFiled çš„ comparTo() æ ¸å¿ƒå®žçŽ°ï¼š // ðŸ”¸ èŽ·å–å­—æ®µåŽä¼šå¯¹å­—æ®µæŽ’åºï¼ŒæŽ’åºé€»è¾‘ï¼špublic int compareTo(Object obj)&#123; ObjectStreamField other = (ObjectStreamField) obj; boolean isPrim = isPrimitive(); if(isPrim != other.isPrimitive()) &#123; return isPrim ? -1 : 1; &#125; return name.compareTo(other.name);&#125; ðŸ“Œ æŽ’åºè§„åˆ™æ€»ç»“ï¼š ä¸¤ä¸ªå­—æ®µç±»åž‹ç›¸åŒï¼ŒæŒ‰ç…§å­—æ®µåçš„å­—å…¸é¡ºåºè¿›è¡ŒæŽ’åºï¼› ä¸¤ä¸ªå­—æ®µç±»åž‹ä¸åŒï¼ŒåŸºæœ¬ç±»åž‹æŽ’åœ¨éžåŸºæœ¬ç±»åž‹ä¹‹å‰ã€‚ å›žåˆ° ObjectOutputStream çš„ defaultWriteFields()ï¼Œå¯¹åŸºæœ¬ç±»åž‹å­—æ®µçš„å¤„ç†è¿‡ç¨‹ä¸º â€”â€” å…ˆèŽ·å–æ‰€æœ‰åŸºæœ¬ç±»åž‹å­—æ®µå ç”¨çš„å­—èŠ‚æ•°ï¼Œå†å°†åŸºæœ¬ç±»åž‹å­—æ®µçš„å€¼ä¾æ¬¡æ”¾å…¥ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼š // ðŸ”¹ èŽ·å–æ‰€æœ‰åŸºæœ¬ç±»åž‹å­—æ®µçš„å­—èŠ‚æ•°int primDataSize = desc.getPrimDataSize();if (primVals == null || primVals.length &lt; primDataSize) &#123; primVals = new byte[primDataSize];&#125;// ðŸ”¹ å°†åŸºæœ¬ç±»åž‹å­—æ®µä¾æ¬¡å†™å…¥å­—èŠ‚æ•°ç»„desc.getPrimFieldValues(obj, primVals);// ðŸ”¸ å°†å­—èŠ‚æ•°ç»„è¾“å‡ºbout.write(primVals, 0, primDataSize, false); ï¼ˆ4ï¼‰èŽ·å–æ‰€æœ‰å¯¹è±¡ç±»åž‹çš„å­—æ®µï¼Œå¾ªçŽ¯éåŽ†æ¯ä¸€ä¸ªå­—æ®µï¼Œé€’å½’è°ƒç”¨ writeObject0() å®žçŽ°å†™å…¥ã€‚ ï¼ˆç•¥ï¼Œä¸Šè¿° writeObject æµç¨‹é‡Œå·²æ¶‰åŠï¼‰ å››ã€é«˜çº§ç‰¹æ€§ï¼ˆ1ï¼‰transient å…³é”®å­—transient å…³é”®å­—åœ¨Javaåºåˆ—åŒ–ä¸­ç”¨æ¥æŽ§åˆ¶å­—æ®µä¸è¢«åºåˆ—åŒ–ã€‚ ObjectStreamClass çš„ getDefaultFields() å†…éƒ¨å®žçŽ°ï¼š private static ObjectStreamField[] getDefaultFields(Class&lt;?&gt; cl) &#123; Field[] clFields = cl.getDeclaredFields(); ArrayList&lt;ObjectStreamField&gt; list = new ArrayList&lt;&gt;(); // ðŸ”» åºåˆ—åŒ–å­—æ®µä¸èƒ½ä¸º static ä¸”ä¸èƒ½ä¸º transient int mask = Modifier.STATIC | Modifier.TRANSIENT; for (int i = 0; i &lt; clFields.length; i++) &#123; if ((clFields[i].getModifiers() &amp; mask) == 0) &#123; list.add(new ObjectStreamField(clFields[i], false, true)); &#125; &#125; int size = list.size(); return (size == 0) ? NO_FIELDS : list.toArray(new ObjectStreamField[size]);&#125; ï¼ˆ2ï¼‰static å…³é”®å­—static å­—æ®µå±žäºŽç±»å…¨å±€å…±æœ‰ï¼Œä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ åœ¨ååºåˆ—åŒ–å¾—åˆ°çš„ç»“æžœé‡Œï¼Œé™æ€å˜é‡çš„å€¼ä¾èµ–ç±»å¯¹è¯¥é™æ€å­—æ®µçš„ â‘ åˆå§‹åŒ–æ“ä½œä»¥åŠ â‘¡æ˜¯å¦åœ¨åŒä¸€ä¸ªJVMè¿›ç¨‹å†…ã€‚ %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR subgraph é™æ€å˜é‡ t(\"a = 0\"):::p end t --> |\"èµ‹å€¼\"|1(\"a = 10\"):::lp 1 -.-> |\"ååºåˆ—åŒ–æ“ä½œ 1\"|A(\"a = 10\"):::lp 1 -.-> |\"ååºåˆ—åŒ–æ“ä½œ 2\"|B(\"a = 0\"):::g subgraph \"JVMè¿›ç¨‹ 2\" B end subgraph \"JVMè¿›ç¨‹ 1(åŒä¸ª)\" A end B -.-> info(\"å› ä¸ºç±»åœ¨JVMè¿›ç¨‹å†…åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ç›¸åŒçš„ç±»åœ¨ä¸åŒJVMéƒ½ä¼šè¢«åˆå§‹åŒ–ä¸€éã€‚\"):::lg classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆ3ï¼‰serialVersionUIDserialVersionUID ç”¨æ¥å®žçŽ°ç±»ç‰ˆæœ¬å…¼å®¹ï¼Œåœ¨å®žé™…å¼€å‘ä¸­èƒ½æ»¡è¶³ç±»å­—æ®µå˜åŒ–çš„éœ€æ±‚ã€‚ å¿…é¡»å®šä¹‰ serialVersionUID å­—æ®µï¼š å¦‚æžœä¸å®šä¹‰serialVersionUIDå­—æ®µï¼ŒJavaåºåˆ—åŒ–ä¼šæ ¹æ®ç±»å­—æ®µå’Œå…¶ä»–ä¸Šä¸‹æ–‡è®¡ç®—ä¸€ä¸ªé»˜è®¤å€¼ã€‚ å½“ç±»å­—æ®µå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒserialVersionUID å€¼ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œå°±ä¼šå‡ºçŽ°å› ç±»å­—æ®µå˜åŒ–å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥çš„é—®é¢˜ã€‚æ¯”å¦‚å¢žåŠ æ–°å­—æ®µåŽï¼Œæ— æ³•å†è¯»å–å¢žåŠ å­—æ®µä¹‹å‰çš„åºåˆ—åŒ–æ•°æ®ã€‚ååºåˆ—åŒ–ä¼šæŠ¥InvalidCastException å¼‚å¸¸ã€‚ serialVersionUID å­—æ®µå¿…é¡»æ˜¯ static + final ç±»åž‹ï¼Œæ‰èƒ½è¢«åºåˆ—åŒ–ã€‚ ObjectStreamClass çš„ getDeclaredSUID()ï¼š private static Long getDeclaredSUID(Class&lt;?&gt; cl) &#123; try &#123; Field f = cl.getDeclaredField(&quot;serialVersionUID&quot;); // ðŸ”» serialVersionUID å­—æ®µå¿…é¡»æ˜¯ static + final ç±»åž‹ int mask = Modifier.STATIC | Modifier.FINAL; if ((f.getModifiers() &amp; mask) == mask) &#123; f.setAccessible(true); return Long.valueOf(f.getLong(null)); &#125; &#125; catch (Exception ex) &#123; &#125; return null;&#125; ï¼ˆ4ï¼‰åºåˆ—åŒ–/ååºåˆ—åŒ–hookwriteReplace() å’Œ readResolve() ç”¨äºŽåºåˆ—åŒ–å†™å…¥ / ååºåˆ—åŒ–æ—¶æ‹¦æˆªå¹¶æ›¿æ¢æˆä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡ã€‚ âžŠ writeReplaceæ–¹æ³• æ–¹æ³•çš„å®Œæ•´å®šä¹‰ï¼š private/default/protected/public Object writeReplace() throws ObjectStreamException;// ç”±äºŽåŸºäºŽåå°„æ‰§è¡Œï¼Œå› æ­¤ä½œç”¨åŸŸé™å®šç¬¦ä¸å—é™åˆ¶ã€‚ è‹¥å®šä¹‰äº† wirteReplace()ï¼Œå°±æ²¡å¿…è¦å†å®šä¹‰ âŒ writeObject() äº†ã€‚å†…éƒ¨ä¼šå…ˆè°ƒç”¨writeReplaceæ–¹æ³•å°†å½“å‰åºåˆ—åŒ–å¯¹è±¡æ›¿æ¢æˆè‡ªå®šä¹‰ç›®æ ‡å¯¹è±¡ã€‚ï¼ˆreadObject åŒç†ï¼‰ å·¥ä½œåŽŸç†ï¼š ObjectOutputStream çš„ writeObject0()ï¼š // check for replacement objectObject orig = obj;Class&lt;?&gt; cl = obj.getClass();ObjectStreamClass desc;for(;;) &#123; // REMIND: skip this check for strings/arrays? Class&lt;?&gt; repCL; // ðŸ”» è°ƒç”¨ obj åºåˆ—åŒ–å†™å…¥ if (!desc.hasWriteReplaceMethod() || (obj = desc.invokeWriteReplace(obj)) == null || (repCl = obj.getCLass()) == cl) &#123; break; &#125; cl = repCl;&#125; âž‹ readResolveæ–¹æ³• æ–¹æ³•çš„å®Œæ•´å®šä¹‰ï¼š private/default/protected/public Object readResolve() throws ObjectStreamException;// ç”±äºŽåŸºäºŽåå°„æ‰§è¡Œï¼Œå› æ­¤ä½œç”¨åŸŸé™å®šç¬¦ä¸å—é™åˆ¶ã€‚ è‹¥å®šä¹‰äº† readResolve æ–¹æ³•ï¼Œâœ… readObject æ–¹æ³•æ˜¯å…è®¸å‡ºçŽ°çš„ã€‚ å·¥ä½œåŽŸç†ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR subgraph \"ObjectInputStream.java\" A([\"readObject0()\"]):::p A --> |\"ðŸ”¸ è¿”å›žååºåˆ—åŒ–ç»“æžœ\"|x(\"åˆ¤æ–­æ˜¯å¦å­˜åœ¨ readResolve()\"):::lg x -.-> |\"[ å­˜åœ¨ ]\"|B B([\"è°ƒç”¨ readResolve()\"]):::g B -.-> |\"ðŸ”¹ è¿”å›žè‡ªå®šä¹‰çš„å¯¹è±¡\"|C([\"readObject\"]):::p C end x --> |\"[ ä¸å­˜åœ¨ ]ðŸ”¸ ç›´æŽ¥è¿”å›žå¯¹è±¡ç»“æžœ\"|C classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px é¦–å…ˆè°ƒç”¨ readObject0 æ–¹æ³•å¾—åˆ°ååºåˆ—åŒ–ç»“æžœ è‹¥ readResolve æ–¹æ³•å­˜åœ¨ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥æ–¹æ³•è¿”å›žè‡ªå®šä¹‰çš„å¯¹è±¡ã€‚ å°†è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸º ObjectInputStream çš„ readObject çš„è¿”å›žå€¼ã€‚ ä½¿ç”¨åœºæ™¯ï¼š ä½¿ç”¨ readResolve() åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¯¹æžšä¸¾å¯¹è±¡è¿›è¡Œæ¢å¤æ€§ä¿æŠ¤ã€‚ /** * å¯¹äºŽç±»å®žçŽ°çš„æžšä¸¾ç±»åž‹ï¼Œååºåˆ—åŒ–å‡ºæ¥çš„æžšä¸¾å¯¹è±¡æœŸæœ›æ˜¯å®šä¹‰çš„æžšä¸¾å¯¹è±¡ï¼Œ * è¿™ä¹Ÿä½“çŽ°äº†æžšä¸¾çš„æ„ä¹‰ã€‚ * * ä½†ä»Žä»£ç æ‰§è¡Œæƒ…å†µçœ‹ï¼Œååºåˆ—åŒ–å‡ºæ¥çš„çš„æžšä¸¾å¯¹è±¡æ˜¯ä¸€ä¸ªæ–°å»ºå‡ºæ¥çš„æžšä¸¾å¯¹è±¡ï¼Œ * è™½ç„¶å€¼å’Œæžšä¸¾å€¼å®šä¹‰çš„ä¸€æ ·ï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ */public class Brand implements Serializable &#123; private int val; private Brand(int val) &#123; this.val = val; &#125; public static final Brand NIKE = new Brand(0); public static final Brand ADDIDAS = new Brand(1); public static void main(String[] args) throws Exception &#123; ObjectOutputStream outputStream = new ObjectOutputStream( new FileOutputStream(new File(&quot;out1&quot;))); outputStream.writeObject(Brand.ADDIDAS); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream( new FileInputSrteam(new File(&quot;out1&quot;))); Brand brand = (Brand) inputStream.readObject(); System.out.println(brand == Brand.ADDIDAS); // âŒ false &#125; &#125; åŠ ä¸Š readResolve() åŽï¼š /** * ä½¿ç”¨ readResolve() åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¯¹æžšä¸¾å¯¹è±¡è¿›è¡Œæ¢å¤æ€§ä¿æŠ¤ã€‚ */public class Brand implements Serializable &#123; private int val; private Brand(int val) &#123; this.val = val; &#125; public static final Brand NIKE = new Brand(0); public static final Brand ADDIDAS = new Brand(1); // ðŸ”» public Object readResolve() throws ObjectStreamException &#123; if (val == 0) &#123; return NIKE; &#125; if (val == 1) &#123; return ADDIDAS; &#125; return null &#125; public static void main(String[] args) throws Exception &#123; ObjectOutputStream outputStream = new ObjectOutputStream( new FileOutputStream(new File(&quot;out1&quot;))); outputStream.writeObject(Brand.ADDIDAS); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream( new FileInputSrteam(new File(&quot;out1&quot;))); Brand brand = (Brand) inputStream.readObject(); System.out.println(brand == Brand.ADDIDAS); // â­•ï¸ true &#125; &#125; ï¼ˆ5ï¼‰æ•°æ®æ ¡éªŒJavaåºåˆ—åŒ–æœºåˆ¶åœ¨ååºåˆ—åŒ–æ—¶æ”¯æŒå¯¹è¯»å–åˆ°çš„æ•°æ®è¿›è¡Œæ ¡éªŒï¼ˆé»˜è®¤ä¸æ ¡éªŒï¼‰ã€‚è¿™æ˜¯å› ä¸ºJavaåºåˆ—åŒ–åŽçš„æ•°æ®æ˜¯æ˜Žæ–‡å½¢å¼ï¼Œæœ‰å¯èƒ½è¢«ä¿®æ”¹ã€‚ ä½¿ç”¨æ•°æ®æ ¡éªŒç‰¹æ€§éœ€è¦è®©è‡ªå®šä¹‰çš„åºåˆ—åŒ–ç±»å®žçŽ°java.io.ObjectInputValidationæŽ¥å£ public class Person implements Serializable, ObjectInputValidation é€šè¿‡è°ƒç”¨å›žè°ƒå‡½æ•° validateObject æ¥å®žçŽ°æ•°æ®éªŒè¯ã€‚ @Overridepublic void validateObject() throws InvalidObjectException &#123; if (age &lt;= 0) &#123; throw new InvalidObjectException(&quot;age invalid&quot;) &#125;&#125; äº”ã€åºåˆ—åŒ–æ–¹å¼å¯¹æ¯”é€‰æ‹© Serializable è¿˜æ˜¯ Externalizable ï¼Ÿ * å¯¹æ¯”ï¼š Serializable (ðŸŸ¢ä¼˜å…ˆé€‰æ‹©) Externalizable åŠŸèƒ½ javaåºåˆ—åŒ–å·²æ”¯æŒ javaåºåˆ—åŒ–å·²æ”¯æŒ æ˜“ç”¨æ€§ æ˜“ç”¨æ€§æ›´å¥½ï¼šSerializable æä¾›äº†é»˜è®¤çš„åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–è¡Œä¸ºï¼Œç”¨æˆ·æ— éœ€å…³æ³¨åºåˆ—åŒ–çš„å®žçŽ°ç»†èŠ‚å³å¯æ‹¿æ¥ä½¿ç”¨ã€‚ Externalizable å¿…é¡»å®žçŽ°å®žçŽ° readExternal å’Œ writeExternal æŽ¥å£ï¼Œä¸”è¦æä¾›é»˜è®¤æž„é€ å‡½æ•°ã€‚ è‡ªå®šä¹‰åºåˆ—åŒ– ä¹Ÿå¯é€šè¿‡ readObject å’Œ writeObject æ¥æ”¯æŒ * ç»ˆæ­¢åºåˆ—åŒ–ç‰¹æ€§ï¼š åœ¨ç»§æ‰¿é“¾è·¯ä¸Šï¼Œå¦‚æžœè¦ç»ˆæ­¢ä¸€ä¸ªå­ç±»çš„ Serializable æˆ–è€… Externaizable ç‰¹æ€§ï¼š åœ¨ readObject / writeObject æ–¹æ³•æˆ– readExternal / writeExternal æ–¹æ³•æŽ¥å£é‡ŒæŠ›å‡º UnsupportedOperation-Exception å¼‚å¸¸ï¼Œè¡¨ç¤ºä¸æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½ã€‚ å…­ã€å°ç»“Javaåºåˆ—åŒ–æ–¹æ¡ˆæˆç†Ÿåº¦é«˜ï¼Œä½†æ€§èƒ½å’ŒåŽ‹ç¼©æ•ˆæžœå‡ä¸€èˆ¬ï¼Œåªé€‚åˆJVMç³»åˆ—è¯­è¨€å…±äº«æ•°æ®ï¼Œä¸å…·å¤‡å®Œå…¨çš„è·¨è¯­è¨€èƒ½åŠ›ã€‚å¦å¤–ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ•°æ®å®‰å…¨æ€§å’Œå®Œæ•´æ€§é—®é¢˜ã€‚ åœ¨å®žé™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€ä¼šé€‰æ‹©å…·æœ‰è·¨è¯­è¨€èƒ½åŠ›ã€æ€§èƒ½é«˜æ•ˆã€åŽ‹ç¼©æ•ˆæžœæ˜¾è‘—çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Thriftã€Protocol Bufferç­‰ã€‚ - end - ðŸ”– ç¬”è®°æ¥è‡ªï¼šã€Šæ·±å…¥ç†è§£åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ã€‹ ðŸ“š æ‰©å±•é˜…è¯»ï¼šã€ŠFastSerializeråºåˆ—åŒ–ç‰¹æ€§ä»‹ç» - ååºåˆ—åŒ–åŽŸç†ã€‹","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"}]},{"title":"IO - RandomAccessFile ä»»æ„è®¿é—®æ–‡ä»¶","slug":"note/Basics/IO/IO_RandomAccessFile","date":"2023-05-04T09:09:58.497Z","updated":"2023-05-16T12:50:53.213Z","comments":true,"path":"note/Basics/IO/IO_RandomAccessFile/","link":"","permalink":"https://equnee.github.io/note/Basics/IO/IO_RandomAccessFile/","excerpt":"","text":"java.io - ç›®å½• æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡º æ ‡å‡†è®¾å¤‡è¾“å…¥/è¾“å‡ºï¼šSystem æŽ§åˆ¶å°è¯»å†™ç±»ï¼šConsole æ–‡ä»¶åŸºæœ¬å¤„ç† æ–‡ä»¶æ“ä½œç±»ï¼šFile æ–‡ä»¶æœç´¢ç±»ï¼šFileFilterã€FilenameFilter æ–‡ä»¶ä»»æ„è¯»å†™ç±»ï¼šRandomAccessFile è¾“å…¥/è¾“å‡ºæµ è¾“å…¥/è¾“å‡ºæµ - åˆ†ç±» è¾“å…¥/è¾“å‡ºæµ - å®žçŽ°ç±» åºåˆ—åŒ–/ååºåˆ—åŒ– ä¸€ã€ä½¿ç”¨åœºæ™¯ ðŸ“Œ RandomAccessFile æ—¢å¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä¹Ÿå¯ä»¥å‘æ–‡ä»¶è¾“å‡ºæ•°æ®ï¼Œæ˜¯ä¸€ä¸ªæ›´æŽ¥è¿‘äºŽæ“ä½œç³»ç»ŸAPIçš„å°è£…ç±»ã€‚ ä¸Žæ™®é€šçš„è¾“å…¥/è¾“å‡ºæµä¸åŒçš„æ˜¯ï¼Œ å®ƒæ”¯æŒâ€œéšæœºè®¿é—®â€çš„æ–¹å¼ï¼Œç¨‹åºå¯ä»¥ç›´æŽ¥è·³è½¬åˆ°æ–‡ä»¶çš„ä»»æ„åœ°æ–¹æ¥è¯»å†™æ•°æ®ã€‚ï¼ˆä¸ŽInputStreamã€Readeréœ€è¦ä¾æ¬¡å‘åŽè¯»å–ç›¸åŒºåˆ†ï¼‰ å®ƒå°†æ–‡ä»¶å†…å®¹å­˜å‚¨åœ¨ä¸€ä¸ªå¤§åž‹byteæ•°ç»„ä¸­ã€‚å®ƒå­˜åœ¨ç€æŒ‡å‘è¯¥éšå«byteæ•°ç»„çš„å…‰æ ‡æˆ–ç´¢å¼•ï¼Œç§°ä¸ºæ–‡ä»¶æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆä½ç½®å¯ä»¥é€šè¿‡seekæ–¹æ³•è®¾ç½® ä½¿ç”¨åœºæ™¯ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR T([\"RandomAccessFile çš„ä½¿ç”¨åœºæ™¯\"]):::p T --> A(\"ä»…è®¿é—®æ–‡ä»¶éƒ¨åˆ†å†…å®¹\"):::lp T --> B(\"å‘å·²å­˜åœ¨çš„æ–‡ä»¶åŽè¿½åŠ å†…å®¹\"):::lp classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px åªè®¿é—®æ–‡ä»¶éƒ¨åˆ†å†…å®¹ï¼Œè€Œä¸æ˜¯æŠŠæ–‡ä»¶ä»Žå¤´è¯»åˆ°å°¾ï¼Œä½¿ç”¨RandomAccessFileæ›´å¥½ã€‚ å‘å·²å­˜åœ¨çš„æ–‡ä»¶åŽè¿½åŠ å†…å®¹ï¼šä¸ŽOutputStreamã€Writerç­‰è¾“å‡ºæµä¸åŒçš„æ˜¯ï¼ŒRandomAccessFileå…è®¸è‡ªç”±å®šä½æ–‡ä»¶è®°å½•æŒ‡é’ˆï¼Œæ‰€ä»¥RandomAccessFileå¯ä»¥ä¸ä»Žå¼€å§‹çš„åœ°æ–¹å¼€å§‹è¾“å‡ºï¼Œæ‰€ä»¥RandomAccessFileå¯ä»¥å‘å·²å­˜åœ¨çš„æ–‡ä»¶åŽè¿½åŠ å†…å®¹ã€‚ äºŒã€æ–¹æ³•java.io.RandomAccessFile â‘  æž„é€ æ–¹æ³• æ–¹æ³• è¯´æ˜Ž RandomAccessFile(File file, String mode) ä½¿ç”¨Fileå‚æ•°æ¥æŒ‡å®šæ–‡ä»¶æœ¬èº«ï¼ˆæ‰“å¼€æ–‡ä»¶ï¼‰ RandomAccessFile(String name, String mode) ä½¿ç”¨Stringå‚æ•°æ¥æŒ‡å®šæ–‡ä»¶åï¼ˆæ‰“å¼€æ–‡ä»¶ï¼‰ RandomAccessFileçš„4ç§è®¿é—®æ¨¡å¼ï¼š å‚æ•°å€¼ è¯´æ˜Ž r ä»¥åªè¯»æ–¹å¼æ‰“å¼€æŒ‡å®šæ–‡ä»¶ã€‚è‹¥è¯•å›¾å¯¹è¯¥RamdomAceessFileæ‰§è¡Œå†™å…¥æ–¹æ³•ï¼Œéƒ½å°†æ‰§è¡ŒIOExceptionå¼‚å¸¸ rw ä»¥è¯»ã€å†™æ–¹å¼æ‰“å¼€æŒ‡å®šæ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶å°šä¸å­˜åœ¨ï¼Œåˆ™å°è¯•åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ rws ä»¥è¯»ã€å†™æ–¹å¼æ‰“å¼€æŒ‡å®šæ–‡ä»¶ã€‚ç›¸å¯¹äºŽâ€rwâ€æ¨¡å¼ï¼Œè¿˜è¦æ±‚å¯¹æ–‡ä»¶çš„å†…å®¹æˆ–å…ƒæ•°æ®çš„æ¯ä¸ªæ›´æ–°éƒ½åŒæ­¥å†™å…¥åˆ°åº•å±‚å­˜å‚¨è®¾å¤‡ã€‚ rwd ä»¥è¯»ã€å†™æ–¹å¼æ‰“å¼€æŒ‡å®šæ–‡ä»¶ã€‚ç›¸å¯¹äºŽâ€rwâ€æ¨¡å¼ï¼Œè¿˜è¦æ±‚å¯¹æ–‡ä»¶å†…å®¹çš„æ¯ä¸ªæ›´æ–°éƒ½åŒæ­¥å†™å…¥åˆ°åº•å±‚å­˜å‚¨è®¾å¤‡ã€‚* rwdæ¨¡å¼å¯ç”¨äºŽå‡å°‘æ‰§è¡Œçš„I/Oæ“ä½œæ•°é‡ã€‚ â‘¡ æ“ä½œæ–‡ä»¶æŒ‡é’ˆRandomAccessFileå¯¹è±¡çš„è®°å½•æŒ‡é’ˆï¼šæŒ‡å‘å½“å‰è¯»å†™çš„ä½ç½®ï¼Œå„ç§read/writeæ“ä½œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°è¯¥æŒ‡é’ˆï¼ˆç§»åŠ¨å•ä½ï¼šå­—èŠ‚ï¼‰ã€‚ æ–¹æ³• è¯´æ˜Ž long getFilePointer() è¿”å›žæ–‡ä»¶è®°å½•æŒ‡é’ˆçš„å½“å‰ä½ç½®ã€‚ void seek(long pos) å°†æ–‡ä»¶è®°å½•æŒ‡é’ˆå®šä½åˆ°posä½ç½®ã€‚ void skipBytes(int n) ä½¿æ–‡ä»¶æŒ‡é’ˆå‘å‰ç§»åŠ¨æŒ‡å®šçš„nä¸ªå­—èŠ‚ã€‚ * å½“ç¨‹åºæ–°åˆ›å»ºä¸€ä¸ªRandomAccessFileå¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡çš„æ–‡ä»¶è®°å½•æŒ‡é’ˆä½äºŽæ–‡ä»¶å¤´ï¼ˆä¹Ÿå°±æ˜¯0å¤„ï¼‰ï¼Œå½“è¯»/å†™äº†nä¸ªå­—èŠ‚åŽï¼Œæ–‡ä»¶è®°å½•æŒ‡é’ˆå°†ä¼šå‘åŽç§»åŠ¨nä¸ªå­—èŠ‚ã€‚ â‘¢ è¯»å†™æ–¹æ³•RandomAccessFileå®žçŽ°äº†DataInput/DataOutputæŽ¥å£ï¼š * è¯»å–ï¼š// ------ åŸºæœ¬è¯»å– --------------------------------------------int read(); // ä»Žè¯¥æ–‡ä»¶è¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚int read(byte[] b); // ä»Žæ–‡ä»¶ä¸­æœ€å¤šè¯»å–b.lengthä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å­—èŠ‚æ•°ç»„bä¸­ã€‚int read(byte[] b, int off, int len); // ä»ŽæŒ‡å®šçš„offä½ç½®å¼€å§‹ï¼Œä»Žæ–‡ä»¶ä¸­æœ€å¤šè¯»å–lenä¸ªå­—èŠ‚çš„æ•°æ®ã€‚// ------ è¯»å–æŒ‡å®šç±»åž‹çš„æ•°å€¼ -----------------------------------boolean readBoolean(); // è¯»å–ä¸€ä¸ªbooleanbyte readByte(); // è¯»å–ä¸€ä¸ªæœ‰ç¬¦å·çš„8ä½å€¼char readChar(); // è¯»å–ä¸€ä¸ªå­—ç¬¦double readDouble(); // è¯»å–ä¸€ä¸ªdoublefloat readFloat(); // è¯»å–ä¸€ä¸ªfloatint readInt(); // è¯»å–ä¸€ä¸ªæœ‰ç¬¦å·çš„32ä½æ•´æ•°long readLong(); // è¯»å–ä¸€ä¸ªæœ‰ç¬¦å·çš„64ä½æ•´æ•°short readShort(); // è¯»å–ä¸€ä¸ªæœ‰ç¬¦å·çš„16ä½æ•°int readUnsignedByte(); // è¯»å–ä¸€ä¸ªæ— ç¬¦å·çš„8ä½æ•°int readUnsignedShort(); // è¯»å–ä¸€ä¸ªæ— ç¬¦å·çš„16ä½æ•°// ------ è¯»å–ä¸€è¡Œå­—ç¬¦ä¸² ---------------------------------------String readLine() // ------ è¯»å–ä¸­æ–‡å­—ç¬¦ä¸² ---------------------------------------String readUTF() // ä»¥ä¸Šå‡½æ•°å‡æŒ‰ç…§å­—èŠ‚ç è¯»å–çš„ï¼Œè‹¥æœ‰ä¸­æ–‡å‡ºçŽ°ï¼ŒreadLine()ä¼šæ˜¾ç¤ºä¹±ç ï¼Œå¯ä½¿ç”¨readUTF()è¯»å–ã€‚ // å®ƒä»Žå½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹è¯»å–å‰ä¸¤ä¸ªå­—èŠ‚ï¼Œç±»ä¼¼äºŽä½¿ç”¨readUnsignedShortã€‚ * å†™å…¥ï¼š// ------ åŸºæœ¬è¯»å– --------------------------------------------void write() // åœ¨è¯¥æ–‡ä»¶çš„å½“å‰æŒ‡é’ˆä½ç½®å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶è¦†ç›–åŽŸæœ‰çš„å­—èŠ‚ã€‚void write(byte[] b) // å°†b.lengthå­—èŠ‚ä»ŽæŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥æ–‡ä»¶ï¼ˆä»Žå½“å‰æ–‡ä»¶æŒ‡é’ˆå¼€å§‹ï¼‰void write(byte[] b, int off, int len) // ä»Žå‚æ•°offæŒ‡å®šçš„èµ·å§‹ä½ç½®ï¼Œå°†æŒ‡å®šå­—èŠ‚æ•°ç»„ä¸­çš„lenä¸ªå­—èŠ‚å†™å…¥æ–‡ä»¶ã€‚ // ------ å†™å…¥å›ºå®šç±»åž‹çš„æ•°å€¼ -----------------------------------void writeBoolean(boolean v); // æŒ‰å•å­—èŠ‚å€¼å°†booleanå†™å…¥è¯¥æ–‡ä»¶void writeByte(int v); // æŒ‰å•å­—èŠ‚å€¼å°†byteå†™å…¥è¯¥æ–‡ä»¶void writeBytes(String s); // æŒ‰å­—èŠ‚åºåˆ—å°†è¯¥å­—ç¬¦ä¸²å†™å…¥è¯¥æ–‡ä»¶void writeChar(int v); // æŒ‰åŒå­—èŠ‚å€¼å°†charå†™å…¥è¯¥æ–‡ä»¶ï¼Œå…ˆå†™é«˜å­—èŠ‚void writeChars(String s); // æŒ‰å­—ç¬¦åºåˆ—å°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥è¯¥æ–‡ä»¶void writeDouble(double v); /* ä½¿ç”¨Doubleç±»ä¸­çš„doubleToLongBitsæ–¹æ³•å°†åŒç²¾åº¦å‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªlongï¼Œ ç„¶åŽæŒ‰8å­—èŠ‚æ•°é‡å°†è¯¥longå€¼å†™å…¥è¯¥æ–‡ä»¶ï¼Œå…ˆå†™é«˜å­—èŠ‚ */void writeFloat(float v); /* ä½¿ç”¨Floatç±»ä¸­çš„floatToIntBitsæ–¹æ³•å°†æµ®ç‚¹å‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªintï¼Œ ç„¶åŽæŒ‰4å­—èŠ‚æ•°é‡å°†è¯¥intå€¼å†™å…¥è¯¥æ–‡ä»¶ï¼Œå…ˆå†™é«˜å­—èŠ‚ */void writeInt(int v); // æŒ‰4ä¸ªå­—èŠ‚å°†intå†™å…¥è¯¥æ–‡ä»¶ï¼Œå…ˆå†™é«˜å­—èŠ‚void writeLong(long v); // æŒ‰8ä¸ªå­—èŠ‚å°†longå†™å…¥è¯¥æ–‡ä»¶ï¼Œå…ˆå†™é«˜å­—èŠ‚void writeShort(int v); // æŒ‰2ä¸ªå­—èŠ‚å°†shortå†™å…¥è¯¥æ–‡ä»¶ï¼Œå…ˆå†™é«˜å­—èŠ‚// ------ å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæŒ‰å­—èŠ‚å†™å…¥ï¼Œè‹¥ä¸­æ–‡ä¼šä¹±ç ï¼‰----------------writeBytes() writeChars() // æŒ‰ç…§åŒå­—èŠ‚å†™å…¥ï¼Œå³ä¸€ä¸ªå­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚ã€‚ // ------ å†™å…¥ä¸­æ–‡å­—ç¬¦ä¸² ---------------------------------------String writeUTF() /* å®ƒæŠŠ2ä¸ªå­—èŠ‚ä»Žæ–‡ä»¶çš„å½“å‰æ–‡ä»¶æŒ‡é’ˆå†™å…¥åˆ°æ­¤æ–‡ä»¶ï¼Œç±»ä¼¼äºŽä½¿ç”¨writeShortæ–¹æ³• å¹¶ç»™å®šè¦è·Ÿéšçš„å­—èŠ‚æ•°ã€‚æ­¤å€¼æ˜¯å®žé™…å†™å‡ºçš„å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ */ ä¸‰ã€å®žä¾‹â‘  è®¿é—®æŒ‡å®šçš„ä¸­é—´éƒ¨åˆ†æ•°æ®public class RandomAccessFileTest &#123; public static void main(String[] args) &#123; try( RandomAccessFile raf = new RandomAccessFile( &quot;RandomAccessFileTest.java&quot; , &quot;r&quot;)) // ä»¥åªè¯»æ–¹å¼æ‰“å¼€ï¼Œåªèƒ½è¯»å– &#123; // ðŸ”¹ èŽ·å–RandomAccessFileå¯¹è±¡æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆå§‹ä½ç½®æ˜¯0 System.out.println(&quot;RandomAccessFileçš„æ–‡ä»¶æŒ‡é’ˆçš„åˆå§‹ä½ç½®ï¼š&quot; + raf.getFilePointer()); // ðŸ”¹ ç§»åŠ¨rafçš„æ–‡ä»¶è®°å½•æŒ‡é’ˆçš„ä½ç½®ï¼ˆå°†ä»Ž300å­—èŠ‚å¤„å¼€å§‹è¯»ã€å†™ï¼‰ raf.seek(300); byte[] bbuf = new byte[1024]; // ç”¨äºŽä¿å­˜å®žé™…è¯»å–çš„å­—èŠ‚æ•° int hasRead = 0; // ðŸ”¹ ä½¿ç”¨å¾ªçŽ¯æ¥é‡å¤â€œå–æ°´â€è¿‡ç¨‹ while ((hasRead = raf.read(bbuf)) &gt; 0 ) &#123; // å–å‡ºâ€œç«¹ç­’â€ä¸­çš„æ°´æ»´ï¼ˆå­—èŠ‚ï¼‰ï¼Œå°†å­—èŠ‚æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²è¾“å…¥ System.out.print(new String(bbuf , 0 , hasRead )); &#125; &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125;&#125;// è¿è¡Œä¸Šé¢ç¨‹åºï¼Œå°†çœ‹åˆ°ç¨‹åºåªè¯»å–åŽé¢éƒ¨åˆ†çš„æ•ˆæžœã€‚ â‘¡ å‘æŒ‡å®šæ–‡ä»¶åŽè¿½åŠ å†…å®¹public class AppendContent &#123; public static void main(String[] args) &#123; try( // ðŸ”¹ ä»¥è¯»ã€å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ª RandomAccessFile å¯¹è±¡ RandomAccessFile raf=new RandomAccessFile(&quot;out.txt&quot; , &quot;rw&quot;)) &#123; // ðŸ”¹ å°† RandomAccessFile å¯¹è±¡çš„è®°å½•æŒ‡é’ˆ ç§»åŠ¨åˆ°out.txtæ–‡ä»¶çš„æœ€åŽ raf.seek(raf.length()); // ðŸ”¹ ä½¿ç”¨ RandomAccessFile æ‰§è¡Œè¾“å‡º raf.write(&quot;è¿½åŠ çš„å†…å®¹ï¼\\r\\n&quot;.getBytes()); &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125;&#125;// æ¯è¿è¡Œä¸Šé¢ç¨‹åºä¸€æ¬¡ï¼Œéƒ½å¯ä»¥çœ‹åˆ°out.txtæ–‡ä»¶ä¸­å¤šä¸€è¡Œâ€œè¿½åŠ çš„å†…å®¹ï¼â€å­—ç¬¦ä¸²ã€‚ â‘¢ å‘æŒ‡å®šæ–‡ä»¶ã€æŒ‡å®šä½ç½®æ’å…¥å†…å®¹/** * ç¨‹åºå…ˆå°†æ–‡ä»¶ä¸­æ’å…¥ç‚¹åŽçš„å†…å®¹è¯»å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œç„¶åŽé‡æ–°å®šä½åˆ°æ’å…¥ç‚¹ï¼Œå°†éœ€è¦æ’å…¥çš„å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶åŽé¢ï¼Œ * æœ€åŽå°†ä¸´æ—¶æ–‡ä»¶çš„å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶åŽé¢ï¼Œé€šè¿‡è¿™ä¸ªè¿‡ç¨‹å°±å¯ä»¥å‘æŒ‡å®šæ–‡ä»¶ã€æŒ‡å®šä½ç½®æ’å…¥å†…å®¹ã€‚ */public class InsertContent &#123; public static void insert(String fileName, long pos, String insertContent) throws IOException &#123; // ðŸ”¹ åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥ä¿å­˜æ’å…¥ç‚¹åŽçš„æ•°æ®ï¼ˆè¯¥ä¸´æ—¶æ–‡ä»¶å°†åœ¨JVMé€€å‡ºæ—¶è¢«åˆ é™¤ï¼‰ File tmp = File.createTempFile(&quot;tmp&quot; , null); tmp.deleteOnExit(); try( RandomAccessFile raf = new RandomAccessFile(fileName , &quot;rw&quot;); FileOutputStream tmpOut=new FileOutputStream(tmp); FileInputStream tmpIn=new FileInputStream(tmp)) &#123; raf.seek(pos); // ------ðŸ”¹ ä¸‹é¢ä»£ç å°†æ’å…¥ç‚¹åŽçš„å†…å®¹è¯»å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ä¿å­˜------ byte[] bbuf=new byte[64]; // ç”¨äºŽä¿å­˜å®žé™…è¯»å–çš„å­—èŠ‚æ•° int hasRead=0; // ä½¿ç”¨å¾ªçŽ¯æ–¹å¼è¯»å–æ’å…¥ç‚¹åŽçš„æ•°æ® while ((hasRead=raf.read(bbuf)) &gt; 0 )&#123; // å°†è¯»å–çš„æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶ tmpOut.write(bbuf , 0 , hasRead); &#125; // ----------ðŸ”¹ ä¸‹é¢ä»£ç ç”¨äºŽæ’å…¥å†…å®¹---------- // æŠŠæ–‡ä»¶è®°å½•æŒ‡é’ˆé‡æ–°å®šä½åˆ°posä½ç½® raf.seek(pos); // è¿½åŠ éœ€è¦æ’å…¥çš„å†…å®¹ raf.write(insertContent.getBytes()); // è¿½åŠ ä¸´æ—¶æ–‡ä»¶ä¸­çš„å†…å®¹ while ((hasRead=tmpIn.read(bbuf)) &gt; 0 )&#123; raf.write(bbuf , 0 , hasRead); &#125; &#125; &#125; public static void main(String[] args) throws IOException &#123; insert(&quot;InsertContent.java&quot; , 45 , &quot;æ’å…¥çš„å†…å®¹\\r\\n&quot;); &#125;&#125;// æ¯æ¬¡è¿è¡Œä¸Šé¢ç¨‹åºï¼Œéƒ½ä¼šçœ‹åˆ°å‘InsertContent.javaä¸­æ’å…¥äº†ä¸€è¡Œå­—ç¬¦ä¸² å››ã€åº”ç”¨ å¤šçº¿ç¨‹æ–­ç‚¹çš„ç½‘ç»œä¸‹è½½å·¥å…·ï¼ˆå¦‚FlashGetç­‰ï¼‰å°±å¯é€šè¿‡RandomAccessFileç±»æ¥å®žçŽ°ï¼š %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR subgraph \"[ å¤šçº¿ç¨‹æ–­ç‚¹çš„ç½‘ç»œä¸‹è½½å·¥å…· ]\" A[[\"ä¸Žè¢«ä¸‹è½½æ–‡ä»¶å¤§å°ç›¸åŒçš„ç©ºæ–‡ä»¶\"]]:::lp B[[\"è®°å½•æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®æ–‡ä»¶\"]]:::lb end net(\"ç½‘ç»œæ•°æ®\"):::info -.->|\"å†™å…¥\"| A A --> |\"æ¯å†™ä¸€äº›æ•°æ®ï¼šè®°ä¸‹æ–‡ä»¶æŒ‡é’ˆä½ç½®\"|B B -.-> |\"æ–­ç½‘åŽå†æ¬¡ä¸‹è½½ï¼šæ ¹æ®è®°å½•çš„ä½ç½®ç»§ç»­å‘ä¸‹å†™æ•°æ®\"|A classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,stroke-dasharray: 3 3, stroke-width: 2px, stroke: #676666 ä¸‹è½½å·¥å…·ç”¨å¤šæ¡çº¿ç¨‹å¯åŠ¨è¾“å…¥æµæ¥è¯»å–ç½‘ç»œæ•°æ®ï¼Œå¹¶ä½¿ç”¨RandomAccessFileå°†ä»Žç½‘ç»œä¸Šè¯»å–çš„æ•°æ®å†™å…¥å‰é¢å»ºç«‹çš„ç©ºæ–‡ä»¶ä¸­ï¼Œæ¯å†™ä¸€äº›æ•°æ®åŽï¼Œè®°å½•æ–‡ä»¶æŒ‡é’ˆçš„æ–‡ä»¶å°±åˆ†åˆ«è®°ä¸‹æ¯ä¸ªRandomAccessFileå½“å‰çš„æ–‡ä»¶æŒ‡é’ˆä½ç½®ã€‚ - end - ðŸ”– ç¬”è®°æ¥è‡ªï¼š ã€ŠJavaç¼–ç¨‹çš„é€»è¾‘ã€‹ ã€Šç–¯ç‹‚Javaè®²ä¹‰ã€‹ ã€ŠJavaé«˜æ‰‹çœŸç»ï¼ˆç¼–ç¨‹åŸºç¡€å·ï¼‰ã€‹","categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"}]},{"title":"ðŸ¦‹ HashMap åŽŸç†åŠæºç åˆ†æž","slug":"note/Data-Structure/data-structure_HashMap","date":"2023-03-09T15:11:32.969Z","updated":"2023-05-04T09:28:31.248Z","comments":true,"path":"note/Data-Structure/data-structure_HashMap/","link":"","permalink":"https://equnee.github.io/note/Data-Structure/data-structure_HashMap/","excerpt":"","text":"ï¼ˆæœ¬æ–‡ç¼–è¾‘ä¸­ï¼‰ æ³¨ï¼šæœ¬æ–‡åˆ¶ä½œçš„æµç¨‹å›¾ä»…ä¸ºä¸ªäººç†è§£ï¼Œä»…ä¾›å‚è€ƒã€‚ ä¸€ã€HashMapä»‹ç»1. åŽŸç†ï¼ˆ1ï¼‰HashMapæ€Žä¹ˆå­˜å–%%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph TD T((\"HashMapæ€Žä¹ˆå­˜å–å€¼\")):::p T --> |\"æ•°æ®ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨\"| A[\"key â€” value\"] A --> |\"åŒ…è£…ä¸ºNodeæ•°ç»„å¯¹è±¡\"| B[\"Node { key, value }\"] B --> |\"é€šè¿‡nodeæ•°ç»„ä¸‹æ ‡ä¿å­˜å¯¹åº”æ•°æ®\"| C[\"node[0] = new Node { key, value }node[1] = new Node { key, value }node[2] = new Node { key, value } ...\"] C -.-> |\"[ ä¿å­˜ ] éåŽ†æ•°ç»„ï¼Œå¯¹åº”keyå’Œvalue\"| D[\"for (Node node : nodes)\"] C --> |\"[ èŽ·å– ] é€šè¿‡ æ•°ç»„ç´¢å¼• èŽ·å–ï¼ˆkeyçš„hashå€¼ï¼‰\"|E[\"node[ hash(key) ] = value\"]:::lb classDef p fill:#ddaebd style E fill:#d9dfeb, stroke:#657eae,stroke-width:2px,stroke-dasharray: 3 3 ä½¿ç”¨Nodeæ•°ç»„ä¿å­˜ã€é€šè¿‡Nodeæ•°ç»„ç´¢å¼•èŽ·å–ã€‚ ï¼ˆ2ï¼‰Hashç®—æ³•æ€Žä¹ˆå†™%%{ init: { 'themeVariables': { 'fontSize': '13px', 'clusterBorder': 'none', 'clusterBkg': '#f0f2f7' } } }%% graph TD T((\"Hashç®—æ³•æ€Žä¹ˆå†™ï¼Ÿ\")):::p T --> |\"å¦‚ä½•è®¡ç®—å‡ºæ•°ç»„ç´¢å¼•ï¼Ÿhash(key)\"| A[\"* å› ä¸ºNodeæ•°ç»„æœ‰å›ºå®šçš„åˆå§‹åŒ–é»˜è®¤é•¿åº¦ï¼ˆlengthï¼‰* ç´¢å¼•å€¼éœ€é™å®šåœ¨æ•°ç»„é•¿åº¦èŒƒå›´å†…ï¼ˆ0ï½žlength-1ï¼‰* ç´¢å¼•å€¼è¿˜è¦å°½å¯èƒ½å¹³è¡¡ã€åˆ†å¸ƒå‡åŒ€\"] A --> B([\"å–æ¨¡è¿ç®—ï¼šhash % length\"]) B ==> |\"ï¼ˆæ›´å¥½çš„æ–¹æ¡ˆï¼šä½¿ç”¨ä½è¿ç®—æ•ˆçŽ‡æ›´é«˜ï¼‰\"| C([\"ä½è¿ç®—ï¼šhash & (length - 1)\"]) C -.- c(\"lengthå¿…é¡»æ˜¯2çš„næ¬¡å¹‚\"):::b subgraph \"å‰ç½®æ¡ä»¶\" c -.- c2[\"å‡å¦‚ key = 20, length = 16, hash & (length-1):0001 0100 // 20 0000 1111 // 150000 0100 // =4\"]:::c2 end classDef p fill:#ddaebd classDef b fill:#d2d9e7, stroke-width: 0px style c2 color: #86868b, fill:#ebedf3, stroke-dasharray: 3 3 %% å–æ¨¡è¿ç®— style B fill: #f4e4e9 %% \"ä½è¿ç®—\" style C fill:#b8c3d9, stroke:#657eae,stroke-width:2px ä¸ºäº†è§£å†³å–æ¨¡çš„æ•ˆçŽ‡é—®é¢˜ï¼Œé‡‡ç”¨äº†ä½è¿ç®—çš„æ–¹æ³•ï¼šindex = hashå€¼ &amp; (length -1)æ­¤æ—¶éœ€è¦ä¸€ä¸ªå‰ç½®æ¡ä»¶ï¼šlengthçš„é•¿åº¦å¿…é¡»æ˜¯2çš„næ¬¡å¹‚ã€‚å½“lengthçš„é•¿åº¦æ˜¯2næ—¶ï¼Œæœ‰ä»¥ä¸‹å…¬å¼æˆç«‹ï¼š num%2n = num&amp;(2n-1) ã€‚ ðŸ¦‹ å› ä¸ºå°±åƒåè¿›åˆ¶å–ä½™æ•°ä¸€æ ·ï¼Œè‹¥é™¤ä»¥10æˆ–10çš„æ•´æ¬¡å¹‚æ•°ï¼Œä½™æ•°åˆšå¥½æ˜¯å–ä½Žä½ä¸Šçš„æ•°å­—ã€‚åŒç†ï¼ŒäºŒè¿›åˆ¶å–ä½™æ•°åªè¦é™¤ä»¥2çš„næ¬¡å¹‚æ•°ï¼Œä½Žä½ä¸Šçš„æ•°å­—å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ä½™æ•°ã€‚è€Œ(2n - 1)çš„äºŒè¿›åˆ¶æœ‰æ•ˆä½éƒ½æ˜¯1ï¼Œå’Œnä½çš„1ä½œä¸Žè¿ç®—ç›¸å½“äºŽå–ä½Žnä½çš„å€¼ã€‚ lengthçš„é•¿åº¦åˆšå¥½æ˜¯2çš„næ¬¡å¹‚ï¼Œæ‰©å®¹ä¹Ÿæ˜¯æŒ‰åŽŸæ¥çš„2å€å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œå¯ä»¥åŠ å¿«hashè®¡ç®—ã€å‡å°‘hashå†²çªã€‚ ðŸ¦‹ åŠ å¿«hashè®¡ç®—ï¼š ä¸¤å€æ‰©å®¹æœºåˆ¶ä½¿å®¹é‡ä¸€ç›´ä¿æŒåœ¨2çš„næ¬¡å¹‚æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡è¿ç®—ï¼Œæå‡hashè®¡ç®—æ•ˆçŽ‡ã€‚ å½“å®¹é‡ä¿æŒä¸º2çš„næ¬¡å¹‚æ—¶ï¼Œæ¯æ¬¡æ‰©å®¹æ—¶ä½è¿ç®—è®¡ç®—å¾—å‡ºçš„ä½™æ•°ä¸å˜ï¼Œæ•°æ®å­˜æ”¾çš„ç´¢å¼•ä½ç½®ä¹Ÿä¿æŒä¸å˜ã€‚è€Œä½¿ç”¨%è®¡ç®—æ—¶ï¼Œç»“æžœä¼šå› ä¸ºå®¹é‡çš„å˜åŒ–è€Œæ”¹å˜ï¼ˆæ¨¡è¿ç®—ä¼šäº§ç”Ÿå°æ•°ç‚¹ï¼‰ï¼Œæ¯æ¬¡æ‰©å®¹æ—¶æ•°æ®åœ¨æ•°ç»„ä¸­å­˜æ”¾çš„ä½ç½®ä¼šå‘ç”Ÿæ”¹å˜ï¼ˆæ•°æ®æ¼‚ç§»ï¼‰ï¼Œå½±å“æ€§èƒ½ã€‚ ðŸ¦‹ å‡å°‘hashå†²çªï¼š å°†å®¹é‡ä¿æŒä¸ºå¶æ•°è¿›è¡Œhashè®¡ç®—æ—¶ï¼Œç»è¿‡(length-1)åŽï¼Œè®¡ç®—å‡ºçš„ç´¢å¼•å€¼ä¸ºå¥‡æ•°å’Œå¶æ•°çš„æ¦‚çŽ‡ç›¸åŒï¼ˆå–å†³äºŽéšæœºç”Ÿæˆçš„hashå€¼ï¼‰ï¼› è€Œä½¿ç”¨å¥‡æ•°å®¹é‡è¿›è¡Œhashè®¡ç®—æ—¶ï¼Œç»è¿‡(length-1)åŽï¼Œæœ€ç»ˆç»“æžœå‡ä¸ºå¶æ•°ï¼Œè¿™æ ·ä»»ä½• hash å€¼éƒ½åªä¼šè¢«æ•£åˆ—åˆ°æ•°ç»„çš„å¶æ•°ä¸‹æ ‡ä½ç½®ä¸Šï¼Œè¿™æµªè´¹äº†è¿‘ä¸€åŠçš„ç©ºé—´ã€‚ å› æ­¤2çš„næ¬¡å¹‚å®¹é‡ã€åŒå€æ‰©å®¹æœºåˆ¶å¯ä»¥ä½¿å®¹é‡ä¿æŒåœ¨å¶æ•°å€¼ï¼Œå¯ä»¥ä½¿æ·»åŠ çš„å…ƒç´ åœ¨HashMapçš„æ•°ç»„ä¸­å‡åŒ€åˆ†å¸ƒï¼Œå‡å°‘hashç¢°æ’žã€‚ ï¼ˆ3ï¼‰Hashå†²çªæ€Žä¹ˆåŠž%%{ init: { 'themeVariables': { 'fontSize': '13px', 'edgeLabelBackground': '#ddebe6' } } }%% graph TD T((\"1. Hashå†²çªæ€Žä¹ˆä¼˜åŒ–\")):::p --> T1(\"hashè¡¨é‡Œå¯ä»¥å­˜å‚¨å…ƒç´ çš„ä½ç½®è¢«ç§°ä¸ºâ€œæ¡¶ï¼ˆbucketï¼‰â€\") T1 --> |\"é€šå¸¸æƒ…å†µ\"| A(\"å•ä¸ªâ€œæ¡¶â€é‡Œå­˜å‚¨ä¸€ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶æ€§èƒ½æœ€ä½³\"):::g A -.-> |\"O(1)\"| a[\"hashç®—æ³•å¯ä»¥æ ¹æ®hashCodeå€¼è®¡ç®—å‡ºâ€œæ¡¶â€çš„å­˜å‚¨ä½ç½®ï¼ŒæŽ¥ç€ä»Žâ€œæ¡¶â€ä¸­å–å‡ºå…ƒç´ ã€‚\"] T1 --> |\"å“ˆå¸Œå†²çªçš„æƒ…å†µ\"| B(\"å•ä¸ªæ¡¶ä¼šå­˜å‚¨å¤šä¸ªå…ƒç´ ï¼ˆhashå€¼ç›¸åŒï¼‰\"):::g B -.-> |\"O(n)\"|b([\"å¤šä¸ªå…ƒç´ ä»¥ é“¾è¡¨ å½¢å¼å­˜å‚¨\"]):::B b --> 2T((\"2. Hashå†²çªå¾ˆå¤§æ€Žä¹ˆä¼˜åŒ–\")):::p subgraph \"ï¼ˆé“¾è¡¨å¿…é¡»æŒ‰é¡ºåºæœç´¢ï¼Œå­˜å–æ€§èƒ½å·®ï¼‰\" 2T --> C([\"å°†é“¾è¡¨ç»“æž„è½¬ä¸ºçº¢é»‘æ ‘\"]):::B C -.- |\"O(logn)\"|c[\"ä»¥æ ‘çš„é«˜åº¦ä¸ºæœ€å·®æŸ¥è¯¢æ€§èƒ½ï¼Œæ°¸è¿œä¸ä¼šå‡ºçŽ°O(n)çš„æƒ…å†µã€‚\"]:::info end classDef p fill:#ddaebd classDef g fill:#f4e4e9 classDef B fill:#d9dfeb, stroke:#657eae,stroke-width:2px classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 Hashå†²çªç¤ºæ„å›¾ %%{ init: { 'themeVariables': { 'clusterBorder': 'none', 'clusterBkg': '#ececee' } } }%% %% é“¾è¡¨è¶…è¿‡8æ—¶æ ‘åŒ–æˆçº¢é»‘æ ‘ graph TD subgraph \"Node[]\" Entry0[\"Node0Nodeï¼œK,V>\"] -.- Node1 -.- Node2 -.- Node3 -.- Node4 -.- Node5 -.- Node6 end subgraph é“¾è¡¨ Node1 --> A[Node] --> B[Node] --> C[Node] --> D[Node] --> E[Node] --> F[Node] end subgraph çº¢é»‘æ ‘ Node4 --> a[Node] a[Node] --> b[Node] b --> b1[Node] b --> b2[Node] a --> c[Node] c --> c1[Node] c --> c2[Node] b1 --> d[Node] b1 --> d2[Node] end style é“¾è¡¨ fill:#ddebe6 style çº¢é»‘æ ‘ fill:#f4e4e9 ï¼ˆ4ï¼‰å†…å­˜ç»“æž„ç¤ºæ„å›¾ åˆ›å»ºå¯¹è±¡ï¼Œå†…å­˜ç»“æž„ç¤ºæ„å›¾ï¼š Map&lt;String, Integer&gt; countMap = new HashMap&lt;&gt;();countMap.put(&quot;hello&quot;, 1);countMap.put(&quot;world&quot;, 3);countMap.put(&quot;position&quot;, 4); ä¿å­˜é”®å€¼å¯¹ â€œhelloâ€çš„hashå€¼ä¸º96207088ï¼Œæ¨¡16çš„ç»“æžœä¸º0ï¼Œæ‰€ä»¥æ’å…¥table[0]æŒ‡å‘çš„é“¾è¡¨å¤´éƒ¨ï¼Œå†…å­˜ç»“æž„å˜ä¸ºï¼š â€œworldâ€çš„hashå€¼ä¸º111207038ï¼Œæ¨¡16ç»“æžœä¸º14ï¼Œæ‰€ä»¥ä¿å­˜å®Œâ€œworldâ€åŽï¼Œå†…å­˜ç»“æž„ï¼š â€œpositionâ€çš„hashå€¼ä¸º771782464ï¼Œæ¨¡16ç»“æžœä¹Ÿä¸º0, table[0]å·²ç»æœ‰èŠ‚ç‚¹äº†ï¼Œæ–°èŠ‚ç‚¹ä¼šæ’åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå†…å­˜ç»“æž„å˜ä¸ºå¦‚å›¾ï¼š 2. ä½¿ç”¨ï¼ˆ1ï¼‰åŸºæœ¬ä½¿ç”¨Printer.printHashMapStructures(map); // æ‰“å°æ ‘ç»“æž„getMapFromStringParam(); ï¼ˆ2ï¼‰å¦‚ä½•éåŽ†graph LR T((\"éåŽ†HashMapçš„5ç§æ–¹æ³•\")):::p T --> A([\"entrySet\"]):::lp T --> B([\"keySet\"]):::lp T --> C([\"forEach\"]):::lp T --> |\"æµæ“ä½œ\"|D([\"StreamApi.forEach\"]):::lp T -.-> E([\"values\"]) A -.-> a(\"ï¼ˆ1ï¼‰entrySet\") A -.-> a2(\"ï¼ˆ2ï¼‰entrySet + è¿­ä»£å™¨\") B -.-> |\"ï¼ˆæ•ˆçŽ‡ä½Žï¼‰\"| b(\"ï¼ˆ3ï¼‰keySet + get()\") C -.-> c(\"ï¼ˆ4ï¼‰forEach + Lambda\") D -.-> d(\"ï¼ˆ5ï¼‰Stream().forEachï¼ˆå•çº¿ç¨‹ï¼‰\") D -.-> d2(\"ï¼ˆ6ï¼‰Stream().forEachï¼ˆå¤šçº¿ç¨‹ï¼‰\") E -.-> e(\"ï¼ˆ7ï¼‰ä»…éåŽ†value\") classDef p fill:#ddaebd classDef lp fill:#f4e4e9 classDef B fill:#d9dfeb, stroke:#657eae,stroke-width:2px éåŽ†HashMapä»£ç ï¼š package com.equne;import java.util.HashMap;import java.util.Iterator;import java.util.Map;public class Main &#123; /** ï¼ˆ1ï¼‰entrySet */ public static void traverse1(Map&lt;String, String&gt; map) &#123; for (Map.Entry&lt;String, String&gt; entry : map.entrySet())&#123; System.out.println(entry.getKey() + &quot;, &quot; + entry.getValue()); &#125; &#125; /** ï¼ˆ2ï¼‰è¿­ä»£å™¨ï¼ˆentrySetï¼‰ */ public static void traverse2(Map&lt;String, String&gt; map) &#123; Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator = map.entrySet().iterator(); while (iterator.hasNext())&#123; Map.Entry&lt;String, String&gt; entry = iterator.next(); System.out.println(entry.getKey() + &quot;, &quot; + entry.getValue()); &#125; &#125; /** ï¼ˆ3ï¼‰keySet + get() */ public static void traverse3(Map&lt;String, String&gt; map) &#123; for (String key : map.keySet())&#123; System.out.println(key + &quot;, &quot; + map.get(key)); &#125; &#125; /** ï¼ˆ4ï¼‰forEach + Lambda */ public static void traverse4(Map&lt;String, String&gt; map) &#123; map.forEach((key, value) -&gt; &#123; System.out.println(key + &quot;, &quot; + value); &#125;); &#125; /** ï¼ˆ5ï¼‰StreamApiï¼ˆå•çº¿ç¨‹ï¼‰ */ public static void traverse5(Map&lt;String, String&gt; map) &#123; map.entrySet().stream().forEach((entry) -&gt; &#123; System.out.println(entry.getKey() + &quot;, &quot; +entry.getValue()); &#125;); &#125; /** ï¼ˆ6ï¼‰StreamApiï¼ˆå¤šçº¿ç¨‹ï¼‰ */ public static void traverse6(Map&lt;String, String&gt; map) &#123; map.entrySet().stream().parallel().forEach((entry) -&gt; &#123; System.out.println(entry.getKey() + &quot;, &quot; +entry.getValue()); &#125;); &#125; /** ï¼ˆ7ï¼‰ä»…éåŽ†value */ public static void traverse7(Map&lt;String, String&gt; map) &#123; for (String v : map.values())&#123; System.out.println(v); &#125; &#125; public static void main(String[] args) &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put(&quot;key1&quot;, &quot;value1&quot;); map.put(&quot;key2&quot;, &quot;value2&quot;); traverse1(map); traverse2(map); traverse3(map); traverse4(map); traverse5(map); traverse6(map); traverse7(map); &#125;&#125; entrySet å’Œ keySet Map.entrySet è¿­ä»£å™¨ä¼šç”Ÿæˆ EntryIteratorï¼Œå…¶è¿”å›žçš„å®žä¾‹æ˜¯ä¸€ä¸ªåŒ…å« key/value é”®å€¼å¯¹çš„å¯¹è±¡ã€‚ è€Œ keySet ä¸­è¿­ä»£å™¨è¿”å›žçš„åªæ˜¯ key å¯¹è±¡ï¼Œè¿˜éœ€è¦åˆ° map ä¸­äºŒæ¬¡å–å€¼ï¼ˆå¤šä¸€ä¸ªgetæ–¹æ³•çš„è°ƒç”¨ï¼‰ã€‚æ•… entrySet è¦æ¯” keySet å¿«ä¸€å€å·¦å³ã€‚ï¼ˆkeySeté€‚åˆä»…éœ€è¦æ“ä½œkeyæ—¶ä½¿ç”¨ï¼‰ðŸ”— æ‘˜è‡ªï¼šã€ŠJavaä¿®ç‚¼æŒ‡å—ï¼šé«˜é¢‘æºç è§£æžã€‹ foreach + Lambda è¡¨è¾¾å¼ï¼ˆJava8 çš„æ–°ç‰¹æ€§ï¼‰ forEach()ï¼šç”¨äºŽéåŽ†åŠ¨æ€æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¹¶æ‰§è¡Œç‰¹å®šæ“ä½œã€‚ Lambda è¡¨è¾¾å¼ï¼šç®­å¤´ç¬¦å· -&gt;ï¼Œå…¶ä¸¤è¾¹è¿žæŽ¥ç€è¾“å…¥å‚æ•°å’Œå‡½æ•°ä½“ã€‚ Stream() å…¶å®žç”¨Iterableæœ¬èº«çš„forEachæ–¹æ³•å³å¯ï¼Œæ²¡æœ‰å¿…è¦ç”¨æµå¼æ“ä½œã€‚StreamApié€‚åˆåœ¨å¯¹é›†åˆè¿›è¡Œå…¶ä»–æµå¼æ“ä½œä¹‹åŽä½¿ç”¨ã€‚ è¡¥å……ï¼šç”¨æµèŽ·å–æ˜ å°„å€¼çš„æžç«¯æ¡ˆä¾‹ï¼šOptional&lt;String&gt; value = map .entrySet() .stream() .filter(entry -&gt; entry.getKey().equals(key)) .map(Entry::getValue) // åŒå†’å·ï¼šå¼•ç”¨æ–¹æ³• .findFirst(); ðŸ”— æ‘˜è‡ªï¼šã€Šå¥½ä»£ç ï¼Œåä»£ç ã€‹ . äºŒã€HashMapæºç  æ³¨ï¼šæœ¬æ–‡æºç ç‰ˆæœ¬å‡ä¸ºï¼šJDK 8 1. å±žæ€§// ðŸ”¹ å¸¸é‡// é»˜è®¤çš„åˆå§‹å®¹é‡å€¼ï¼ˆ16ï¼‰- å¿…é¡»æ˜¯2çš„næ¬¡å¹‚static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4;// æœ€å¤§å®¹é‡ä¸Šé™ï¼ˆ2çš„30æ¬¡æ–¹ï¼‰static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;// é»˜è®¤çš„è´Ÿè½½å› æ•°ï¼ˆ0.75ï¼‰static final float DEFAULT_LOAD_FACTOR = 0.75f;// æ ‘åŒ–é˜ˆå€¼ï¼šå½“ä¸€ä¸ªæ¡¶ä¸­çš„å…ƒç´ ä¸ªæ•°å¤§äºŽç­‰äºŽ8æ—¶è¿›è¡Œæ ‘åŒ–static final int TREEIFY_THRESHOLD = 8;// æ ‘é™çº§ä¸ºé“¾è¡¨çš„ä»“ä½è®¡æ•°é˜ˆå€¼ï¼Œå½“ä¸€ä¸ªæ¡¶ä¸­çš„å…ƒç´ ä¸ªæ•°å°äºŽç­‰äºŽ6æ—¶æŠŠæ ‘è½¬åŒ–ä¸ºé“¾è¡¨ã€‚static final int UNTREEIFY_THRESHOLD = 6;// å°†tableæ ‘åŒ–çš„æœ€å°å®¹é‡å€¼ï¼ˆ64ï¼‰ï¼šå½“æ¡¶çš„ä¸ªæ•°è¾¾åˆ°64çš„æ—¶å€™æ‰è¿›è¡Œæ ‘åŒ–ï¼ˆè‡³å°‘åº”ä¸º4*TREEIFY_THRESHOLDï¼Œä»¥é¿å…è°ƒæ•´å¤§å°å’Œæ ‘åŒ–é˜ˆå€¼ä¹‹é—´çš„å†²çªã€‚ï¼‰static final int MIN_TREEIFY_CAPACITY = 64;// ðŸ”¹ å˜é‡// Nodeæ•°ç»„ï¼Œåˆå«ä½œæ¡¶ï¼ˆbucketï¼‰transient Node&lt;K,V&gt;[] table;// ä½œä¸ºentrySet()çš„ç¼“å­˜transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;// å…ƒç´ çš„æ•°é‡transient int size;// è®°å½•hashMapçš„ä¿®æ”¹æ¬¡æ•°ï¼ˆæ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹ map ç»“æž„çš„è®¡æ•°å™¨ï¼‰transient int modCount;// æ‰©å®¹é˜ˆå€¼ = table.length * loadFactorï¼ˆå½“sizeå¤§äºŽé˜ˆå€¼æ—¶æ‰©å®¹ï¼‰int threshold;// è´Ÿè½½å› æ•°ï¼šè¡¨ç¤ºæ•´ä½“ä¸Štableè¢«å ç”¨çš„ç¨‹åº¦final float loadFactor; 2. æž„é€ æ–¹æ³•graph LR T((\"HashMapæž„é€ æ–¹æ³•\")):::p T --> A([\"HashMap map1 = new HashMap();\"]):::lp T --> B([\"HashMap map2 = new HashMap(30);\"]):::lp T --> C([\"HashMap map3 = new HashMap(30, 0.5f);\"]):::lp T --> D([\"HashMap map4 = new HashMap(map);\"]):::lp A --- |\"æ— å‚æž„é€ æ–¹æ³•\"|a(\"ä¸æŒ‡å®šå®¹é‡ï¼Œé»˜è®¤:16\") B --- |\"initialCapacoty\"| b(\"æŒ‡å®šåˆå§‹åŒ–å®¹é‡ï¼š30\") C --- |\"initialCapacotyloadFactor\"| c(\"æŒ‡å®šåˆå§‹åŒ–å®¹é‡ã€è´Ÿè½½å› æ•°\") D --- |\"Map map\"| d(\"ä»¥æŒ‡å®šmapæž„é€ æ–°map\") D -.- ci(\"* æ³¨æ„ï¼šä¸Žä¸Šè¿°ä»…åˆ›å»ºç©ºHashMapä¸åŒï¼Œæ­¤æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†put()å­˜å€¼tableæ‰çœŸæ­£è¿›è¡Œäº†åˆå§‹åŒ–ã€‚\"):::info classDef p fill:#ddaebd classDef lp fill: #f4e4e9 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ï¼ˆ1ï¼‰HashMap() æ— å‚æ•°çš„æž„é€ æ–¹æ³•/** * Constructs an empty HashMap with the default initial capacity(16) and the default load factor (0.75). * ä»¥é»˜è®¤åˆå§‹å®¹é‡(16)å’Œé»˜è®¤è´Ÿè½½å› æ•°(0.75)ï¼Œæž„é€ ä¸€ä¸ªç©ºçš„HashMapã€‚ */public HashMap() &#123; // ðŸ”» å°†è´Ÿè½½å› æ•°èµ‹ä¸ºé»˜è®¤å€¼ã€‚ this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted&#125; ï¼ˆ2ï¼‰HashMap(20) å¸¦åˆå§‹å®¹é‡çš„æž„é€ æ–¹æ³•ï¼š/** * Constructs an empty HashMap with the specified initial capacity and the default load factor (0.75). * ä»¥ç‰¹å®šçš„åˆå§‹å®¹é‡å’Œé»˜è®¤çš„è´Ÿè½½å› æ•°(0.75)ï¼Œæž„é€ ä¸€ä¸ªç©ºçš„HashMap * * @param initialCapacity åˆå§‹å®¹é‡ * @throws IllegalArgumentException åˆå§‹å®¹é‡ä¸ºè´Ÿå€¼æ—¶æŠ›å‡ºéžæ³•æ•°æ®å¼‚å¸¸ã€‚ */ public HashMap(int initialCapacity) &#123; // ðŸ”» è°ƒç”¨äº†å¸¦åˆå§‹å®¹é‡ã€è´Ÿè½½å› æ•°çš„æž„é€ æ–¹æ³•ï¼ˆè¯¦è§ä¸‹æ–‡(3)ï¼‰ this(initialCapacity, DEFAULT_LOAD_FACTOR); &#125; ï¼ˆ3ï¼‰HashMap(20, 0.5f) å¸¦åˆå§‹å®¹é‡ã€è´Ÿè½½å› æ•°çš„æž„é€ æ–¹æ³•/** * Constructs an empty HashMap with the specified initial capacity and load factor. * ä»¥ç‰¹å®šçš„åˆå§‹å®¹é‡å’Œè´Ÿè½½å› æ•°æž„é€ ä¸€ä¸ªç©ºçš„HashMapã€‚ * * @param initialCapacity åˆå§‹åŒ–å®¹é‡ * @param loadFactor è´Ÿè½½å› æ•° * @throws IllegalArgumentException if the initial capacity is negative * or the load factor is nonpositive * å½“åˆå§‹å®¹é‡ä¸ºè´Ÿå€¼ã€æˆ–è´Ÿè½½å› æ•°ä¸ºéžæ­£æ—¶æŠ›å‡ºéžæ³•æ•°æ®å¼‚å¸¸ã€‚ */public HashMap(int initialCapacity, float loadFactor) &#123; // ðŸ”´ ä¸€ã€åˆ¤æ–­ä¼ å…¥å‚æ•°çš„åˆæ³•æ€§ // ðŸ”¹ åˆå§‹å®¹é‡å€¼éžè´Ÿæ•° if (initialCapacity &lt; 0) throw new IllegalArgumentException(&quot;Illegal initial capacity: &quot; + initialCapacity); // ðŸ”¹ åˆå§‹å®¹é‡å€¼ä¸è¶…è¿‡æœ€å¤§å®¹é‡ if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; // ðŸ”¹ è´Ÿè½½å› æ•°å¤§äºŽ0ä¸”ä¸ºæ•°å­— if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(&quot;Illegal load factor: &quot; + loadFactor); // ðŸ”´ äºŒã€ä¸ºé…ç½®å‚æ•°èµ‹å€¼ // ðŸ”¹ ä¸ºè´Ÿè½½å› æ•°èµ‹å€¼ this.loadFactor = loadFactor; // ðŸ”¹ ä¸ºæ‰©å®¹é˜ˆå€¼èµ‹å€¼ï¼šä½¿ç”¨tableSizeFor()å°†ç»™å®šæ•°å€¼è°ƒæ•´ä¸º2çš„æ¬¡å¹‚æ•°ã€‚ this.threshold = tableSizeFor(initialCapacity);&#125; ï¼ˆ4ï¼‰HashMap(map)- HashMap() å¸¦mapçš„æž„é€ æ–¹æ³• /** * Constructs a new HashMap with the same mappings as the specified Map. * The HashMap is created with default load factor (0.75) and an initial capacity sufficient to hold the mappings in the specified Map. * ä½¿ç”¨ä¸ŽæŒ‡å®šMapç›¸åŒçš„æ˜ å°„æž„é€ æ–°çš„HashMapã€‚ * æ­¤HashMapç”±ï¼šé»˜è®¤è´Ÿè½½å› æ•°(0.75)ã€è¶³å¤Ÿçš„åˆå§‹å®¹é‡ï¼ˆè¶³ä»¥å­˜ä¸‹æŒ‡å®šMapï¼‰åˆ›å»ºã€‚ * * @param m the map whose mappings are to be placed in this map * @å‚æ•°ï¼š mï¼ŒåŽŸmap * @throws NullPointerException if the specified map is null * @å¼‚å¸¸ï¼š å½“åŽŸmapä¸ºç©ºæ—¶æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ */public HashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; // ðŸ”» å°†è´Ÿè½½å› æ•°èµ‹ä¸ºé»˜è®¤å€¼ã€‚ this.loadFactor = DEFAULT_LOAD_FACTOR; // ðŸ”» è°ƒç”¨putMapEntries()ï¼Œå°†åŽŸæœ‰mapå­˜å…¥æ–°mapã€‚ putMapEntries(m, false);&#125; - putMapEntries() èµ‹å€¼å¹¶åˆå§‹åŒ–å‡½æ•°/** * Implements Map.putAll and Map constructor. * èµ‹å€¼å¹¶æž„é€ å‡½æ•°ã€‚ * * @param m the map * @å‚æ•°ï¼š mï¼Œä¼ å…¥çš„map * @param evict false when initially constructing this map, else true (relayed to method afterNodeInsertion). * @å‚æ•°ï¼š evictï¼Œé¦–æ¬¡åˆ›å»ºæ­¤mapæ—¶è¿”å›žfalseï¼Œéžé¦–æ¬¡åˆ›å»ºè¿”å›žtrueã€‚ */final void putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) &#123; int s = m.size(); // mçš„å…ƒç´ ä¸ªæ•° // ðŸ”´ ä¸€ã€è‹¥mä¸­æœ‰å…ƒç´ ï¼Œéœ€è¦æ ¹æ®æ–°Mapçš„åˆå§‹åŒ–æƒ…å†µä¸ºå…¶æ‰©å®¹é˜ˆå€¼èµ‹å€¼ã€‚ ï¼ˆè‹¥mæ— å…ƒç´ åˆ™æ— éœ€èµ‹å€¼ï¼Œç›´æŽ¥ä½¿ç”¨ç»™å®šçš„è´Ÿè½½å› æ•°å’Œæ‰©å®¹é˜ˆå€¼(lf*cap)å®Œæˆæž„é€ ã€‚ï¼‰ if (s &gt; 0) &#123; // ðŸ”¹ è‹¥æ•°ç»„æœªåˆå§‹åŒ–ï¼šæ ¹æ®mä¸­å…ƒç´ æ•°é‡å’Œè´Ÿè½½å› æ•°è®¡ç®—æ–°Mapçš„æ‰©å®¹é˜ˆå€¼ã€‚ if (table == null) &#123; // pre-size // mçš„æ‰©å®¹é˜ˆå€¼ = å…ƒç´ æ•°é‡ / è´Ÿè½½å› æ•°ï¼ˆðŸ”¸+1.0Fï¼šå¯¹å°æ•°åšå‘ä¸Šå–æ•´ä»¥å°½å¯èƒ½ä¿è¯æ›´å¤§å®¹é‡ï¼‰ float ft = ((float)s / loadFactor) + 1.0F; // å°†mæ‰©å®¹é˜ˆå€¼çš„æ•°æ®ç±»åž‹è½¬ä¸ºæ•´åž‹ï¼Œå¹¶é™å®šåœ¨é»˜è®¤å®¹é‡ä¸Šé™å†… int t = ((ft &lt; (float)MAXIMUM_CAPACITY) ? (int)ft : MAXIMUM_CAPACITY); // è‹¥è®¡ç®—å‡ºmçš„æ‰©å®¹é˜ˆå€¼ &gt; æ–°Mapæ‰©å®¹é˜ˆå€¼ï¼Œè°ƒç”¨tableSizeForæ–¹æ³•ï¼Œå°†æ–°Mapæ‰©å®¹é˜ˆå€¼è®¾ç½®ä¸ºï¼šè¯¥å€¼æœ€æŽ¥è¿‘å®¹é‡çš„2æ¬¡å¹‚æ•°ã€‚ if (t &gt; threshold) threshold = tableSizeFor(t); &#125; // ðŸ”¹ è‹¥æ•°ç»„å·²åˆå§‹åŒ–ã€ä¸”Mapä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†å…¶æ‰©å®¹é˜ˆå€¼ï¼šæ‰©å®¹ã€‚ else if (s &gt; threshold) resize(); // ðŸ”´ äºŒã€èµ‹å€¼ï¼šéåŽ†mçš„entryï¼Œé€ä¸ªèµ‹å€¼åˆ°æ–°Mapä¸Šã€‚ for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123; K key = e.getKey(); V value = e.getValue(); // ðŸ”¹ è°ƒç”¨putVal()ä¸ºæ¯ä¸ªèŠ‚ç‚¹èµ‹å€¼ï¼ˆæ­¤æ—¶æ–°Mapæ‰çœŸæ­£åˆå§‹åŒ–å®Œæˆï¼‰ putVal(hash(key), key, value, false, evict); &#125; &#125;&#125; ((float)s / loadFactor) + 1.0F + 1.0Fï¼šä¸ºäº†è®©æµ®ç‚¹æ•°è¿›è¡Œé™¤æ³•è®¡ç®—åŽå‘ä¸Šå–æ•´ï¼Œä»¥å°½å¯èƒ½ä¿è¯è¶³å¤Ÿå®¹é‡ã€‚ 3. é™æ€å®žç”¨ç¨‹åº- hash() è®¡ç®—key.hashCode()/* ---------------- Static utilities -------------- *//** * Computes key.hashCode() and spreads (XORs) higher bits of hash to lower. * è®¡ç®—key.hashCode()å¹¶å°†å“ˆå¸Œçš„é«˜ä½æ‰©å±•ï¼ˆå¼‚æˆ–è¿ç®—ï¼‰åˆ°ä½Žä½ã€‚ */static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; (h=key.hashCode()) ^ (h &gt;&gt;&gt;16) hash(Object) æ–¹æ³•é€šè¿‡ä»¥ä¸Šè¡¨è¾¾å¼å¾—åˆ°æŒ‡å®šå¯¹è±¡çš„Hashå€¼ã€‚è¿™é‡Œæ˜¯å–å¾—å½“å‰å¯¹è±¡çš„Hashå€¼ï¼Œé¦–å…ˆè¿›è¡Œå¸¦ç¬¦å·ä½çš„å³ç§»16ä½æ“ä½œï¼ˆè¿™æ—¶å€™å¯¹è±¡Hashå€¼çš„é«˜ä½æ®µå°±å˜æˆäº†ä½Žä½æ®µï¼‰ï¼Œç„¶åŽä¸Žå¯¹è±¡åŽŸæ¥çš„Hashå€¼è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ å¼‚æˆ–çš„åŽŸå› ï¼š å› ä¸ºæ•°ç»„å®¹é‡æ€»æ˜¯2çš„næ¬¡å¹‚æ•°ï¼Œè®¡ç®—ç´¢å¼•ä½ç½®æ—¶ï¼Œæ•£åˆ—çœŸæ­£ç”Ÿæ•ˆçš„åªæ˜¯ä½Žnbitçš„æœ‰æ•ˆä½ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿç¢°æ’žã€‚å› æ­¤ï¼ŒæŠŠé«˜16bitå’Œä½Ž16bitå¼‚æˆ–ä¸€ä¸‹ï¼Œæ—¢å‡å°‘äº†ç³»ç»Ÿçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šé€ æˆå› ä¸ºé«˜ä½æ²¡æœ‰å‚ä¸Žä¸‹æ ‡çš„è®¡ç®—(tableé•¿åº¦æ¯”è¾ƒå°)æ—¶ï¼Œå¼•èµ·ç¢°æ’žã€‚ - tableSizeFor() è¿”å›žæœ€æŽ¥è¿‘ç»™å®šç›®æ ‡å®¹é‡çš„äºŒæ¬¡å¹‚æ•°å€¼/** * Returns a power of two size for the given target capacity. * è¿”å›žç»™å®šç›®æ ‡å®¹é‡çš„äºŒæ¬¡å¹‚æ•°ã€‚ */static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;&#125;/* ä»¥ä¸‹ä¸ºå¤‡æ³¨ï¼š ------------------------------------------------- * è¯¥ä½è¿ç®—ç”¨äºŽæ±‚å‡ºé«˜ä½1ä¹‹åŽæ¯ä½éƒ½ä¸º1çš„ç»“æžœã€‚ å› ä¸ºå°†æ¯ä½å˜ä¸º1ï¼Œåˆ™åŠ ä¸Š1åŽåˆšå¥½æ˜¯ä¸€ä¸ªäºŒæ¬¡å¹‚æ•°ã€‚ å¦‚(0000 1000)ï¼Œä½¿å…¶ç¬¬ä¸€ä½1åŽé¢éƒ½ä¸º1ï¼Œå³(0000 1111) ------------------------------------------------- */ // å¦‚ï¼ŒinitialCapacity = 9 // ðŸ”´ å°† n - 1 int n = cap -1; // n = 8 // ðŸ”´ ä½œä½è¿ç®—ï¼š1. æ— ç¬¦å·ä½ç§» 2. ä¸Žnä½œæˆ–çš„ä½è¿ç®—ã€‚ n |= n &gt;&gt;&gt; 1; n = 0000 1000 n = 0000 0100 n = 0000 1100 n |= n &gt;&gt;&gt; 2; n = 0000 1100 n = 0000 0011 n = 0000 1111 // =15 n |= n &gt;&gt;&gt; 4; n = 0000 1111 n = 0000 0000 n = 0000 1111 n |= n &gt;&gt;&gt; 8; n = 0000 1111 n = 0000 0000 n = 0000 1111 n |= n &gt;&gt;&gt; 16; // ðŸ”¸ å› ä¸ºintæ˜¯32ä½çš„ï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°16å³å¯. // ðŸ”´ è¿”å›žä½ç§»ç»“æžœn + 1 return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUN_CAPACITY : n + 1; n &lt; 0, åˆ™è¿”å›ž n = 1 n &gt;= 0, ä¸” n &gt;= æœ€å¤§å®¹é‡, åˆ™è¿”å›žæœ€å¤§å®¹é‡ n &gt;= 0, ä¸” n &lt; æœ€å¤§å®¹é‡, åˆ™è¿”å›ž n + 1 ï¼ˆ=16ï¼‰ ä¸ºä»€ä¹ˆå…ˆè¿›è¡Œn-1æ“ä½œï¼šä¸ºäº†å¤„ç†nåˆšå¥½æ˜¯äºŒæ¬¡å¹‚æ•°çš„æƒ…å†µã€‚ ðŸ¦‹ è‹¥nå·²ç»æ˜¯2çš„næ¬¡å¹‚äº†ï¼ŒæŒ‰ç…§é€»è¾‘å˜1ä¹‹åŽå†åŠ 1ï¼Œç»“æžœå°±ä¼šå˜æˆnçš„2å€äº†ï¼Œä¸Žåº”æœ‰çš„ç»“æžœä¸ä¸€è‡´ã€‚å¦‚ï¼Œn=16ï¼ˆ0001 0000ï¼‰ï¼Œä½è¿ç®—åŽ n=31ï¼ˆ0001 1111ï¼‰ã€‚ - Comparable /** * Returns x&#x27;s Class if it is of the form &quot;class C implements * Comparable&lt;C&gt;&quot;, else null. */static Class&lt;?&gt; comparableClassFor(Object x) &#123; if (x instanceof Comparable) &#123; Class&lt;?&gt; c; Type[] ts, as; Type t; ParameterizedType p; if ((c = x.getClass()) == String.class) // bypass checks return c; if ((ts = c.getGenericInterfaces()) != null) &#123; for (int i = 0; i &lt; ts.length; ++i) &#123; if (((t = ts[i]) instanceof ParameterizedType) &amp;&amp; ((p = (ParameterizedType)t).getRawType() == Comparable.class) &amp;&amp; (as = p.getActualTypeArguments()) != null &amp;&amp; as.length == 1 &amp;&amp; as[0] == c) // type arg is c return c; &#125; &#125; &#125; return null;&#125;/** * Returns k.compareTo(x) if x matches kc (k&#x27;s screened comparable * class), else 0. */@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;) // for cast to Comparablestatic int compareComparables(Class&lt;?&gt; kc, Object k, Object x) &#123; return (x == null || x.getClass() != kc ? 0 : ((Comparable)k).compareTo(x));&#125; 4. å®žçŽ°æ–¹æ³•ï¼ˆ1ï¼‰Get() - èŽ·å–%%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph TD T([\"å¦‚ä½•ä»ŽHashMapèŽ·å–å…ƒç´ ï¼Ÿ\"]):::p T --> B(\"å…ˆæ ¹æ®keyæ‰¾åˆ°æ¡¶ä½\") B --> A([\"åˆ¤æ–­å½“å‰ä½ç½®çš„å…ƒç´ æ˜¯å¦å°±è¦æ‰¾çš„å€¼\"]):::lp A --> |\"æ˜¯\"| C2[\"æ ¸å¯¹k-vå€¼åŽè¿”å›ž\"]:::b A --> |\"å¦ï¼ˆæœ‰hashå†²çªï¼‰\"| C([\"åˆ¤æ–­ä¸ºé“¾è¡¨æˆ–çº¢é»‘æ ‘\"]):::lp C -.-> |\"é“¾è¡¨\"|a[\"éåŽ†é“¾è¡¨ã€æ ¸å¯¹k-vå€¼åŽè¿”å›ž\"]:::b C -.-> |\"çº¢é»‘æ ‘\"|b[\"ä»Žæ ‘çš„æ ¹èŠ‚ç‚¹æŸ¥æ‰¾ã€æ ¸å¯¹k-vå€¼åŽè¿”å›ž\"]:::b classDef p fill:#ddaebd classDef b fill:#d9dfeb classDef lp fill: #f4e4e9 - get() é€šè¿‡keyèŽ·å–value/** * Returns the value to which the specified key is mapped, * or null if this map contains no mapping for the key. * è¿”å›žæŒ‡å®škeyæ‰€æ˜ å°„çš„valueå€¼ã€‚è‹¥æ‰¾ä¸åˆ°å¯¹åº”valueæ—¶è¿”å›žnullã€‚ * * ä½†è¿”å›žnullä¸ä¸€å®šä»£è¡¨ä¸å­˜åœ¨è¯¥keyæ˜ å°„çš„å€¼ï¼Œæœ‰å¯èƒ½æ˜¯è¯¥keyä¿å­˜çš„valueå€¼æ­£æ˜¯&quot;null&quot;ã€‚ * å¯ä»¥ä½¿ç”¨containsKey()æ¥è¯†åˆ«ã€‚ */public V get(Object key) &#123; // Node Node&lt;K,V&gt; e; // ðŸ”» ä½¿ç”¨keyå’Œå…¶hashå€¼è°ƒç”¨getNode()æ–¹æ³•ï¼Œè¿”å›žNodeçš„valueå€¼ã€‚ return (e = getNode(hash(key), key)) == null ? null : e.value;&#125; null ? null : e.valueï¼šè‹¥è¯¥å€¼ä¸ºnullï¼Œè¿”å›žnullï¼›è‹¥è¯¥å€¼ä¸ä¸ºnullï¼Œè¿”å›že.value - getNode() èŽ·å–Node/** * Implements Map.get and related methods. * å®žçŽ°äº†Map.get()å’Œç›¸å…³æ–¹æ³• * * @param hash keyçš„hashå€¼ * @param key key * @return è¿”å›žè¯¥keyå¯¹åº”çš„Nodeï¼Œè‹¥æ— è¿”å›žnull */final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; // Nodeæ•°ç»„ Node&lt;K,V&gt; first, e; // Node int n; // æ•°ç»„é•¿åº¦ K k; // key // ðŸ”» åˆ¤æ–­è¯¥æ•°ç»„éžç©º // å¹¶æ ¹æ®ä¼ å…¥keyçš„hashå€¼è®¡ç®—å‡ºè¯¥hashå€¼å¯¹åº”çš„Nodeçš„ä¸‹æ ‡ï¼Œå°†è¯¥æ•°ç»„ä¸‹æ ‡å¯¹åº”çš„å€¼èµ‹å€¼ç»™first-Nodeï¼ˆæ„ä¸ºhashå†²çªæ—¶ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; // ðŸ”¹ å…ˆåˆ¤æ–­è‹¥firståˆšå¥½æ˜¯æˆ‘ä»¬è¦æ‰¾çš„Nodeæ—¶ï¼šç›´æŽ¥è¿”å›žfirst if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; // ðŸ”¹ å½“firstå°¾éƒ¨è¿˜æœ‰å…ƒç´ ï¼ˆå³æœ‰hashå†²çªï¼‰æ—¶ï¼Œæ ¹æ®Nodeçš„ç»“æž„å–å€¼ã€‚ if ((e = first.next) != null) &#123; // ðŸ”¸ çº¢é»‘æ ‘ï¼šå°†Nodeè½¬ä¸ºTreeNodeç±»åž‹ï¼Œå¹¶è°ƒç”¨getTreeNode()å–å€¼ã€‚ if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); // ðŸ”¸ é“¾è¡¨ï¼šéåŽ†å–å€¼ã€‚ do &#123; if (e.hash == hash &amp;&amp; // åˆ¤æ–­hashå€¼å’Œkeyå€¼éƒ½ç›¸åŒ ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; // ðŸ”» æ•°ç»„ä¸ºç©ºï¼Œè¿”å›žnull return null;&#125; ï¼ˆ2ï¼‰Remove() - åˆ é™¤%%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph TD T([\"å¦‚ä½•ä»ŽHashMapåˆ é™¤å…ƒç´ ï¼Ÿ\"]):::p T --> B(\"å…ˆæ ¹æ®keyæ‰¾åˆ°æ¡¶ä½\") B --> A([\"åˆ¤æ–­å½“å‰ä½ç½®çš„å…ƒç´ æ˜¯å¦å°±è¦åˆ é™¤çš„å€¼\"]):::lp A --> |\"æ˜¯\"| C2[\"ç›´æŽ¥åˆ é™¤è¯¥å…ƒç´ \"]:::b A --> |\"å¦ï¼ˆæœ‰hashå†²çªï¼‰\"| C([\"åˆ¤æ–­ä¸ºé“¾è¡¨æˆ–çº¢é»‘æ ‘\"]):::lp C --> |\"é“¾è¡¨\"|a[\"å°†ä¸Šä¸ªä½ç½®çš„æŒ‡é’ˆï¼ˆè·³è¿‡è¯¥å€¼ï¼‰æŒ‡å‘ä¸‹ä¸ªä½ç½®\"]:::b C --> |\"çº¢é»‘æ ‘\"|b[\"åŽ»æŽ‰å½“å‰èŠ‚ç‚¹åŽè‡ªå¹³è¡¡\"]:::b b -.- bt[\"ï¼ˆæ ‘é•¿åº¦å°äºŽ6æ—¶è½¬ä¸ºé“¾è¡¨ï¼‰\"]:::info classDef info fill:#f6f6f7,color:#737379stroke-width: 3px, stroke-dasharray: 3 3 classDef p fill:#ddaebd classDef b fill:#d9dfeb classDef lp fill: #f4e4e9 - remove() åˆ é™¤å…ƒç´  /** * Removes the mapping for the specified key from this map if present. * æ ¹æ®æŒ‡å®škeyåˆ é™¤æ˜ å°„ã€‚ * * @param key è¦ä»Žmapä¸­åˆ é™¤æ˜ å°„çš„é”® * @return è¿”å›žä¸Žé”®å…³è”çš„å‰å€¼ï¼Œè‹¥å‰å€¼ä¸ºç©ºè¿”å›žnull */public V remove(Object key) &#123; Node&lt;K,V&gt; e; // ðŸ”» è°ƒç”¨removeNode()åˆ é™¤è¯¥é”®æ˜ å°„ï¼Œè‹¥å‰å€¼ä¸ºç©ºè¿”å›žnullï¼Œè‹¥å‰å€¼éžç©ºè¿”å›žå‰å€¼ã€‚ return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125; - removeNode() åˆ é™¤Node /** * Implements Map.remove and related methods. * å®žçŽ°åˆ é™¤å’Œç›¸å…³æ–¹æ³•ã€‚ * * @param hash keyçš„hashå€¼ * @param key key * @param value è‹¥æœ‰å€¼æ—¶åŒ¹é…è¯¥å€¼ * @param matchValue è‹¥ä¸ºçœŸï¼šä»…å€¼ç›¸ç­‰æ—¶åˆ é™¤ * @param movable ä¸ºfalse:åˆ é™¤æ—¶ä¸ç§»åŠ¨å…¶ä»–å€¼ * @return è¿”å›žNodeï¼Œè‹¥æ— è¯¥Nodeè¿”å›žnull */final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; // Nodeæ•°ç»„ï¼ˆå¼•ç”¨å½“å‰hashMapçš„æ•£åˆ—è¡¨ï¼‰ Node&lt;K,V&gt; p; // å½“å‰Nodeå…ƒç´ ï¼šp int n, index; // nï¼šæ•°ç»„é•¿åº¦ï¼Œindexï¼šæ•°ç»„ä¸‹æ ‡ // æ•°ç»„éžç©ºã€å½“å‰ç´¢å¼•ä½ç½®çš„Nodeå…ƒç´ péžç©º if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; // è¦åˆ é™¤çš„Nodeå…ƒç´ ï¼šnodeï¼›å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸ªèŠ‚ç‚¹ï¼še(=p.next) K k; V v; // å½“å‰å…ƒç´ pçš„keyå’Œvalueå€¼ // ðŸ”¹ ç¬¬ä¸€ä¸ªä½ç½®åˆšå¥½æ˜¯è¦åˆ é™¤çš„å…ƒç´ ï¼šèµ‹å€¼ç»™nodeï¼Œæ‰§è¡Œä¸‹æ–¹ä¿®æ”¹æŒ‡é’ˆçš„ä»£ç  if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; // ðŸ”¹ å­˜åœ¨å“ˆå¸Œå†²çªæ—¶ï¼šæ ¹æ®é“¾è¡¨æˆ–çº¢é»‘æ ‘ç»“æž„èŽ·å–è¦åˆ é™¤çš„å…ƒç´ node else if ((e = p.next) != null) &#123; // ðŸ”¸ çº¢é»‘æ ‘ï¼šä½¿ç”¨getTreeNode()èŽ·å–å…ƒç´ ï¼Œèµ‹å€¼ç»™nodeã€‚ if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); // ðŸ”¸ é“¾è¡¨ï¼šç”¨hashå€¼å’Œé”®å€¼å¯¹éåŽ†ï¼šèµ‹å€¼ç»™nodeã€‚ else &#123; do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; // ðŸ”´ æ ¹æ®å…ƒç´ (node)çš„ç»“æž„åˆ é™¤ if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; // ðŸ”¹ è‹¥è¦åˆ é™¤æ ‘ç»“æž„èŠ‚ç‚¹ï¼šä½¿ç”¨removeTreeNode()ç§»é™¤æ ‘èŠ‚ç‚¹ if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); // ðŸ”¹ è‹¥è¦åˆ é™¤NodeèŠ‚ç‚¹ä¸Šçš„å…ƒç´ ï¼ˆåˆšå¥½æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼šå°†è¯¥èŠ‚ç‚¹èµ‹å€¼ä¸ºä¸‹ä¸ªå…ƒç´  else if (node == p) tab[index] = node.next; // ðŸ”¹ è‹¥è¦åˆ é™¤é“¾è¡¨èŠ‚ç‚¹ï¼šæŒ‡å‘å…¶ä¸‹ä¸ªå…ƒç´ çš„nextï¼Œå°†é“¾è¡¨é“¾æŽ¥èµ·æ¥ã€‚ else p.next = node.next; ++modCount; // è®°å½•ä¿®æ”¹æ¬¡æ•°ï¼ˆå¯ä»¥åˆ¤æ–­æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼‰ --size; // æ•°ç»„é•¿åº¦è‡ªå‡ afterNodeRemoval(node); return node; &#125; &#125; return null;&#125; ï¼ˆ3ï¼‰Put() - æ·»åŠ %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph TD T([\"å¦‚ä½•å‘HashMapæ·»åŠ å…ƒç´ ï¼Ÿ\"]):::p T --> B(\"å…ˆæ ¹æ®keyæ‰¾åˆ°æ¡¶ä½\") B --> A([\"åˆ¤æ–­å½“å‰ç´¢å¼•æ˜¯å¦å°±æ˜¯è¦æ·»åŠ å…ƒç´ çš„ä½ç½®\"]):::lp A --> |\"æ— å…ƒç´ \"| C2[\"ç›´æŽ¥å°†å…ƒç´ æ·»åŠ åˆ°è¯¥ä½ç½®\"]:::b A --> |\"æœ‰å…ƒç´ ï¼ˆæœ‰hashå†²çªï¼‰\"| C([\"åˆ¤æ–­ä¸ºé“¾è¡¨æˆ–çº¢é»‘æ ‘\"]):::lp C --> |\"é“¾è¡¨\"|a[\"å°†å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨\"]:::b C --> |\"çº¢é»‘æ ‘\"|b[\"å°†å…ƒç´ æ·»åŠ åˆ°æ ‘å°¾éƒ¨\"]:::b a -.- at[\"é“¾è¡¨é•¿åº¦è¶…è¿‡8ã€ä¸”æ¡¶æ•°é‡å¤§äºŽ64æ—¶è½¬ä¸ºæ ‘ï¼ˆ*æ¡¶æ•°å°äºŽ64æ—¶ä¸ä¼šæ ‘åŒ–ï¼Œåªä¼šæ‰©å®¹ï¼‰\"]:::info classDef info fill:#f6f6f7,color:#737379stroke-width: 3px, stroke-dasharray: 3 3 classDef p fill:#ddaebd classDef b fill:#d9dfeb classDef lp fill: #f4e4e9 + put() æ·»åŠ å…ƒç´ /** * Associates the specified value with the specified key in this map. If the map previously contained a mapping for the key, the old value is replaced. * å­˜å€¼ï¼šå°†æŒ‡å®šå€¼ä¸Žæ­¤æ˜ å°„ä¸­çš„æŒ‡å®šé”®ç›¸å…³è”ã€‚å¦‚æžœæ˜ å°„å…ˆå‰åŒ…å«é”®çš„æ˜ å°„ï¼Œåˆ™å°†æ›¿æ¢æ—§å€¼ã€‚ * * @param key * @param value * @return è¿”å›žè¢«æ›¿æ¢çš„åŽŸå€¼ */public V put(K key, V value) &#123; // è°ƒç”¨putVal()æ–¹æ³•å­˜å€¼ return putVal(hash(key), key, value, false, true);&#125; - putVal() èµ‹å€¼æ–¹æ³•ï¼ˆè‹¥keyå·²æœ‰å€¼æ—¶é»˜è®¤æ›¿æ¢ï¼‰/** * Implements Map.put and related methods. * å®žçŽ°äº†Mapèµ‹å€¼ä»¥åŠç›¸å…³æ–¹æ³•ã€‚ * * @param hash keyçš„hashå€¼ * @param key keyå€¼ * @param value éœ€è¦èµ‹çš„å€¼ * @param onlyIfAbsent æ˜¯å¦ä¿ç•™åŽŸå€¼ï¼ˆé»˜è®¤ä¸ºfalseï¼šä¼šæ›¿æ¢åŽŸå€¼ï¼‰ * @param evict false:è¡¨å¤„äºŽåˆ›å»ºçŠ¶æ€ * @return è¿”å›žå‰å€¼ï¼Œå¦‚æžœæ²¡æœ‰åˆ™ä¸ºç©º */final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; // Nodeæ•°ç»„ Node&lt;K,V&gt; p; // Node int n, i; // nï¼šæ•°ç»„é•¿åº¦ï¼Œ iï¼šæ•°ç»„ç´¢å¼• // ðŸ”´ ä¸€ã€è‹¥ç©ºæ•°ç»„ï¼šåˆå§‹åŒ– // å½“æ•°ç»„ä¸ºç©ºã€é•¿åº¦ä¸º0æ—¶ï¼šæ‰©å®¹ï¼Œå¹¶èŽ·å¾—Nodeæ•°ç»„é•¿åº¦nï¼ˆå®¹é‡ï¼‰ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // ðŸ”´ äºŒã€è‹¥ç©ºç´¢å¼•ï¼šç›´æŽ¥å­˜ // è‹¥ä¼ å…¥çš„keyè®¡ç®—å‡ºçš„ç´¢å¼•ä½ç½®æ— å…ƒç´ ï¼Œåˆ™ä½¿ç”¨é”®å€¼å¯¹åœ¨è¯¥ä½ç½®ä¸Šåˆ›å»ºNodeï¼ŒputVal()å®Œæˆã€‚ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); // ðŸ”´ ä¸‰ã€è‹¥ç´¢å¼•éžç©ºï¼šæ ¹æ®æƒ…å†µå­˜å€¼ // å¯èƒ½æœ‰hashå†²çªï¼Œåˆ¤æ–­è¯¥Nodeæ˜¯å¦ä¸ºé“¾è¡¨æˆ–çº¢é»‘æ ‘è¿›è¡Œå­˜å€¼ã€‚ else &#123; Node&lt;K,V&gt; e; // node K k; // key // ðŸ”¹ è‹¥påˆšå¥½åœ¨å½“å‰ç´¢å¼•ä½ç½®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆæœªæ¶‰åŠåˆ°é“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼‰ï¼Œå°†è¯¥Nodeèµ‹å€¼ç»™eä»¥å¤‡å­˜å€¼ï¼ˆå½“å‰Nodeçš„keyå€¼å’Œä¼ å…¥çš„keyå€¼ç›¸ç­‰ï¼‰ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // ðŸ”¹ TreeNodeç±»åž‹ï¼šé€šè¿‡putTreeVal()æ–¹æ³•åœ¨çº¢é»‘æ ‘ä¸Šæ’å…¥é”®å€¼å¯¹ï¼Œèµ‹å€¼ç»™eä»¥å¤‡å­˜å€¼ã€‚ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // ðŸ”¹ é“¾è¡¨ç±»åž‹ï¼šå¾ªçŽ¯ç›´åˆ°å°†å…ƒç´ æ’å…¥é“¾è¡¨å°¾éƒ¨ï¼Œèµ‹å€¼ç»™eä»¥å¤‡å­˜å€¼ã€‚ else &#123; for (int binCount = 0; ; ++binCount) &#123; // binCountï¼šé“¾è¡¨èŠ‚ç‚¹ä¸ªæ•° // ðŸ”¸ è‹¥å·²éåŽ†åˆ°é“¾è¡¨å°¾éƒ¨ï¼šä½¿ç”¨newNode()åœ¨å°¾éƒ¨å†æ·»åŠ ä¸€ä¸ªæ–°èŠ‚ç‚¹å¹¶å­˜å€¼ã€‚ if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); // * è‹¥æ·»åŠ èŠ‚ç‚¹åŽé“¾è¡¨çš„é•¿åº¦è¶…è¿‡æ ‘åŒ–é˜ˆå€¼ï¼š // é€šè¿‡treeifyBin()å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œè·³å‡ºå¾ªçŽ¯ï¼ŒputVal()å®Œæˆã€‚ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; // ðŸ”¸ è‹¥è¿˜æœªéåŽ†åˆ°å°¾éƒ¨ã€ä¸”è¯¥èŠ‚ç‚¹çš„keyå€¼ä¸Žä¼ å…¥keyå€¼ç›¸ç­‰ï¼š // åˆ™è·³å‡ºå¾ªçŽ¯ï¼Œæ‰§è¡Œä¸‹æ–¹æ›¿æ¢åŽŸå€¼çš„åˆ¤æ–­ã€‚ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; // ðŸ”¸ ç»§ç»­å¾ªçŽ¯éåŽ†é“¾è¡¨ p = e; &#125; &#125; // ðŸ”» æ›¿æ¢å¹¶è¾“å‡ºåŽŸå€¼ï¼ˆkeyå·²æœ‰å€¼æ—¶ï¼‰ if (e != null) &#123; // existing mapping for key V oldValue = e.value; // è‹¥è®¾ç½®äº†æ›¿æ¢åŽŸå€¼ã€æˆ–åŽŸå€¼ä¸ºç©ºæ—¶ï¼šå­˜å€¼ if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); // è®¿é—®åŽå›žè°ƒï¼ˆâ“ return oldValue; &#125; &#125; ++modCount; // è®°å½•ä¿®æ”¹æ¬¡æ•°ï¼ˆæ–¹ä¾¿åœ¨è¿­ä»£ä¸­æ£€æµ‹ç»“æž„æ€§å˜åŒ–ï¼‰ // ðŸ”» è‹¥å­˜å€¼åŽå…ƒç´ æ•°é‡å¤§äºŽæ‰©å®¹é˜ˆå€¼ï¼Œåˆ™æ‰©å®¹ã€‚ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); // æ’å…¥åŽå›žè°ƒï¼ˆâ“ return null;&#125; æ¯”è¾ƒæ—¶å…ˆæ¯”è¾ƒhashå€¼ï¼Œhashç›¸åŒçš„æ—¶å€™ï¼Œå†ä½¿ç”¨equalsæ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼šif(e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) å› ä¸ºhashæ˜¯æ•´æ•°ï¼Œæ¯”è¾ƒçš„æ€§èƒ½ä¸€èˆ¬è¦æ¯”equals()é«˜å¾ˆå¤šï¼Œä½¿ç”¨çŸ­è·¯ä¸Žï¼šhashä¸åŒï¼Œå°±æ²¡æœ‰å¿…è¦è°ƒç”¨equalsæ–¹æ³•äº†ï¼Œè¿™æ ·æ•´ä½“ä¸Šå¯ä»¥æé«˜æ¯”è¾ƒæ€§èƒ½ã€‚ + putIfAbsent() èµ‹å€¼ï¼Œä¸”å·²æœ‰å€¼æ—¶ä¸è¿›è¡Œè¦†ç›–@Overridepublic V putIfAbsent(K key, V value) &#123; // ðŸ”» ä¸Žé»˜è®¤çš„put()åŒºåˆ«åœ¨äºŽç¬¬å››ä¸ªå‚æ•°ï¼šonlyIfAbsentï¼ˆä¸ºtrueæ—¶ä¸è¦†ç›–åŽŸå€¼ï¼‰ return putVal(hash(key), key, value, true, true);&#125; ï¼ˆ4ï¼‰*Resize() - æ‰©å®¹â‘  ä½•æ—¶æ‰©å®¹%%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph TD T([\"HashMapä½•æ—¶éœ€è¦æ‰©å®¹ï¼Ÿ\"]):::p T --> |\"1. åˆå§‹åŒ–\"| A(\"1. tableä¸ºnull æˆ–é•¿åº¦ä¸º0æ—¶\"):::lp T --> |\"2. å­˜å€¼\"| B(\"2. æ·»åŠ å…ƒç´ ä¸”å…ƒç´ æ•°é‡å³å°†è¶…è¿‡æ‰©å®¹é˜ˆå€¼ï¼ˆthresholdï¼‰æ—¶\"):::lp B -.- |\"hreshold å¯ä»¥ç”± tableSizeFor() è®¡ç®—å¾—åˆ°\"| b[\"tableSizeFor()ï¼šå¯ä»¥è®¡ç®—å‡ºå¤§äºŽå½“å‰æ–¹æ³•å…¥å‚å€¼ï¼Œå¹¶ä¸”å’Œå½“å‰æ–¹æ³•å…¥å‚å€¼æœ€æŽ¥è¿‘çš„2çš„å¹‚æ•°ã€‚\"]:::info classDef p fill: #ddaebd classDef lp fill: #f4e4e9 classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 â‘¡ å¦‚ä½•æ‰©å®¹ %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph TD T([\"HashMapå¦‚ä½•æ‰©å®¹ï¼Ÿ\"]):::p T --> A(\"2å€æ‰©å®¹ï¼Œåˆ›å»ºæ–°æ•°ç»„\") A --> B(\"ç§»åŠ¨å…ƒç´ åˆ°æ–°æ•°ç»„ï¼ˆé‡æ–°è®¡ç®—hashï¼‰\") B --> b([\"åˆ¤æ–­å…ƒç´ ç±»åž‹è°ƒæ•´ä½ç½®\"]):::lp b -.-|\"å•ä¸ªå€¼\"| b1[\"â‘ åŽŸä½ç½®â‘¡ åŽŸä½ç½® + åŽŸå®¹é‡\"]:::lb b -.-|\"çº¢é»‘æ ‘\"| b2[\"split()åˆ†å‰²æ ‘â‘ ä¸€æ£µï¼šåŽŸä½ç½®â‘¡å¦ä¸€æ£µï¼šåŽŸä½ç½® + åŽŸå®¹é‡\"]:::lb b -.-|\"é“¾è¡¨\"| b3[\"â‘ ä½Žä½é“¾è¡¨ï¼šåŽŸä½ç½®â‘¡é«˜ä½é“¾è¡¨ï¼šåŽŸä½ç½® + åŽŸå®¹é‡\"]:::lb b2 -.- b2t[\"è‹¥æ ‘èŠ‚ç‚¹æ•°é‡â‰¤6ï¼šè½¬é“¾è¡¨\"]:::info classDef p fill: #ddaebd classDef lp fill: #f4e4e9 classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 è°ƒæ•´ä½ç½®çš„åŽŸå› ï¼š å› ä¸ºHashMapè®¡ç®—ç´¢å¼•ä½ç½®æ˜¯æ ¹æ®hashå€¼ &amp; (å½“å‰å®¹é‡ -1)ï¼Œå› æ­¤å½“å®¹é‡æ”¹å˜æ—¶ï¼Œä¸€äº›åŽŸæœ¬çš„ç´¢å¼•ä½ç½®ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚æ‰©å®¹çš„åŒæ—¶é‡æ–°è°ƒæ•´å…ƒç´ ä½ç½®ï¼Œå–å€¼æ—¶æ‰èƒ½æ­£ç¡®åŒ¹é…åˆ°ç›¸åº”çš„é”®å€¼å¯¹ã€‚ â‘¢ å¦‚ä½•è°ƒæ•´ä½ç½® å…ƒç´ ä½ç½®å¦‚ä½•æ”¹å˜ï¼Ÿ %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph TD T([\"å…ƒç´ ä½ç½®å¦‚ä½•æ”¹å˜ï¼Ÿ\"]):::p T --> A(\"hashå€¼ & åŽŸé•¿åº¦\"):::lb A --> a[\"ç»“æžœä¸º0ï¼Œä½ç½®ä¸å˜\"]:::lp A --> b[\"ç»“æžœä¸º1ï¼Œåœ¨æ–°ä½ç½®\"]:::lp a -.- at[\"å¦‚ï¼ŒåŽŸhashå€¼=3ï¼ˆåŽŸä½ç½®=3ï¼‰ï¼Œæ•°ç»„é•¿åº¦16ï¼Œ hash & 16ï¼š 0000 0011 // 3 0001 0000 // 16 0000 0000 // =0åˆ™ï¼Œæ–°ä½ç½® = åŽŸä½ç½® = 3\"]:::info b -.- bt[\"å¦‚ï¼ŒåŽŸhashå€¼=19ï¼ˆåŽŸä½ç½®=3ï¼‰ï¼Œæ•°ç»„é•¿åº¦16ï¼Œhash & 16ï¼š 0001 0011 // 19 0001 0000 // 16 0001 0000 // =1åˆ™ï¼Œæ–°ä½ç½® = åŽŸä½ç½® + åŽŸå®¹é‡ = 19\"]:::info classDef p fill: #ddaebd classDef lp fill: #f4e4e9 classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 æ»¡è¶³â€œ(e.hash &amp; oldCap)==0â€æ¡ä»¶çš„èŠ‚ç‚¹å¯ä»¥ç»§ç»­åœ¨åŽŸç´¢å¼•ä½ä¸Šå­˜å‚¨ï¼Œä¸æ»¡è¶³è¯¥æ¡ä»¶çš„èŠ‚ç‚¹åˆ™éœ€è¦è¿›è¡Œç§»åŠ¨æ“ä½œã€‚ HashMapä¸­ï¼Œtableæ•°ç»„éƒ½æ˜¯ä»¥2çš„å¹‚æ•°è¿›è¡Œæ‰©å®¹æ“ä½œçš„ï¼Œå°±æ˜¯å°†åŽŸå®¹é‡å€¼å·¦ç§»1ä½ã€‚ å› æ­¤è¿›è¡Œæ‰©å®¹æ“ä½œåŽï¼Œå„ä¸ªK-Vé”®å€¼å¯¹èŠ‚ç‚¹æ˜¯å¦ä»èƒ½åœ¨åŽŸç´¢å¼•ä½ä¸Šï¼Œå–å†³äºŽæ–°å¢žçš„ä¸€ä½ï¼ˆoldCapçš„å€¼ï¼‰åœ¨è¿›è¡Œä¸Žè¿ç®—æ—¶æ˜¯å¦ä¸º0ã€‚ é“¾è¡¨å…ƒç´ ç§»åŠ¨ï¼š æ»¡è¶³â€œ(e.hash &amp; oldCap)==0â€æ¡ä»¶çš„èŠ‚ç‚¹ä¼šæž„æˆæ–°çš„å•å‘é“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ä¼šæŒ‰ç…§åŽŸç´¢å¼•ä½é¡ºåºå­˜å‚¨äºŽæ–°çš„HashMapé›†åˆçš„tableæ•°ç»„ä¸­ï¼› æ»¡è¶³â€œ(e.hash &amp;oldCap) !=0â€æ¡ä»¶çš„èŠ‚ç‚¹ä¼šæž„æˆå¦ä¸€ä¸ªæ–°çš„å•å‘é“¾è¡¨ï¼Œå¹¶ä¸”å°†åŽŸç´¢å¼•å€¼+åŽŸæ•°ç»„é•¿åº¦çš„è®¡ç®—ç»“æžœä½œä¸ºæ–°çš„ç´¢å¼•å€¼å­˜å‚¨äºŽæ–°çš„HashMapé›†åˆçš„tableæ•°ç»„ä¸­ã€‚ çº¢é»‘æ ‘å…ƒç´ ç§»åŠ¨ï¼š å°†è¿™æ£µçº¢é»‘æ ‘æ‹†åˆ†æˆä¸¤æ£µæ–°çš„çº¢é»‘æ ‘ï¼šï¼ˆè‹¥çº¢é»‘æ ‘ä¸­èŠ‚ç‚¹æ•°â‰¤6ï¼Œä¼šå°†æ ‘ç»“æž„è½¬ä¸ºé“¾è¡¨ç»“æž„ï¼‰â‘  ä¸€æ£µçº¢é»‘æ ‘ï¼ˆæˆ–é“¾è¡¨ï¼‰ç•™åœ¨åŽŸç´¢å¼•ä½ä¸Šï¼Œâ‘¡ å¦ä¸€æ£µçº¢é»‘æ ‘ï¼ˆæˆ–é“¾è¡¨ï¼‰æ”¾åˆ°åŽŸç´¢å¼•å€¼+åŽŸæ•°ç»„å®¹é‡å€¼è®¡ç®—ç»“æžœå¯¹åº”çš„æ–°ç´¢å¼•ä½ä¸Šã€‚ - resize() æ‰©å®¹/** * Initializes or doubles table size. If null, allocates in accord with initial capacity target held in field threshold. * Otherwise, because we are using power-of-two expansion, the elements from each bin must either stay at same index, or move with a power of two offset in the new table. * åˆå§‹åŒ–æˆ–äºŒå€æ‰©å®¹ã€‚è‹¥ä¸ºç©ºï¼Œæ ¹æ®é˜ˆå€¼å’Œåˆå§‹å®¹é‡åˆ†é…ã€‚ * ç”±äºŽä½¿ç”¨2æ¬¡å¹‚æ‰©å®¹ï¼Œå› æ­¤æ¯ä¸ªå…ƒç´ ä¿æŒç›¸åŒç´¢å¼•ï¼Œæˆ–åœ¨æ–°è¡¨ä¸­ä»¥äºŒæ¬¡å¹‚åç§»é‡ç§»åŠ¨ã€‚ * * @return table*/final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; // åŽŸtable int oldCap = (oldTab == null) ? 0 : oldTab.length; // æ‰©å®¹å‰çš„tableé•¿åº¦ï¼Œè‹¥æ— å…ƒç´ è¿”å›ž0 int oldThr = threshold; // åŽŸé˜ˆå€¼ int newCap, newThr = 0; // æ–°é•¿åº¦ã€æ–°é˜ˆå€¼ // ðŸ”´ ä¸€ã€è®¾ç½®æ‰©å®¹é˜ˆå€¼ // ðŸ”¹ â‘  è‹¥å·²åˆå§‹åŒ–(åŽŸæ•°ç»„æœ‰å…ƒç´ )ï¼šæ£€æŸ¥æ•°ç»„é•¿åº¦å¹¶è®¾ç½®2å€æ‰©å®¹é˜ˆå€¼ã€‚ if (oldCap &gt; 0) &#123; // ðŸ”¸ è‹¥åŽŸæ•°ç»„é•¿åº¦è¶…è¿‡æœ€å¤§å®¹é‡å€¼ï¼šâ€”&gt; å·²åˆ°è¾¾å®¹é‡ä¸Šå€¼ï¼Œæ— æ³•å†æ‰©å®¹ï¼Œè¿”å›žåŽŸè¡¨ã€‚ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; // ðŸ”¸ è‹¥åŽŸæ•°ç»„é•¿åº¦2å€æ‰©å®¹åŽä»æœªè¶…è¿‡å®¹é‡ä¸Šé™ï¼Œä¸”åŽŸæ•°ç»„é•¿åº¦è¶…è¿‡äº†é»˜è®¤åˆå§‹å®¹é‡ï¼šâ€”&gt; åŽŸæ‰©å®¹é˜ˆå€¼è®¾ç½®ä¸º2å€ã€‚ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; // ðŸ”¹ â‘¡ è‹¥æœªåˆå§‹åŒ–(åŽŸæ•°ç»„æ— å…ƒç´ )ï¼Œä½†å·²è®¾ç½®è¿‡æ‰©å®¹é˜ˆå€¼(&gt;0) ï¼šå°†æ–°æ•°ç»„é•¿åº¦è®¾ç½®ä¸ºè¯¥æ‰©å®¹é˜ˆå€¼ã€‚ else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; // ðŸ”¹ â‘¢ è‹¥æœªåˆå§‹åŒ–(åŽŸæ•°ç»„æ— å…ƒç´ )ï¼Œä¸”æœªè®¾ç½®è¿‡æ‰©å®¹é˜ˆå€¼ï¼šä½¿ç”¨ç³»ç»Ÿè®¾ç½®çš„é»˜è®¤æ•°ç»„é•¿åº¦å’Œé»˜è®¤é˜ˆå€¼èµ‹å€¼ã€‚ else &#123; // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; // ðŸ”´ äºŒã€æ£€æŸ¥æ‰©å®¹é˜ˆå€¼ // è‹¥æ–°æ‰©å®¹é˜ˆå€¼ä»ä¸º0ï¼šä½¿ç”¨æ–°æ•°ç»„é•¿åº¦è®¡ç®—æ–°çš„æ‰©å®¹é˜ˆå€¼ï¼ˆå¹¶å°†æ•°ç»„é•¿åº¦é™åˆ¶åœ¨æœ€å¤§å®¹é‡ä¸Šé™å†…ï¼‰ if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; // è®¾ç½®æ‰©å®¹é˜ˆå€¼ threshold = newThr; // ðŸ”´ ä¸‰ã€æ‰©å®¹ @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;) // ðŸ”¹ æ–°å»ºæ•°ç»„ Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; // ä½¿ç”¨æ–°çš„æ•°ç»„é•¿åº¦åˆ›å»ºæ–°æ•°ç»„ table = newTab; // ðŸ”¹ ç§»åŠ¨å…ƒç´ åˆ°æ–°æ•°ç»„ // - è‹¥åŽŸæ•°ç»„ä¸ºç©ºï¼Œæ— éœ€ç§»åŠ¨ï¼Œç›´æŽ¥è¿”å›žè¯¥æ•°ç»„ã€‚ // - è‹¥åŽŸæ•°ç»„éžç©ºï¼šç§»åŠ¨æ•°æ®åˆ°æ–°æ•°ç»„ã€‚ if (oldTab != null) &#123; // ðŸ”¸ å¤–å±‚å¾ªçŽ¯ï¼šéåŽ†åŽŸæ•°ç»„å…ƒç´  for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; // æ¸…ç©ºåŽŸå€¼ï¼Œä¾¿äºŽGCå›žæ”¶ã€‚ oldTab[j] = null; // â‘  å•ä¸ªå€¼ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; // åŽŸä½ æˆ– +æ—§å®¹é‡oldCap // â‘¡ çº¢é»‘æ ‘ï¼šåˆ†å‰² else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); // â‘¢ é“¾è¡¨ï¼š else &#123; // preserve order // ä½Žä½é“¾è¡¨ï¼šä½ç½®ä¸å˜ Node&lt;K,V&gt; loHead = null, loTail = null; // é«˜ä½é“¾è¡¨ï¼šä½ç½® + å®¹é‡ Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; // ðŸ”¸ å†…å±‚å¾ªçŽ¯ï¼šè®¡ç®—æ–°èŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®ã€‚ do &#123; next = e.next; // trueï¼šä½ç½®ä¸å˜ï¼ˆä½Žä½é“¾è¡¨ï¼‰ if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; // falseï¼šä½ç½® + å®¹é‡ï¼ˆé«˜ä½é“¾è¡¨ï¼‰ else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); // ä½Žä½é“¾è¡¨èµ‹å€¼ if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; // é«˜ä½é“¾è¡¨èµ‹å€¼ if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; // ðŸ”¹ è¿”å›žæ–°æ•°ç»„ return newTab;&#125; 5. å†…éƒ¨ç±»ï¼ˆ1ï¼‰Node HashMap.Nodeç±»ï¼š /** * Basic hash bin node, used for most entries. (See below for TreeNode subclass, and in LinkedHashMap for its Entry subclass.) * åŸºæœ¬hashçš„binèŠ‚ç‚¹ï¼Œç”¨äºŽå¤§éƒ¨åˆ†èŠ‚ç‚¹ã€‚ï¼ˆTreeNodeå­ç±»è§ä¸‹æ–‡ï¼ŒEntryå­ç±»è§LinkedHashMapã€‚ï¼‰ */static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; final K key; // finalï¼šç”±äºŽkeyæ˜¯è®¡ç®—å…ƒç´ æŽ’åˆ—ä½ç½®çš„ä¾æ®ï¼Œå› æ­¤ä¸€æ—¦åˆå§‹åŒ–å°±ä¸å…è®¸æ”¹å˜ã€‚ V value; Node&lt;K,V&gt; next; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå› ä¸ºéœ€è¦ç”¨NodeèŠ‚ç‚¹æž„å»ºå•å‘é“¾è¡¨ï¼‰ Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return value; &#125; public final String toString() &#123; return key + &quot;=&quot; + value; &#125; // ðŸ”» é‡å†™hashCode()ï¼šå°†keyçš„Hashå€¼ã€valueçš„Hashå€¼è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; // ðŸ”» é‡å†™equals() public final boolean equals(Object o) &#123; // ðŸ”¹ â‘  åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹çš„å†…å­˜èµ·å§‹åœ°å€ç›¸åŒ if (o == this) return true; // ðŸ”¹ â‘¡ åˆ¤æ–­ä¸¤ä¸ªMapç±»åž‹èŠ‚ç‚¹çš„keyå’Œvalueå€¼éƒ½ç›¸ç­‰ if (o instanceof Map.Entry) &#123; Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125;&#125; é‡å†™HashCode() Javaå®˜æ–¹å¯¹é‡å†™å¯¹è±¡çš„ hashCode() æ–¹æ³•æœ‰ä¸¥æ ¼çš„è¦æ±‚ â€”â€” è‹¥é‡å†™ hashCode() æ–¹æ³•ï¼Œåˆ™éœ€è¦é‡å†™ç›¸åº”çš„ equals() æ–¹æ³•ã€‚ è¡¥å……ï¼šObjectså·¥å…·ç±» graph LR T([\"Objectså·¥å…·ç±»\"]):::p T --> A(\"æä¾›äº†è¿›è¡Œå¯¹è±¡æ¯”è¾ƒã€æ£€éªŒçš„åŸºæœ¬æ“ä½œ\"):::lb A --> 1([\"compare(T, S, Comparator)\"]):::lp A --> 2([\"hashCode(Object)\"]):::lp A --> 3([\"hashCode(Object[])\"]):::lp A --> 4(\"isNull(Object)ã€nonNull(Object)ã€requireNonNull(Object)ç­‰\"):::lp A --> 5([\"toString(Object)\"]):::lp 1 -.- 1t[\"ä¸¤ä¸ªå¯¹è±¡çš„æ¯”è¾ƒæ“ä½œ\"] 2 -.- 2t[\"è®¡ç®—å¯¹è±¡Hashå€¼\"] 3 -.- 3t[\"è®¡ç®—å¤šä¸ªå¯¹è±¡çš„Hashå€¼ç»„åˆ\"] 4 -.- 4t[\"æ ¡éªŒæˆ–ç¡®è®¤å½“å‰å¯¹è±¡æ˜¯å¦ä¸ºç©º\"] 5 -.- 5t[\"è¿”å›žå¯¹è±¡çš„å­—ç¬¦ä¸²ä¿¡æ¯\"] classDef p fill: #ddaebd classDef lp fill: #f4e4e9 classDef lb fill: #d9dfeb æ ¹æ®å“ˆå¸Œå€¼å­˜å–å¯¹è±¡ã€æ¯”è¾ƒå¯¹è±¡æ˜¯è®¡ç®—æœºç¨‹åºä¸­ä¸€ç§é‡è¦çš„æ€ç»´æ–¹å¼ã€‚ å®ƒä½¿å¾—å­˜å–å¯¹è±¡ä¸»è¦ä¾èµ–äºŽè‡ªèº«Hashå€¼ï¼Œè€Œä¸æ˜¯ä¸Žå…¶ä»–å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œå­˜å–æ•ˆçŽ‡ä¹Ÿä¸Žé›†åˆå¤§å°æ— å…³ï¼Œé«˜è¾¾O(1)ï¼Œå³ä½¿è¿›è¡Œæ¯”è¾ƒï¼Œä¹Ÿåˆ©ç”¨Hashå€¼æé«˜æ¯”è¾ƒæ€§èƒ½ã€‚ ï¼ˆ2ï¼‰TreeNode TreeNode ç»§æ‰¿è‡ª LinkedHashMap.Entry ç±»ã€‚ HashMapé›†åˆä½¿ç”¨ HashMap.TreeNode ç±»çš„å¯¹è±¡è¡¨ç¤ºçº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œæ¥æž„æˆçº¢é»‘æ ‘ã€‚ â‘  å½“æŸä¸ªç´¢å¼•ä½ä¸Šçš„é“¾è¡¨é•¿åº¦è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼ï¼ˆé»˜è®¤ä¸ºå•å‘é“¾è¡¨é•¿åº¦è¶…è¿‡8ï¼‰æ—¶ï¼Œå•å‘é“¾è¡¨ä¼šè½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼›â‘¡ å½“çº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹è¶³å¤Ÿå°‘ï¼ˆé»˜è®¤ä¸ºçº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹æ•°é‡å°‘äºŽ6ä¸ªï¼‰æ—¶ï¼Œçº¢é»‘æ ‘ä¼šè½¬æ¢ä¸ºå•å‘é“¾è¡¨ã€‚ - å±žæ€§static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123; // çˆ¶èŠ‚ç‚¹ TreeNode&lt;K,V&gt; parent; // red-black tree links // å·¦èŠ‚ç‚¹ TreeNode&lt;K,V&gt; left; // å³èŠ‚ç‚¹ TreeNode&lt;K,V&gt; right; // å‰èŠ‚ç‚¹ï¼šåˆ é™¤æ—¶éœ€è¦å–æ¶ˆé“¾æŽ¥&quot;next&quot; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion // èŠ‚ç‚¹é¢œè‰²ï¼štrueçº¢è‰²ï¼›falseé»‘è‰² boolean red; // æž„é€ æ–¹æ³•ï¼Œå‚æ•°ï¼šhashå€¼ã€keyã€valueã€ä¸‹ä¸€ä¸ªNodeèŠ‚ç‚¹ TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; super(hash, key, val, next); &#125; // ... // è¿˜æœ‰æž„å»ºçº¢é»‘æ ‘ã€è§£æž„çº¢é»‘æ ‘ã€æ·»åŠ èŠ‚ç‚¹ã€ç§»é™¤èŠ‚ç‚¹ç­‰æ–¹æ³•&#125; - getTreeNode() èŽ·å–çº¢é»‘æ ‘èŠ‚ç‚¹ /** * Calls find for root node. * è°ƒç”¨æŸ¥æ‰¾æ ¹èŠ‚ç‚¹ */final TreeNode&lt;K,V&gt; getTreeNode(int h, Object k) &#123; // ðŸ”» è°ƒç”¨find()æŸ¥æ‰¾èŠ‚ç‚¹ return ((parent != null) ? root() : this).find(h, k, null); // è‹¥æ ¹èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œè°ƒç”¨rootèŠ‚ç‚¹æŸ¥æ‰¾ï¼›è‹¥æ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œä½¿ç”¨thisæŸ¥æ‰¾ã€‚&#125; - find() æŸ¥æ‰¾æ ‘èŠ‚ç‚¹ /** * Finds the node starting at root p with the given hash and key. The kc argument caches comparableClassFor(key) upon first use comparing keys. * ä½¿ç”¨ç»™å®šçš„keyå’Œhashå€¼æŸ¥æ‰¾ä»Žæ ¹på¼€å§‹çš„èŠ‚ç‚¹ã€‚ */final TreeNode&lt;K,V&gt; find(int h, Object k, Class&lt;?&gt; kc) &#123; TreeNode&lt;K,V&gt; p = this; // å½“å‰æ ‘å½¢Nodeï¼šp // éåŽ†æ•´æ ‘ï¼š do &#123; int ph, dir; K pk; TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q; // å½“å‰Nodeå·¦èŠ‚ç‚¹ã€å³èŠ‚ç‚¹ã€ // è‹¥å½“å‰èŠ‚ç‚¹hashå€¼è¾ƒå¤§ï¼špå–å…¶å·¦èŠ‚ç‚¹ if ((ph = p.hash) &gt; h) p = pl; // è‹¥å½“å‰èŠ‚ç‚¹hashå€¼è¾ƒå°ï¼špå–å…¶å³èŠ‚ç‚¹ else if (ph &lt; h) p = pr; // è‹¥å½“å‰èŠ‚ç‚¹keyå€¼ç­‰äºŽç»™å®škeyå€¼ï¼Œè¿”å›žå½“å‰èŠ‚ç‚¹ else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk))) return p; // è‹¥å·¦èŠ‚ç‚¹ä¸ºç©ºï¼Œpå–å…¶å³èŠ‚ç‚¹ else if (pl == null) p = pr; // è‹¥å³èŠ‚ç‚¹ä¸ºç©ºï¼Œpå–å…¶å·¦èŠ‚ç‚¹ else if (pr == null) p = pl; // æ ¹æ®compareToæ¯”è¾ƒ else if ((kc != null || (kc = comparableClassFor(k)) != null) &amp;&amp; (dir = compareComparables(kc, k, pk)) != 0) p = (dir &lt; 0) ? pl : pr; // æ ¹æ®compareToçš„ç»“æžœï¼Œè‹¥å³èŠ‚ç‚¹èƒ½æ‰¾åˆ°ï¼šè¿”å›žå³èŠ‚ç‚¹ else if ((q = pr.find(h, k, kc)) != null) return q; // è‹¥compareToçš„ç»“æžœåœ¨å·¦èŠ‚ç‚¹ä¸Šï¼šç»§ç»­æŸ¥æ‰¾ else p = pl; &#125; while (p != null); return null;&#125; - split() åˆ†å‰²æ ‘ç»“æž„ï¼ˆHashMapæ‰©å®¹æ—¶ä½¿ç”¨åˆ°çš„æ–¹æ³•ï¼‰/** * Splits nodes in a tree bin into lower and upper tree bins, or untreeifies if now too small. Called only from resize; see above discussion about split bits and indices. * åˆ†å‰²è¯¥æ ‘ä¸ºä¸¤æ£µæ ‘ï¼Œè‹¥æ ‘å¤ªå°åˆ™é“¾åŒ–ã€‚ * * @param map * @param tab table * @param index è¢«åˆ†å‰²æ ‘çš„ç´¢å¼•ä½ç½® * @param bit æ‰©å®¹å‰çš„åŽŸæ•°ç»„å®¹é‡ */final void split(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, int index, int bit) &#123; TreeNode&lt;K,V&gt; b = this; // å½“å‰æ ‘èŠ‚ç‚¹ // Relink into lo and hi lists, preserving order TreeNode&lt;K,V&gt; loHead = null, loTail = null; TreeNode&lt;K,V&gt; hiHead = null, hiTail = null; int lc = 0, hc = 0; // éåŽ†æ—¶è®¡ç®—é“¾è¡¨çš„é•¿åº¦ // ðŸ”´ ä¸€ã€é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®ï¼ˆéåŽ†åŒå‘é“¾è¡¨ç»“æž„ï¼‰ for (TreeNode&lt;K,V&gt; e = b, next; e != null; e = next) &#123; // ðŸ”» æ‹†åˆ†ï¼šå‰²æ–­å½“å‰èŠ‚ç‚¹çš„nextå¼•ç”¨ã€‚ next = (TreeNode&lt;K,V&gt;)e.next; e.next = null; // ðŸ”¹ åŽŸä½ç½®ï¼š if ((e.hash &amp; bit) == 0) &#123; // æ— éœ€ç§»åŠ¨å…ƒç´ å³å¯ç»„æˆæ–°é“¾è¡¨ï¼š if ((e.prev = loTail) == null) loHead = e; else loTail.next = e; loTail = e; ++lc; // è®°å½•é“¾è¡¨é•¿åº¦ &#125; // ðŸ”¹ æ–°ä½ç½®ï¼š else &#123; if ((e.prev = hiTail) == null) hiHead = e; else hiTail.next = e; hiTail = e; ++hc; // è®°å½•é•¿åº¦ &#125; &#125; // ðŸ”´ äºŒã€ç§»åŠ¨å…ƒç´ ï¼ˆå°†ä¸¤ä¸ªæ–°é“¾è¡¨æ ‘åŒ–æˆ–å–æ¶ˆæ ‘åŒ–ï¼‰ // ðŸ”¹ 0ï¼šåŽŸä½ç½® if (loHead != null) &#123; // ðŸ”¸ è‹¥èŠ‚ç‚¹â‰¤æ ‘åŒ–é˜ˆå€¼ï¼šå–æ¶ˆæ ‘åŒ–ï¼Œè½¬ä¸ºé“¾è¡¨ if (lc &lt;= UNTREEIFY_THRESHOLD) tab[index] = loHead.untreeify(map); // ðŸ”¸ è‹¥èŠ‚ç‚¹â‰¥æ ‘åŒ–é˜ˆå€¼ï¼šæ ‘åŒ– else &#123; // å°†é“¾è¡¨å­˜å…¥tableç´¢å¼•ä½ç½® tab[index] = loHead; // ç¡®è®¤é“¾è¡¨å­˜åœ¨å…ƒç´ åŽæ ‘åŒ– if (hiHead != null) // (else is already treeified) loHead.treeify(tab); &#125; &#125; // ðŸ”¹ 1ï¼šæ–°ä½ç½®ï¼ˆåŽŸä½ç½® + åŽŸå®¹é‡ï¼‰ï¼šåŒä¸Š if (hiHead != null) &#123; if (hc &lt;= UNTREEIFY_THRESHOLD) tab[index + bit] = hiHead.untreeify(map); else &#123; tab[index + bit] = hiHead; if (loHead != null) hiHead.treeify(tab); &#125; &#125;&#125; ðŸ¦‹ çº¢é»‘æ ‘ä¸­éšå«çš„åŒå‘é“¾è¡¨ç»“æž„ï¼š â‘  åœ¨å°†çº¢é»‘æ ‘ç»“æž„è½¬æ¢ä¸ºé“¾è¡¨ç»“æž„çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªéšå«çš„åŒå‘é“¾è¡¨è¿›è¡ŒéåŽ†ï¼› â‘¡ åœ¨çº¢é»‘æ ‘ç»“æž„çš„æ‹†åˆ†è¿‡ç¨‹ä¸­ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨è¿™ä¸ªéšå«çš„åŒå‘é“¾è¡¨è¿›è¡ŒéåŽ†ã€‚ ï¼ˆ3ï¼‰Iterators- nextNode() HashMapå®žçŽ°äº†Iterator(è¿­ä»£å™¨)æŽ¥å£ã€‚ abstract class HashIterator &#123; Node&lt;K,V&gt; next; // å°†è¿”å›žçš„ä¸‹ä¸ªentry Node&lt;K,V&gt; current; // å½“å‰ entry int expectedModCount; // ç”¨äºŽå¿«é€Ÿå¤±è´¥çš„å±žæ€§ int index; // å½“å‰ç´¢å¼• HashIterator() &#123; expectedModCount = modCount; Node&lt;K,V&gt;[] t = table; current = next = null; index = 0; if (t != null &amp;&amp; size &gt; 0) &#123; // advance to first entry do &#123;&#125; while (index &lt; t.length &amp;&amp; (next = t[index++]) == null); &#125; &#125; final Node&lt;K,V&gt; nextNode() &#123; Node&lt;K,V&gt;[] t; Node&lt;K,V&gt; e = next; // è‹¥modCountä¸ç­‰äºŽexpectedModCountï¼šæŠ›å‡ºå¼‚å¸¸ if (modCount != expectedModCount) throw new ConcurrentModificationException(); // è‹¥æŒ‡å®šNodeä¸ºç©ºï¼šæŠ›å‡ºå¼‚å¸¸ if (e == null) throw new NoSuchElementException(); // è‹¥nextæŒ‡å‘çš„Nodeï¼ˆå³å½“å‰Nodeçš„nextçš„å€¼ï¼‰ä¸ä¸ºç©ºï¼Œä¸”æ•°ç»„ä¸ä¸ºç©ºï¼š if ((next = (current = e).next) == null &amp;&amp; (t = table) != null) &#123; // é™å®šç´¢å¼•ä¸è¶…å‡ºé•¿åº¦ã€ä¸”ä¸‹ä¸ªä½ç½®ä»æœ‰å…ƒç´ ã€‚ do &#123;&#125; while (index &lt; t.length &amp;&amp; (next = t[index++]) == null); &#125; return e; &#125; // ... // EntryIteratorï¼Œç»§æ‰¿è‡ªHashIterator final class EntryIterator extends HashIterator implements Iterator&lt;Map.Entry&lt;K,V&gt;&gt; &#123; public final Map.Entry&lt;K,V&gt; next() &#123; return nextNode(); &#125; &#125;&#125; éåŽ†å…ƒç´ æ—¶ä½¿ç”¨modCountå±žæ€§åˆ¤æ–­HashMapæ˜¯å¦å‘ç”Ÿç»“æž„æ€§å˜åŒ– ðŸ”¹ å±žæ€§ï¼š- modCountï¼šHashMapç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºå¯¹HashMapçš„ä¿®æ”¹æ¬¡æ•°ã€‚ï¼ˆä¸ŽArrayListå’ŒLinkedListç›¸åŒï¼‰- expectedModCountï¼šè¡¨ç¤ºå¯¹hashMapä¿®æ”¹æ¬¡æ•°çš„æœŸæœ›å€¼ï¼Œå®ƒçš„åˆå§‹å€¼ä¸ºmodCountã€‚- ConcurrentModificationException()å¼‚å¸¸ï¼šæ­¤å¼‚å¸¸ä¸ºäº†é˜²æ­¢åœ¨ä½¿ç”¨IteratoréåŽ†å®¹å™¨çš„åŒæ—¶åˆå¯¹å®¹å™¨ä½œå¢žåŠ æˆ–åˆ é™¤æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨å¤šçº¿ç¨‹æ“ä½œã€‚ ðŸ”¹ è¯´æ˜Žï¼šHashMapçš„Iteratoræ˜¯fail-fastè¿­ä»£å™¨ã€‚æ¯æ¬¡å‘ç”Ÿç»“æž„æ€§å˜åŒ–æ—¶modCountéƒ½ä¼šå¢žåŠ ï¼Œè€Œæ¯æ¬¡è¿­ä»£å™¨æ“ä½œæ—¶éƒ½ä¼šæ£€æŸ¥expectedModCountæ˜¯å¦ä¸ŽmodCountç›¸åŒï¼Œè¿™æ ·å°±èƒ½æ£€æµ‹å‡ºç»“æž„æ€§å˜åŒ–ã€‚å½“æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜äº†HashMapçš„ç»“æž„ï¼ˆå¢žåŠ ã€åˆ é™¤ã€ä¿®æ”¹å…ƒç´ ï¼‰ï¼Œå°†ä¼šæŠ›å‡ºConcurrentModificationExceptidonã€‚ ðŸ”¹ è§£å†³æ–¹æ³•ï¼šåœ¨éåŽ†çš„è¿‡ç¨‹ä¸­æŠŠéœ€è¦åˆ é™¤çš„å¯¹è±¡ä¿å­˜åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç­‰éåŽ†ç»“æŸåŽå†è°ƒç”¨removeAllæ–¹æ³•æ¥åˆ é™¤ï¼Œæˆ–è€…é€šè¿‡Iteratorçš„remove()æ–¹æ³•ç§»é™¤å…ƒç´ ã€‚ å‚è€ƒï¼š HashMapæ‰©å®¹éƒ¨åˆ†ï¼šã€ŠJavaé«˜å¹¶å‘ä¸Žé›†åˆæ¡†æž¶ï¼šJCFå’ŒJUCæºç åˆ†æžä¸Žå®žçŽ°ã€‹ å†…å­˜ç»“æž„ç¤ºæ„å›¾éƒ¨åˆ†ï¼šã€ŠJavaç¼–ç¨‹çš„é€»è¾‘ã€‹","categories":[{"name":"æ•°æ®ç»“æž„","slug":"æ•°æ®ç»“æž„","permalink":"https://equnee.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"HashMap","slug":"HashMap","permalink":"https://equnee.github.io/tags/HashMap/"}]},{"title":"ðŸŒ·ã€Šç§’æ‡‚è®¾è®¡æ¨¡å¼ã€‹â€”â€” è´£ä»»é“¾æ¨¡å¼","slug":"note/Design-pattern/design-pattern_Chain_of_Responsibility","date":"2023-03-08T15:14:10.467Z","updated":"2023-05-04T09:26:08.332Z","comments":true,"path":"note/Design-pattern/design-pattern_Chain_of_Responsibility/","link":"","permalink":"https://equnee.github.io/note/Design-pattern/design-pattern_Chain_of_Responsibility/","excerpt":"","text":"ç¬”è®°æ¥è‡ªã€Šç§’æ‡‚è®¾è®¡æ¨¡å¼ã€‹ %%{ init: { 'themeVariables': { 'fontSize': '13px' } } }%% graph LR T([\"è´£ä»»é“¾ä»‹ç»\"]):::p T --> A([\"è´£ä»»é“¾\"]):::g T --> B([\"è´£ä»»é“¾æ¨¡å¼\"]):::p T --> C([\"ä¸šåŠ¡è´£ä»»é“¾\"]):::b A -.-> a(\"è´£ä»»é“¾æ˜¯ç”±å¾ˆå¤šè´£ä»»èŠ‚ç‚¹ä¸²è”èµ·æ¥çš„ä¸€æ¡ä»»åŠ¡é“¾æ¡ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªè´£ä»»èŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªä¸šåŠ¡å¤„ç†çŽ¯èŠ‚ã€‚\"):::lg B -.-> b(\"è´£ä»»é“¾æ¨¡å¼(Chain of Responsibility) å…è®¸ä¸šåŠ¡è¯·æ±‚è€…å°†è´£ä»»é“¾è§†ä¸ºä¸€ä¸ªæ•´ä½“å¹¶å¯¹å…¶å‘èµ·è¯·æ±‚ï¼Œè€Œä¸å¿…å…³å¿ƒé“¾æ¡å†…éƒ¨å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ä¸Žæµç¨‹èµ°å‘ã€‚\"):::lp B -.-> b2(\"è¯·æ±‚è€…ä¸å¿…å…³å¿ƒå…·ä½“æ˜¯å“ªä¸ªèŠ‚ç‚¹èµ·äº†ä½œç”¨ï¼Œæ€»ä¹‹ä¸šåŠ¡æœ€ç»ˆèƒ½å¾—åˆ°ç›¸åº”çš„å¤„ç†ã€‚\"):::info C -.->c(\"åœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå½“ä¸€ä¸ªä¸šåŠ¡éœ€è¦ç»åŽ†ä¸€ç³»åˆ—ä¸šåŠ¡å¯¹è±¡åŽ»å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›ä¸šåŠ¡å¯¹è±¡ä¸²è”èµ·æ¥æˆä¸ºä¸€æ¡ä¸šåŠ¡è´£ä»»é“¾ï¼Œè¯·æ±‚è€…å¯ä»¥ç›´æŽ¥é€šè¿‡è®¿é—®ä¸šåŠ¡è´£ä»»é“¾æ¥å®Œæˆä¸šåŠ¡çš„å¤„ç†ï¼Œæœ€ç»ˆå®žçŽ°è¯·æ±‚è€…ä¸Žå“åº”è€…çš„è§£è€¦ã€‚\"):::lb classDef p fill:#ddaebd classDef g fill:#9ac5bb classDef b fill:#aab7d2 classDef lp fill:#f4e4e9 classDef lg fill:#ddebe6 classDef lb fill:#d9dfeb classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px ä¸€ã€ç®€å•çš„ç”Ÿäº§çº¿ æœ€ç®€å•çš„è´£ä»»é“¾æ¨¡å¼ä¾‹å­ï¼šæ±½è½¦ç”Ÿäº§çº¿çš„åˆ¶é€ æµç¨‹ã€‚ %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph LR T([\"æ±½è½¦ç”Ÿäº§çº¿çš„åˆ¶é€ æµç¨‹\"]):::p T --- A(\"åŠ³åŠ¨åˆ†å·¥\"):::lp T --- B(\"æž¶æž„ç”Ÿäº§çº¿\"):::lp a --> C(\"æœ€ç»ˆ é€šè¿‡ç”Ÿäº§çº¿çš„ä¼ é€’ï¼Œæ±½è½¦ä¾¿ä»Žé›¶ä»¶åˆ°æˆå“å¾—ä»¥é‡äº§ï¼Œç”Ÿäº§æ•ˆçŽ‡å¤§å¤§æå‡\"):::B b --> C A -.- a(\"å°†æ±½è½¦é›¶ä»¶çš„å®‰è£…å·¥ä½œæ‹†åˆ†å¹¶åˆ†é…ç»™å„å®‰è£…èŠ‚ç‚¹\") B -.-b(\"å°†å®‰è£…èŠ‚ç‚¹ç»„ç»‡èµ·æ¥ï¼Œé¦–å°¾ç›¸æŽ¥ï¼Œè§„åˆ’æ“ä½œæµç¨‹\") classDef p fill:#ddaebd classDef lp fill:#f4e4e9 classDef B fill:#d9dfeb, stroke:#657eae,stroke-width:2px classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 æˆ‘ä»¬å°†æ±½è½¦ç”Ÿäº§çº¿ä»Žå·¦è‡³å³åˆ†ä¸º3ä¸ªåŠŸèƒ½èŠ‚ç‚¹ï¼šè¿™æ ·å°†äº§å“é€çº§ä¼ é€’ï¼Œæ¯ç»è¿‡ä¸€ä¸ªèŠ‚ç‚¹å°±å®Œæˆä¸€éƒ¨åˆ†å·¥ä½œï¼Œæœ€ç»ˆå®Œæˆäº§å“äº¤ä»˜ã€‚ %%{ init: { 'themeVariables': { 'fontSize': '12px' } } }%% graph LR T([\"æ±½è½¦ç”Ÿäº§çº¿èŠ‚ç‚¹\"]):::p T --> A(\"AèŠ‚ç‚¹\"):::lp T --> B(\"BèŠ‚ç‚¹\"):::lp T --> C(\"CèŠ‚ç‚¹\"):::lp A -.- a[\"è´Ÿè´£ç»„è£…è½¦æž¶ã€å®‰è£…è½¦è½®\"] B -.- b[\"è´Ÿè´£å®‰è£…å‘åŠ¨æœºã€æ²¹ç®±ã€ä¼ åŠ¨è½´ç­‰å†…éƒ¨æœºä»¶\"] C -.- c[\"è´Ÿè´£ç»„è£…å¤–å£³ã€å–·æ¼†ç­‰æ“ä½œ\"] classDef p fill:#ddaebd classDef lp fill:#f4e4e9 classDef B fill:#d9dfeb, stroke:#657eae,stroke-width:2px classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 äºŒã€å·¥ä½œæµç¨‹æ‹†åˆ† å¸¦æœ‰ä¸€äº›é€»è¾‘çš„è´£ä»»é“¾ï¼šæŠ¥é”€å®¡æ‰¹æµç¨‹ã€‚ å®¡æ‰¹æµç¨‹æŒ‰è´Ÿè´£äººæˆ–è€…å·¥ä½œèŒè´£è¿›è¡Œæ‹†åˆ†ï¼šéœ€è¦ä¾æ¬¡é€šè¿‡è´¢åŠ¡ä¸“å‘˜ã€è´¢åŠ¡ç»ç†ã€è´¢åŠ¡æ€»ç›‘çš„å®¡æ‰¹ã€‚å¦‚æžœç”³è¯·é‡‘é¢åœ¨å®¡æ‰¹äººçš„å®¡æ‰¹èŒæƒèŒƒå›´å†…åˆ™å®¡æ‰¹é€šè¿‡å¹¶ç»ˆæ­¢æµç¨‹ï¼Œåä¹‹åˆ™ä¼šå‡çº§è‡³æ›´é«˜å±‚çº§çš„ä¸Šçº§åŽ»ç»§ç»­å®¡æ‰¹ï¼Œç›´è‡³æœ€ç»ˆçš„è´¢åŠ¡æ€»ç›‘ï¼Œå¦‚æžœä»æ—§è¶…å‡ºè´¢åŠ¡æ€»ç›‘çš„å®¡æ‰¹é‡‘é¢åˆ™é©³å›žç”³è¯·ï¼Œæµç¨‹ç»ˆæ­¢ã€‚ å¦‚ä½•è®¾è®¡è¿™ä¸ªå®¡æ‰¹æµç¨‹ï¼šé¦–å…ˆæŒ‰è§’è‰²å¯¹ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œå°†ä¸åŒçš„ä¸šåŠ¡ä»£ç æ”¾åœ¨ä¸åŒçš„è§’è‰²ç±»ä¸­ï¼Œå¦‚æ­¤è¾¾åˆ°èŒæƒåˆ†æ‹†çš„ç›®çš„ï¼Œå¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ä¹Ÿèƒ½å¾—åˆ°æé«˜ã€‚ . ä¸‰ã€è¸¢çš®çƒ1. å®žä¾‹ åŸºäºŽä¸Šè¿°å®¡æ‰¹æµç¨‹ï¼Œæ¥åšä¸€ä¸ªç®€å•çš„å®žä¾‹ï¼šå‡è®¾æŸå…¬å¸çš„æŠ¥é”€å®¡æ‰¹æµç¨‹æœ‰3ä¸ªå®¡æ‰¹è§’è‰²%%{ init: { 'themeVariables': { 'fontSize': '12px' } } }%% %% å‡è®¾æŸå…¬å¸çš„æŠ¥é”€å®¡æ‰¹æµç¨‹æœ‰3ä¸ªå®¡æ‰¹è§’è‰² graph LR T([\"æŠ¥é”€å®¡æ‰¹æµç¨‹ï¼ˆ3ä¸ªè§’è‰²ï¼‰\"]):::p T --> A(\"è´¢åŠ¡ä¸“å‘˜\"):::lp T --> B(\"è´¢åŠ¡ç»ç†\"):::lp T --> C(\"è´¢åŠ¡æ€»ç›‘\"):::lp A -.- a[\"1000å…ƒå®¡æ‰¹æƒé™\"] B -.- b[\"5000å…ƒå®¡æ‰¹æƒé™\"] C -.- c[\"10000å…ƒå®¡æ‰¹æƒé™\"] classDef p fill:#ddaebd classDef lp fill:#f4e4e9 classDef B fill:#d9dfeb, stroke:#657eae,stroke-width:2px classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 2. ä»£ç  Staff /** * è´¢åŠ¡ä¸“å‘˜ç±» */public class Staff &#123; private String name; public Staff(String name)&#123; this.name = name; &#125; public boolean approve(int amount) &#123; if (amount &lt;= 1000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€ä¸“å‘˜ï¼š&quot; + name + &quot;ã€‘&quot;); return true; &#125; else &#123; System.out.println(&quot;æ— æƒå®¡æ‰¹ï¼Œè¯·æ‰¾ä¸Šçº§ã€‚ã€ä¸“å‘˜ï¼š&quot; + name + &quot;ã€‘&quot;); return false; &#125; &#125;&#125; Manager /** * è´¢åŠ¡ç»ç†ç±» */public class Manager &#123; private String name; public Manager(String name)&#123; this.name = name; &#125; public boolean approve(int amount) &#123; if (amount &lt;= 5000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€ç»ç†ï¼š&quot; + name + &quot;ã€‘&quot;); return true; &#125; else &#123; System.out.println(&quot;æ— æƒå®¡æ‰¹ï¼Œè¯·æ‰¾ä¸Šçº§ã€‚ã€ç»ç†ï¼š&quot; + name + &quot;ã€‘&quot;); return false; &#125; &#125;&#125; CFO /** * è´¢åŠ¡æ€»ç›‘ç±» */public class CFO &#123; private String name; public Manager(String name)&#123; this.name = name; &#125; /* å®šä¹‰äº†è´¢åŠ¡æ€»ç›‘ç±»CFOçš„å®¡æ‰¹æ–¹æ³•approve()å¹¶æŽ¥å—è¦å®¡æ‰¹çš„é‡‘é¢ï¼Œ å¦‚æžœé‡‘é¢åœ¨10000å…ƒä»¥å†…åˆ™å®¡æ‰¹é€šè¿‡ï¼Œå¦åˆ™é©³å›žæ­¤ç”³è¯·ã€‚ */ public boolean approve(int amount) &#123; if (amount &lt;= 10000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€æ€»ç›‘ï¼š&quot; + name + &quot;ã€‘&quot;); return true; &#125; else &#123; System.out.println(&quot;é©³å›žç”³è¯·ã€‚ã€æ€»ç›‘ï¼š&quot; + name + &quot;ã€‘&quot;); return false; &#125; &#125;&#125; 3ä¸ªå®¡æ‰¹è§’è‰²çš„ä»£ç éƒ½æ¯”è¾ƒç±»ä¼¼ï¼Œåªè¦è¶…è¿‡å…¶å®¡æ‰¹é‡‘é¢çš„æƒé™å°±é©³å›žç”³è¯·ï¼Œåä¹‹åˆ™å®¡æ‰¹é€šè¿‡ã€‚ æŽ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯å¼€å§‹æäº¤ç”³è¯·äº†ï¼šClient /** * å®¢æˆ·ç«¯ç±» */public class Client &#123; public static void main(String[] args)&#123; int amount = 10000; // å‡ºå·®èŠ±è´¹10000å…ƒ // å…ˆæ‰¾ä¸“å‘˜å¼ é£žå®¡æ‰¹ Staff staff = new Staff(&quot;å¼ é£ž&quot;); if (!staff.approve(amount)) &#123; // è¢«é©³å›žï¼Œæ‰¾å…³äºŒçˆ·é—®é—® Manager manager = new Manager(&quot;å…³ç¾½&quot;); if (!manager.approve(amount))&#123; // è¿˜æ˜¯è¢«é©³å›žï¼Œåªèƒ½æ‰¾è€å¤§äº† CFO cfo = new CFO(&quot;åˆ˜å¤‡&quot;); cfo.approve(amount); &#125; &#125; &#125;&#125;/******************************* æ— æƒå®¡æ‰¹ï¼Œè¯·æ‰¾ä¸Šçº§ã€‚ã€ä¸“å‘˜ï¼šå¼ é£žã€‘ æ— æƒå®¡æ‰¹ï¼Œè¯·æ‰¾ä¸Šçº§ã€‚ã€ç»ç†ï¼šå…³ç¾½ã€‘ å®¡æ‰¹é€šè¿‡ã€‚ã€æ€»ç›‘ï¼šåˆ˜å¤‡ã€‘ *******************************/ 3. é—®é¢˜graph LR T([\"é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿ\"]):::p T --> A(\"æµç¨‹ç¹ç\"):::lp T --> B(\"ç»´æŠ¤å›°éš¾\"):::lp T --> C(\"èŒæƒé™åˆ¶\"):::lp A -.- a(\"åŠžäº‹æ•ˆçŽ‡ä½Žï¼Œå®¡æ‰¹æµç¨‹å¤ªè¿‡çƒ¦çï¼Œæœ‰ç§è¢«è¸¢çš®çƒçš„æ„Ÿè§‰ã€‚\"):::info B -.- b(\"è‹¥åŽæœŸä¼˜åŒ–ä¸šåŠ¡æµç¨‹è€Œæ·»åŠ æ–°çš„å®¡æ‰¹è§’è‰²ï¼Œæˆ–å¢žåŠ æ›´å¤æ‚çš„é€»è¾‘ï¼Œç”³è¯·äººå°±ä¸å¾—ä¸å­¦ä¹ æ–°æµç¨‹ï¼Œä¸åœä¿®æ”¹è‡ªå·±çš„ç”³è¯·é€»è¾‘ï¼Œå¢žåŠ äº†ç»´æŠ¤æˆæœ¬ã€‚\"):::info C -.- c(\"å®¡æ‰¹äººçš„ä¸šåŠ¡ä¹‹é—´æœ‰çŽ¯çŽ¯ç›¸æ‰£çš„å…³è”ï¼Œå¯¹äºŽè¶…å‡ºå®¡æ‰¹äººèŒæƒèŒƒå›´çš„ç”³è¯·ä¼šä¼ é€’ç»™ä¸Šçº§ï¼Œç›´åˆ°è§£å†³é—®é¢˜ä¸ºæ­¢ã€‚\"):::info a --> D([\"å·¥ä½œæµæž¶æž„è®¾è®¡ä¸åˆç†ç”³è¯·äººç»ˆå°†è¢«æ·¹æ²¡åœ¨ä¸€å †å¤æ‚çš„å®¡æ‰¹æµç¨‹ä¸­ã€‚\"]):::B b --> D c --> D classDef p fill:#ddaebd classDef lp fill:#f4e4e9 classDef B fill:#d9dfeb, stroke:#657eae,stroke-width:2px classDef lb fill: #d9dfeb classDef info fill:#f6f6f7,color:#737379, stroke-width: 2px, stroke-dasharray: 3 3 ç±»ä¼¼å¦‚ä¸ŠçŽ¯çŽ¯ç›¸æ‰£çš„ä¼ é€’æœºåˆ¶ï¼Œå°±éœ€è¦æˆ‘ä»¬æ­å»ºä¸€ä¸ªé“¾å¼ç»“æž„çš„å·¥ä½œæµï¼Œè¿™ä¹Ÿæ˜¯è´£ä»»é“¾æ¨¡å¼çš„ç²¾é«“ä¹‹æ‰€åœ¨ã€‚ . å››ã€æž¶æž„å·¥ä½œæµæˆ‘ä»¬ç”¨æŠ½è±¡ç±»æ¥å®šä¹‰å®¡æ‰¹äººï¼š å®¡æ‰¹äºº Approverpublic abstract class Approver &#123; protected String name; // æŠ½è±¡å‡ºå®¡æ‰¹äººçš„å§“å protected Approver nextApprover; // ä¸‹ä¸€ä½å®¡æ‰¹äººï¼Œæ›´é«˜çº§åˆ«çš„é¢†å¯¼ public Approver(String name)&#123; this.name = name; &#125; protected Approver setNextApprover(Approver nextApprover) &#123; this.nextApprover = nextApprover; return this.nextApprover; // è¿”å›žä¸‹ä¸€ä½å®¡æ‰¹äººï¼Œä½¿å…¶æ”¯æŒé“¾å¼ç¼–ç¨‹ &#125; public abstract void approve(int amount); // æŠ½è±¡å®¡æ‰¹æ–¹æ³•ç”±å…·ä½“å®¡æ‰¹äººå­ç±»å®žçŽ° /* * ç”±äºŽå®¡æ‰¹äººåœ¨æ— æƒå®¡æ‰¹æ—¶éœ€è¦ä¼ é€’ä¸šåŠ¡ç»™å…¶ä¸Šçº§é¢†å¯¼ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¬¬4è¡Œå®šä¹‰ä¸Šçº§é¢†å¯¼çš„å¼•ç”¨nextApproverï¼Œä¸Žä¸‹ä¸€ä½å®¡æ‰¹äººä¸²è”èµ·æ¥ï¼ŒåŒæ—¶å°†å…¶æ³¨å…¥ç¬¬10è¡Œã€‚ * å½“ç„¶ï¼Œæ¯ä½å®¡æ‰¹äººçš„è§’è‰²ä¸åŒï¼Œå…¶å®¡æ‰¹é€»è¾‘ä¹Ÿæœ‰æ‰€åŒºåˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¬¬15è¡Œå¯¹å®¡æ‰¹æ–¹æ³•è¿›è¡ŒæŠ½è±¡ï¼Œäº¤ç”±å…·ä½“çš„å­ç±»å®¡æ‰¹è§’è‰²åŽ»ç»§æ‰¿å’Œå®žçŽ°ã€‚ */&#125; æŽ¥ç€å¯¹3ä¸ªå®¡æ‰¹è§’è‰²çš„ä»£ç è¿›è¡Œé‡æž„ï¼š Staff /** * è´¢åŠ¡ä¸“å‘˜ç±» */ public class Staff extends Approver &#123; public Staff(String name) &#123; super(name); &#125; @Override public void approve(int amount) &#123; if(amount &lt;= 1000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€ä¸“å‘˜ï¼š&quot; + name + &quot;ã€‘&quot;); &#125; else &#123; System.out.println(&quot;æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ä¸“å‘˜ï¼š&quot; + name + &quot;ã€‘&quot;); this.nextApprover.approve(amount); &#125; &#125;&#125;/* è´¢åŠ¡ä¸“å‘˜ç±»ç»§æ‰¿äº†å®¡æ‰¹äººæŠ½è±¡ç±»å¹¶å®žçŽ°äº†å®¡æ‰¹æ–¹æ³•approve()ï¼Œ æŽ¥æ”¶åˆ°æŠ¥é”€ç”³è¯·é‡‘é¢åŽè‡ªç¬¬9è¡Œå¼€å§‹ç”³æ˜Žè‡ªå·±çš„å®¡æ‰¹æƒé™ä¸º1000å…ƒï¼Œ è‹¥è¶…å‡ºåˆ™è°ƒç”¨è‡ªå·±ä¸Šçº§é¢†å¯¼çš„å®¡æ‰¹æ–¹æ³•nextApprover() ï¼Œå°†å®¡æ‰¹ä¸šåŠ¡ä¼ é€’ä¸‹åŽ»ã€‚*/ Manager /** * è´¢åŠ¡ç»ç†ç±» */ public class Manager extends Approver &#123; public Manager(String name) &#123; super(name); &#125; @Override public void approve(int amount) &#123; if(amount &lt;= 5000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€ç»ç†ï¼š&quot; + name + &quot;ã€‘&quot;); &#125; else &#123; System.out.println(&quot;æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ç»ç†&quot; + name + &quot;ã€‘&quot;); this.nextApprover.approve(amount); &#125; &#125;&#125; CFO /** * è´¢åŠ¡ä¸“å‘˜ç±» */ public class CFO extends Approver &#123; public CFO(String name) &#123; super(name); &#125; @Override public void approve(int amount) &#123; if(amount &lt;= 1000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€è´¢åŠ¡æ€»ç›‘ï¼š&quot; + name + &quot;ã€‘&quot;); &#125; else &#123; System.out.println(&quot;é©³å›žç”³è¯·ã€‚ã€è´¢åŠ¡æ€»ç›‘ï¼š&quot; + name + &quot;ã€‘&quot;); &#125; &#125;&#125;/* æ¯”è¾ƒç‰¹æ®Šçš„å®¡æ‰¹äººæ˜¯è´£ä»»é“¾æœ«èŠ‚ç‚¹çš„è´¢åŠ¡æ€»ç›‘ç±»ï¼Œæœ€é«˜èŒçº§çš„è´¢åŠ¡æ€»ç›‘CFOçš„å®¡æ‰¹é€»è¾‘ç•¥æœ‰ä¸åŒï¼Œ å½“ç”³è¯·é‡‘é¢è¶…å‡º10000å…ƒåŽå°±å†æœ‰ä¸‹ä¸€ä¸ªå®¡æ‰¹äººäº†ï¼Œæ‰€ä»¥æ­¤æ—¶å°±ä¼šé©³å›žæŠ¥é”€ç”³è¯·ã€‚*//** * è´¢åŠ¡ä¸“å‘˜ç±» */ public class CFO extends Approver &#123; public CFO(String name) &#123; super(name); &#125; @Override public void approve(int amount) &#123; if(amount &lt;= 1000) &#123; System.out.println(&quot;å®¡æ‰¹é€šè¿‡ã€‚ã€è´¢åŠ¡æ€»ç›‘ï¼š&quot; + name + &quot;ã€‘&quot;); &#125; else &#123; System.out.println(&quot;é©³å›žç”³è¯·ã€‚ã€è´¢åŠ¡æ€»ç›‘ï¼š&quot; + name + &quot;ã€‘&quot;); &#125; &#125;&#125;/* æ¯”è¾ƒç‰¹æ®Šçš„å®¡æ‰¹äººæ˜¯è´£ä»»é“¾æœ«èŠ‚ç‚¹çš„è´¢åŠ¡æ€»ç›‘ç±»ï¼Œæœ€é«˜èŒçº§çš„è´¢åŠ¡æ€»ç›‘CFOçš„å®¡æ‰¹é€»è¾‘ç•¥æœ‰ä¸åŒï¼Œ å½“ç”³è¯·é‡‘é¢è¶…å‡º10000å…ƒåŽå°±å†æœ‰ä¸‹ä¸€ä¸ªå®¡æ‰¹äººäº†ï¼Œæ‰€ä»¥æ­¤æ—¶å°±ä¼šé©³å›žæŠ¥é”€ç”³è¯·ã€‚*/ Client /** * å®¢æˆ·ç«¯ç±» */ public class Client &#123; public static void main(String[] args)&#123; Aprrovrt flightJohn = new Staff(&quot;å¼ é£ž&quot;); // æ­¤å¤„ä½¿ç”¨é“¾å¼ç¼–ç¨‹é…ç½®è´£ä»»é“¾ flightJogn.setNextApprover(new Manager(&quot;å…³ç¾½&quot;)).setNextApprover(new CFO(&quot;åˆ˜å¤‡&quot;)); // ç›´æŽ¥æ‰¾ä¸“å‘˜å¼ é£žå®¡æ‰¹ flightJohn.approve(1000); /************************ å®¡æ‰¹é€šè¿‡ã€‚ã€ä¸“å‘˜ï¼šå¼ é£žã€‘ ************************/ flightJohn.approve(4000); /************************ æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ä¸“å‘˜ï¼šå¼ é£žã€‘ å®¡æ‰¹é€šè¿‡ã€‚ã€ç»ç†ï¼šå…³ç¾½ã€‘ ************************/ flightJohn.approve(9000); /************************ æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ä¸“å‘˜ï¼šå¼ é£žã€‘ æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ä¸“å‘˜ï¼šå…³ç¾½ã€‘ å®¡æ‰¹é€šè¿‡ã€‚ã€CEOï¼šåˆ˜å¤‡ã€‘ ************************/ flightJohn.approve(9000); /************************ æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ä¸“å‘˜ï¼šå¼ é£žã€‘ æ— æƒå®¡æ‰¹ï¼Œå‡çº§å¤„ç†ã€‚ã€ä¸“å‘˜ï¼šå…³ç¾½ã€‘ é©³å›žç”³è¯·ã€‚ã€CEOï¼šåˆ˜å¤‡ã€‘ ************************/ &#125; &#125; è‡³æ­¤ï¼Œä»¥è´£ä»»é“¾æ¨¡å¼ä¸ºåŸºç¡€æž¶æž„çš„å·¥ä½œæµæ­å»ºå®Œæˆï¼š å„å®¡æ‰¹è§’è‰²ï¼šåªéœ€è¦å®šä¹‰å…¶èŒæƒèŒƒå›´å†…çš„å·¥ä½œï¼Œå†ä¾é é«˜å±‚æŠ½è±¡å®žçŽ°è§’è‰²è´£ä»»çš„é“¾å¼ç»“æž„ï¼Œå®¡æ‰¹é€»è¾‘å¾—ä»¥æ‹†åˆ†ã€ä¸²è”ï¼Œè®©ä¸šåŠ¡ç”³è¯·åœ¨è´£ä»»é“¾ä¸Šé€çº§ä¼ é€’ã€‚ ç”³è¯·äººï¼šå†ä¹Ÿä¸å¿…å…³å¿ƒä¸šåŠ¡å¤„ç†ç»†èŠ‚ä¸Žç»“æžœäº†ï¼Œå½»åº•å°†å·¥ä½œæµæˆ–ä¸šåŠ¡é€»è¾‘æŠ›å¼€ï¼Œè½»æ¾åœ°å°†ç”³è¯·é€’äº¤ç»™è´£ä»»é“¾å…¥å£å³å¯å¾—åˆ°æœ€ç»ˆç»“æžœã€‚ äº”ã€è®©ä¸šåŠ¡é£žä¸€ä¼šå„¿1. ç±»ç»“æž„ è´£ä»»é“¾æ¨¡å¼çš„ç±»ç»“æž„ï¼š %%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% classDiagram Handler --o Handler Handler C(\"Clientå®¢æˆ·ç«¯\"):::lp A -.- |\"å®¡æ‰¹äººApprover\"| a[\"æ‰€æœ‰ä¸šåŠ¡å¤„ç†èŠ‚ç‚¹çš„é¡¶å±‚æŠ½è±¡* å®šä¹‰äº†æŠ½è±¡ä¸šåŠ¡å¤„ç†æ–¹æ³• handle() å¹¶ç•™ç»™å­ç±»å®žçŽ°* å®žä½“æ–¹æ³• setSuccessor()-æ³¨å…¥ç»§ä»»è€… ï¼šæž„å»ºè´£ä»»é“¾\"] B -.- |\"StaffManagerCFO\"| b[\"å®žé™…ä¸šåŠ¡å¤„ç†çš„å®žçŽ°ç±»ï¼Œå¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œæ¯ä¸ªéƒ½å®žçŽ°äº† handle() æ–¹æ³•ä»¥å¤„ç†è‡ªå·±èŒæƒèŒƒå›´å†…çš„ä¸šåŠ¡ï¼ŒèŒæƒèŒƒå›´ä¹‹å¤–çš„äº‹åˆ™ä¼ é€’ç»™ä¸‹ä¸€ä½ç»§ä»»è€…\"] C -.- c[\"ä¸šåŠ¡ç”³è¯·äººï¼Œåªéœ€å¯¹ä¸šåŠ¡é“¾æ¡çš„ç¬¬ä¸€ä¸ªå…¥å£èŠ‚ç‚¹å‘èµ·è¯·æ±‚å³å¯å¾—åˆ°æœ€ç»ˆå“åº”ã€‚\"] classDef p fill:#ddaebd classDef lp fill:#f4e4e9 3. æ€»ç»“%%{ init: { 'themeVariables': { 'fontSize': '14px' } } }%% graph LR T([\"è´£ä»»é“¾æ¨¡å¼æ€»ç»“\"]):::p T --> A([\"æœ¬è´¨\"]):::g T --> C([\"ä¼˜ç‚¹\"]):::p A ---> a[\"å¤„ç†æŸç§è¿žç»­çš„å·¥ä½œæµï¼Œå¹¶ç¡®ä¿ä¸šåŠ¡èƒ½å¤Ÿè¢«ä¼ é€’è‡³ç›¸åº”çš„è´£ä»»èŠ‚ç‚¹ä¸Šå¾—åˆ°å¤„ç†ã€‚\"]:::lg C --> c1([\"å¯æ‰©å±•\"]):::lp C --> c2([\"ä½Žè€¦åˆ\"]):::lp c1 -.- c1t[\"å¯¹è´£ä»»é“¾æ¨¡å¼çš„åº”ç”¨è®©æˆ‘ä»¬å¯ä»¥æ³°ç„¶è‡ªè‹¥åœ°åº”å¯¹ä¸šåŠ¡éœ€æ±‚çš„å˜æ›´ï¼Œæ–¹ä¾¿åœ°å¯¹ä¸šåŠ¡é“¾æ¡è¿›è¡Œæ‹†åˆ†ã€é‡ç»„ï¼Œä»¥åŠå¯¹å•ç‹¬èŠ‚ç‚¹çš„å¢žã€åˆ ã€æ”¹ã€‚\"]:::lp c1 -.- c1t2[\"ç»“æž„æ¾æ•£çš„ä¸šåŠ¡å¤„ç†èŠ‚ç‚¹è®©ç³»ç»Ÿå…·å¤‡æ›´åŠ çµæ´»çš„å¯ä¼¸ç¼©æ€§ã€å¯æ‰©å±•æ€§ã€‚\"]:::info c2 -.- c2t[\"è´£ä»»é“¾æ¨¡å¼è®©ç”³è¯·æ–¹ä¸Žå¤„ç†æ–¹è§£è€¦ï¼Œç”³è¯·äººèƒ½å½»åº•ä»Žä¸šåŠ¡ç»†èŠ‚ä¸­è§£è„±å‡ºæ¥ï¼Œæ— è®ºå®¡æ‰¹æµç¨‹å¤šä¹ˆå¤æ‚ï¼Œéƒ½åªéœ€è¦ç®€å•çš„ç­‰å¾…ï¼Œè®©ä¸šåŠ¡åœ¨è´£ä»»é“¾ä¸Šé£žä¸€ä¼šå„¿ã€‚\"]:::lp classDef p fill:#ddaebd classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://equnee.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"Chain","slug":"Chain","permalink":"https://equnee.github.io/tags/Chain/"}]},{"title":"ðŸŒ·ã€Šç§’æ‡‚è®¾è®¡æ¨¡å¼ã€‹â€”â€” å•ä¾‹æ¨¡å¼","slug":"note/Design-pattern/design-pattern_Singleton","date":"2023-03-07T17:32:40.177Z","updated":"2023-05-04T09:26:02.193Z","comments":true,"path":"note/Design-pattern/design-pattern_Singleton/","link":"","permalink":"https://equnee.github.io/note/Design-pattern/design-pattern_Singleton/","excerpt":"","text":"æ¥è‡ªã€Šç§’æ‡‚è®¾è®¡æ¨¡å¼ã€‹ ä¸€. å­¤ç‹¬çš„å¤ªé˜³æˆ‘ä»¬å¯ä»¥æŠŠå¤ªé˜³ç³»çœ‹ä½œä¸€ä¸ªåºžå¤§çš„ç³»ç»Ÿï¼Œå…¶ä¸­æœ‰å„ç§å„æ ·çš„å¯¹è±¡å­˜åœ¨ï¼Œä¸°å¯Œå¤šå½©çš„å®žä¾‹é€ å°±äº†ç³»ç»Ÿçš„ç¾Žå¥½ã€‚è¿™ä¸ªç³»ç»Ÿé‡Œçš„æŸäº›å®žä¾‹æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æˆ‘ä»¬èµ–ä»¥ç”Ÿå­˜çš„æ’æ˜Ÿå¤ªé˜³ã€‚ ä¸Žå…¶ä»–è¡Œæ˜Ÿæˆ–å«æ˜Ÿä¸åŒçš„æ˜¯ï¼Œå¤ªé˜³æ˜¯å¤ªé˜³ç³»å†…å”¯ä¸€çš„æ’æ˜Ÿå®žä¾‹ã€‚ä½†å€˜è‹¥å¤©ä¸Šæœ‰9ä¸ªå¤ªé˜³ï¼Œé‚£ä¹ˆå°†ä¼šå¸¦æ¥ä¸€åœºç¾éš¾ã€‚å¤ªé˜³ä¸å¤šä¸å°‘ä»…æ­¤ä¸€ä¾‹ã€‚ äºŒ. é¥¿æ±‰é€ æ—¥%%{ init: { 'themeVariables': { 'fontSize': '22px', 'fontFamily': 'Noto Serif SC' } } }%% graph LR T((\"é¥¿æ±‰é€ æ—¥\")):::b T --> A([\"1. å¼€å§‹\"]):::p T --> B([\"2. æž„é€ æ–¹æ³•ç§æœ‰åŒ–\"]):::p T --> C([\"3. è‡ªæœ‰æ°¸æœ‰\"]):::p T --> D([\"4. å…¬å¼€è®¿é—®\"]):::p T --> E([\"5. æ€»ç»“\"]):::b A --> a(\"æ—¢ç„¶å¤ªé˜³ç³»é‡Œåªæœ‰ä¸€ä¸ªå¤ªé˜³ï¼Œå°±éœ€è¦ä¸¥æ ¼æŠŠæŽ§å¤ªé˜³å®žä¾‹åŒ–çš„è¿‡ç¨‹ã€‚\"):::lp a -.-> at([\"Public class Sun {} // ä¸€ä¸ªæœ€ç®€å•çš„Sunç±»\"]):::lg B --> b(\"å¤ªé˜³åªæœ‰ä¸€ä¸ªï¼Œä¸èƒ½éšæ„åˆ›å»ºå®žä¾‹ã€‚ä½†ç”±äºŽJavaä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ— å‚æž„é€ å™¨ï¼Œå› æ­¤å¿…é¡»ç¦æ­¢å¤–éƒ¨è°ƒç”¨æž„é€ å™¨*ã€‚\"):::lp b -.-> bt([\"private Sun(){}\"]):::lg C --> c(\"è®©å®ƒåœ¨ç±»åŠ è½½æ—¶å°±è‡ªå·±åˆ›å»ºè‡ªå·±ï¼Œå¹¶ä½¿å…¶è‡ªæœ‰æ°¸æœ‰\"):::lp c -.-> ct([\"private static final Sun sun = new Sun();\"]):::lg D --> d(\"ä½¿ç”¨é™æ€æ–¹æ³•*getInstance()æ¥èŽ·å–å¤ªé˜³çš„å•ä¾‹å¯¹è±¡å¹¶å°†å…¶è®¾ç½®ä¸ºâ€œpublicâ€ä»¥æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨\"):::lp d -.- dt([\"public static Sun getInstance(){ return sun; }\"]):::lg d -.- d2t[\"*å¦‚åŒç¨‹åºå…¥å£çš„é™æ€æ–¹æ³•main(), ä¸éœ€è¦ä»»ä½•å¯¹è±¡å¼•ç”¨å°±èƒ½è¢«è®¿é—®\"]:::info T -..-> e(\"ï¼ˆè¿˜å¯ä»¥æ·»åŠ å…¶ä»–åŠŸèƒ½æ–¹æ³•ï¼Œå¦‚å‘å…‰å’Œå‘çƒ­ç­‰ï¼‰\"):::info d --> et(\"æœ€åŽï¼Œä¸ç®¡è°å¾—åˆ°æˆ–å¾—åˆ°å‡ æ¬¡ï¼Œå¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå¤ªé˜³å®žä¾‹ï¼Œè¿™æ ·å°±ç¡®ä¿äº†æ•´ä¸ªå¤ªé˜³ç³»ä¸­æ’æ˜Ÿå¤ªé˜³çš„å”¯ä¸€åˆæ³•æ€§ï¼Œä»–äººæ— æ³•ä¼ªé€ ã€‚\"):::lb E --> e2t(\"è¿™å°±æ˜¯â€œé¥¿æ±‰æ¨¡å¼â€(eager initialization)ï¼šå³åœ¨åˆå§‹é˜¶æ®µ(static)å°±ä¸»åŠ¨è¿›è¡Œå®žä¾‹åŒ–ï¼Œå¹¶æ—¶åˆ»ä¿æŒä¸€ç§æ¸´æ±‚çš„çŠ¶æ€(public)ï¼Œæ— è®ºæ­¤å•ä¾‹æ˜¯å¦æœ‰äººä½¿ç”¨ã€‚\"):::lb classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#cde2da classDef info fill:#f6f6f7,color:#5a5a5f,stroke-dasharray: 3 3, stroke-width: 2px 1. å¼€å§‹ public class Sun &#123;&#125; 2. æž„é€ æ–¹æ³•ç§æœ‰åŒ– æŽ¥ä¸‹æ¥æˆ‘ä»¬å¾—ç¡®ä¿ä»»ä½•äººéƒ½ä¸èƒ½åˆ›å»ºå¤ªé˜³çš„å®žä¾‹ï¼Œå¦åˆ™ä¸€æ—¦ç¨‹åºå‘˜è°ƒç”¨ä»£ç â€œnew Sun()â€ï¼Œå¤©ç©ºå°±ä¼šå‡ºçŽ°å¤šä¸ªå¤ªé˜³ï¼Œä¾¿åˆéœ€è¦â€œåŽç¾¿â€åŽ»è§£å†³äº†ã€‚ å®žä¾‹åŒ–å·¥ä½œå®Œå…¨å½’å±žäºŽå†…éƒ¨äº‹åŠ¡ï¼Œä»»ä½•å¤–éƒ¨ç±»éƒ½æ— æƒå¹²é¢„ public class Sun &#123; private Sun()&#123; // æž„é€ æ–¹æ³•ç§æœ‰åŒ– &#125; &#125; 3. è‡ªæœ‰æ°¸æœ‰ public class Sun &#123; private static final Sun sun = new Sun(); // è‡ªæœ‰æ°¸æœ‰çš„å¤ªé˜³å•ä¾‹ private Sun()&#123; // æž„é€ æ–¹æ³•ç§æœ‰åŒ– &#125; &#125; å…³é”®å­— è¯´æ˜Ž private ç¡®ä¿å¤ªé˜³å®žä¾‹çš„ç§æœ‰æ€§ã€ä¸å¯è§æ€§å’Œä¸å¯è®¿é—®æ€§ï¼› static ç¡®ä¿å¤ªé˜³çš„é™æ€æ€§ï¼Œå°†å¤ªé˜³æ”¾å…¥å†…å­˜é‡Œçš„é™æ€åŒºï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–äº†ï¼Œå®ƒä¸Žç±»åŒåœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸Žç±»åŒæ—¶æœŸä¸”æ—©äºŽå†…å­˜å †ä¸­çš„å¯¹è±¡å®žä¾‹åŒ–çš„ï¼Œè¯¥å®žä¾‹åœ¨å†…å­˜ä¸­æ°¸ç”Ÿï¼Œå†…å­˜åžƒåœ¾æ”¶é›†å™¨(Garbage Collector, GC)ä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œå›žæ”¶ï¼› final ç¡®ä¿è¿™ä¸ªå¤ªé˜³æ˜¯å¸¸é‡ã€æ’é‡ï¼Œå®ƒæ˜¯ä¸€é¢—ç»ˆæžçš„æ’æ˜Ÿï¼Œå¼•ç”¨ä¸€æ—¦è¢«èµ‹å€¼å°±ä¸èƒ½å†ä¿®æ”¹ï¼› new åˆå§‹åŒ–å¤ªé˜³ç±»çš„é™æ€å®žä¾‹ï¼Œå¹¶èµ‹äºˆé™æ€å¸¸é‡sunã€‚ 4. å…¬å¼€è®¿é—® å•ä¾‹çš„å¤ªé˜³å¯¹è±¡å†™å¥½äº†ï¼Œå¯ä¸€åˆ‡çš†æ˜¯ç§æœ‰çš„ï¼Œå¤–éƒ¨å¦‚ä½•è®¿é—®ï¼Ÿâ€”â€” ä½¿ç”¨é™æ€æ–¹æ³•getInstance()æ¥èŽ·å–å¤ªé˜³çš„å•ä¾‹å¯¹è±¡ã€‚ public class Sun &#123; private static final Sun sun = new Sun(); // è‡ªæœ‰æ°¸æœ‰çš„å¤ªé˜³å•ä¾‹ private Sun()&#123; // æž„é€ æ–¹æ³•ç§æœ‰åŒ– &#125; public static Sun getInstance()&#123; // é˜³å…‰æ™®ç…§ï¼Œæ–¹æ³•å…¬å¼€åŒ– return sun; &#125; &#125; ä¸‰. æ‡’æ±‰çš„é˜Ÿä¼graph LR T((æ‡’æ±‰çš„é˜Ÿä¼)):::b T --> A([\"1. ç”¨æ—¶æ‰åˆ›å»º\"]):::p T --> B([\"2. æŽ’é˜Ÿï¼ˆåŒæ­¥é”ï¼‰\"]):::p T --> C([\"3. éœ€è¦æ—¶å†æŽ’é˜Ÿï¼ˆåŒæ£€é”ï¼‰\"]):::p A --> a(\"è‹¥æ— è¯·æ±‚å°±ä¸å®žä¾‹åŒ–ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´\"):::lp a -.-> at([\"åŽ»æŽ‰ finalif(sun == null)\"]):::lg B --> b(\"ç”±äºŽå¤šçº¿ç¨‹æ—¶çš„ç¼ºé™·ï¼šè¯·æ±‚æ–¹æ³•åŠ ä¸ŠåŒæ­¥é”synchronized\"):::lp b -.- bt2([\"public static synchronized Sun getInstance() \"]):::lg b -.-> bt3(\"åŠ é”åŽæŸçº¿ç¨‹è°ƒç”¨å‰å¿…é¡»èŽ·å–åŒæ­¥é”ï¼Œè°ƒç”¨å®Œä¼šé‡Šæ”¾é”ç»™å…¶ä»–çº¿ç¨‹ç”¨ï¼Œä¹Ÿå°±æ˜¯ç»™è¯·æ±‚æŽ’é˜Ÿã€‚\"):::info C --> c(\"ä¸ºäº†è§£å†³çº¿ç¨‹é˜»å¡žï¼šä½¿ç”¨2ä¸ªåµŒå¥—çš„åˆ¤ç©ºé€»è¾‘\"):::lp c -.- ct([\"private volatile static Sun sun;if(sun = null){ synchronized(){if(sun == null){sun = new Sun();}\"]):::lg c -.- ct2[\"1. å¤–å±‚æ”¾å®½å…¥å£ï¼Œä¿è¯çº¿ç¨‹å¹¶å‘çš„é«˜æ•ˆæ€§2. å†…å±‚åŠ é”åŒæ­¥ï¼Œä¿è¯å®žä¾‹åŒ–çš„å•æ¬¡è¿è¡Œ\"]:::info classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#cde2da classDef info fill:#f6f6f7,color:#433f40,stroke-dasharray: 3 3, stroke-width: 2px 1. ç”¨æ—¶æ‰åˆ›å»º å•ä¾‹çš„â€œé¥¿æ±‰æ¨¡å¼â€ï¼Œè®©å¤ªé˜³ä¸€å¼€å§‹å°±å‡†å¤‡å°±ç»ªï¼Œéšæ—¶ä¾›åº”å…è´¹æ—¥å…‰ã€‚ ç„¶è€Œï¼Œå¦‚æžœå§‹ç»ˆæ²¡äººèŽ·å–æ—¥å…‰ï¼Œé‚£å°±ç™½é€ äº†å¤ªé˜³ï¼Œç™½ç™½æµªè´¹ä¸€å—å†…å­˜åŒºåŸŸã€‚ç±»ä¼¼äºŽå•†å®¶è´§å“æ»žé”€çš„æƒ…å†µï¼Œè´§æž¶ä¸Šå †æ”¾ç€å•†å“å´æ²¡äººä¹°ï¼Œç™½ç™½æµªè´¹ç©ºé—´ã€‚å› æ­¤ï¼Œå•†å®¶ä¸ºäº†é™ä½Žé£Žé™©ï¼Œè§„å®šæœ‰äº›å•†å“å¿…é¡»æå‰é¢„è®¢ï¼Œè¿™å°±æ˜¯â€œæ‡’æ±‰æ¨¡å¼â€(lazy initialization)ã€‚ public class Sun &#123; private static Sun sun; // è¿™é‡Œä¸è¿›è¡Œå®žä¾‹åŒ– private Sun()&#123; // æž„é€ æ–¹æ³•ç§æœ‰åŒ– &#125; public static Sun getInstance() &#123; if(sun == null) &#123; // å¦‚æžœæ— æ—¥æ‰é€ æ—¥ sun = new Sun(); &#125; return sun; &#125;&#125; å…³é”®å­— è¯´æ˜Ž åŽ»æŽ‰ final ä¸€å¼€å§‹å¹¶æ²¡æœ‰é€ å¤ªé˜³ï¼Œæ‰€ä»¥åŽ»æŽ‰äº†å…³é”®å­—finalã€‚ ç”¨æ—¶æ‰å®žä¾‹åŒ– ä»…åœ¨æŸçº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨ç¬¬9è¡Œçš„getInstance()æ–¹æ³•æ—¶æ‰ä¼šè¿è¡Œå¯¹å¤ªé˜³è¿›è¡Œå®žä¾‹åŒ–çš„é€»è¾‘ä»£ç ï¼Œä¹‹åŽå†è¯·æ±‚å°±ç›´æŽ¥è¿”å›žæ­¤å®žä¾‹äº†ã€‚â—ï¸ç¼ºç‚¹ï¼šåˆæ¬¡è¯·æ±‚æ—¶é€Ÿåº¦è¾ƒä¹‹å‰çš„é¥¿æ±‰åˆå§‹åŒ–æ¨¡å¼æ…¢ï¼Œå› ä¸ºè¦æ¶ˆè€—CPUèµ„æºåŽ»ä¸´æ—¶é€ è¿™ä¸ªå¤ªé˜³ã€‚ 2. æŽ’é˜Ÿ å› ä¸ºä¸Šè¿°ç¨‹åºåœ¨å¤šçº¿ç¨‹æ¨¡å¼ä¸‹æœ‰ç¼ºé™·ï¼šå¹¶å‘è¯·æ±‚æ—¶åˆ¤ç©ºé€»è¾‘ä¼šåŒæ—¶æˆç«‹ï¼Œå¯¼è‡´å¤šæ¬¡å®žä¾‹åŒ–å¤ªé˜³ã€å¤šæ¬¡èµ‹å€¼ï¼Œè¿èƒŒå•ä¾‹ç†å¿µã€‚ public class Sun &#123; private static Sun sun; // è¿™é‡Œä¸è¿›è¡Œå®žä¾‹åŒ– private Sun()&#123; // æž„é€ æ–¹æ³•ç§æœ‰åŒ– &#125; public static synchronized Sun getInstance() &#123; // æ­¤å¤„åŠ å…¥åŒæ­¥é” if(sun == null) &#123; // å¦‚æžœæ— æ—¥æ‰é€ æ—¥ sun = new Sun(); &#125; return sun; &#125;&#125; å…³é”®å­— è¯´æ˜Ž synchronized å°†å¤ªé˜³ç±»Sunä¸­ç¬¬9è¡Œçš„getInstance()æ”¹æˆäº†åŒæ­¥æ–¹æ³•ï¼Œå¦‚æ­¤å¯é¿å…å¤šçº¿ç¨‹é™·é˜±ã€‚ 3. éœ€è¦æ—¶å†æŽ’é˜Ÿ å¦‚æžœä»…ä¸ºäº†å®žä¾‹åŒ–ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œç›´æŽ¥åŠ é”æŽ’é˜Ÿ,ä½¿ç”¨synchronizedè®©æ‰€æœ‰è¯·æ±‚æŽ’é˜Ÿç­‰å€™ï¼šä¼šé€ æˆçº¿ç¨‹é˜»å¡žï¼Œèµ„æºä¸Žæ—¶é—´è¢«ç™½ç™½æµªè´¹ã€‚ public class Sun &#123; private volatile static Sun sun; private Sun() &#123; // æž„é€ æ–¹æ³•ç§æœ‰åŒ– &#125; public static Sun getInstance() &#123; // åŽå±±å…¥å£ if(sun = null)&#123; synchronized(Sun.class)&#123; // è§‚æ—¥è€…è¿›è¡ŒæŽ’é˜Ÿ if(sun == null)&#123; sun = new Sun(); // åªæœ‰æŽ’å¤´å…µé€ äº†å¤ªé˜³ï¼Œæ—­æ—¥ä¸œå‡ &#125; &#125; &#125; return sun; // â€¦â€¦é˜³å…‰æ™®ç…§ï¼Œå…¶ä½™äººä¸å¿…å†é€ æ—¥ &#125;&#125; å…³é”®å­— è¯´æ˜Ž åŽ»æŽ‰ final ç¬¬3è¡Œå¯¹sunå˜é‡çš„å®šä¹‰ä¸å†ä½¿ç”¨finalå…³é”®å­—ï¼Œè¯´æ˜Žå®ƒä¸å†æ˜¯å¸¸é‡ï¼Œè€Œæ˜¯éœ€è¦åŽç»­èµ‹å€¼çš„å˜é‡ï¼› volatile å…³é”®å­—volatileå¯¹é™æ€å˜é‡çš„ä¿®é¥°åˆ™èƒ½ä¿è¯sunå˜é‡å€¼åœ¨å„çº¿ç¨‹è®¿é—®æ—¶çš„åŒæ­¥æ€§ã€å”¯ä¸€æ€§ã€‚ åŽ»æŽ‰å…¥å£çš„åŒæ­¥é” å¯¹äºŽç¬¬9è¡Œçš„getInstance()æ–¹æ³•ï¼ŒåŽ»æŽ‰æ–¹æ³•ä¸Šçš„å…³é”®å­—synchronizedï¼Œä½¿å¤§å®¶éƒ½èƒ½åŒæ—¶è¿›å…¥æ–¹æ³•å¹¶å¯¹å…¶è¿›è¡Œå¼€å‘ã€‚ åˆ¤ç©ºé€»è¾‘1 æœ‰äº›äººï¼ˆçº¿ç¨‹ï¼‰èµ·æ—©å°±æ˜¯ä¸ºäº†è§‚çœ‹æ—¥å‡ºï¼Œé‚£ä¹ˆè¿™äº›äººä¼šé€šè¿‡ç¬¬10è¡Œçš„åˆ¤ç©ºé€»è¾‘è¿›å…¥è§‚æ—¥å°ã€‚ åˆ¤ç©ºé€»è¾‘2 åœ¨ç¬¬12è¡Œæˆ‘ä»¬åˆè¿›è¡Œä¸€æ¬¡åˆ¤ç©ºé€»è¾‘ï¼Œè¿™å°±æ„å‘³ç€åªæœ‰é˜Ÿä¼ä¸­çš„ç¬¬ä¸€ä¸ªäººé€ äº†å¤ªé˜³ï¼Œæœ‰å¹¸çœ‹åˆ°äº†æ—¥å‡ºçš„ç¬¬ä¸€ç¼•é˜³å…‰ï¼Œè€ŒåŽé¢çš„äººåˆ™ç»Ÿç»Ÿç¦»å¼€ï¼Œç›´åˆ°ç¬¬17è¡Œå¾—åˆ°å·²ç»é€ å¥½çš„å¤ªé˜³ã€‚ æœ€åŽï¼šå¤ªé˜³é«˜é«˜å‡èµ·ï¼Œå®žä¾‹åŒ–æ“ä½œå®Œæ¯•ï¼Œèµ·æ™šçš„äººä»¬éƒ½æ— é¡»å†è¿›å…¥è§‚æ—¥å°ï¼Œç›´æŽ¥èŽ·å–å¤ªé˜³å®žä¾‹å³å¯ï¼Œæ¸©æš–é˜³å…‰æ™®ç…§å¤§åœ°ã€‚ å››. å¤§é“è‡³ç®€ç›¸æ¯”â€œæ‡’æ±‰æ¨¡å¼â€ï¼Œå…¶å®žæ›´å¸¸ç”¨â€œé¥¿æ±‰æ¨¡å¼â€ï¼Œå› ä¸ºè¿™ä¸ªå•ä¾‹è¿Ÿæ—©æ˜¯è¦è¢«å®žä¾‹åŒ–å ç”¨å†…å­˜çš„ï¼Œå»¶è¿Ÿæ‡’åŠ è½½çš„æ„ä¹‰å¹¶ä¸å¤§ï¼ŒåŠ é”è§£é”åè€Œæ˜¯ä¸€ç§èµ„æºæµªè´¹ï¼ŒåŒæ­¥æ›´æ˜¯ä¼šé™ä½ŽCPUçš„åˆ©ç”¨çŽ‡ï¼Œä½¿ç”¨ä¸å½“çš„è¯åè€Œä¼šå¸¦æ¥ä¸å¿…è¦çš„é£Žé™©ã€‚è¶Šç®€å•çš„åŒ…å®¹æ€§è¶Šå¼ºï¼Œè€Œè¶Šå¤æ‚çš„åè€Œè¶Šå®¹æ˜“å‡ºé”™ã€‚ å•ä¾‹æ¨¡å¼çš„ç±»ç»“æž„ï¼š classDiagram class Singleton{ - instance : singleton - Sigleton() + getInstance() Singleton } Singleton --> Singleton Singletonï¼ˆå•ä¾‹ï¼‰ï¼šåŒ…å«ä¸€ä¸ªè‡ªå·±çš„ç±»å®žä¾‹çš„å±žæ€§ï¼Œå¹¶æŠŠæž„é€ æ–¹æ³•ç”¨privatå…³é”®å­—éšè—èµ·æ¥ï¼Œå¯¹å¤–åªægetInstance()æ–¹æ³•ä»¥èŽ·å¾—è¿™ä¸ªå•ä¾‹å¯¹è±¡ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://equnee.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"singleton","slug":"singleton","permalink":"https://equnee.github.io/tags/singleton/"}]},{"title":"Macè¿œç¨‹è¿žæŽ¥Windowsï¼ˆMicrosoft Remote Desktopï¼‰","slug":"guide/mac_mrd_windows","date":"2021-03-25T07:49:07.000Z","updated":"2023-03-23T12:00:15.278Z","comments":true,"path":"guide/mac_mrd_windows/","link":"","permalink":"https://equnee.github.io/guide/mac_mrd_windows/","excerpt":"","text":"æ‘˜è¦: åŒæ—¶å¸¦ä¸¤å°ç”µè„‘å‡ºé—¨å¾ˆéº»çƒ¦ï¼ŒäºŽæ˜¯é€‰æ‹©åœ¨Macä¸Šä½¿ç”¨ Microsoft Remote Desktop è¿œç¨‹è¿žæŽ¥ä½¿ç”¨ä¸å¸¦å‡ºé—¨çš„ Windowsï¼Œä»Žæ­¤åªéœ€è¦æŠŠWindowsæ”¾åœ¨å®¶é‡Œè¿žæŽ¥ç”µæºå’Œwifiä¸€ç›´æ”¾ç€å°±è¡Œï¼é¡ºä¾¿æ•´ç†äº†ä¸€äº›åˆ«äººé‡åˆ°çš„é”™è¯¯å’Œè§£å†³æ–¹æ³•ã€‚ æ—¥æœŸ: 2021/3/25 çŽ¯å¢ƒ : MacOS 11.2.2 + Windows10 ä¸€. è½¯ä»¶ä¸‹è½½ä¸‹è½½ Microsoft Remote Desktopï¼Œæ ¹æ®æƒ…å†µä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„appï¼š ä½¿ç”¨ Windows æŽ§åˆ¶ windowsï¼š&gt;&gt; å®˜ç½‘ä¸‹è½½ ä½¿ç”¨ Mac æŽ§åˆ¶ windowsï¼š App Store ä¸‹è½½ï¼Œä»…å›½å¤–çš„åº”ç”¨å•†åº—æä¾›ä¸‹è½½ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨å›½å¤–çš„ AppleIDï¼Œå¯å‚è€ƒ&gt; &gt; å›½å¤–AppleIDç”³è¯·æ–¹æ³•ã€‚ å…¶ä»–æ¸ é“ä¸‹è½½ï¼ˆä¿ºä¹Ÿæ²¡è¯•è¿‡ äºŒ. åˆ›å»ºè¿žæŽ¥2.1 Windows é…ç½® é¦–å…ˆç¡®ä¿å°†è¢«æŽ§åˆ¶çš„ Windows å¼€å¯äº†è¿œç¨‹æ¡Œé¢è¿žæŽ¥é…ç½®ï¼š ï¼ˆ1ï¼‰ç³»ç»Ÿå±žæ€§ è®¾ç½®äº†ç³»ç»Ÿå±žæ€§ä¸ºå…è®¸è¿œç¨‹æ¡Œé¢è¿žæŽ¥ è‹¥é€‰é¡¹éƒ½æ˜¯ç°è‰²æ— æ³•å…è®¸è¿œç¨‹è¿žæŽ¥ï¼Œ&gt; å‚è€ƒè¿™é‡Œã€‚ è¿è¡Œ gpedit.msc å›žè½¦æ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨,åœ¨å·¦ä¾§çš„åˆ—è¡¨ä¸­ä¾æ¬¡å±•å¼€ï¼šè®¡ç®—æœºé…ç½®&gt;ç®¡ç†æ¨¡æ¿&gt;Windowsç»„ä»¶&gt;è¿œç¨‹æ¡Œé¢ä¼šè¯ä¸»æœº&gt;è¿žæŽ¥ åŒå‡»æ‰“å¼€å³ä¾§çš„â€å…è®¸ç”¨æˆ·é€šè¿‡ä½¿ç”¨è¿œç¨‹æ¡Œé¢æœåŠ¡è¿›è¡Œè¿œç¨‹è¿žæŽ¥â€œ,çœ‹ä¸€ä¸‹ä¹‹å‰æ˜¯å¦æœ‰é…ç½®,å¦‚æžœæœ‰çš„è¯æ”¹æˆâ€æœªé…ç½®â€,å¦‚æžœä¹‹å‰å°±æ˜¯æœªé…ç½®,é‚£å¯ä»¥æ”¹æˆå·²å¯ç”¨,ç„¶åŽæ‚¨å†çœ‹ä¸€ä¸‹ç³»ç»Ÿå±žæ€§&gt;è¿œç¨‹æ¡Œé¢ä¸­çš„ç›¸å…³è®¾ç½®åŒºåŸŸæ˜¯å¦æ¢å¤æ­£å¸¸. ï¼ˆ2ï¼‰é˜²ç«å¢™ è®¾ç½®äº†é˜²ç«å¢™å…è®¸è¿œç¨‹æ¡Œé¢é€šè¿‡é˜²ç«å¢™é€šä¿¡ ï¼ˆ3ï¼‰ç«¯å£ å¼€å¯äº†ç”¨äºŽè¿œç¨‹æ¡Œé¢è¿žæŽ¥çš„æœåŠ¡ç«¯å£ï¼š åœ¨cmdä¸­è¾“å…¥netstat -aon|findstr 3389ï¼ŒæŸ¥çœ‹é»˜è®¤ç«¯å£å·3389æ˜¯å¦å¼€å¯ã€‚ è‹¥ç«¯å£å·æœªå¼€å¯ï¼šæ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œå¼€å¯ä¸‹é¢ä¸¤é¡¹æœåŠ¡ã€‚ï¼ˆUmRdpServiseå¯æ’­æ”¾å£°éŸ³) è‹¥ä¿®æ”¹è¿‡æˆ–æ— æ³•æŸ¥è¯¢åˆ°3389ç«¯å£ï¼Œ&gt; å‚è€ƒè¿™é‡Œã€‚ ï¼ˆ4ï¼‰æœ¬åœ°ç­–ç•¥ è®¾ç½®æœ¬åœ°ç­–ç•¥éžæ¥å®¾ã€‚åœ¨è¿è¡Œä¸­è¾“å…¥ï¼šgpedit.msc ï¼ˆ5ï¼‰å…³é—­ Windows hello ç¡®ä¿å…³é—­äº†è®¾ç½®å†… ä»…å…è®¸ Windows hello ç™»å½• (æœªè®¾ç½®å¯å¿½ç•¥ã€‚) Windows Helloï¼šä½¿æ‚¨å¯ä»¥ä½¿ç”¨è„¸éƒ¨ï¼Œè™¹è†œï¼ŒæŒ‡çº¹æˆ–PINç™»å½•è®¾å¤‡ï¼Œåº”ç”¨ç¨‹åºï¼Œåœ¨çº¿æœåŠ¡å’Œç½‘ç»œã€‚ ï¼ˆ6ï¼‰AAD ç¡®ä¿ä¸æ˜¯é€šè¿‡ Microsoft Authenticator ï¼Œè€Œæ˜¯é€šè¿‡æ‰‹åŠ¨è¾“å…¥å¯†ç è¿›è¡ŒéªŒè¯ç™»å½•çš„ï¼š å› ä¸º Microsoft Authenticator ç™»å½•ä½¿ç”¨çš„è®¤è¯æ–¹å¼ä¸Žå…¶ä»–åŸŸä¸äº’é€šï¼Œå°±ä¸èƒ½ç›´æŽ¥å¼€å¯è¿žæŽ¥å•¦ã€‚ 2.2 æ·»åŠ è®¡ç®—æœº é…ç½®Windowså…è®¸è¿œç¨‹æ¡Œé¢è¿žæŽ¥åŽï¼Œä½¿ç”¨Macå‡†å¤‡å¼€å§‹è¿žæŽ¥ï¼Œåœ¨Microsoft Remote Desktopä¸­æ·»åŠ PCï¼Œè¾“å…¥ä¸»æœºå + ç”¨æˆ·è´¦å·ä¿¡æ¯ã€‚ PC nameï¼šIPåœ°å€ã€‚ æŸ¥çœ‹æ–¹æ³•ï¼šåœ¨ Windows çš„å‘½ä»¤æç¤ºç¬¦(win+R é”®æ‰“å¼€çš„è¿è¡Œçª—å£è¾“å…¥cmd) è¾“å…¥å‘½ä»¤ ipconfigï¼Œå¯æŸ¥çœ‹ipv4åœ°å€ã€‚ User accountï¼šç™»å½•è¯¥PCçš„è´¦å·å¯†ç ã€‚å»ºè®®é€‰æ‹© Ask when requiredï¼Œå…ˆä¸è¾“å…¥è´¦å·å¯†ç ï¼Œåœ¨è¿žæŽ¥æ—¶è¾“å…¥ï¼Œç¡®ä¿èƒ½è¿žæŽ¥æˆåŠŸåŽå†æ·»åŠ è®°å½•ï¼Œé˜²æ­¢è¿™é‡Œä¿å­˜çš„è´¦å·å¯†ç æœ‰è¯¯ï¼ŒåŽé¢æ€Žä¹ˆéƒ½è¿žä¸ä¸Šã€‚ 2.3 å¡«å†™è´¦æˆ·ä¿¡æ¯ï¼ˆ1ï¼‰ æœ¬åœ°ç”¨æˆ· ä½¿ç”¨æœ¬åœ°ç”¨æˆ·åç™»å½•ï¼š æœ¬åœ°ç”¨æˆ·å(cmdè¾“å…¥ whoami æŸ¥çœ‹) + æœ¬åœ°è§£é”å¯†ç ã€‚ ï¼ˆ2ï¼‰ å¾®è½¯è´¦æˆ· ä½¿ç”¨å¾®è½¯è´¦æˆ·ç™»å½•ï¼š æœ¬åœ°åˆ›å»ºçš„è‹±æ–‡è´¦æˆ·è‹¥å…³è”äº†å¾®è½¯è´¦å·ï¼Œå¯ä½¿ç”¨è¯¥å¾®è½¯è´¦å·é‚®ç®±è¿›è¡Œè¿œç¨‹ç™»å½•ï¼Œç”¨æˆ·åä¸ºé‚®ç®±æ ¼å¼çš„å¾®è½¯è´¦å·(username@outlook.com) + å¯¹åº”çš„å¾®è½¯è´¦å·å¯†ç ã€‚ ï¼ˆ3ï¼‰ ç©ºå¯†ç  æˆ–ä½¿ç”¨ç©ºå¯†ç è¿›è¡Œè¿œç¨‹æ¡Œé¢è¿žæŽ¥ï¼šåœ¨ windows ä¸­è®¾ç½® æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥gpedit.mscï¼Œæ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨ 2.4 æŠ¥é”™è§£å†³ï¼ˆ1ï¼‰ The User Account Did Not work ðŸ”’ æç¤ºï¼šThe User Account Did Not Work.The user account used to connect to xx.xx.xx.xx (remote PC) did not work. Try again.ï¼ˆâ€“&gt; ä½ è¾“çš„è¿™ä¸ªè´¦æˆ·ä¿¡æ¯è¿žä¸ä¸Šã€‚ï¼‰ ðŸ”‘ è§£å†³æ–¹æ³•ï¼šéœ€è¦è¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç ã€‚ å¾®è½¯è´¦å·ç™»å½•ï¼šé‚®ç®±æ ¼å¼çš„å¾®è½¯è´¦å·(username@outlook.com) + å¯¹åº”çš„å¾®è½¯è´¦å·å¯†ç  æœ¬åœ°ç”¨æˆ·ç™»å½•ï¼šæœ¬åœ°ä¸»æœºåæˆ–æœ¬åœ°è´¦æˆ·å + æœ¬åœ°è´¦æˆ·è§£é”å¯†ç  ä»¥å‰å¯ä»¥ï¼ŒçŽ°åœ¨çªç„¶è¿žä¸ä¸Šäº†ï¼šæ£€æŸ¥ä¸Šé¢ä¸¤ä¸ªå¯†ç æ˜¯ä¸æ˜¯æ”¹è¿‡äº†ï¼Œå¦‚æžœæ”¹è¿‡è®°å¾—åŒæ­¥ä¿®æ”¹ã€‚ ï¼ˆ2ï¼‰ 0x204 ðŸ”’ è¿žæŽ¥æ—¶æç¤ºï¼šWe couldnâ€™t connect to the remote PC.Make sure the PC is turned on and connected to the network, and thar remote access is enabled. Error code:0x204ï¼ˆâ€“&gt; æˆ‘ä»¬æ— æ³•è¿žæŽ¥åˆ°è¿œç¨‹ç”µè„‘ï¼Œç¡®ä¿ç”µè„‘å·²æ‰“å¼€å¹¶è¿žæŽ¥åˆ°ç½‘ç»œï¼Œå¹¶ä¸”å·²å¯ç”¨è¿œç¨‹è®¿é—®ã€‚ï¼‰ ðŸ”‘ è§£å†³æ–¹æ³•ï¼š å¼€ç”µè„‘ã€‚æ£€æŸ¥æ˜¯å¦æ‰“å¼€windowsç”µæºï¼Œç¡®ä¿éžå…³æœºæˆ–ç¡çœ çŠ¶æ€ï¼Œå¼€å¯ç”µæºè§£é”å±å¹•å°±å¯ä»¥å•¦ã€‚ è¿žWi-Fiã€‚ å¼€æœåŠ¡ã€‚ç¡®ä¿å·²å¼€å¯ Windows çš„è¿œç¨‹æ¡Œé¢è¿žæŽ¥é…ç½®ã€‚ ï¼ˆ3ï¼‰ 0x207 ðŸ”’ æç¤ºï¼š ðŸ”‘ï¼šç¡®ä¿windowsçš„æœ¬åœ°ç»„ç­–ç•¥ä¸æ˜¯ ä»…æ¥å®¾ çŠ¶æ€ã€‚ ä¸‰. Macé…ç½®3.1 åˆ›å»ºç›®å½• åœ¨macç”µè„‘ä¸Šï¼Œæ ¹æ®éœ€è¦åˆ›å»ºç”¨äºŽæ–‡ä»¶ä¼ è¾“çš„ç›®å½•ã€‚ 3.2 ç¼–è¾‘é…ç½® å¼€å¯Microsoft Remote Desktop è½¯ä»¶ï¼Œç‚¹å‡»ç¼–è¾‘ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæ·»åŠ é‡å®šå‘åˆšåˆ›å»ºçš„æ–‡ä»¶å¤¹å¯¹åº”çš„è·¯å¾„ 3.3 å®Œæˆ å¯æŸ¥çœ‹windowsä¸Šçš„æ–‡ä»¶å¤¹æ˜ å°„ï¼Œæ²¡å‡ºçŽ°çš„è¯é‡æ–°è¿žæŽ¥è¯•è¯•ã€‚ å››. ç»“å°¾ç¬¬ä¸€æ¬¡å®Œæˆmacå’Œwindowsä¹‹é—´è¿œç¨‹æ¡Œé¢çš„é…ç½®ï¼Œå›žå¤´çœ‹æ„Ÿè§‰å†™å¾—æœ‰äº›å¤æ‚ï¼Œå› ä¸ºå¤šè®°å½•äº†ä¸€äº›è‡ªå·±ä¹Ÿæ²¡é‡åˆ°è¿‡çš„é—®é¢˜å’Œæƒ…å†µã€‚å¦‚æžœå„ä½è¿˜é‡åˆ°äº†æ–‡ä¸­æ²¡æåˆ°çš„æƒ…å†µï¼Œæ¬¢è¿Žè¯„è®ºç•™è¨€ï¼Œæˆ‘ä¼šç»§ç»­è¡¥å……ï½ž","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://equnee.github.io/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://equnee.github.io/tags/windows/"},{"name":"Mac","slug":"Mac","permalink":"https://equnee.github.io/tags/Mac/"}]},{"title":"ðŸ¡ Mermaid â€” è¶…å¥½ç”¨çš„æ–‡æ¡£å›¾å½¢å·¥å…·ï¼","slug":"tool/markdown+mermaid","date":"2020-04-01T16:37:51.048Z","updated":"2023-05-04T09:26:31.173Z","comments":true,"path":"tool/markdown+mermaid/","link":"","permalink":"https://equnee.github.io/tool/markdown+mermaid/","excerpt":"","text":"ä¸€. Markdownï¼ˆç•¥ äºŒ. Mermaid åœ¨çº¿ä½“éªŒï¼šhttps://mermaid.live/ 1. ä¸ºä»€ä¹ˆç”¨ Mermaid åœ¨é…åˆ Markdown å†™ç¬”è®°æ—¶ï¼Œæœ€è®©æˆ‘å¤´ç–¼çš„å°±æ˜¯å¦‚ä½•ä»¥æœ€çœæ—¶çœåŠ›çš„æ–¹å¼æ’å…¥æµç¨‹å›¾ã€‚æˆ‘åšè¿‡å¾ˆå¤šå°è¯•ï¼šå¦‚ï¼Œæ‰‹ç»˜ã€ä½¿ç”¨Xmindå¯¼å›¾è½¯ä»¶ã€ProcessOnä¹‹ç±»çš„åœ¨çº¿ç»˜å›¾å·¥å…·ç­‰ã€‚ä½†å®ƒä»¬éƒ½æœ‰æœ€æ˜¾è‘—çš„ç¼ºç‚¹ï¼šæœ€ç»ˆä»¥å›¾åƒå½¢å¼å¯¼å…¥æ–‡æ¡£ï¼Œå› æ­¤ä¿®æ”¹å’Œå¯¼å‡ºéžå¸¸ç¹çã€‚ è€Œ Mermaid å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªè¯´è¿‘ä¹Žå®Œç¾Žçš„æ–¹æ¡ˆï¼ é«˜æ•ˆæ˜“ç”¨ å®ƒç›´æŽ¥åœ¨ Markdown ä¸­ä»¥ä»£ç æ®µçš„å½¢å¼åˆ›å»ºå’Œä¿®æ”¹å›¾è¡¨ï¼Œå¹¶å®žæ—¶æ¸²æŸ“ä¸º Svg è§†å›¾ï¼Œå¯ä»¥é«˜æ•ˆåˆ¶ä½œç®€æ˜“çš„æµç¨‹å›¾ã€‚å¹¶ä¸”éšæ—¶ä¿®æ”¹ã€ç«‹å³å¯è§ã€‚ å®ƒå’Œ Markdown ä¸€æ ·éƒ½æ˜¯çº¯æ–‡æœ¬æ ¼å¼å­˜å‚¨çš„è¯­è¨€ï¼Œæ˜“äºŽä¿å­˜å’Œåˆ†äº«ã€‚ Webå‹å¥½ å®ƒä¸å—åˆ¶äºŽç‰¹å®šç¼–è¾‘å™¨ï¼Œå¤§éƒ¨åˆ†æ”¯æŒ Markdown çš„ç¼–è¾‘å™¨éƒ½æ”¯æŒ Mermaidã€‚ å®ƒåŸºäºŽ Javascriptï¼Œå¯é›†æˆåµŒå…¥å‰ç«¯æ¡†æž¶ï¼Œå¦‚ Vueã€Hexoç­‰ã€‚ 2. Mermaid ç”¨æ³•Mermaid å¯ç»˜åˆ¶æµç¨‹å›¾ã€æ—¶åºå›¾ã€Gitå›¾ã€ç±»å›¾ã€é¥¼å›¾ã€ç”˜ç‰¹å›¾ç­‰å›¾è¡¨ï¼Œè¯¦ç»†å¯æŸ¥é˜… å®˜æ–¹æ–‡æ¡£ã€‚ä¸‹é¢ä»¥æˆ‘å¸¸ç”¨çš„ä¸¤ä¸ªæµç¨‹å›¾æ¨¡ç‰ˆä½œä¸ºç¤ºä¾‹ï¼ˆä¸»è¦å±•ç¤ºæ ·å¼çš„ä¸¤ç§ä½¿ç”¨æ–¹æ³•ï¼‰ï¼š åŸºç¡€ï¼ˆä½¿ç”¨åŸºæœ¬æ ·å¼ï¼‰ graph LR T((\"Title\")):::p T ==> A([\"Pink\"]):::p T --> B([\"Green\"]):::g T --> C([\"Blue\"]):::b A -.-> a(\"light Pink\"):::lp B -.-> b(\"light Green\"):::lg C -.-> c(\"light Blue\"):::lb a -.- info[\"Info\"]:::info classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px graph LR T((&quot;Title&quot;)):::p T ==&gt; A([&quot;Pink&quot;]):::p T --&gt; B([&quot;Green&quot;]):::g T --&gt; C([&quot;Blue&quot;]):::b A -.-&gt; a(&quot;light Pink&quot;):::lp B -.-&gt; b(&quot;light Green&quot;):::lg C -.-&gt; c(&quot;light Blue&quot;):::lb a -.- info[&quot;Info&quot;]:::info%% æ ·å¼ï¼š style T color:#fff classDef p fill:#ddaebd classDef b fill:#aab7d2 classDef g fill:#9ac5bb classDef lp fill:#f4e4e9 classDef lb fill:#d9dfeb classDef lg fill:#ddebe6 classDef info fill:#f6f6f7,color:#737379,stroke-dasharray: 3 3, stroke-width: 2px è¿›é˜¶ï¼ˆä½¿ç”¨é¢„åŠ è½½æ ·å¼ï¼‰ %%{ init: { 'themeVariables': { 'fontFamily': 'Noto Serif SC', 'mainBkg': '#f4e4e9', 'edgeLabelBackground': '#ddebe6' } } }%% graph TD T((\"Title\")):::pink T --> A A -.-> |\"text2\"| B subgraph \"subgraph\" A --> |\"text3\"|C:::lb end classDef pink fill:#ddaebd style B fill:#d9dfeb, stroke:#657eae,stroke-width:3px,stroke-dasharray: 5 3 %%&#123; init: &#123; &#x27;themeVariables&#x27;: &#123; &#x27;fontFamily&#x27;: &#x27;Noto Serif SC&#x27;, &#x27;mainBkg&#x27;: &#x27;#f4e4e9&#x27;, &#x27;edgeLabelBackground&#x27;: &#x27;#ddebe6&#x27; &#125; &#125;&#125;%%graph TDT((&quot;Title&quot;)):::pinkT --&gt; AA -.-&gt; |&quot;text2&quot;| Bsubgraph &quot;subgraph&quot;A --&gt; |&quot;text3&quot;|C:::lbendclassDef pink fill:#ddaebdstyle B fill:#d9dfeb, stroke:#657eae,stroke-width:3px,stroke-dasharray: 5 3 3. Hexo + Mermaid æ’ä»¶ ä»£ç ä»“åº“: https://github.com/webappdevelp/hexo-filter-mermaid-diagrams ï¼ˆ1ï¼‰å®‰è£…æ’ä»¶$ yarn add hexo-filter-mermaid-diagrams æˆ– $ npm install hexo-filter-mermaid-diagrams ï¼ˆ2ï¼‰ç¼–è¾‘é…ç½®å®‰è£…å®ŒæˆåŽï¼Œç¼–è¾‘hexoé…ç½®æ–‡ä»¶ï¼šconfig.yml # mermaid chartmermaid: enable: true version: &quot;7.1.2&quot; options: ï¼ˆ3ï¼‰æ·»åŠ è„šæœ¬ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åŽï¼Œç¼–è¾‘åšå®¢é¡µé¢ç»„ä»¶çš„footeréƒ¨åˆ†ã€‚è¿™æ˜¯ä¸ºäº†å°† mermaid.js ä»¥ script å½¢å¼æ’å…¥åˆ° html å°¾éƒ¨ï¼Œä½¿å…¶èƒ½æ­£å¸¸æ¸²æŸ“ã€‚ footeræ–‡ä»¶å¦‚ï¼Œfooter.pugï¼Œ after_footer.pug , after-footer.ejs æˆ– swigï¼Œè¯¥æ–‡ä»¶é€šå¸¸å­˜æ”¾åœ¨ä¸»é¢˜ç›®å½•ä¸‹çš„layoutç›®å½•ä¸­ã€‚ è‹¥åšå®¢ä½¿ç”¨pugæ¨¡ç‰ˆå¼•æ“Žæ¸²æŸ“ï¼Œåœ¨ after_footer.pugæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç : if theme.mermaid.enable == true script(type=&#x27;text/javascript&#x27;, id=&#x27;maid-script&#x27; mermaidoptioins=theme.mermaid.options src=&#x27;https://unpkg.com/mermaid@&#x27;+ theme.mermaid.version + &#x27;/dist/mermaid.min.js&#x27; + &#x27;?v=&#x27; + theme.version) script. if (window.mermaid) &#123; var options = JSON.parse(document.getElementById(&#x27;maid-script&#x27;).getAttribute(&#x27;mermaidoptioins&#x27;)); mermaid.initialize(options); &#125; è‹¥ä½¿ç”¨ejså¼•æ“Žæ¸²æŸ“ï¼Œåˆ™åœ¨after-footer.ejsæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š &lt;% if (theme.mermaid.enable) &#123; %&gt; &lt;script src=&#x27;https://unpkg.com/mermaid@&lt;%= theme.mermaid.version %&gt;/dist/mermaid.min.js&#x27;&gt;&lt;/script&gt; &lt;script&gt; if (window.mermaid) &#123; mermaid.initialize(&#123;theme: &#x27;neutral&#x27;&#125;); &#125; &lt;/script&gt;&lt;% &#125; %&gt; swigæ¨¡ç‰ˆå¼•æ“Žï¼š &#123;% if theme.mermaid.enable %&#125; &lt;script src=&#x27;https://unpkg.com/mermaid@&#123;&#123; theme.mermaid.version &#125;&#125;/dist/mermaid.min.js&#x27;&gt;&lt;/script&gt; &lt;script&gt; if (window.mermaid) &#123; mermaid.initialize(&#123;&#123; JSON.stringify(theme.mermaid.options) &#125;&#125;); &#125; &lt;/script&gt;&#123;% endif %&#125; ï¼ˆ4ï¼‰è¸©å‘ä»¥ä¸Šä¸ºå®˜æ–¹æ–‡æ¡£ä¸­çš„é…ç½®æ–¹æ³•ï¼Œè€Œæˆ‘åœ¨åˆæ¬¡é…ç½®çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜é‡åˆ°ä»¥ä¸‹é—®é¢˜å¯ä¾›å‚è€ƒï¼š htmlé¡µé¢ä¸­ï¼Œmermaidæ®µè½ä»…æ˜¾ç¤ºä¸ºä»£ç å—ï¼Œå¼€å‘è€…å·¥å…·ä¸­è¯¥æ®µè½ä¸ºæ™®é€šæºä»£ç ã€‚ è¿™æ˜¯å› ä¸ºæ’ä»¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œåº”ç¡®ä¿æ­£ç¡®å®Œæˆä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ï¼ˆå®‰è£…æ’ä»¶ã€æ‰“å¼€é…ç½®ï¼‰ã€‚ htmlé¡µé¢ä¸­ï¼Œmermaidæ®µè½æ˜¾ç¤ºä¸ºç©ºç™½å›¾ç‰‡ï¼Œå¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹è¯¥æ®µè½ä¸ºsvgæ–‡ä»¶ï¼ŒæŽ§åˆ¶å°æŠ¥é”™ï¼š Uncaught TypeError: Cannot read properties of null (readingâ€™mermaidâ€™)ã€‚ æ­¤æ—¶æ’ä»¶å·²ç»ç”Ÿæ•ˆï¼Œè€Œjsä»£ç æ–‡ä»¶å¼•å…¥æœ‰è¯¯ï¼Œæ— æ³•æˆåŠŸæ¸²æŸ“ã€‚ ç»§ç»­æŸ¥çœ‹htmlä»£ç å‘çŽ°ï¼Œæ–‡ä»¶åº•éƒ¨çš„&lt;sctipt&gt;æ ‡ç­¾ä¸­ï¼Œæ˜¾ç¤ºæˆ‘å¼•å…¥mermaidçš„urlä¸ºï¼š &lt;script type=&quot;text/javascript&quot; id=&quot;maid-script&quot; src=&quot;https://unpkg.com/mermaid@10.0.2/dist/mermaid.min.js?v=undefined&quot;&gt;&lt;/script&gt; è¿™æ®µä»£ç æ˜¯ç”±å®˜æ–¹æä¾›çš„è„šæœ¬ã€åœ¨footeræ–‡ä»¶ä¸­æ ¹æ®ç”¨æˆ·çš„é…ç½®ç»„åˆæˆçš„ï¼š script(type=&#x27;text/javascript&#x27;, id=&#x27;maid-script&#x27; mermaidoptioins=theme.mermaid.options src=&#x27;https://unpkg.com/mermaid@&#x27;+ theme.mermaid.version + &#x27;/dist/mermaid.min.js&#x27; + &#x27;?v=&#x27; + theme.version) å¦‚æžœé…ç½®æœ‰è¯¯åˆ™ä¼šç”Ÿæˆé”™è¯¯çš„urlï¼Œçœ‹èµ·æ¥æ˜¯versionçš„é—®é¢˜ï¼ŒäºŽæ˜¯æˆ‘å°†urlæ”¹ä¸ºç›´æŽ¥å¼•å…¥jsdelivrä¸Šçš„èµ„æºï¼Œé‚èƒ½æ­£å¸¸æ¸²æŸ“ï¼š src=&#x27;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js&#x27;)","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://equnee.github.io/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"Mermaid","slug":"Mermaid","permalink":"https://equnee.github.io/tags/Mermaid/"},{"name":"Markdown","slug":"Markdown","permalink":"https://equnee.github.io/tags/Markdown/"}]}],"categories":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"https://equnee.github.io/categories/Java%E5%9F%BA%E7%A1%80/"},{"name":"æ•°æ®ç»“æž„","slug":"æ•°æ®ç»“æž„","permalink":"https://equnee.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://equnee.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://equnee.github.io/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://equnee.github.io/tags/Java/"},{"name":"I/O","slug":"I-O","permalink":"https://equnee.github.io/tags/I-O/"},{"name":"HashMap","slug":"HashMap","permalink":"https://equnee.github.io/tags/HashMap/"},{"name":"Chain","slug":"Chain","permalink":"https://equnee.github.io/tags/Chain/"},{"name":"singleton","slug":"singleton","permalink":"https://equnee.github.io/tags/singleton/"},{"name":"windows","slug":"windows","permalink":"https://equnee.github.io/tags/windows/"},{"name":"Mac","slug":"Mac","permalink":"https://equnee.github.io/tags/Mac/"},{"name":"Mermaid","slug":"Mermaid","permalink":"https://equnee.github.io/tags/Mermaid/"},{"name":"Markdown","slug":"Markdown","permalink":"https://equnee.github.io/tags/Markdown/"}]}